<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZMMRP0070_SCREEN8000</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMRP0070_SCREEN8000</h2>
<h3> Description: Include ZMMRP0070_SCREEN8000</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*----------------------------------------------------------------------*<br />
***INCLUDE&nbsp;ZMMRP0070_SCREEN8000.<br />
*----------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Module&nbsp;&nbsp;STATUS_8000&nbsp;&nbsp;OUTPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
MODULE STATUS_8000 OUTPUT.<br />
&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'STANDARD'.<br />
&nbsp;&nbsp;SET&nbsp;TITLEBAR&nbsp;&nbsp;'TITLE_8000'.<br />
ENDMODULE.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Module&nbsp;&nbsp;USER_COMMAND_8000&nbsp;&nbsp;INPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
MODULE USER_COMMAND_8000 INPUT.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_CODE&nbsp;LIKE&nbsp;OK_CODE.<br />
<br />
&nbsp;&nbsp;L_CODE&nbsp;=&nbsp;OK_CODE.<br />
&nbsp;&nbsp;CLEAR&nbsp;OK_CODE.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;L_CODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&F03'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&F15'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;PROGRAM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SAVE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_POST.<br />
&nbsp;&nbsp;ENDCASE.<br />
ENDMODULE.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&CLASS&nbsp;定义<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
CLASS LCL_EVENT_RECEIVER DEFINITION.<br />
&nbsp;&nbsp;PUBLIC&nbsp;SECTION.<br />
&nbsp;&nbsp;&nbsp;&nbsp;METHODS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE_TOOLBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;EVENT&nbsp;TOOLBAR&nbsp;OF&nbsp;CL_GUI_ALV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_OBJECT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE_USER_COMMAND&nbsp;FOR&nbsp;EVENT&nbsp;USER_COMMAND&nbsp;OF&nbsp;CL_GUI_ALV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_UCOMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE_ENTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;EVENT&nbsp;DATA_CHANGED_FINISHED&nbsp;OF&nbsp;CL_GUI_ALV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_MODIFIED<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_GOOD_CELLS.<br />
ENDCLASS.<br />
<br />
CLASS LCL_EVENT_RECEIVER2 DEFINITION.<br />
&nbsp;&nbsp;PUBLIC&nbsp;SECTION.<br />
&nbsp;&nbsp;&nbsp;&nbsp;METHODS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE_TOOLBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;EVENT&nbsp;TOOLBAR&nbsp;OF&nbsp;CL_GUI_ALV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_OBJECT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE_USER_COMMAND&nbsp;FOR&nbsp;EVENT&nbsp;USER_COMMAND&nbsp;OF&nbsp;CL_GUI_ALV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_UCOMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE_ENTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;EVENT&nbsp;DATA_CHANGED_FINISHED&nbsp;OF&nbsp;CL_GUI_ALV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_MODIFIED<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_GOOD_CELLS.<br />
ENDCLASS.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&CLASS&nbsp;实现<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
CLASS LCL_EVENT_RECEIVER IMPLEMENTATION.<br />
   </div>
   <div class="codeComment">
*&nbsp;修改工具栏<br />
   </div>
   <div class="code">
&nbsp;&nbsp;METHOD&nbsp;HANDLE_TOOLBAR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_SET_TOOLBAR&nbsp;USING&nbsp;'T'&nbsp;CHANGING&nbsp;E_OBJECT&nbsp;.<br />
&nbsp;&nbsp;ENDMETHOD.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"HANDLE_TOOLBAR<br />
   </div>
   <div class="codeComment">
*&nbsp;响应用户命令<br />
   </div>
   <div class="code">
&nbsp;&nbsp;METHOD&nbsp;HANDLE_USER_COMMAND.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_USER_COMMAND&nbsp;USING&nbsp;'T'&nbsp;E_UCOMM.<br />
&nbsp;&nbsp;ENDMETHOD.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"HANDLE_USER_COMMAND<br />
   </div>
   <div class="codeComment">
*&nbsp;响应回车事件<br />
   </div>
   <div class="code">
&nbsp;&nbsp;METHOD&nbsp;HANDLE_ENTER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_HANDLE_ENTER&nbsp;USING&nbsp;'T'&nbsp;E_MODIFIED&nbsp;ET_GOOD_CELLS.<br />
&nbsp;&nbsp;ENDMETHOD.<br />
ENDCLASS.                    "LCL_EVENT_RECEIVER IMPLEMENTATION<br />
<br />
CLASS LCL_EVENT_RECEIVER2 IMPLEMENTATION.<br />
   </div>
   <div class="codeComment">
*&nbsp;修改工具栏<br />
   </div>
   <div class="code">
&nbsp;&nbsp;METHOD&nbsp;HANDLE_TOOLBAR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_SET_TOOLBAR&nbsp;USING&nbsp;'B'&nbsp;CHANGING&nbsp;E_OBJECT.<br />
&nbsp;&nbsp;ENDMETHOD.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"HANDLE_TOOLBAR<br />
   </div>
   <div class="codeComment">
*&nbsp;响应用户命令<br />
   </div>
   <div class="code">
&nbsp;&nbsp;METHOD&nbsp;HANDLE_USER_COMMAND.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_USER_COMMAND&nbsp;USING&nbsp;'B'&nbsp;E_UCOMM.<br />
&nbsp;&nbsp;ENDMETHOD.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"HANDLE_USER_COMMAND<br />
   </div>
   <div class="codeComment">
*&nbsp;响应回车事件<br />
   </div>
   <div class="code">
&nbsp;&nbsp;METHOD&nbsp;HANDLE_ENTER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_HANDLE_ENTER&nbsp;USING&nbsp;'B'&nbsp;E_MODIFIED&nbsp;ET_GOOD_CELLS.<br />
&nbsp;&nbsp;ENDMETHOD.<br />
ENDCLASS.                    "LCL_EVENT_RECEIVER IMPLEMENTATION<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Module&nbsp;&nbsp;M_INIT_ALV&nbsp;&nbsp;OUTPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;初始化ALV<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
MODULE M_INIT_ALV OUTPUT.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_SET_VISIBLE&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;如果容器为空<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;GO_CONTAINER_TOP&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_CONTAINER_TOP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;'CONTAINER_TOP'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GO_CONTAINER_BUTTOM&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_CONTAINER_BUTTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;'CONTAINER_BUTTOM'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;如果ALV对象为空，则生成<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;GO_ALV_TOP&nbsp;IS&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;实例化该ALV对象<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_ALV_TOP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;GO_CONTAINER_TOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;ALV显示<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_DISPLAY_ALV1.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;底部ALV<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;GO_ALV_BUTTOM&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_ALV_BUTTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;GO_CONTAINER_BUTTOM.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;ALV显示<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_DISPLAY_ALV2.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDMODULE.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&ALV显示<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_DISPLAY_ALV1.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LO_EVENT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;LCL_EVENT_RECEIVER,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT&nbsp;TYPE&nbsp;LVC_S_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_FIELDCAT&nbsp;TYPE&nbsp;LVC_T_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_LAYOUT&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_LAYO.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;宏<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DEFINE&nbsp;DF_ADD_FIELDCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_FIELDCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"列位置<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"要显示的字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"字段名<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-JUST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"对齐方式<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"可编辑<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用表<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&7.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&2&nbsp;=&nbsp;'CB'&nbsp;OR&nbsp;&2&nbsp;=&nbsp;'ZSYLZL'&nbsp;OR&nbsp;&2&nbsp;=&nbsp;'JSJE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-DO_SUM&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&2&nbsp;=&nbsp;'BWART'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-TECH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&2&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-QFIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_FIELDCAT&nbsp;TO&nbsp;LT_FIELDCAT.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;STEP1:创建FIELDCAT<br />
*&nbsp;固定部分<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DF_ADD_FIELDCAT:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;'ZEILE'&nbsp;&nbsp;TEXT-001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;''&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;'MATNR'&nbsp;&nbsp;TEXT-002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'MATNR'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;'CHARG'&nbsp;&nbsp;TEXT-003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'CHARG'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;'MENGE'&nbsp;&nbsp;TEXT-004&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'MENGE'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;'MEINS'&nbsp;&nbsp;TEXT-005&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'MEINS'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;'WERKS'&nbsp;&nbsp;TEXT-006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'WERKS'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;'LGORT'&nbsp;&nbsp;TEXT-007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'LGORT'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;'CB&nbsp;&nbsp;&nbsp;'&nbsp;&nbsp;TEXT-008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'DMBTR'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;'JSFS&nbsp;'&nbsp;&nbsp;TEXT-009&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;''&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;'LIFNR'&nbsp;&nbsp;TEXT-010&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'LFA1'&nbsp;&nbsp;'LIFNR'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;'SGTXT'&nbsp;&nbsp;TEXT-011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'SGTXT'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;'GRUND'&nbsp;&nbsp;TEXT-012&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'GRUND'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13&nbsp;&nbsp;'SOBKZ'&nbsp;&nbsp;TEXT-013&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'SOBKZ'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;&nbsp;'BWART'&nbsp;&nbsp;TEXT-013&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'BWART'&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z61'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DF_ADD_FIELDCAT:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;&nbsp;&nbsp;'JSJE'&nbsp;&nbsp;&nbsp;TEXT-014&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;'MSEG'&nbsp;&nbsp;'MENGE'&nbsp;.<br />
&nbsp;&nbsp;ELSEIF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z71'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DF_ADD_FIELDCAT:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;'JZ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT-015&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;'MSEG'&nbsp;&nbsp;'MENGE'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;'JS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT-019&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;''&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;'GJSCZ'&nbsp;&nbsp;TEXT-016&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;''&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17&nbsp;&nbsp;&nbsp;'ZSYL'&nbsp;&nbsp;&nbsp;TEXT-017&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;''&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;'ZSYLZL'&nbsp;TEXT-018&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;''&nbsp;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;LW_LAYOUT-CWIDTH_OPT&nbsp;=&nbsp;ABAP_TRUE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"优化列宽设置<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LW_LAYOUT-SEL_MODE&nbsp;&nbsp;&nbsp;=&nbsp;'D'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"选择方式<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;显示ALV<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_OUT_TAB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;LT_FIELDCAT.<br />
   </div>
   <div class="codeComment">
*&nbsp;事件注册<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;LO_EVENT.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;LO_EVENT-&gt;HANDLE_USER_COMMAND&nbsp;FOR&nbsp;GO_ALV_TOP.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;LO_EVENT-&gt;HANDLE_TOOLBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;GO_ALV_TOP.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;LO_EVENT-&gt;HANDLE_ENTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;GO_ALV_TOP.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;SET_TOOLBAR_INTERACTIVE.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&ALV显示<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_DISPLAY_ALV2.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LO_EVENT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;LCL_EVENT_RECEIVER2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT&nbsp;TYPE&nbsp;LVC_S_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_FIELDCAT&nbsp;TYPE&nbsp;LVC_T_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_LAYOUT&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_LAYO.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;宏<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DEFINE&nbsp;DF_ADD_FIELDCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_FIELDCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"列位置<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"要显示的字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"字段名<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-JUST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"对齐方式<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"可编辑<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用表<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&7.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&2&nbsp;=&nbsp;'CB'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-DO_SUM&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&2&nbsp;=&nbsp;'BWART'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-TECH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&2&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FIELDCAT-QFIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_FIELDCAT&nbsp;TO&nbsp;LT_FIELDCAT.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;STEP1:创建FIELDCAT<br />
*&nbsp;固定部分<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DF_ADD_FIELDCAT:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;'ZEILE'&nbsp;&nbsp;TEXT-001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;''&nbsp;''&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;'MATNR'&nbsp;&nbsp;TEXT-002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'MATNR'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;'CHARG'&nbsp;&nbsp;TEXT-003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;'MENGE'&nbsp;&nbsp;TEXT-004&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'MENGE'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;'MEINS'&nbsp;&nbsp;TEXT-005&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'MEINS'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;'WERKS'&nbsp;&nbsp;TEXT-006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'WERKS'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;'LGORT'&nbsp;&nbsp;TEXT-007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'LGORT'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;'CB&nbsp;&nbsp;&nbsp;'&nbsp;&nbsp;TEXT-008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'DMBTR'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;'SGTXT'&nbsp;&nbsp;TEXT-011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'SGTXT'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;'GRUND'&nbsp;&nbsp;TEXT-012&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'GRUND'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13&nbsp;&nbsp;'SOBKZ'&nbsp;&nbsp;TEXT-013&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'SOBKZ'&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;&nbsp;'BWART'&nbsp;&nbsp;TEXT-014&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'L'&nbsp;'X'&nbsp;'MSEG'&nbsp;&nbsp;'BWART'&nbsp;.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;LW_LAYOUT-CWIDTH_OPT&nbsp;=&nbsp;ABAP_TRUE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"优化列宽设置<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LW_LAYOUT-SEL_MODE&nbsp;&nbsp;&nbsp;=&nbsp;'D'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"选择方式<br />
   </div>
   <div class="codeComment">
*&nbsp;显示ALV<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_BUTTOM-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_OUT_TAB2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;LT_FIELDCAT.<br />
   </div>
   <div class="codeComment">
*&nbsp;事件注册<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;LO_EVENT.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;LO_EVENT-&gt;HANDLE_USER_COMMAND&nbsp;FOR&nbsp;GO_ALV_BUTTOM.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;LO_EVENT-&gt;HANDLE_TOOLBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;GO_ALV_BUTTOM.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;LO_EVENT-&gt;HANDLE_ENTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;GO_ALV_BUTTOM.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_BUTTOM-&gt;SET_TOOLBAR_INTERACTIVE.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_BUTTOM-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&设定工具栏<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_SET_TOOLBAR USING I_TYPE CHANGING C_OBJECT TYPE REF TO CL_ALV_EVENT_TOOLBAR_SET.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TOOLBAR&nbsp;TYPE&nbsp;STB_BUTTON.<br />
<br />
&nbsp;&nbsp;DEFINE&nbsp;ADD_TOOLBAR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TOOLBAR-FUNCTION&nbsp;&nbsp;&nbsp;=&nbsp;&1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TOOLBAR-ICON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TOOLBAR-QUICKINFO&nbsp;&nbsp;=&nbsp;&3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TOOLBAR-DISABLED&nbsp;&nbsp;&nbsp;=&nbsp;&4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TOOLBAR&nbsp;TO&nbsp;C_OBJECT-&gt;MT_TOOLBAR&nbsp;.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
   </div>
   <div class="codeComment">
*&nbsp;删除没用的按钮<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DELETE&nbsp;C_OBJECT-&gt;MT_TOOLBAR&nbsp;WHERE&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&DETAIL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&SORT_ASC&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&SORT_DSC&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&FIND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&FIND_MORE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&MB_SUM&nbsp;&nbsp;&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&MB_SUBTOT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&MB_FILTER'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&COL0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;FUNCTION&nbsp;&lt;&gt;&nbsp;'&GRAPH&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;新增自定义按钮<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;I_TYPE&nbsp;=&nbsp;'T'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD_TOOLBAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'TADD'&nbsp;&nbsp;&nbsp;&nbsp;'@17@'&nbsp;&nbsp;&nbsp;'新增行'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'TDEL'&nbsp;&nbsp;&nbsp;&nbsp;'@18@'&nbsp;&nbsp;&nbsp;'删除行'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'TDOWN'&nbsp;&nbsp;&nbsp;'@49@'&nbsp;&nbsp;&nbsp;'模板下载'&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'TUP'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'@48@'&nbsp;&nbsp;&nbsp;'导入'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'TREFRESH'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'@42@'&nbsp;&nbsp;&nbsp;'根据物料、批次、地点、数量取得批次相关信息'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD_TOOLBAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'BADD'&nbsp;&nbsp;&nbsp;&nbsp;'@17@'&nbsp;&nbsp;&nbsp;'新增行'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'BDEL'&nbsp;&nbsp;&nbsp;&nbsp;'@18@'&nbsp;&nbsp;&nbsp;'删除行'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'BDOWN'&nbsp;&nbsp;&nbsp;'@49@'&nbsp;&nbsp;&nbsp;'模板下载'&nbsp;&nbsp;&nbsp;'',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'BUP'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'@48@'&nbsp;&nbsp;&nbsp;'导入'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " SET_TOOLBAR1<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&设定用户响应事件<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_USER_COMMAND USING I_TYPE I_UCOMM TYPE SY-UCOMM.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZEILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MBLPO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT_TAB1&nbsp;TYPE&nbsp;TYT_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT_TAB2&nbsp;TYPE&nbsp;TYT_OUT_TAB2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;TYPE&nbsp;TY_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2&nbsp;TYPE&nbsp;TY_OUT_TAB2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STRING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ROWS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_T_ROW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ROWS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW.<br />
&nbsp;&nbsp;CASE&nbsp;I_UCOMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'TDEL'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取选中行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;GET_SELECTED_ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROWS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ROWS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'没有选中任何数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;删除<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_ROWS&nbsp;BY&nbsp;INDEX&nbsp;DESCENDING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROWS&nbsp;INTO&nbsp;LW_ROWS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_ROWS-INDEX&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB1&nbsp;INDEX&nbsp;LW_ROWS-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'TDOWN'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取路径<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_FILEPATH&nbsp;USING&nbsp;L_PATH&nbsp;'批量库存处理导入模板(上)'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_PATH&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'用户取消'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;模板下载<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_TEMPLATE&nbsp;USING&nbsp;'ZMMRP0070_TOP'&nbsp;L_PATH.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'TUP'.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取路径<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_EXCEL_FILEPATH&nbsp;USING&nbsp;L_PATH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_PATH&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'用户取消'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上传<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_READ_EXCEL2&nbsp;USING&nbsp;L_PATH&nbsp;LT_OUT_TAB1.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取批次信息<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_INFO&nbsp;USING&nbsp;LT_OUT_TAB1.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取最大项目编号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ZEILE&nbsp;USING&nbsp;L_ZEILE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编辑数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZEILE&nbsp;=&nbsp;L_ZEILE&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-ZEILE&nbsp;=&nbsp;L_ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-BWART&nbsp;=&nbsp;ZMMRP0070_HEAD-BWART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_OUT_TAB1&nbsp;TO&nbsp;GT_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'TADD'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取最大项目编号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ZEILE&nbsp;USING&nbsp;L_ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-ZEILE&nbsp;=&nbsp;L_ZEILE&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-SOBKZ&nbsp;=&nbsp;P_SOBKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-SGTXT&nbsp;=&nbsp;P_SGTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-GRUND&nbsp;=&nbsp;P_GRUND.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-BWART&nbsp;=&nbsp;ZMMRP0070_HEAD-BWART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_OUT_TAB1&nbsp;TO&nbsp;GT_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'TREFRESH'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取选中行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;GET_SELECTED_ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROWS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ROWS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'没有选中任何数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;放入内表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_ROWS&nbsp;BY&nbsp;INDEX&nbsp;DESCENDING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROWS&nbsp;INTO&nbsp;LW_ROWS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_ROWS-INDEX&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1&nbsp;INDEX&nbsp;LW_ROWS-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_OUT_TAB1&nbsp;TO&nbsp;LT_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_INFO&nbsp;USING&nbsp;LT_OUT_TAB1.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;更新信息到内表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1&nbsp;WITH&nbsp;KEY&nbsp;ZEILE&nbsp;=&nbsp;LW_OUT_TAB1-ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_OUT_TAB1&nbsp;FROM&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BADD'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_DISPLAY&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取最大项目编号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ZEILE&nbsp;USING&nbsp;L_ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2-ZEILE&nbsp;=&nbsp;L_ZEILE&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2-SOBKZ&nbsp;=&nbsp;P_SOBKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2-SGTXT&nbsp;=&nbsp;P_SGTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2-GRUND&nbsp;=&nbsp;P_GRUND.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2-BWART&nbsp;=&nbsp;ZMMRP0070_HEAD-BWARTCC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_OUT_TAB2&nbsp;TO&nbsp;GT_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BDEL'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_DISPLAY&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取选中行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_BUTTOM-&gt;GET_SELECTED_ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROWS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ROWS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'没有选中任何数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;删除<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_ROWS&nbsp;BY&nbsp;INDEX&nbsp;DESCENDING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROWS&nbsp;INTO&nbsp;LW_ROWS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_ROWS-INDEX&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB2&nbsp;INDEX&nbsp;LW_ROWS-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BDOWN'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_DISPLAY&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取路径<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_FILEPATH&nbsp;USING&nbsp;L_PATH&nbsp;'批量库存处理导入模板(下)'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_PATH&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'用户取消'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;模板下载<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_TEMPLATE&nbsp;USING&nbsp;'ZMMRP0070_BUTTOM'&nbsp;L_PATH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BUP'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_DISPLAY&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWARTCC&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先输入产出移动类型'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取路径<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_EXCEL_FILEPATH&nbsp;USING&nbsp;L_PATH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_PATH&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'用户取消'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上传<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;G_ERROR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_READ_EXCEL2&nbsp;USING&nbsp;L_PATH&nbsp;LT_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;获取最大项目编号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ZEILE&nbsp;USING&nbsp;L_ZEILE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编辑数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT_TAB2&nbsp;INTO&nbsp;LW_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZEILE&nbsp;=&nbsp;L_ZEILE&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2-ZEILE&nbsp;=&nbsp;L_ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2-BWART&nbsp;=&nbsp;ZMMRP0070_HEAD-BWARTCC.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单位<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_CUNIT_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIT_NOT_FOUND&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_OUT_TAB2&nbsp;TO&nbsp;GT_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;ENDCASE.<br />
   </div>
   <div class="codeComment">
*&nbsp;刷新内表到屏幕<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_REFRESH_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Module&nbsp;&nbsp;M_BARCODE_ENTER&nbsp;&nbsp;INPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;处理barcode回车<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
MODULE M_BARCODE_ENTER INPUT.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_ENTER.<br />
ENDMODULE.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&回车<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_ENTER.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_COL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_COL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_CHARG&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARG_CHARACTERS&nbsp;TYPE&nbsp;ZMM_CHARG_CHARACTERS&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_CHARG_CHARACTERS&nbsp;TYPE&nbsp;ZMM_CHARG_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZEILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MBLPO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT_TAB1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TYT_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_INFO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_BARCODE_INFO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_INFO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_BARCODE_INFO&nbsp;OCCURS&nbsp;0.<br />
&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT_TAB1&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_INFO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_INFO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BARCODE&nbsp;IS&nbsp;INITIAL<br />
&nbsp;&nbsp;OR&nbsp;OK_CODE&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;BARCODE&nbsp;=&nbsp;ZMMRP0070_HEAD-BARCODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该条码/包码对应的批次已存在'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;获取barcode对应的批次信息<br />
   </div>
   <div class="code">
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_get_barcode_info/zmm_get_barcode_info.html">'ZMM_GET_BARCODE_INFO'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BARCODE&nbsp;=&nbsp;ZMMRP0070_HEAD-BARCODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_INFO&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_INFO.<br />
&nbsp;&nbsp;IF&nbsp;LT_INFO&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'条码/包码对应的批次不存在'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;检查：批次必须存在于指定库位<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-WERKSYC&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_INFO&nbsp;WHERE&nbsp;WERKS&nbsp;&lt;&gt;&nbsp;ZMMRP0070_HEAD-WERKSYC.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-LGORTYC&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_INFO&nbsp;WHERE&nbsp;LGORT&nbsp;&lt;&gt;&nbsp;ZMMRP0070_HEAD-LGORTYC.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LT_INFO&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该条码/包码对应的批次在'&nbsp;ZMMRP0070_HEAD-WERKSYC&nbsp;&&&nbsp;'地点'&nbsp;ZMMRP0070_HEAD-LGORTYC&nbsp;'库存地点不存在'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;检查：库存不能为0<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DELETE&nbsp;LT_INFO&nbsp;WHERE&nbsp;LABST&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;IF&nbsp;LT_INFO&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该条码/包码对应的批次在'&nbsp;ZMMRP0070_HEAD-WERKSYC&nbsp;&&&nbsp;'地点'&nbsp;ZMMRP0070_HEAD-LGORTYC&nbsp;'库存地点库存数量为0'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;信息追加到ALV<br />
*&nbsp;获取最大项目编号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ZEILE&nbsp;CHANGING&nbsp;L_ZEILE.<br />
   </div>
   <div class="codeComment">
*&nbsp;追加<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_INFO&nbsp;INTO&nbsp;LW_INFO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZEILE&nbsp;=&nbsp;L_ZEILE&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-ZEILE&nbsp;&nbsp;=&nbsp;L_ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-MATNR&nbsp;&nbsp;=&nbsp;LW_INFO-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-CHARG&nbsp;&nbsp;=&nbsp;LW_INFO-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-MENGE&nbsp;&nbsp;=&nbsp;LW_INFO-LABST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-MEINS&nbsp;&nbsp;=&nbsp;LW_INFO-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-WERKS&nbsp;&nbsp;=&nbsp;LW_INFO-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-LGORT&nbsp;&nbsp;=&nbsp;LW_INFO-LGORT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-BARCODE&nbsp;=&nbsp;LW_INFO-BARCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-SOBKZ&nbsp;=&nbsp;P_SOBKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-SGTXT&nbsp;=&nbsp;P_SGTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-GRUND&nbsp;=&nbsp;P_GRUND.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_OUT_TAB1&nbsp;TO&nbsp;LT_OUT_TAB1.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_INFO&nbsp;USING&nbsp;LT_OUT_TAB1.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;LINES&nbsp;OF&nbsp;LT_OUT_TAB1&nbsp;TO&nbsp;GT_OUT_TAB1.<br />
   </div>
   <div class="codeComment">
*&nbsp;设定滚动条到最后一行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;GET_SCROLL_INFO_VIA_ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ES_ROW_INFO&nbsp;=&nbsp;LW_ROW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ES_COL_INFO&nbsp;=&nbsp;LW_COL.<br />
&nbsp;&nbsp;LW_ROW-INDEX&nbsp;=&nbsp;LINES(&nbsp;GT_OUT_TAB1&nbsp;)&nbsp;-&nbsp;5.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;SET_SCROLL_INFO_VIA_ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_ROW_INFO&nbsp;=&nbsp;LW_ROW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_COL_INFO&nbsp;=&nbsp;LW_COL.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;清掉对应的barcode<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;ZMMRP0070_HEAD-BARCODE.<br />
   </div>
   <div class="codeComment">
*&nbsp;刷新内表到屏幕<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_REFRESH_TABLE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&根据物料、批次更新相关信息<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_INFO USING T_OUT_TAB TYPE TYT_OUT_TAB1.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_ZMMDG0010_GJSCZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJSCZ&nbsp;TYPE&nbsp;ZMMDG0010_GJSCZ-GJSCZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJSBL&nbsp;TYPE&nbsp;ZMMDG0010_GJSCZ-GJSBL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YLBL&nbsp;&nbsp;TYPE&nbsp;ZMMDG0010_GJSCZ-YLBL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_ZMMDG0010_GJSCZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LIANYING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_VERPR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VERPR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_CHARG&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARG_CHARACTERS&nbsp;TYPE&nbsp;ZMM_CHARG_CHARACTERS&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_CHARG_CHARACTERS&nbsp;TYPE&nbsp;ZMM_CHARG_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_OUT_TAB1.<br />
<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;SDM001,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPKH&nbsp;TYPE&nbsp;ZMMDG0010_02-ZSPKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MWSKZ&nbsp;TYPE&nbsp;ZMMDG0010_02-MWSKZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;SDM001.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_SDM&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;SDM001,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_SDM&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SDM001.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;获取批次特性<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;T_OUT_TAB&nbsp;TO&nbsp;LT_CHARG.<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_get_charg_characters/zmm_get_charg_characters.html">'ZMM_GET_CHARG_CHARACTERS'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG_CHARACTERS&nbsp;=&nbsp;LT_CHARG_CHARACTERS.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;信息更新到ALV<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_CHARG_CHARACTERS&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;ATNAM.<br />
<br />
   </div>
   <div class="codeComment">
**************郭悦更新20160308****************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;IT_SDM.<br />
&nbsp;&nbsp;SELECT&nbsp;ZSPKH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MWSKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMDG0010_02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_SDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;T_OUT_TAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZSPKH&nbsp;=&nbsp;T_OUT_TAB-MATNR.<br />
   </div>
   <div class="codeComment">
**************郭悦更新20160308****************<br />
<br />
*&nbsp;追加<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;T_OUT_TAB&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;单位<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_CUNIT_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIT_NOT_FOUND&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;Implement&nbsp;suitable&nbsp;error&nbsp;handling&nbsp;here<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;结算方式<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_CHARG_CHARACTERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_CHARG_CHARACTERS&nbsp;INTO&nbsp;LW_CHARG_CHARACTERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LW_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;LW_OUT_TAB1-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATNAM&nbsp;=&nbsp;'ZLYJSFS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JSFS&nbsp;=&nbsp;LW_CHARG_CHARACTERS-ATWRT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;供应商<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_CHARG_CHARACTERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_CHARG_CHARACTERS&nbsp;INTO&nbsp;LW_CHARG_CHARACTERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LW_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;LW_OUT_TAB1-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATNAM&nbsp;=&nbsp;'ZGYSDM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-LIFNR&nbsp;=&nbsp;LW_CHARG_CHARACTERS-ATWRT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;移动类型Z61时，需要额外字段<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z61'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;结算金额<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_LIANYING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zsd_get_cost_meins/zsd_get_cost_meins.html">'ZSD_GET_COST_MEINS'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_MATNR&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CHARG&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_WERKS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_MENGE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_VERPR&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_VERPR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_LIANYING&nbsp;=&nbsp;L_LIANYING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_LIANYING&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
**************郭悦更新20160308****************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;IT_SDM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_SDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_SDM&nbsp;INTO&nbsp;WA_SDM&nbsp;WITH&nbsp;KEY&nbsp;ZSPKH&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_SDM-MWSKZ&nbsp;=&nbsp;'J1'."J1为17%的税<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JSJE&nbsp;=&nbsp;L_VERPR&nbsp;&nbsp;/&nbsp;117&nbsp;*&nbsp;100."郭悦20160308修改<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_SDM-MWSKZ&nbsp;=&nbsp;'J0'."J0为免税商品<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JSJE&nbsp;=&nbsp;L_VERPR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JSJE&nbsp;=&nbsp;L_VERPR&nbsp;&nbsp;/&nbsp;117&nbsp;*&nbsp;100."郭悦20160308修改<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JSJE&nbsp;=&nbsp;L_VERPR&nbsp;&nbsp;/&nbsp;117&nbsp;*&nbsp;100."郭悦20160308修改<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
**************郭悦更新20160308****************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_OUT_TAB1-JSJE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z71'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;金重<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_CHARG_CHARACTERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_CHARG_CHARACTERS&nbsp;INTO&nbsp;LW_CHARG_CHARACTERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LW_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;LW_OUT_TAB1-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATNAM&nbsp;=&nbsp;'ZJZ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JZ&nbsp;=&nbsp;LW_CHARG_CHARACTERS-ATFLV.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;件数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_OUT_TAB1-MEINS&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JS&nbsp;=&nbsp;LW_OUT_TAB1-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_OUT_TAB1-JZ&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-JS&nbsp;=&nbsp;LW_OUT_TAB1-MENGE&nbsp;/&nbsp;LW_OUT_TAB1-JZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_OUT_TAB1-JS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贵金属材质<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_CHARG_CHARACTERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_CHARG_CHARACTERS&nbsp;INTO&nbsp;LW_CHARG_CHARACTERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LW_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;LW_OUT_TAB1-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATNAM&nbsp;=&nbsp;'ZGJSCZ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-GJSCZ&nbsp;=&nbsp;LW_CHARG_CHARACTERS-ATWRT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;折算原料<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-ZSYL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-ZSYLZL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_OUT_TAB1-GJSCZ&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;GJSCZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJSBL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YLBL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMDG0010_GJSCZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_ZMMDG0010_GJSCZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;GJSCZ&nbsp;=&nbsp;LW_OUT_TAB1-GJSCZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-ZSYL&nbsp;=&nbsp;LW_ZMMDG0010_GJSCZ-MATNR.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;折算原料重量<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_ZMMDG0010_GJSCZ-GJSBL&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-ZSYLZL&nbsp;=&nbsp;LW_OUT_TAB1-JZ&nbsp;*&nbsp;LW_OUT_TAB1-JS&nbsp;*&nbsp;LW_ZMMDG0010_GJSCZ-YLBL&nbsp;/&nbsp;LW_ZMMDG0010_GJSCZ-GJSBL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;T_OUT_TAB&nbsp;FROM&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&内表数据刷新到屏幕<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_REFRESH_TABLE.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_STABLE&nbsp;TYPE&nbsp;LVC_S_STBL.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;刷新成本<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_REFRESH_CB.<br />
   </div>
   <div class="codeComment">
*&nbsp;数据刷新到屏幕<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LW_STABLE-ROW&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LW_STABLE-COL&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;=&nbsp;LW_STABLE.<br />
&nbsp;&nbsp;IF&nbsp;GO_ALV_BUTTOM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_BUTTOM-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;=&nbsp;LW_STABLE.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&刷新成本<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_REFRESH_CB.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_MBEW&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MBEW-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWKEY&nbsp;TYPE&nbsp;MBEW-BWKEY,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWTAR&nbsp;TYPE&nbsp;MBEW-BWTAR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERPR&nbsp;TYPE&nbsp;MBEW-VERPR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LBKUM&nbsp;TYPE&nbsp;MBEW-LBKUM,&nbsp;"库存数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALK3&nbsp;TYPE&nbsp;MBEW-SALK3,&nbsp;"总价<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_MBEW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_OLD_JS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;TYPE&nbsp;TY_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2&nbsp;TYPE&nbsp;TY_OUT_TAB2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MBEW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_MBEW&nbsp;OCCURS&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;取移动平均价<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;GT_OUT_TAB1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWKEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWTAR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERPR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LBKUM&nbsp;&nbsp;&nbsp;"库存数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALK3&nbsp;&nbsp;&nbsp;"总价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_MBEW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MBEW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;GT_OUT_TAB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;GT_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BWKEY&nbsp;=&nbsp;GT_OUT_TAB1-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BWTAR&nbsp;=&nbsp;GT_OUT_TAB1-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_MBEW&nbsp;BY&nbsp;MATNR&nbsp;BWKEY&nbsp;BWTAR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_MBEW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MBEW&nbsp;INTO&nbsp;LW_MBEW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LW_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWKEY&nbsp;=&nbsp;LW_OUT_TAB1-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWTAR&nbsp;=&nbsp;LW_OUT_TAB1-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;小于库存，乘得；等于库存，总成本<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_OUT_TAB1-MENGE&nbsp;&lt;&nbsp;LW_MBEW-LBKUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-CB&nbsp;=&nbsp;LW_MBEW-VERPR&nbsp;*&nbsp;LW_OUT_TAB1-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1-CB&nbsp;=&nbsp;LW_MBEW-SALK3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_OUT_TAB1&nbsp;FROM&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&读取EXCEL内容到任意内表<br />
*&nbsp;I_PATH&nbsp;&nbsp;:&nbsp;Excel文档路径<br />
*&nbsp;O_EXCEL&nbsp;:&nbsp;从EXCEL中获取到的内表数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_READ_EXCEL2 USING I_PATH  O_EXCEL TYPE STANDARD TABLE.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FILE&nbsp;&nbsp;TYPE&nbsp;RLGRAP-FILENAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_LINE&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;DATA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TAB&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ALSMEX_TABLINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB&nbsp;&nbsp;TYPE&nbsp;ALSMEX_TABLINE.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LINE&gt;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;CREATE&nbsp;DATA&nbsp;LW_LINE&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;ASSIGN&nbsp;LW_LINE-&gt;*&nbsp;TO&nbsp;&lt;LINE&gt;.<br />
&nbsp;&nbsp;L_FILE&nbsp;=&nbsp;I_PATH.<br />
&nbsp;&nbsp;TRANSLATE&nbsp;L_FILE&nbsp;TO&nbsp;UPPER&nbsp;CASE.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'ALSM_EXCEL_TO_INTERNAL_TABLE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILENAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_FILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BEGIN_COL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BEGIN_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_END_COL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;250<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_END_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;65536<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTERN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_TAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCONSISTENT_PARAMETERS&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPLOAD_OLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'上传文件有误！'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;LT_TAB&nbsp;WHERE&nbsp;ROW&nbsp;=&nbsp;1.&nbsp;&nbsp;"删除字段名行<br />
<br />
&nbsp;&nbsp;REFRESH:<br />
&nbsp;&nbsp;&nbsp;&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_TAB&nbsp;INTO&nbsp;LW_TAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;CHANGE&nbsp;OF&nbsp;LW_TAB-ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-TABIX&nbsp;NE&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LINE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDON.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;LW_TAB-COL&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;TRY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;=&nbsp;LW_TAB-VALUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;CX_ROOT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'上传文件数据有误'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDTRY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;LAST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;O_EXCEL&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'上传文件为空'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&过账<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_POST.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2&nbsp;TYPE&nbsp;TY_OUT_TAB2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ERR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_CODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPI2017_GM_CODE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR200,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;TYPE&nbsp;TY_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DOCU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPI2017_GM_HEAD_RET-MAT_DOC,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_HEADER&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPI2017_GM_HEAD_01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPI2017_GM_ITEM_CREATE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ITEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPI2017_GM_ITEM_CREATE&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_RETURN&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIRET2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_RETURN&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIRET2&nbsp;OCCURS&nbsp;0.<br />
&nbsp;&nbsp;CLEAR&nbsp;G_ERROR.<br />
   </div>
   <div class="codeComment">
*&nbsp;获取画面最新的数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_TOP-&gt;CHECK_CHANGED_DATA.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_BUTTOM-&gt;CHECK_CHANGED_DATA.<br />
   </div>
   <div class="codeComment">
*&nbsp;检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_SAVE_BEFORE_CHECK.<br />
&nbsp;&nbsp;IF&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
********************************<br />
*&nbsp;节点1：生成物料凭证<br />
********************************<br />
**********抬头*****************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LW_HEADER-PSTNG_DATE&nbsp;=&nbsp;ZMMRP0070_HEAD-BUDAT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"过账日期<br />
&nbsp;&nbsp;LW_HEADER-DOC_DATE&nbsp;&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-BLDAT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"凭证日期<br />
<br />
   </div>
   <div class="codeComment">
************行项目************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-MOVE_TYPE&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-BWART.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"移动类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-COSTCENTER&nbsp;=&nbsp;ZMMRP0070_HEAD-KOSTL.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"成本中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ORDERID&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-AUFNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内部订单<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-PLANT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-WERKS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"发货工厂<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-STGE_LOC&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-LGORT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"发货仓位<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-BATCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-CHARG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"发货批次<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;LW_ITEM-MOVE_PLANT&nbsp;=&nbsp;ZMMRP0070_HEAD-WERKSYR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"接收工厂<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-MOVE_STLOC&nbsp;=&nbsp;ZMMRP0070_HEAD-LGORTYR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"接收库位<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ENTRY_QNT&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MENGE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ENTRY_UOM&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MEINS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"指定单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-MATERIAL&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-MATNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-SPEC_STOCK&nbsp;=&nbsp;LW_OUT_TAB1-SOBKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ITEM_TEXT&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-SGTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-MOVE_REAS&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-GRUND.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;LW_ITEM-AMOUNT_LC&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-CB.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_ITEM&nbsp;TO&nbsp;LT_ITEM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB2&nbsp;INTO&nbsp;LW_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-MOVE_TYPE&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-BWARTCC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"移动类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-COSTCENTER&nbsp;=&nbsp;ZMMRP0070_HEAD-KOSTLCC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"成本中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ORDERID&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-AUFNRCC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内部订单<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-PLANT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-WERKS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"发货工厂<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-STGE_LOC&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-LGORT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"发货仓位<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-BATCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-CHARG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"发货批次<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ENTRY_QNT&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-MENGE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ENTRY_UOM&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-MEINS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"指定单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-MATERIAL&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-MATNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-SPEC_STOCK&nbsp;=&nbsp;LW_OUT_TAB2-SOBKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-ITEM_TEXT&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-SGTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-MOVE_REAS&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-GRUND.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ITEM-AMOUNT_LC&nbsp;&nbsp;=&nbsp;LW_OUT_TAB2-CB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_ITEM&nbsp;TO&nbsp;LT_ITEM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
************MB1B&nbsp;303**********<br />
   </div>
   <div class="code">
&nbsp;&nbsp;L_CODE&nbsp;=&nbsp;'03'.&nbsp;"默认值MB1A<br />
&nbsp;&nbsp;CASE&nbsp;ZMMRP0070_HEAD-BWART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'311'&nbsp;OR&nbsp;'301'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_CODE&nbsp;=&nbsp;'04'.&nbsp;"MB1B<br />
&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_GOODSMVT_CREATE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOODSMVT_HEADER&nbsp;&nbsp;=&nbsp;LW_HEADER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOODSMVT_CODE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_CODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATERIALDOCUMENT&nbsp;=&nbsp;L_DOCU<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOODSMVT_ITEM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_RETURN.<br />
   </div>
   <div class="codeComment">
*&nbsp;状态判定<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ERR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TEXT.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_RETURN&nbsp;INTO&nbsp;LW_RETURN&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_RETURN-TYPE&nbsp;=&nbsp;'E'<br />
&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LW_RETURN-TYPE&nbsp;=&nbsp;'A'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ERR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TEXT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TEXT&nbsp;=&nbsp;LW_RETURN-MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;L_TEXT&nbsp;LW_RETURN-MESSAGE&nbsp;INTO&nbsp;L_TEXT&nbsp;SEPARATED&nbsp;BY&nbsp;'//'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;结果处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;L_ERR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_TRANSACTION_ROLLBACK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;L_TEXT&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
********************************<br />
*&nbsp;节点2：生成会计凭证<br />
********************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_BELNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BELNR_D,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PRCTR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;PRCTR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_BUZEI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSEG-BUZEI,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER&nbsp;TYPE&nbsp;BAPIACHE09,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT&nbsp;TYPE&nbsp;BAPIACCR09,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_OBJ_KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIACHE09-OBJ_KEY,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CURRENCYAMOUNT&nbsp;TYPE&nbsp;BAPIACCR09&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ACCOUNTGL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIACGL09&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIACGL09,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_EXTENSION2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIPAREX&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_EXTENSION2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIPAREX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CRITERIA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIACKEC9&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_CRITERIA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIACKEC9,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR200.<br />
&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z61'.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;过账<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_BUZEI,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_OBJ_KEY,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TYPE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CURRENCYAMOUNT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EXTENSION2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CRITERIA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_RETURN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ACCOUNTGL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;B~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;T001W&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;T001K&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BWKEY&nbsp;=&nbsp;B~BWKEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~WERKS&nbsp;=&nbsp;ZMMRP0070_HEAD-WERKSYC<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;__________________抬头数据_______________________<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-USERNAME&nbsp;&nbsp;&nbsp;=&nbsp;SY-UNAME.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用户<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-HEADER_TXT&nbsp;=&nbsp;'联营商品转组合商品'.&nbsp;"抬头文本<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-COMP_CODE&nbsp;&nbsp;=&nbsp;L_BUKRS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-FISC_YEAR&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-BUDAT+0(4).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"会计年度<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-DOC_DATE&nbsp;&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-BLDAT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"凭证日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-PSTNG_DATE&nbsp;=&nbsp;ZMMRP0070_HEAD-BUDAT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"记账日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-DOC_TYPE&nbsp;&nbsp;&nbsp;=&nbsp;'WA'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"凭证类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DOCUMENTHEADER-BUS_ACT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'RFBU'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"业务事务<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;***********************科目1407010100**************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1&nbsp;WHERE&nbsp;JSJE&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;__________________总账_______________________<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_PRCTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_ACCOUNTGL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_BUZEI&nbsp;=&nbsp;L_BUZEI&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-ITEMNO_ACC&nbsp;=&nbsp;L_BUZEI.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"会计凭证中的行项目数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-GL_ACCOUNT&nbsp;=&nbsp;'5001001001'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总分类帐帐目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-ITEM_TEXT&nbsp;&nbsp;=&nbsp;'联营商品组合投料'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"行文本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-COMP_CODE&nbsp;&nbsp;=&nbsp;L_BUKRS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;PRCTR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_PRCTR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MARC<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LW_OUT_TAB1-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;WERKS&nbsp;=&nbsp;LW_OUT_TAB1-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-PROFIT_CTR&nbsp;=&nbsp;L_PRCTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-ORDERID&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ZMMRP0070_HEAD-AUFNR.&nbsp;&nbsp;"内部订单<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_ACCOUNTGL&nbsp;TO&nbsp;LT_ACCOUNTGL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;__________________金额_______________________<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_CURRENCYAMOUNT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-ITEMNO_ACC&nbsp;&nbsp;&nbsp;=&nbsp;L_BUZEI.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"行号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-CURR_TYPE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'00'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"货币类型：凭证货币<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-CURRENCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'CNY'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"货币类别<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-AMT_DOCCUR&nbsp;&nbsp;&nbsp;=&nbsp;LW_OUT_TAB1-JSJE.&nbsp;"金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_CURRENCYAMOUNT&nbsp;TO&nbsp;LT_CURRENCYAMOUNT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;***********************科目6401990100**************************<br />
*&nbsp;&nbsp;__________________总账_______________________<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_ACCOUNTGL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_BUZEI&nbsp;=&nbsp;L_BUZEI&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-ITEMNO_ACC&nbsp;=&nbsp;L_BUZEI.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"会计凭证中的行项目数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-GL_ACCOUNT&nbsp;=&nbsp;'2202099002'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总分类帐帐目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-ITEM_TEXT&nbsp;&nbsp;=&nbsp;'联营商品组合投料'.&nbsp;"行文本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-COMP_CODE&nbsp;&nbsp;=&nbsp;L_BUKRS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-PROFIT_CTR&nbsp;=&nbsp;L_PRCTR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"利润中心<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-ALLOC_NMBR&nbsp;=&nbsp;ZMMRP0070_HEAD-BUDAT&nbsp;&&&nbsp;LW_OUT_TAB1-LIFNR&nbsp;.&nbsp;"分配号<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ACCOUNTGL-material&nbsp;&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_ACCOUNTGL&nbsp;TO&nbsp;LT_ACCOUNTGL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;__________________金额_______________________<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_CURRENCYAMOUNT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-ITEMNO_ACC&nbsp;&nbsp;&nbsp;=&nbsp;L_BUZEI.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"行号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-CURR_TYPE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'00'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"货币类型：凭证货币<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-CURRENCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'CNY'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"货币类别<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_CURRENCYAMOUNT-AMT_DOCCUR&nbsp;&nbsp;&nbsp;=&nbsp;0&nbsp;-&nbsp;LW_OUT_TAB1-JSJE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_CURRENCYAMOUNT&nbsp;TO&nbsp;LT_CURRENCYAMOUNT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ACCOUNTGL&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_ACC_DOCUMENT_POST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOCUMENTHEADER&nbsp;=&nbsp;LW_DOCUMENTHEADER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJ_KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_OBJ_KEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ACCOUNTGL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_ACCOUNTGL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CURRENCYAMOUNT&nbsp;=&nbsp;LT_CURRENCYAMOUNT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TYPE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_RETURN&nbsp;INTO&nbsp;LW_RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_RETURN-TYPE&nbsp;=&nbsp;'E'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LW_RETURN-TYPE&nbsp;=&nbsp;'A'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_MSG&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;LW_RETURN-MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;L_MSG&nbsp;LW_RETURN-MESSAGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;'&nbsp;&nbsp;/&nbsp;&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;有错误，则rollback<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_TRANSACTION_ROLLBACK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;L_MSG&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
********************************<br />
*&nbsp;全部成功后提交<br />
********************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_TRANSACTION_COMMIT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WAIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;IF&nbsp;L_OBJ_KEY&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'商品凭证'&nbsp;L_DOCU&nbsp;'已保存'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;L_OBJ_KEY+0(10)&nbsp;TO&nbsp;L_BELNR&nbsp;NO-ZERO.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;&nbsp;=&nbsp;'结算会计凭证'&nbsp;&&&nbsp;L_BUKRS&nbsp;&&&nbsp;'&nbsp;'&nbsp;&&&nbsp;ZMMRP0070_HEAD-BUDAT+0(4)&nbsp;&&&nbsp;'&nbsp;'&nbsp;&&&nbsp;L_BELNR&nbsp;&&&nbsp;'已保存'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;&nbsp;'商品凭证'&nbsp;L_DOCU&nbsp;'已保存,'&nbsp;L_MSG.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;EXPORT&nbsp;L_DOCU&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'DOCU'.<br />
&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&获取当前最大的行项目编号<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_ZEILE CHANGING C_ZEILE.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZEILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MBLPO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT_TAB1&nbsp;TYPE&nbsp;TYT_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT_TAB2&nbsp;TYPE&nbsp;TYT_OUT_TAB2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;TYPE&nbsp;TY_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2&nbsp;TYPE&nbsp;TY_OUT_TAB2.<br />
   </div>
   <div class="codeComment">
*&nbsp;获取最大项目编号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LT_OUT_TAB1&nbsp;=&nbsp;GT_OUT_TAB1.<br />
&nbsp;&nbsp;SORT&nbsp;LT_OUT_TAB1&nbsp;BY&nbsp;ZEILE&nbsp;DESCENDING.<br />
&nbsp;&nbsp;CLEAR&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_OUT_TAB1&nbsp;INDEX&nbsp;1&nbsp;INTO&nbsp;LW_OUT_TAB1&nbsp;.<br />
&nbsp;&nbsp;L_ZEILE&nbsp;=&nbsp;LW_OUT_TAB1-ZEILE.<br />
<br />
&nbsp;&nbsp;LT_OUT_TAB2&nbsp;=&nbsp;GT_OUT_TAB2.<br />
&nbsp;&nbsp;SORT&nbsp;LT_OUT_TAB2&nbsp;BY&nbsp;ZEILE&nbsp;DESCENDING.<br />
&nbsp;&nbsp;CLEAR&nbsp;LW_OUT_TAB2.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_OUT_TAB2&nbsp;INDEX&nbsp;1&nbsp;INTO&nbsp;LW_OUT_TAB2&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;LW_OUT_TAB2-ZEILE&nbsp;&gt;&nbsp;L_ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZEILE&nbsp;=&nbsp;LW_OUT_TAB2-ZEILE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;C_ZEILE&nbsp;=&nbsp;L_ZEILE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FM_SET_FIELD<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_SET_VISIBLE .<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DISMODE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ZMMRP0070&nbsp;TYPE&nbsp;ZMMRP0070,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ZMMRP0070&nbsp;TYPE&nbsp;ZMMRP0070&nbsp;OCCURS&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;取数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMRP0070<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMRP0070<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;BWART&nbsp;=&nbsp;P_BWART.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'移动类型'&nbsp;P_BWART&nbsp;'不可用'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_ZMMRP0070&nbsp;BY&nbsp;FIELDNAME.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZMMRP0070&nbsp;INTO&nbsp;LW_ZMMRP0070<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;FIELDNAME&nbsp;=&nbsp;'ZMMRP0070_HEAD-BWARTCC'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;L_DISMODE&nbsp;=&nbsp;LW_ZMMRP0070-DISMODE.<br />
&nbsp;&nbsp;IF&nbsp;L_DISMODE&nbsp;=&nbsp;'2'&nbsp;OR&nbsp;L_DISMODE&nbsp;=&nbsp;'3'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_DISPLAY&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_DISPLAY&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;设定<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_ZMMRP0070.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZMMRP0070&nbsp;INTO&nbsp;LW_ZMMRP0070<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;FIELDNAME&nbsp;=&nbsp;SCREEN-NAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;LW_ZMMRP0070-DISMODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'1'."只读<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'2'."可输<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'3'."必输<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-REQUIRED&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'GP1'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;L_DISMODE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'1'."只读<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'2'."可输<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'3'."必输<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-REQUIRED&nbsp;=&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN&nbsp;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*----------------------------------------------------------------------*<br />
*&nbsp;保存前的检查<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_SAVE_BEFORE_CHECK.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_CB1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_CB2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZL1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZL2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-TABIX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TMP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB1&nbsp;TYPE&nbsp;TY_OUT_TAB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OUT_TAB2&nbsp;TYPE&nbsp;TY_OUT_TAB2.<br />
   </div>
   <div class="codeComment">
*&nbsp;检查1：结算方式和供应商必须一致<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-TABIX&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TMP&nbsp;=&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*************START&nbsp;BY&nbsp;LIQUAN&nbsp;2015.08.22************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z71'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_OUT_TAB1-JSFS&nbsp;&lt;&gt;&nbsp;LW_TMP-JSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LW_OUT_TAB1-LIFNR&nbsp;&lt;&gt;&nbsp;LW_TMP-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LW_OUT_TAB1-ZSYL&nbsp;&nbsp;&lt;&gt;&nbsp;LW_TMP-ZSYL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;L_TABIX&nbsp;'行商品，供应商/结算方式/折算原料与其他行不一致'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*************START&nbsp;BY&nbsp;LIQUAN&nbsp;2015.08.22************<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z61'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_OUT_TAB1-JSJE&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;L_TABIX&nbsp;'行商品，结算金额为0'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;检查2：成本必须一致<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z71'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_DISPLAY&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_CB1&nbsp;=&nbsp;L_CB1&nbsp;+&nbsp;LW_OUT_TAB1-CB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZL1&nbsp;&nbsp;=&nbsp;L_ZL1&nbsp;+&nbsp;LW_OUT_TAB1-ZSYLZL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB2&nbsp;INTO&nbsp;LW_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_CB2&nbsp;=&nbsp;L_CB2&nbsp;+&nbsp;LW_OUT_TAB2-CB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZL2&nbsp;&nbsp;=&nbsp;L_ZL2&nbsp;+&nbsp;LW_OUT_TAB2-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_CB1&nbsp;&lt;&gt;&nbsp;L_CB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'消耗成本与产出成本不一致，请检查'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_ZL1&nbsp;&lt;&gt;&nbsp;L_ZL2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'折算原料重量合计与产出数量不一致，请检查'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;检查3<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;ZMMRP0070_HEAD-BWART&nbsp;=&nbsp;'Z61'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB1&nbsp;INTO&nbsp;LW_OUT_TAB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_CB1&nbsp;=&nbsp;L_CB1&nbsp;+&nbsp;LW_OUT_TAB1-CB&nbsp;+&nbsp;LW_OUT_TAB1-JSJE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB2&nbsp;INTO&nbsp;LW_OUT_TAB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_CB2&nbsp;=&nbsp;L_CB2&nbsp;+&nbsp;LW_OUT_TAB2-CB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_CB1&nbsp;&lt;&gt;&nbsp;L_CB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'消耗成本与产出成本不一致，请检查'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ERROR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*----------------------------------------------------------------------*<br />
*&nbsp;ALV回车事件<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_HANDLE_ENTER USING I_TYPE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_MODIFIED&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_GOOD_CELLS&nbsp;TYPE&nbsp;LVC_T_MODI.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_COUNT&nbsp;TYPE&nbsp;I.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;L_COUNT.<br />
   </div>
   <div class="codeComment">
*&nbsp;如果修改数量，自动更新成本<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;ET_GOOD_CELLS&nbsp;WITH&nbsp;KEY&nbsp;FIELDNAME&nbsp;=&nbsp;'MENGE'&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_COUNT&nbsp;=&nbsp;L_COUNT&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;成本修改也更新画面<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;ET_GOOD_CELLS&nbsp;WITH&nbsp;KEY&nbsp;FIELDNAME&nbsp;=&nbsp;'CB'&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_COUNT&nbsp;=&nbsp;L_COUNT&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;IF&nbsp;L_COUNT&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_REFRESH_TABLE.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
