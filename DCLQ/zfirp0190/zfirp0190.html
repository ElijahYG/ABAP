<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZFIRP0190</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZFIRP0190</h2>
<h3> Description: 明细账账簿</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="code">
REPORT ZFIRP0190.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;REPORT&nbsp;&nbsp;ZFIRP0190<br />
*&&nbsp;Application&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;FI-RP-0190<br />
*&&nbsp;Subject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;明细账账簿<br />
*&&nbsp;Author&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;liquan<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUTHOR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIPTION<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----------&nbsp;&nbsp;&nbsp;&nbsp;-----------------<br />
*&&nbsp;2015/09/18&nbsp;&nbsp;&nbsp;&nbsp;liquan&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initial<br />
*&---------------------------------------------------------------------*<br />
<br />
*&---------------------------------------------------------------------*<br />
*&引入选择屏幕表<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
TABLES:<br />
&nbsp;&nbsp;BSEG,<br />
&nbsp;&nbsp;BKPF.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&定义类型<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
TYPES:<br />
&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;TY_FAG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-RBUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-RYEAR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;RACCT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-RACCT,&nbsp;&nbsp;&nbsp;"科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;DRCRK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-DRCRK,&nbsp;&nbsp;&nbsp;"借贷标识<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSLVT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSLVT,&nbsp;&nbsp;&nbsp;"期初余额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL01,&nbsp;&nbsp;&nbsp;"期间01&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL02,&nbsp;&nbsp;&nbsp;"期间02&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL03,&nbsp;&nbsp;&nbsp;"期间03&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL04,&nbsp;&nbsp;&nbsp;"期间04&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL05&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL05,&nbsp;&nbsp;&nbsp;"期间05&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL06&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL06,&nbsp;&nbsp;&nbsp;"期间06&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL07,&nbsp;&nbsp;&nbsp;"期间07&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL08&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL08,&nbsp;&nbsp;&nbsp;"期间08&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL09&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL09,&nbsp;&nbsp;&nbsp;"期间09&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL10,&nbsp;&nbsp;&nbsp;"期间10&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL11,&nbsp;&nbsp;&nbsp;"期间11&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL12,&nbsp;&nbsp;&nbsp;"期间12&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL13,&nbsp;&nbsp;&nbsp;"期间13&nbsp;发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;HSL14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;FAGLFLEXT-HSL14,&nbsp;&nbsp;&nbsp;"期间14&nbsp;发生额<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;TY_FAG,<br />
&nbsp;&nbsp;TYT_FAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_FAG&nbsp;OCCURS&nbsp;0.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&定义全局数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;GT_TAB&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZFIRP0190&nbsp;OCCURS&nbsp;0.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&初始化<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
INITIALIZATION.<br />
&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;GT_TAB.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&选择屏幕<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
SELECTION-SCREEN BEGIN OF BLOCK BK1 WITH FRAME TITLE TEXT-001.<br />
PARAMETERS:<br />
&nbsp;&nbsp;P_1&nbsp;&nbsp;TYPE&nbsp;CHAR1&nbsp;RADIOBUTTON&nbsp;GROUP&nbsp;GP1&nbsp;DEFAULT&nbsp;'X'&nbsp;USER-COMMAND&nbsp;UC1,<br />
&nbsp;&nbsp;P_2&nbsp;&nbsp;TYPE&nbsp;CHAR1&nbsp;RADIOBUTTON&nbsp;GROUP&nbsp;GP1,<br />
&nbsp;&nbsp;P_3&nbsp;&nbsp;TYPE&nbsp;CHAR1&nbsp;RADIOBUTTON&nbsp;GROUP&nbsp;GP1.<br />
SELECTION-SCREEN END OF BLOCK BK1.<br />
<br />
SELECTION-SCREEN BEGIN OF BLOCK BK2 WITH FRAME TITLE TEXT-002.<br />
SELECT-OPTIONS:<br />
&nbsp;&nbsp;S_BUKRS&nbsp;&nbsp;&nbsp;FOR&nbsp;BSEG-BUKRS&nbsp;NO-EXTENSION&nbsp;NO&nbsp;INTERVALS&nbsp;,"OBLIGATORY,<br />
&nbsp;&nbsp;S_GJAHR&nbsp;&nbsp;&nbsp;FOR&nbsp;BSEG-GJAHR&nbsp;NO-EXTENSION&nbsp;NO&nbsp;INTERVALS&nbsp;,"OBLIGATORY,<br />
   </div>
   <div class="codeComment">
*&nbsp;S_MONAT&nbsp;&nbsp;&nbsp;FOR&nbsp;BKPF-MONAT,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;S_HKONT&nbsp;&nbsp;&nbsp;FOR&nbsp;BSEG-HKONT,<br />
&nbsp;&nbsp;S_KUNNR&nbsp;&nbsp;&nbsp;FOR&nbsp;BSEG-KUNNR,<br />
&nbsp;&nbsp;S_LIFNR&nbsp;&nbsp;&nbsp;FOR&nbsp;BSEG-LIFNR.<br />
SELECTION-SCREEN END OF BLOCK BK2.<br />
<br />
PARAMETERS P_CHK TYPE CHAR1 AS CHECKBOX DEFAULT 'X'.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&屏幕控制<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
AT SELECTION-SCREEN OUTPUT .<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_CONTROL_SCREEN.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&数据检查<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
AT SELECTION-SCREEN.<br />
&nbsp;&nbsp;IF&nbsp;SY-UCOMM&nbsp;=&nbsp;'ONLI'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;数据检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CHECK_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&F8<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
START-OF-SELECTION.<br />
   </div>
   <div class="codeComment">
*&nbsp;取数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_DATA.<br />
   </div>
   <div class="codeComment">
*&nbsp;打印<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_PRINT.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&屏幕控制<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_CONTROL_SCREEN.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_HKONT&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_KUNNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MONAT&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.<br />
   </div>
   <div class="codeComment">
*&nbsp;修改显示方式<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_HKONT&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MONAT&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_KUNNR&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LIFNR&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;按总账<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_HKONT&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MONAT&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_KUNNR&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_LIFNR&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;按客户<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_HKONT&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_KUNNR&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MONAT&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_LIFNR&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;按供应商<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_HKONT&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_KUNNR&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MONAT&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_LIFNR&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;激活<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-NAME&nbsp;CP&nbsp;'*S_HKONT*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;L_HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-NAME&nbsp;CP&nbsp;'*S_KUNNR*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;L_KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-NAME&nbsp;CP&nbsp;'*S_LIFNR*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;L_LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-NAME&nbsp;CP&nbsp;'*S_MONAT*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;L_MONAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&取数<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_DATA.<br />
   </div>
   <div class="codeComment">
*&nbsp;按总账取数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_HKONT_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;按客户<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_2&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_KUNNR_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;按供应商<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_3&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_LIFNR_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;GT_TAB&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'没有可打印的数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&取总账相关数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_HKONT_DATA.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_BSIS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-BUKRS,&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-GJAHR,&nbsp;"会计年度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HKONT&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-HKONT,&nbsp;"会计科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BELNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-BELNR,&nbsp;"会计编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUZEI&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-BUZEI,&nbsp;"行项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHKZG&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-SHKZG,&nbsp;"借贷标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUDAT&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-BUDAT,&nbsp;"过账日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-DMBTR,&nbsp;"发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XNEGP&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIS-XNEGP,&nbsp;"反记账标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BKTXT&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-BKTXT,&nbsp;"摘要<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_BSIS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_FAG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RACCT&nbsp;&nbsp;&nbsp;TYPE&nbsp;FAGLFLEXT-RACCT&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HSLVT&nbsp;&nbsp;&nbsp;TYPE&nbsp;FAGLFLEXT-HSLVT&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RYEAR&nbsp;&nbsp;&nbsp;TYPE&nbsp;FAGLFLEXT-RYEAR&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR00&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR00,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR01&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR02&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR03&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR04&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR04,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR05&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR05,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR06&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR06,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR07&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR07,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR08&nbsp;TYPE&nbsp;FAGLFLEXT-OBJNR08,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRCRK&nbsp;&nbsp;&nbsp;TYPE&nbsp;FAGLFLEXT-DRCRK&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RPMAX&nbsp;&nbsp;&nbsp;TYPE&nbsp;FAGLFLEXT-RPMAX&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_FAG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FAG_TMP&nbsp;LIKE&nbsp;LW_FAG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FAG2&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_FAG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_FAG2&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_FAG&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_FAG&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_FAG&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_NEXT&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_BSIS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-TABIX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_HSLVT&nbsp;&nbsp;&nbsp;TYPE&nbsp;FAGLFLEXT-HSLVT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;DMBTR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;TYPE&nbsp;DMBTR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_SKB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SKB1-BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SAKNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SKB1-SAKNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_SKB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_SKAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HKONT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SKAT-SAKNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT20&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SKAT-TXT20,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_SKAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_SKAT&nbsp;LIKE&nbsp;LW_SKAT&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TMP&nbsp;&nbsp;LIKE&nbsp;LW_BSIS&nbsp;OCCURS&nbsp;0&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB&nbsp;&nbsp;TYPE&nbsp;ZFIRP0190,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_SKB1&nbsp;LIKE&nbsp;LW_SKB1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_BSIS&nbsp;LIKE&nbsp;LW_BSIS&nbsp;OCCURS&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;取总账未清<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUZEI<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~DMBTR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~XNEGP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~BKTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_BSIS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;BSIS&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;BKPF&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BUKRS&nbsp;=&nbsp;B~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MONAT&nbsp;IN&nbsp;S_MONAT<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~HKONT&nbsp;IN&nbsp;S_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取总账已清<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUZEI<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~DMBTR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~XNEGP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~BKTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPENDING&nbsp;TABLE&nbsp;LT_BSIS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;BSAS&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;BKPF&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BUKRS&nbsp;=&nbsp;B~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MONAT&nbsp;IN&nbsp;S_MONAT<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~HKONT&nbsp;IN&nbsp;S_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取科目描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LT_TMP&nbsp;=&nbsp;LT_BSIS.<br />
&nbsp;&nbsp;SORT&nbsp;LT_TMP&nbsp;BY&nbsp;HKONT.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_TMP&nbsp;COMPARING&nbsp;HKONT.<br />
&nbsp;&nbsp;IF&nbsp;LT_TMP&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_SKAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;SKAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SAKNR&nbsp;=&nbsp;LT_TMP-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KTOPL&nbsp;=&nbsp;'CBAI'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;取上年结转<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;RACCT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HSLVT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RYEAR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR00<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR03<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR04<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR05<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR06<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR07<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJNR08<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRCRK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RPMAX<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_FAG<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;FAGLFLEXT<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;RBUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;RYEAR&nbsp;&nbsp;IN&nbsp;S_GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;RACCT&nbsp;&nbsp;IN&nbsp;S_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;上年结转汇总<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_FAG&nbsp;BY&nbsp;RACCT.<br />
&nbsp;&nbsp;CLEAR&nbsp;L_HSLVT.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_FAG&nbsp;INTO&nbsp;LW_FAG_TMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FAG&nbsp;&nbsp;=&nbsp;LW_FAG_TMP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_HSLVT&nbsp;=&nbsp;L_HSLVT&nbsp;+&nbsp;LW_FAG-HSLVT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;END&nbsp;OF&nbsp;RACCT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FAG2-RACCT&nbsp;=&nbsp;LW_FAG-RACCT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_FAG2-HSLVT&nbsp;=&nbsp;L_HSLVT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_FAG2&nbsp;TO&nbsp;LT_FAG2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_HSLVT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;LT_FAG&nbsp;=&nbsp;LT_FAG2.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;数据处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_SKB1&nbsp;BY&nbsp;SAKNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_BSIS&nbsp;BY&nbsp;HKONT&nbsp;BUDAT&nbsp;BUKRS&nbsp;GJAHR&nbsp;BELNR&nbsp;BUZEI.<br />
<br />
&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;LINES(&nbsp;LT_BSIS&nbsp;).<br />
&nbsp;&nbsp;SORT&nbsp;LT_SKAT&nbsp;BY&nbsp;HKONT.<br />
&nbsp;&nbsp;SORT&nbsp;LT_FAG&nbsp;BY&nbsp;RACCT.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_BSIS&nbsp;INTO&nbsp;LW_BSIS.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;判定是否到科目最后一条<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_END.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_LINE&nbsp;=&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;L_TABIX&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSIS&nbsp;INTO&nbsp;LW_NEXT&nbsp;INDEX&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_NEXT-HKONT&nbsp;&lt;&gt;&nbsp;LW_BSIS-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;赋值<br />
<br />
*&nbsp;&nbsp;&nbsp;标题等<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_SKAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_SKAT&nbsp;INTO&nbsp;LW_SKAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;=&nbsp;LW_BSIS-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;增加上年结转<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;CHANGE&nbsp;OF&nbsp;LW_BSIS-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_FAG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_FAG&nbsp;INTO&nbsp;LW_FAG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;RACCT&nbsp;=&nbsp;LW_BSIS-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_SKAT-TXT20&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'科目：'&nbsp;&&&nbsp;LW_BSIS-HKONT&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_SKAT-TXT20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-BUDAT+0(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'上年结转'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_FAG-HSLVT&nbsp;&gt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_FAG-HSLVT&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;=&nbsp;LW_FAG-HSLVT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;=&nbsp;ABS(&nbsp;LW_FAG-HSLVT&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LW_FAG-HSLVT&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_FAG-HSLVT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDON.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;赋值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_SKAT-TXT20&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'科目：'&nbsp;&&&nbsp;LW_BSIS-HKONT&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_SKAT-TXT20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-BUDAT+0(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-BUDAT+4(2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-BUDAT+6(2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BELNR&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-BKTXT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIS-XNEGP&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIS-SHKZG&nbsp;=&nbsp;'S'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-DMBTR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-DMBTR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIS-SHKZG&nbsp;=&nbsp;'H'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-DMBTR&nbsp;*&nbsp;-1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-DMBTR&nbsp;*&nbsp;-1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIS-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;=&nbsp;LW_TAB-JIE&nbsp;-&nbsp;LW_TAB-DAI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;=&nbsp;L_DMBTRS&nbsp;+&nbsp;L_DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_DMBTRS&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;L_DMBTRS&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIS-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;科目变化时<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*****************modify&nbsp;&nbsp;by&nbsp;liquan&nbsp;&nbsp;2015.11.18&nbsp;start&nbsp;*************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_CAL_HJ.<br />
   </div>
   <div class="codeComment">
*****************modify&nbsp;&nbsp;by&nbsp;liquan&nbsp;&nbsp;2015.11.18&nbsp;&nbsp;&nbsp;end&nbsp;*************<br />
*&nbsp;如果科目选中,则输出空白页<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_CHK&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;SKB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_SKB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SAKNR&nbsp;IN&nbsp;S_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_SKB1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_SKAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;SKAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_SKB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SAKNR&nbsp;=&nbsp;LT_SKB1-SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KTOPL&nbsp;=&nbsp;'CBAI'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_SKAT&nbsp;BY&nbsp;HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_SKB1&nbsp;INTO&nbsp;LW_SKB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_TAB&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KEY&nbsp;=&nbsp;LW_SKB1-SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上年结转<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_FAG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_FAG&nbsp;INTO&nbsp;LW_FAG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;RACCT&nbsp;=&nbsp;LW_SKB1-SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_SKAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_SKAT&nbsp;INTO&nbsp;LW_SKAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;=&nbsp;LW_SKB1-SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_SKAT-TXT20&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'科目：'&nbsp;&&&nbsp;LW_SKB1-SAKNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_SKAT-TXT20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'上年结转'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_FAG-HSLVT&nbsp;&gt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_FAG-HSLVT&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;=&nbsp;LW_FAG-HSLVT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;=&nbsp;ABS(&nbsp;LW_FAG-HSLVT&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LW_FAG-HSLVT&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_SKB1-SAKNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_FAG-HSLVT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本年累计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'本年累计'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'31'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'12'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;借方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB-JIE&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-JIE&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贷方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB-DAI&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-DAI&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;增加空白页<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_SKAT.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_SKAT&nbsp;INTO&nbsp;LW_SKAT<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;=&nbsp;LW_SKB1-SAKNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_SKAT-TXT20&nbsp;&&&nbsp;'明细账'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'科目：'&nbsp;&&&nbsp;LW_SKB1-SAKNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_SKAT-TXT20<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
**<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_SKB1-SAKNR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;GT_TAB&nbsp;STABLE&nbsp;BY&nbsp;KEY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&按天、按月、按年合计<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_CAL_HJ.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_NIAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-DATUM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_RI&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_RI&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_YUE&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_YUE&nbsp;&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_NIAN&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_NIAN&nbsp;&nbsp;TYPE&nbsp;P&nbsp;LENGTH&nbsp;10&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_NEXT&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GT_TAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GT_TAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GT_TAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;GT_TAB.<br />
<br />
&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;LINES(&nbsp;GT_TAB&nbsp;).<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_TAB&nbsp;INTO&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;LT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-TXT&nbsp;=&nbsp;'上年结转'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;判断当日、当月、当年<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RI,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_YUE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_NIAN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TABIX&nbsp;=&nbsp;L_LINE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RI&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_YUE&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_NIAN&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;L_TABIX&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_TAB&nbsp;INTO&nbsp;LW_TAB_NEXT&nbsp;INDEX&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_NEXT-KEY&nbsp;&nbsp;&lt;&gt;&nbsp;LW_TAB-KEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LW_TAB_NEXT-NIAN&nbsp;&lt;&gt;&nbsp;LW_TAB-NIAN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_NIAN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RI&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_YUE&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_NEXT-YUE&nbsp;&lt;&gt;&nbsp;LW_TAB-YUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_YUE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RI&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_NEXT-RI&nbsp;&lt;&gt;&nbsp;LW_TAB-RI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RI&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_RI&nbsp;&nbsp;&nbsp;=&nbsp;L_JIE_RI&nbsp;&nbsp;&nbsp;+&nbsp;LW_TAB-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_YUE&nbsp;&nbsp;=&nbsp;L_JIE_YUE&nbsp;&nbsp;+&nbsp;LW_TAB-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_NIAN&nbsp;=&nbsp;L_JIE_NIAN&nbsp;+&nbsp;LW_TAB-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_RI&nbsp;&nbsp;&nbsp;=&nbsp;L_DAI_RI&nbsp;&nbsp;&nbsp;+&nbsp;LW_TAB-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_YUE&nbsp;&nbsp;=&nbsp;L_DAI_YUE&nbsp;&nbsp;+&nbsp;LW_TAB-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_NIAN&nbsp;=&nbsp;L_DAI_NIAN&nbsp;+&nbsp;LW_TAB-DAI.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;当日是否需要合计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_RI&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;P_1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-KEY&nbsp;CP&nbsp;'1001*'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LW_TAB-KEY&nbsp;CP&nbsp;'1002*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LW_TAB&nbsp;TO&nbsp;LW_TAB_TMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-BELNR&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'本日累计'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_JIE_RI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DAI_RI.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;借方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB_TMP-JIE&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_TMP-JIE&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB_TMP-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贷方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB_TMP-DAI&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_TMP-DAI&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB_TMP-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB_TMP&nbsp;TO&nbsp;LT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_RI,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_RI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;当月是否需要合计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_YUE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LW_TAB&nbsp;TO&nbsp;LW_TAB_TMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-BELNR&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'本月累计'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_JIE_YUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DAI_YUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DATE&nbsp;=&nbsp;LW_TAB-NIAN&nbsp;&&&nbsp;LW_TAB-YUE&nbsp;&&&nbsp;LW_TAB-RI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'FIMA_DATE_CREATE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DATE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SET_LAST_DAY_OF_MONTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DATE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-RI&nbsp;=&nbsp;L_DATE+6(2).<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;借方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB_TMP-JIE&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_TMP-JIE&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB_TMP-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贷方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB_TMP-DAI&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_TMP-DAI&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB_TMP-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB_TMP&nbsp;TO&nbsp;LT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_YUE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_YUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;当年是否需要合计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_NIAN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LW_TAB&nbsp;TO&nbsp;LW_TAB_TMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-BELNR&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'本年累计'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_JIE_NIAN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DAI_NIAN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'31'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB_TMP-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'12'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;借方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB_TMP-JIE&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_TMP-JIE&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB_TMP-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贷方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB_TMP-DAI&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB_TMP-DAI&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB_TMP-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB_TMP&nbsp;TO&nbsp;LT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_JIE_NIAN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DAI_NIAN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;GT_TAB&nbsp;=&nbsp;LT_TAB.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&取客户数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_KUNNR_DATA.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_BSID,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-BUKRS,&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-GJAHR,&nbsp;"会计年度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-KUNNR,&nbsp;"会计科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BELNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-BELNR,&nbsp;"会计编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUZEI&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-BUZEI,&nbsp;"行项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHKZG&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-SHKZG,&nbsp;"借贷标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUDAT&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-BUDAT,&nbsp;"过账日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-DMBTR,&nbsp;"发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XNEGP&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSID-XNEGP,&nbsp;"反记账标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BKTXT&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-BKTXT,&nbsp;"摘要<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_BSID,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_KNC1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC1-KUNNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC1-BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC1-GJAHR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UMSAV&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC1-UMSAV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_KNC1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_KNC1&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_KNC1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_KNC3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC3-KUNNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC3-BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC3-GJAHR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHBKZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC3-SHBKZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALDV&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC3-SALDV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_KNC3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_KNC3&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_KNC3&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_QICHU,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC1-KUNNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNC1-UMSAV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_QICHU,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_QICHU&nbsp;&nbsp;LIKE&nbsp;LW_QICHU&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_NEXT&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_BSID,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-TABIX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;DMBTR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;TYPE&nbsp;DMBTR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_KNB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNB1-BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNB1-KUNNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_KNB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_KNA1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNA1-KUNNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;KNA1-NAME1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_KNA1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_KNA1&nbsp;LIKE&nbsp;LW_KNA1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TMP&nbsp;&nbsp;LIKE&nbsp;LW_BSID&nbsp;OCCURS&nbsp;0&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB&nbsp;&nbsp;TYPE&nbsp;ZFIRP0190,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_KNB1&nbsp;LIKE&nbsp;LW_KNB1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_BSID&nbsp;LIKE&nbsp;LW_BSID&nbsp;OCCURS&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;取总账未清<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUZEI<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~DMBTR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~XNEGP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~BKTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_BSID<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;BSID&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;BKPF&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BUKRS&nbsp;=&nbsp;B~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MONAT&nbsp;IN&nbsp;S_MONAT<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~KUNNR&nbsp;IN&nbsp;S_KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取总账已清<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUZEI<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~DMBTR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~XNEGP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~BKTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPENDING&nbsp;TABLE&nbsp;LT_BSID<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;BSAD&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;BKPF&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BUKRS&nbsp;=&nbsp;B~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MONAT&nbsp;IN&nbsp;S_MONAT<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~KUNNR&nbsp;IN&nbsp;S_KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取科目描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LT_TMP&nbsp;=&nbsp;LT_BSID.<br />
&nbsp;&nbsp;SORT&nbsp;LT_TMP&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_TMP&nbsp;COMPARING&nbsp;KUNNR.<br />
&nbsp;&nbsp;IF&nbsp;LT_TMP&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KNA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KNA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KUNNR&nbsp;=&nbsp;LT_TMP-KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*<br />
*&nbsp;&nbsp;SELECT&nbsp;KUNNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KNA1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KNA1<br />
*&nbsp;&nbsp;&nbsp;WHERE&nbsp;KUNNR&nbsp;IN&nbsp;S_KUNNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取供应商统驭科目余额<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UMSAV<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KNC1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KNC1<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;KUNNR&nbsp;IN&nbsp;S_KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取供应商特殊总账科目余额<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHBKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALDV<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KNC3<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KNC3<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;KUNNR&nbsp;IN&nbsp;S_KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;按科目汇总<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_KNC1&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_KNC3&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_KNC1&nbsp;INTO&nbsp;LW_KNC1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-DMBTR&nbsp;=&nbsp;LW_QICHU-DMBTR&nbsp;+&nbsp;LW_KNC1-UMSAV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-KUNNR&nbsp;=&nbsp;LW_KNC1-KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;END&nbsp;OF&nbsp;KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_QICHU&nbsp;TO&nbsp;LT_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_KNC3&nbsp;INTO&nbsp;LW_KNC3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-DMBTR&nbsp;=&nbsp;LW_QICHU-DMBTR&nbsp;+&nbsp;LW_KNC3-SALDV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-KUNNR&nbsp;=&nbsp;LW_KNC3-KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;END&nbsp;OF&nbsp;KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;LW_QICHU&nbsp;INTO&nbsp;LT_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;数据处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_KNA1&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_BSID&nbsp;BY&nbsp;KUNNR&nbsp;BUDAT&nbsp;BUKRS&nbsp;GJAHR&nbsp;BELNR&nbsp;BUZEI.<br />
&nbsp;&nbsp;SORT&nbsp;LT_QICHU&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;LINES(&nbsp;LT_BSID&nbsp;).<br />
&nbsp;&nbsp;SORT&nbsp;LT_KNA1&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_BSID&nbsp;INTO&nbsp;LW_BSID.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;判定是否到科目最后一条<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_END.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_LINE&nbsp;=&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;L_TABIX&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSID&nbsp;INTO&nbsp;LW_NEXT&nbsp;INDEX&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_NEXT-KUNNR&nbsp;&lt;&gt;&nbsp;LW_BSID-KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;标题等<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_KNA1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_KNA1&nbsp;INTO&nbsp;LW_KNA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KUNNR&nbsp;=&nbsp;LW_BSID-KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;上年结转<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;CHANGE&nbsp;OF&nbsp;LW_BSID-KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_QICHU&nbsp;INTO&nbsp;LW_QICHU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KUNNR&nbsp;=&nbsp;LW_BSID-KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_KNA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'客户：'&nbsp;&&&nbsp;LW_BSID-KUNNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_KNA1-NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'上年结转'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&gt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDON.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;赋值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_KNA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'客户：'&nbsp;&&&nbsp;LW_BSID-KUNNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_KNA1-NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-BUDAT+0(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-BUDAT+4(2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-BUDAT+6(2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BELNR&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-BKTXT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSID-XNEGP&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSID-SHKZG&nbsp;=&nbsp;'S'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-DMBTR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-DMBTR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSID-SHKZG&nbsp;=&nbsp;'H'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-DMBTR&nbsp;*&nbsp;-1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-DMBTR&nbsp;*&nbsp;-1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;=&nbsp;LW_TAB-DAI&nbsp;-&nbsp;LW_TAB-JIE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_DMBTR&nbsp;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'贷'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'借'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;=&nbsp;L_DMBTRS&nbsp;+&nbsp;L_DMBTR.<br />
*&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DMBTRS.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSID-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;=&nbsp;LW_TAB-JIE&nbsp;-&nbsp;LW_TAB-DAI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;=&nbsp;L_DMBTRS&nbsp;+&nbsp;L_DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_DMBTRS&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;L_DMBTRS&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSID-KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;科目变化时<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*****************modify&nbsp;&nbsp;by&nbsp;liquan&nbsp;&nbsp;2015.11.18&nbsp;start&nbsp;*************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_CAL_HJ.<br />
   </div>
   <div class="codeComment">
*****************modify&nbsp;&nbsp;by&nbsp;liquan&nbsp;&nbsp;2015.11.18&nbsp;&nbsp;&nbsp;end&nbsp;*************<br />
*&nbsp;如果科目选中,则输出空白页<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_CHK&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KNB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KNB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KUNNR&nbsp;IN&nbsp;S_KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_KNB1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KNA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KNA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_KNB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KUNNR&nbsp;=&nbsp;LT_KNB1-KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_KNB1&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_KNA1&nbsp;BY&nbsp;KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_KNB1&nbsp;INTO&nbsp;LW_KNB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_TAB&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KEY&nbsp;=&nbsp;LW_KNB1-KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上年结转及本年累计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_QICHU&nbsp;INTO&nbsp;LW_QICHU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KUNNR&nbsp;=&nbsp;LW_KNB1-KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_KNA1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_KNA1&nbsp;INTO&nbsp;LW_KNA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KUNNR&nbsp;=&nbsp;LW_KNB1-KUNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_KNA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'客户：'&nbsp;&&&nbsp;LW_KNB1-KUNNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_KNA1-NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'上年结转'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&gt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_KNB1-KUNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本年累计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'本年累计'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'31'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'12'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;借方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB-JIE&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-JIE&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贷方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB-DAI&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-DAI&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;增加空白页<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_KNA1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_KNA1&nbsp;INTO&nbsp;LW_KNA1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KUNNR&nbsp;=&nbsp;LW_KNB1-KUNNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_KNA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'客户：'&nbsp;&&&nbsp;LW_KNB1-KUNNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_KNA1-NAME1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
**<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_KNA1-KUNNR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;GT_TAB&nbsp;STABLE&nbsp;BY&nbsp;KEY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&取供应商数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_LIFNR_DATA.<br />
&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_BSIK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-BUKRS,&nbsp;"公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-GJAHR,&nbsp;"会计年度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-LIFNR,&nbsp;"会计科目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BELNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-BELNR,&nbsp;"会计编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUZEI&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-BUZEI,&nbsp;"行项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHKZG&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-SHKZG,&nbsp;"借贷标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUDAT&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-BUDAT,&nbsp;"过账日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-DMBTR,&nbsp;"发生额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XNEGP&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSIK-XNEGP,&nbsp;"反记账标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BKTXT&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-BKTXT,&nbsp;"摘要<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_BSIK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_NEXT&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_BSIK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-TABIX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;DMBTR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;TYPE&nbsp;DMBTR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_LFB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFB1-BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFB1-LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_LFB1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_LFA1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFA1-LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFA1-NAME1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_LFA1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_LFC1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC1-LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC1-BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC1-GJAHR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UMSAV&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC1-UMSAV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_LFC1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_LFC1&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_LFC1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_LFC3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC3-LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC3-BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC3-GJAHR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHBKZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC3-SHBKZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALDV&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC3-SALDV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_LFC3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_LFC3&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_LFC3&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_QICHU,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC1-LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DMBTR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFC1-UMSAV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_QICHU,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_QICHU&nbsp;&nbsp;LIKE&nbsp;LW_QICHU&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_LFA1&nbsp;LIKE&nbsp;LW_LFA1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TMP&nbsp;&nbsp;LIKE&nbsp;LW_BSIK&nbsp;OCCURS&nbsp;0&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB&nbsp;&nbsp;TYPE&nbsp;ZFIRP0190,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_LFB1&nbsp;LIKE&nbsp;LW_LFB1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_BSIK&nbsp;LIKE&nbsp;LW_BSIK&nbsp;OCCURS&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;取总账未清<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUZEI<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~DMBTR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~XNEGP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~BKTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_BSIK<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;BSIK&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;BKPF&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BUKRS&nbsp;=&nbsp;B~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MONAT&nbsp;IN&nbsp;S_MONAT<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~LIFNR&nbsp;IN&nbsp;S_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取总账已清<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUZEI<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BUDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~DMBTR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~XNEGP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~BKTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPENDING&nbsp;TABLE&nbsp;LT_BSIK<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;BSAK&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;BKPF&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BUKRS&nbsp;=&nbsp;B~BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MONAT&nbsp;IN&nbsp;S_MONAT<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~LIFNR&nbsp;IN&nbsp;S_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取科目描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LT_TMP&nbsp;=&nbsp;LT_BSIK.<br />
&nbsp;&nbsp;SORT&nbsp;LT_TMP&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_TMP&nbsp;COMPARING&nbsp;LIFNR.<br />
&nbsp;&nbsp;IF&nbsp;LT_TMP&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;LT_TMP-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;SELECT&nbsp;LIFNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_LFA1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFA1<br />
*&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;IN&nbsp;S_LIFNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
*&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;取供应商统驭科目余额<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UMSAV<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_LFC1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFC1<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;IN&nbsp;S_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取供应商特殊总账科目余额<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHBKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALDV<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_LFC3<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFC3<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;IN&nbsp;S_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;IN&nbsp;S_GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;按科目汇总<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_LFC1&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_LFC3&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_LFC1&nbsp;INTO&nbsp;LW_LFC1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-DMBTR&nbsp;=&nbsp;LW_QICHU-DMBTR&nbsp;+&nbsp;LW_LFC1-UMSAV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-LIFNR&nbsp;=&nbsp;LW_LFC1-LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;END&nbsp;OF&nbsp;LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_QICHU&nbsp;TO&nbsp;LT_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_LFC3&nbsp;INTO&nbsp;LW_LFC3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-DMBTR&nbsp;=&nbsp;LW_QICHU-DMBTR&nbsp;+&nbsp;LW_LFC3-SALDV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_QICHU-LIFNR&nbsp;=&nbsp;LW_LFC3-LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;END&nbsp;OF&nbsp;LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;LW_QICHU&nbsp;INTO&nbsp;LT_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;数据处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_LFA1&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_QICHU&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_BSIK&nbsp;BY&nbsp;LIFNR&nbsp;BUDAT&nbsp;BUKRS&nbsp;GJAHR&nbsp;BELNR&nbsp;BUZEI.<br />
<br />
&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;LINES(&nbsp;LT_BSIK&nbsp;).<br />
&nbsp;&nbsp;SORT&nbsp;LT_LFA1&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_BSIK&nbsp;INTO&nbsp;LW_BSIK.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;判定是否到科目最后一条<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_END.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_LINE&nbsp;=&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;L_TABIX&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSIK&nbsp;INTO&nbsp;LW_NEXT&nbsp;INDEX&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_NEXT-LIFNR&nbsp;&lt;&gt;&nbsp;LW_BSIK-LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;标题等<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_LFA1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_LFA1&nbsp;INTO&nbsp;LW_LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;LW_BSIK-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;上年结转<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;CHANGE&nbsp;OF&nbsp;LW_BSIK-LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_QICHU&nbsp;INTO&nbsp;LW_QICHU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;LW_BSIK-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_LFA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'供应商：'&nbsp;&&&nbsp;LW_BSIK-LIFNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_LFA1-NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'上年结转'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&gt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDON.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;赋值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_LFA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'供应商：'&nbsp;&&&nbsp;LW_BSIK-LIFNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_LFA1-NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-BUDAT+0(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-BUDAT+4(2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-BUDAT+6(2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BELNR&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-BKTXT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIK-XNEGP&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIK-SHKZG&nbsp;=&nbsp;'S'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-DMBTR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-DMBTR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIK-SHKZG&nbsp;=&nbsp;'H'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-DMBTR&nbsp;*&nbsp;-1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-DMBTR&nbsp;*&nbsp;-1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;=&nbsp;LW_TAB-DAI&nbsp;-&nbsp;LW_TAB-JIE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_DMBTR&nbsp;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'贷'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'借'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;=&nbsp;L_DMBTRS&nbsp;+&nbsp;L_DMBTR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DMBTRS.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_BSIK-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTR&nbsp;=&nbsp;LW_TAB-JIE&nbsp;-&nbsp;LW_TAB-DAI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;=&nbsp;L_DMBTRS&nbsp;+&nbsp;L_DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_DMBTRS&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;L_DMBTRS&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_BSIK-LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;科目变化时<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_END&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*****************modify&nbsp;&nbsp;by&nbsp;liquan&nbsp;&nbsp;2015.11.18&nbsp;start&nbsp;*************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_CAL_HJ.<br />
   </div>
   <div class="codeComment">
*****************modify&nbsp;&nbsp;by&nbsp;liquan&nbsp;&nbsp;2015.11.18&nbsp;&nbsp;&nbsp;end&nbsp;*************<br />
*&nbsp;如果科目选中,则输出空白页<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_CHK&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_LFB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;LIFNR&nbsp;IN&nbsp;S_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_LFB1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_LFB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;LT_LFB1-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_LFB1&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_LFA1&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_LFB1&nbsp;INTO&nbsp;LW_LFB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_TAB&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;KEY&nbsp;=&nbsp;LW_LFB1-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上年结转及本年累计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_QICHU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_QICHU&nbsp;INTO&nbsp;LW_QICHU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;LW_LFB1-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_LFA1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_LFA1&nbsp;INTO&nbsp;LW_LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;LW_LFB1-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_LFA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'供应商：'&nbsp;&&&nbsp;LW_LFB1-LIFNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_LFA1-NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'上年结转'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&gt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_QICHU-DMBTR&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-JIE&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'借'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DAI&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-HE&nbsp;&nbsp;=&nbsp;'贷'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LW_QICHU-DMBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-DIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_LFB1-LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DMBTRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_QICHU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本年累计<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-TXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'本年累计'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'31'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-YUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'12'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;借方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB-JIE&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-JIE&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB-JIE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贷方为0处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;LW_TAB-DAI&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_TAB-DAI&nbsp;=&nbsp;'0.00'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB-DAI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;增加空白页<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_TAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_LFA1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_LFA1&nbsp;INTO&nbsp;LW_LFA1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;LW_LFB1-LIFNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-BIAOTI&nbsp;=&nbsp;LW_LFA1-NAME1&nbsp;&&&nbsp;'明细账'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEMU&nbsp;&nbsp;&nbsp;=&nbsp;'供应商：'&nbsp;&&&nbsp;LW_LFB1-LIFNR&nbsp;&nbsp;&&&nbsp;'&nbsp;-&nbsp;'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_TAB-KEMU&nbsp;LW_LFA1-NAME1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_TAB-KEMU&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
**<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-NIAN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_GJAHR-LOW&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_LFA1-LIFNR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_TAB&nbsp;TO&nbsp;GT_TAB.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;GT_TAB&nbsp;STABLE&nbsp;BY&nbsp;KEY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&打印<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_PRINT.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_OPTIONS&nbsp;TYPE&nbsp;SSFCRESOP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_CONTROL&nbsp;TYPE&nbsp;SSFCTRLOP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_PRINT&nbsp;&nbsp;&nbsp;TYPE&nbsp;SSFCOMPOP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FNAME&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RS38L_FNAM.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;获取SMARTFORM的MODULE名<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'SSF_FUNCTION_MODULE_NAME'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZFIRP0190_SF'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FM_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_FNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_FORM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_FUNCTION_MODULE&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'系统错误'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;打印<br />
*&nbsp;LW_CONTROL-NO_DIALOG&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LW_CONTROL-PREVIEW&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LW_CONTROL-LANGU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-LANGU.<br />
&nbsp;&nbsp;LW_PRINT-TDIMMED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LW_PRINT-TDDEST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZP01'.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;L_FNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTROL_PARAMETERS&nbsp;=&nbsp;LW_CONTROL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER_SETTINGS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SPACE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT_OPTIONS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_PRINT<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOB_OUTPUT_OPTIONS&nbsp;=&nbsp;LW_OPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_TAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMATTING_ERROR&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTERNAL_ERROR&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEND_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER_CANCELED&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;CASE&nbsp;SY-SUBRC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'4'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'取消打印'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-MSGTY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SY-MSGV2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SY-MSGV3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDCASE.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&数据检查<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_CHECK_DATA.<br />
   </div>
   <div class="codeComment">
*&nbsp;公司代码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_BUKRS[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;CURSOR&nbsp;FIELD&nbsp;'S_BUKRS-LOW'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'公司代码为必输项'.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;会计年度<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_GJAHR[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;CURSOR&nbsp;FIELD&nbsp;'S_GJAHR-LOW'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'会计年度为必输项'.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;总账会计科目<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_1&nbsp;=&nbsp;'X'<br />
&nbsp;AND&nbsp;S_HKONT[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;CURSOR&nbsp;FIELD&nbsp;'S_HKONT-LOW'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'总账会计科目为必输项'.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;客户账户<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_2&nbsp;=&nbsp;'X'<br />
&nbsp;AND&nbsp;S_KUNNR[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;CURSOR&nbsp;FIELD&nbsp;'S_KUNNR-LOW'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'客户账户为必输项'.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;供应商账户<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;P_3&nbsp;=&nbsp;'X'<br />
&nbsp;AND&nbsp;S_LIFNR[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;CURSOR&nbsp;FIELD&nbsp;'S_LIFNR-LOW'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'供应商账户为必输项'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*Text&nbsp;elements<br />
*----------------------------------------------------------<br />
*&nbsp;001&nbsp;查询方式<br />
*&nbsp;002&nbsp;查询条件<br />
<br />
<br />
*Selection&nbsp;texts<br />
*----------------------------------------------------------<br />
*&nbsp;P_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;按总账<br />
*&nbsp;P_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;按客户<br />
*&nbsp;P_3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;按供应商<br />
*&nbsp;P_CHK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;无发生额不显示<br />
*&nbsp;S_BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;公司代码<br />
*&nbsp;S_GJAHR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;会计年度<br />
*&nbsp;S_HKONT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;总账会计科目<br />
*&nbsp;S_KUNNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;客户账户<br />
*&nbsp;S_LIFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;供应商账户<br />
*&nbsp;S_MONAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;会计期间<br />
<br />
<br />
*Messages<br />
*----------------------------------------------------------<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;00<br />
*001&nbsp;&nbsp;&nbsp;&1&2&3&4&5&6&7&8<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;ZCB<br />
*000&nbsp;&nbsp;&nbsp;&1&2&3&4<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
