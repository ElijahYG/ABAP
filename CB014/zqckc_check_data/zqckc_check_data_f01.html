<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZQCKC_CHECK_DATA_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZQCKC_CHECK_DATA_F01</h2>
<h3> Description: Include ZQCKC_CHECK_DATA_F01</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;包含&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZQCKC_CHECK_DATA_F01<br />
*&---------------------------------------------------------------------*<br />
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_DIS_ALV<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_DIS_ALV .<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_BUILD_FIELDCAT.&nbsp;&nbsp;&nbsp;"&nbsp;设置显示字段属性<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_BUILD_LAYOUT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;设置屏幕布局<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_ALV_DISPLAY.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ALV显示<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_BUILD_FIELDCAT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置显示字段属性<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_BUILD_FIELDCAT .<br />
&nbsp;&nbsp;REFRESH&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'SEQ'&nbsp;&nbsp;'序号'&nbsp;&nbsp;&nbsp;6.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'WERKS'&nbsp;&nbsp;'地点'&nbsp;4.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'LGORT'&nbsp;&nbsp;'库存地点'&nbsp;4.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'BWART'&nbsp;&nbsp;'移动类型'&nbsp;3.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'MATNR'&nbsp;&nbsp;'商品'&nbsp;10.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'CHARG'&nbsp;&nbsp;'批次'&nbsp;10.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'LIFNR'&nbsp;&nbsp;'供应商'&nbsp;10.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ZXSJS'&nbsp;&nbsp;'件数'&nbsp;10.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ZXSKZ'&nbsp;&nbsp;'克重'&nbsp;10.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'AMOUNT'&nbsp;&nbsp;'金额'&nbsp;13.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ERDAT'&nbsp;'上传日期'&nbsp;10.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ERZET'&nbsp;'上传时间'&nbsp;8.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ERNAM'&nbsp;'上传人'&nbsp;12.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'CHKFLG'&nbsp;'检查标志'&nbsp;12.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ERR_MSG'&nbsp;'错误消息'&nbsp;100.<br />
ENDFORM.                    " FRM_BUILD_FIELDCAT<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SUB_SET_FIELDS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SUB_SET_FIELDS USING I_FIELDNAME TYPE SLIS_FIELDNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_REPTEXT&nbsp;TYPE&nbsp;DD03P-REPTEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_OUTPUTLEN&nbsp;TYPE&nbsp;DD03P-OUTPUTLEN.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;I_FIELDNAME.<br />
&nbsp;&nbsp;GS_FIELDCAT-REPTEXT_DDIC&nbsp;=&nbsp;I_REPTEXT.<br />
&nbsp;&nbsp;GS_FIELDCAT-NO_ZERO&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;I_OUTPUTLEN.<br />
&nbsp;&nbsp;IF&nbsp;I_FIELDNAME&nbsp;=&nbsp;'BOX'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
ENDFORM.                    "SUB_SET_FIELDS<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_BUILD_LAYOUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置屏幕布局<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_BUILD_LAYOUT .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;输出长度的最优化设计<br />
*&nbsp;&nbsp;gs_layout-colwidth_optimize&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;gs_layout-box_fieldname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'BOX'.<br />
<br />
   </div>
   <div class="code">
ENDFORM.                    " FRM_BUILD_LAYOUT<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_ALV_DISPLAY<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALV显示<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_ALV_DISPLAY .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;调用ALV&nbsp;FUNCTION<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'FRM_PF_STATUS_SET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'FRM_USER_COMMAND'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_HTML_TOP_OF_PAGE&nbsp;=&nbsp;'HTML_TOP_OF_PAGE'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_DATA.<br />
<br />
ENDFORM.                    " FRM_ALV_DISPLAY<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_PF_STATUS_SET<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置状态栏<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_PF_STATUS_SET USING RT_EXTAB TYPE SLIS_T_EXTAB.<br />
<br />
&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'STANDARD'.<br />
<br />
ENDFORM.                    " FRM_PF_STATUS_SET<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_USER_COMMAND<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定义按钮功能<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_USER_COMMAND  USING R_UCOMM LIKE SY-UCOMM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;G_GRID&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.&nbsp;"&nbsp;刷新数据<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;G_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;CHECK_CHANGED_DATA.<br />
&nbsp;&nbsp;IF&nbsp;NOT&nbsp;G_GRID&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;REFRESH_TABLE_DISPLAY.&nbsp;"refresh&nbsp;alv<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SAVE'.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
<br />
ENDFORM.                    " FRM_USER_COMMAND<br />
<br />
FORM HTML_TOP_OF_PAGE USING CL_DD TYPE REF TO CL_DD_DOCUMENT.<br />
&nbsp;&nbsp;DATA&nbsp;LV_TEXT&nbsp;TYPE&nbsp;C&nbsp;LENGTH&nbsp;255&nbsp;.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_MSG&nbsp;INTO&nbsp;GS_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;GS_MSG-ID&nbsp;TYPE&nbsp;GS_MSG-TYPE&nbsp;NUMBER&nbsp;GS_MSG-NUMBER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;GS_MSG-MESSAGE_V1&nbsp;GS_MSG-MESSAGE_V2&nbsp;GS_MSG-MESSAGE_V3&nbsp;GS_MSG-MESSAGE_V4&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_DD-&gt;ADD_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT&nbsp;=&nbsp;LV_TEXT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_DD-&gt;NEW_LINE&nbsp;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM .<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CHECK_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_CHECK_DATA .<br />
&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;WA_DATA&gt;&nbsp;LIKE&nbsp;GS_DATA&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;WA_SITE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;TYPE&nbsp;T001W-WERKS,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;WA_SITE&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;IT_SITE&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;WA_SITE&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;WA_T001L&nbsp;TYPE&nbsp;T001L,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_T001L&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;WA_T001L&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;WA_VENDOR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;TYPE&nbsp;LFA1-LIFNR,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;WA_VENDOR.<br />
&nbsp;&nbsp;DATA:&nbsp;IT_VENDOR&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;WA_VENDOR&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;WA_MARC,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MARC-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;TYPE&nbsp;MARC-WERKS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MEINS&nbsp;TYPE&nbsp;MARA-MEINS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;XCHPF&nbsp;TYPE&nbsp;MARA-XCHPF,<br />
&nbsp;&nbsp;&nbsp;&nbsp;TEMPB&nbsp;TYPE&nbsp;MARA-TEMPB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;XCHAR&nbsp;TYPE&nbsp;MARC-XCHAR,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;WA_MARC.<br />
&nbsp;&nbsp;DATA:&nbsp;IT_MARC&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;WA_MARC&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;IT_MATNR&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;GS_DATA&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_ZXSJS&nbsp;LIKE&nbsp;GS_DATA-ZXSJS&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_INTERVAL&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;INRIV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_INTERVAL&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;LT_INTERVAL&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_CHARG&nbsp;TYPE&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARG&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CHARACTERS&nbsp;TYPE&nbsp;ZMM_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARACTERS&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MOD&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;4&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_BATCH_IN_SAP&nbsp;TYPE&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_BATCH_IN_SAP&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_BATCH_IN_SAP&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_AMOUNT&nbsp;LIKE&nbsp;GS_DATA-AMOUNT&nbsp;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;RB_1&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;检查没有检查过的数据<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_DATA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMM_QCKC<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;IN&nbsp;S_WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CHKFLG&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZZHAS_IMPORT&nbsp;=&nbsp;''&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ELSEIF&nbsp;RB_2&nbsp;=&nbsp;'X'&nbsp;.&nbsp;"检查没有检查过，和已检查但有错的数据<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_DATA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMM_QCKC<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;IN&nbsp;S_WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(&nbsp;CHKFLG&nbsp;=&nbsp;''&nbsp;OR&nbsp;CHKFLG&nbsp;=&nbsp;'E'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZZHAS_IMPORT&nbsp;=&nbsp;''&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_DATA[]&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'没有查询符合条件的数据！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;STOP&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得地点主数据<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_SITE<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;T001W<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;IN&nbsp;S_WERKS&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得库存地点主数据<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;IT_T001L<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;T001L<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;IN&nbsp;S_WERKS&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得供应商主数据<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_VENDOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFA1&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得批次的Number&nbsp;Range<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NUMBER_RANGE_INTERVAL_LIST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'02'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'BATCH_CLT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTERVAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_INTERVAL<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR1_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR1_NOT_INTERN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR2_MUST_BE_SPACE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR2_NOT_EXTERN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR2_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBOBJECT_MUST_BE_SPACE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBOBJECT_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_INTERVAL&nbsp;INTO&nbsp;WA_INTERVAL&nbsp;INDEX&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得商品主数据<br />
&nbsp;&nbsp;IT_MATNR[]&nbsp;=&nbsp;GT_DATA[]&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;IT_MATNR&nbsp;BY&nbsp;MATNR&nbsp;.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_MATNR&nbsp;COMPARING&nbsp;MATNR&nbsp;.<br />
&nbsp;&nbsp;SELECT&nbsp;MARC~MATNR&nbsp;MARC~WERKS&nbsp;MARA~MEINS&nbsp;MARA~XCHPF&nbsp;MARA~TEMPB&nbsp;MARC~XCHAR<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_MARC<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MARC<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;MARA&nbsp;ON&nbsp;MARA~MATNR&nbsp;=&nbsp;MARC~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MARC~MATNR&nbsp;=&nbsp;IT_MATNR-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;MARC~WERKS&nbsp;IN&nbsp;S_WERKS&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得批次特性<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GT_DATA&nbsp;TO&nbsp;LT_CHARG&nbsp;.<br />
&nbsp;&nbsp;DELETE&nbsp;LT_CHARG&nbsp;WHERE&nbsp;CHARG&nbsp;IS&nbsp;INITIAL&nbsp;.&nbsp;"&nbsp;删除没有批次的行项目<br />
&nbsp;&nbsp;SORT&nbsp;LT_CHARG&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_CHARG&nbsp;COMPARING&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zsdrp0020_fm_01/zsdrp0020_fm_01.html">'ZSDRP0020_FM_01'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARACTERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_CHARACTERS&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得在SAP中已经存在的批次<br />
&nbsp;&nbsp;LT_BATCH_IN_SAP[]&nbsp;=&nbsp;LT_CHARG[]&nbsp;.<br />
&nbsp;&nbsp;CLEAR:LS_BATCH_IN_SAP&nbsp;.<br />
&nbsp;&nbsp;MODIFY&nbsp;LT_BATCH_IN_SAP&nbsp;FROM&nbsp;LS_BATCH_IN_SAP&nbsp;TRANSPORTING&nbsp;MATNR&nbsp;WHERE&nbsp;CHARG&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;LT_BATCH_IN_SAP&nbsp;BY&nbsp;CHARG&nbsp;.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_BATCH_IN_SAP&nbsp;COMPARING&nbsp;CHARG&nbsp;.<br />
&nbsp;&nbsp;SELECT&nbsp;MATNR&nbsp;CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_BATCH_IN_SAP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MCH1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_BATCH_IN_SAP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;CHARG&nbsp;=&nbsp;LT_BATCH_IN_SAP-CHARG&nbsp;.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_DATA&nbsp;ASSIGNING&nbsp;&lt;WA_DATA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;&lt;WA_DATA&gt;-ERR_MSG,&nbsp;LS_CHARACTERS,WA_SITE,WA_T001L,WA_MARC,WA_VENDOR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-WERKS&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'地点不能为空！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_SITE&nbsp;INTO&nbsp;WA_SITE&nbsp;WITH&nbsp;KEY&nbsp;WERKS&nbsp;=&nbsp;&lt;WA_DATA&gt;-WERKS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'地点在SAP不存在！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查库存地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-LGORT&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'库存地点不能为空！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_T001L&nbsp;INTO&nbsp;WA_T001L&nbsp;WITH&nbsp;KEY&nbsp;WERKS&nbsp;=&nbsp;&lt;WA_DATA&gt;-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LGORT&nbsp;=&nbsp;&lt;WA_DATA&gt;-LGORT&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'地点+库存地点在SAP不存在！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查商品<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-MATNR&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'商品不能为空！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_MARC&nbsp;INTO&nbsp;WA_MARC&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;WA_DATA&gt;-MATNR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'商品在SAP不存在！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_MARC-MEINS&nbsp;&lt;&gt;&nbsp;'ST'&nbsp;AND&nbsp;WA_MARC-MEINS&nbsp;&lt;&gt;&nbsp;'G'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'商品单位既不是G也不是PC！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"检查商品是否列表到地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_MARC&nbsp;INTO&nbsp;WA_MARC&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;WA_DATA&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;=&nbsp;&lt;WA_DATA&gt;-WERKS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'商品没有列表到该地点！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MARC-XCHAR&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'批次不能为空！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_MARC-XCHAR&nbsp;=&nbsp;''&nbsp;AND&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'该商品在该地点不需要批次管理，不需要填写批次！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查批号<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;WA_MARC-XCHPF&nbsp;=&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'批次不能为空！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;AND&nbsp;WA_MARC-XCHPF&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'该商品不管理批次，批次应该为空！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查批号的号码段<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;(&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;&gt;=&nbsp;WA_INTERVAL-FROMNUMBER&nbsp;AND&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;&lt;=&nbsp;WA_INTERVAL-TONUMBER&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'批次号码不在号码范围内！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查批次是否在系统中存在，以及批次号码是否分配给其他商品<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BATCH_IN_SAP&nbsp;INTO&nbsp;LS_BATCH_IN_SAP&nbsp;WITH&nbsp;KEY&nbsp;CHARG&nbsp;=&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_BATCH_IN_SAP-MATNR&nbsp;&lt;&gt;&nbsp;&lt;WA_DATA&gt;-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'该批次号码在系统中已分配给其他商品：'&nbsp;&&&nbsp;LS_BATCH_IN_SAP-MATNR&nbsp;&&&nbsp;'！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_CHKPC&nbsp;=&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'该批次号码在系统中不存在！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查供应商<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-LIFNR&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_VENDOR&nbsp;INTO&nbsp;WA_VENDOR&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;&lt;WA_DATA&gt;-LIFNR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'供应商在SAP不存在！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查移动类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NOT&nbsp;(&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'561'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'562'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'511'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'512'&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'移动类型只能是511/512/561/562！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-LIFNR&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;(&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'511'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'512'&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'移动类型是511/512时必须输入供应商！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-LIFNR&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;AND&nbsp;(&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'561'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'562'&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'输入了供应商的，移动类型不能是561/562！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MARC-MEINS&nbsp;=&nbsp;'ST'&nbsp;AND&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'商品单位是PC必须输入件数！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;&lt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'件数不能是负数！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_ZXSJS&nbsp;=&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;&nbsp;DIV&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_ZXSJS&nbsp;&lt;&gt;&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'件数不能有小数！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MARC-TEMPB&nbsp;=&nbsp;'01'&nbsp;AND&nbsp;&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;&gt;&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'该商品是一般商品，件数不能大于1！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'克重商品批次不能为空！'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MARC-MEINS&nbsp;=&nbsp;'G'&nbsp;AND&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'商品单位是G必须输入克重！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;&lt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'克重不能是负数！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查金额，联营商品金额为0，<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_CHKVA&nbsp;=&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'561'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'562'&nbsp;)&nbsp;AND&nbsp;&lt;WA_DATA&gt;-AMOUNT&nbsp;&lt;=&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'经销商品必须有正数金额！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'511'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'512'&nbsp;)&nbsp;AND&nbsp;&lt;WA_DATA&gt;-AMOUNT&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'联营商品不能有金额！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;检查金额是否小数点后超过2位<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-AMOUNT&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;LV_AMOUNT&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_AMOUNT&nbsp;=&nbsp;&lt;WA_DATA&gt;-AMOUNT&nbsp;*&nbsp;100&nbsp;DIV&nbsp;1&nbsp;/&nbsp;100&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_AMOUNT&nbsp;&lt;&gt;&nbsp;&lt;WA_DATA&gt;-AMOUNT&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'金额最多只能小数点后2位！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;根据批次特性检查<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_CHARACTERS&nbsp;INTO&nbsp;LS_CHARACTERS&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;WA_DATA&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;&lt;WA_DATA&gt;-CHARG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CHARACTERS-SFLY&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;(&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'561'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'562'&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'联营批次商品的移动类型不能是561/562！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CHARACTERS-SFLY&nbsp;=&nbsp;''&nbsp;AND&nbsp;(&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'511'&nbsp;OR&nbsp;&lt;WA_DATA&gt;-BWART&nbsp;=&nbsp;'512'&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'非联营批次商品的移动类型不能是511/512！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MARC-MEINS&nbsp;=&nbsp;'G'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"01&nbsp;一般商品,&nbsp;02&nbsp;&nbsp;批次码,&nbsp;03&nbsp;大类码,&nbsp;X&nbsp;&nbsp;其他<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;无论是什么条码类型的克重商品，其库存重量除以件数应该等于单位克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;/&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;)&nbsp;&lt;&gt;&nbsp;LS_CHARACTERS-ZJZ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'库存克重'&nbsp;&&&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;&&&nbsp;'除以库存件数'&nbsp;&&<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;&&&nbsp;'与单品克重'&nbsp;&&&nbsp;LS_CHARACTERS-ZJZ&nbsp;&&&nbsp;'不匹配'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;导入的件数为0时，当作1来处理<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;/&nbsp;1&nbsp;)&nbsp;&lt;&gt;&nbsp;LS_CHARACTERS-ZJZ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'库存克重'&nbsp;&&&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;&&&nbsp;'除以库存件数'&nbsp;&&<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ZXSJS&nbsp;&&&nbsp;'与单品克重'&nbsp;&&&nbsp;LS_CHARACTERS-ZJZ&nbsp;&&&nbsp;'不匹配'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MARC-TEMPB&nbsp;=&nbsp;'01'&nbsp;.&nbsp;"&nbsp;01&nbsp;&nbsp;一般商品，一个批次只能有一件商品<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CHARACTERS-ZJZ&nbsp;&lt;&gt;&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'一般商品单品克重：'&nbsp;&&&nbsp;LS_CHARACTERS-ZJZ&nbsp;&&&nbsp;'和库存克重：'&nbsp;&&&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;&&&nbsp;'不匹配'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CHARACTERS-ZJZ&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MOD&nbsp;=&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;MOD&nbsp;LS_CHARACTERS-ZJZ&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_MOD&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;=&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;&&&nbsp;'批次/大类码商品单品克重：'&nbsp;&&&nbsp;LS_CHARACTERS-ZJZ&nbsp;&&&nbsp;'和库存克重：'&nbsp;&&&nbsp;&lt;WA_DATA&gt;-ZXSKZ&nbsp;&&&nbsp;'不匹配'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_DATA&gt;-ERR_MSG&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-CHKFLG&nbsp;=&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_DATA&gt;-CHKFLG&nbsp;=&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_UPDATE_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_UPDATE_DATA .<br />
&nbsp;&nbsp;IF&nbsp;GT_DATA[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMM_QCKC&nbsp;FROM&nbsp;TABLE&nbsp;GT_DATA&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
