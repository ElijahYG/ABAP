<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZQC_PUR_INFO_CHECK_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZQC_PUR_INFO_CHECK_F01</h2>
<h3> Description: Include ZQC_BATCH_CHECK_F01</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;包含&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZQC_BATCH_CHECK_F01<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SELECT_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_SELECT_DATA .<br />
&nbsp;&nbsp;IF&nbsp;RB_1&nbsp;=&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;GT_PUR_INFO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZQC_PUR_INFO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SEQ&nbsp;IN&nbsp;S_SEQ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CHKFLG&nbsp;IN&nbsp;(&nbsp;'','E'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZZHAS_IMPORT&nbsp;&lt;&gt;&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;ELSEIF&nbsp;RB_2&nbsp;=&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;GT_PUR_INFO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZQC_PUR_INFO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SEQ&nbsp;IN&nbsp;S_SEQ<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CHKFLG&nbsp;IN&nbsp;(&nbsp;'','E'&nbsp;)<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZZHAS_IMPORT&nbsp;&lt;&gt;&nbsp;'S'&nbsp;..<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CHECK_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_CHECK_DATA .<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;GS_PUR_INFO&gt;&nbsp;LIKE&nbsp;GS_PUR_INFO&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;LS_ZGYSDM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGYSDM&nbsp;TYPE&nbsp;ZQC_PUR_INFO-ZGYSDM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LS_ZGYSDM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LS_ZSPKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPKH&nbsp;TYPE&nbsp;ZQC_PUR_INFO-ZSPKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LS_ZSPKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LS_EKORG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKORG&nbsp;LIKE&nbsp;ZQC_PUR_INFO-EKORG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LS_EKORG&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZGYSDM&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_ZGYSDM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ZSPKH&nbsp;LIKE&nbsp;&nbsp;TABLE&nbsp;OF&nbsp;LS_ZSPKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EKORG&nbsp;LIKE&nbsp;&nbsp;TABLE&nbsp;OF&nbsp;LS_EKORG.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_VJSFS&nbsp;TYPE&nbsp;ZMMDG0010_VJSFS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_VJSFS&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_VJSFS&nbsp;.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;GV_NUM_ALL,GV_NUM_ERR,GV_NUM_RIGHT,GV_NUM_NEED_IMPORT&nbsp;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_PUR_INFO[]&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得供应商编码<br />
&nbsp;&nbsp;SELECT&nbsp;LIFNR&nbsp;AS&nbsp;ZGYSDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZGYSDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFA1&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得商品编码<br />
&nbsp;&nbsp;SELECT&nbsp;MATNR&nbsp;AS&nbsp;ZSPKH<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZSPKH<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MARA&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得采购组织<br />
&nbsp;&nbsp;SELECT&nbsp;EKORG<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_EKORG<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;T024E&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得业务类型和结算类型对应关系<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_VJSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMDG0010_VJSFS&nbsp;.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_ZGYSDM&nbsp;BY&nbsp;ZGYSDM&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;LT_ZSPKH&nbsp;BY&nbsp;ZSPKH&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;LT_EKORG&nbsp;BY&nbsp;EKORG&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;LT_VJSFS&nbsp;BY&nbsp;ZYWLX&nbsp;ZJSFS&nbsp;.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_PUR_INFO&nbsp;ASSIGNING&nbsp;&lt;GS_PUR_INFO&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;&lt;GS_PUR_INFO&gt;-CHKFLG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-NEED_IMPORT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ZZHAS_IMPORT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;供应商编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-ZGYSDM&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'供应商编码不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZGYSDM&nbsp;INTO&nbsp;LS_ZGYSDM&nbsp;WITH&nbsp;KEY&nbsp;ZGYSDM&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZGYSDM&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'供应商编码'&nbsp;&&&nbsp;&lt;GS_PUR_INFO&gt;-ZGYSDM&nbsp;&&&nbsp;'在SAP不存在;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;商品款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-ZSPKH&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSPKH&nbsp;INTO&nbsp;LS_ZSPKH&nbsp;WITH&nbsp;KEY&nbsp;ZSPKH&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZSPKH&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'商品款号'&nbsp;&&&nbsp;&lt;GS_PUR_INFO&gt;-ZSPKH&nbsp;&&&nbsp;'在SAP不存在;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;采购组织<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-EKORG&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'采购组织不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EKORG&nbsp;INTO&nbsp;LS_EKORG&nbsp;WITH&nbsp;KEY&nbsp;EKORG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-EKORG&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'采购组织'&nbsp;&&&nbsp;&lt;GS_PUR_INFO&gt;-EKORG&nbsp;&&&nbsp;'在SAP不存在;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;业务方式<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-ZYWLX&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'业务类型不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_VJSFS&nbsp;INTO&nbsp;LS_VJSFS&nbsp;WITH&nbsp;KEY&nbsp;ZYWLX&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZYWLX&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'业务类型'&nbsp;&&&nbsp;&lt;GS_PUR_INFO&gt;-ZYWLX&nbsp;&&&nbsp;'在SAP不存在;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;结算方式<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-ZLYJSFS&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'结算方式不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_VJSFS&nbsp;INTO&nbsp;LS_VJSFS&nbsp;WITH&nbsp;KEY&nbsp;ZJSFS&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZLYJSFS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'结算方式'&nbsp;&&&nbsp;&lt;GS_PUR_INFO&gt;-ZLYJSFS&nbsp;&&&nbsp;'在SAP不存在;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;业务方类型和结算方式的组合<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_VJSFS&nbsp;INTO&nbsp;LS_VJSFS&nbsp;WITH&nbsp;KEY&nbsp;ZYWLX&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZYWLX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSFS&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZLYJSFS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'业务类型和结算方式的组合在表ZMMDG0010_VJSFS中不存在;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;销售价格单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-ZXSJGJSDW&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'销售价格单位不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-ZXSJGJSDW&nbsp;&lt;&gt;&nbsp;'G'&nbsp;AND&nbsp;&lt;GS_PUR_INFO&gt;-ZXSJGJSDW&nbsp;&lt;&gt;&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'销售价格单位只能是G或PC;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;生效日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-DATAB&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'生效日期不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;截止日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-DATBI&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'截止日期不能为空;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;生效日期&lt;=截止日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-DATAB&nbsp;&gt;&nbsp;&lt;GS_PUR_INFO&gt;-DATBI&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'生效日期不能大于截止日期;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;删除标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-DFLG&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;AND&nbsp;&lt;GS_PUR_INFO&gt;-DFLG&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;&&&nbsp;'删除标记只能为空或X;'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_NUM_ALL&nbsp;=&nbsp;GV_NUM_ALL&nbsp;+&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;GS_PUR_INFO&gt;-ERR_MSG&nbsp;IS&nbsp;INITIAL&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-CHKFLG&nbsp;=&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_NUM_RIGHT&nbsp;=&nbsp;GV_NUM_RIGHT&nbsp;+&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-CHKFLG&nbsp;=&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_NUM_ERR&nbsp;=&nbsp;GV_NUM_ERR&nbsp;+&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GV_NUM_RIGHT&nbsp;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_PUR_INFO_COMPARE&nbsp;.&nbsp;"&nbsp;检查采购信息记录在系统中是否存在，如果存在，是否内容一样<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SAVE_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_SAVE_DATA .<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_PUR_INFO[]&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;MODIFY&nbsp;ZQC_PUR_INFO&nbsp;FROM&nbsp;TABLE&nbsp;GT_PUR_INFO&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_PUR_INFO_COMPARE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_PUR_INFO_COMPARE .<br />
&nbsp;&nbsp;DATA:&nbsp;LS_DB_PUR_INFO&nbsp;TYPE&nbsp;ZMMDG0010_02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_DB_PUR_INFO&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_DB_PUR_INFO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_PUR_INFO_UPLOAD&nbsp;LIKE&nbsp;LS_DB_PUR_INFO&nbsp;.<br />
&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;GS_PUR_INFO&gt;&nbsp;LIKE&nbsp;GS_PUR_INFO&nbsp;.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_DB_PUR_INFO<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMDG0010_02&nbsp;.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_DB_PUR_INFO&nbsp;BY&nbsp;ZGYSDM&nbsp;ZSPKH&nbsp;EKORG&nbsp;ZYWLX&nbsp;ZLYJSFS&nbsp;ZXSJGJSDW&nbsp;.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_PUR_INFO&nbsp;ASSIGNING&nbsp;&lt;GS_PUR_INFO&gt;&nbsp;WHERE&nbsp;CHKFLG&nbsp;=&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_DB_PUR_INFO&nbsp;INTO&nbsp;LS_DB_PUR_INFO&nbsp;WITH&nbsp;KEY&nbsp;ZGYSDM&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZGYSDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPKH&nbsp;&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZSPKH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKORG&nbsp;&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-EKORG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZYWLX&nbsp;&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZYWLX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZLYJSFS&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZLYJSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZXSJGJSDW&nbsp;=&nbsp;&lt;GS_PUR_INFO&gt;-ZXSJGJSDW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;LS_PUR_INFO_UPLOAD&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;GS_PUR_INFO&gt;&nbsp;TO&nbsp;LS_PUR_INFO_UPLOAD&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;LS_PUR_INFO_UPLOAD-ZRQ,LS_PUR_INFO_UPLOAD-ZYHID&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;LS_DB_PUR_INFO-ZRQ,LS_DB_PUR_INFO-ZYHID&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;如果上传采购信息记录在SAP存在，且内容相同，则不需要再导入，否则需要导入<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_DB_PUR_INFO&nbsp;=&nbsp;LS_PUR_INFO_UPLOAD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-NEED_IMPORT&nbsp;=&nbsp;'N'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-NEED_IMPORT&nbsp;=&nbsp;'Y'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_NUM_NEED_IMPORT&nbsp;=&nbsp;GV_NUM_NEED_IMPORT&nbsp;+&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;如果上传采购信息记录在SAP不存在，则需要导入<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_PUR_INFO&gt;-NEED_IMPORT&nbsp;=&nbsp;'Y'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_NUM_NEED_IMPORT&nbsp;=&nbsp;GV_NUM_NEED_IMPORT&nbsp;+&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
