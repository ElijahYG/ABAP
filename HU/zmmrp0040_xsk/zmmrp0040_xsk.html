<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZMMRP0040_XSK</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMRP0040_XSK</h2>
<h3> Description: 配货规则-匹配相似款</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="code">
REPORT ZMMRP0040_XSK.<br />
<br />
TYPE-POOLS: SLIS, VRM.<br />
TABLES ZMMEX0010_MARA.<br />
   </div>
   <div class="codeComment">
************************************************************************<br />
*&nbsp;Types<br />
************************************************************************<br />
   </div>
   <div class="code">
TYPES: BEGIN OF TY_DATA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZYKS&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZXSK&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ1&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ2&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ3&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ4&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ5&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ6&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ7&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ8&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ9&nbsp;&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTJ10&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;TY_DATA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;TY_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-EX_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KCODE&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-EX_KCODE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHK_XSK&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-CHK_XSK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTWG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-EXTWG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ01&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ04&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ04,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;TY_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;TY_MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-EXTWG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_GJS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_GJS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ01&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ02&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ03&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ04&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ04,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_ZT01&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_ZT01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_ZT02&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_ZT02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_ZT03&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_ZT03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_TA01&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_TA01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_TA02&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_TA02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_XZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMP_CODE&nbsp;TYPE&nbsp;C&nbsp;LENGTH&nbsp;100,&nbsp;"&nbsp;匹配码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;TY_MATNR&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
************************************************************************<br />
*&nbsp;Tables<br />
************************************************************************<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;GT_DATA&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMRP0040_XSK,<br />
&nbsp;&nbsp;GS_DATA&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GT_DATA,<br />
&nbsp;&nbsp;G_EXTWG&nbsp;TYPE&nbsp;MARA-EXTWG.<br />
<br />
DATA: GS_MSG TYPE BAPIRET2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GT_MSG&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;GS_MSG.<br />
DATA: GRT_XNKH_UPD TYPE RANGE OF ZMMRP0210_BATCH-EX_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GRT_XNKH_DEL&nbsp;LIKE&nbsp;GRT_XNKH_UPD&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GRT_XNKH_UPD.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;定义ALV显示字段属性内表和工作区<br />
   </div>
   <div class="code">
DATA: GT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT&nbsp;TYPE&nbsp;SLIS_FIELDCAT_ALV,<br />
   </div>
   <div class="codeComment">
*&nbsp;定义ALV屏幕布局工作区<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_LAYOUT&nbsp;&nbsp;&nbsp;TYPE&nbsp;SLIS_LAYOUT_ALV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GT_EVENTS&nbsp;&nbsp;&nbsp;TYPE&nbsp;SLIS_T_EVENT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_EVENTS&nbsp;&nbsp;&nbsp;TYPE&nbsp;SLIS_ALV_EVENT.<br />
DATA: GR_GRID TYPE REF TO CL_GUI_ALV_GRID.<br />
<br />
   </div>
   <div class="codeComment">
************************************************************************<br />
*&nbsp;Parameters<br />
************************************************************************<br />
   </div>
   <div class="code">
SELECTION-SCREEN BEGIN OF BLOCK B01 WITH FRAME TITLE TEXT-T01.<br />
SELECT-OPTIONS  S_EXTWG FOR  G_EXTWG OBLIGATORY.<br />
PARAMETERS      P_MONAT TYPE MONAT.<br />
SELECT-OPTIONS: S_GJS   FOR  ZMMEX0010_MARA-EX_GJS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_PZ01&nbsp;&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-EX_PZ01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_PZ02&nbsp;&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-EX_PZ02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_PZ03&nbsp;&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-EX_PZ03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_PZ04&nbsp;&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-EX_PZ04,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_ZT01&nbsp;&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-EX_ZT01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_ZT02&nbsp;&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-EX_ZT02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_ZT03&nbsp;&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-EX_ZT03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_MATNR&nbsp;FOR&nbsp;&nbsp;ZMMEX0010_MARA-MATNR.<br />
SELECTION-SCREEN END OF BLOCK B01.<br />
<br />
SELECTION-SCREEN BEGIN OF BLOCK B03 WITH FRAME TITLE TEXT-T03.<br />
PARAMETERS: CBX_1 AS CHECKBOX DEFAULT '' .<br />
PARAMETERS: CBX_2 AS CHECKBOX DEFAULT 'X' .<br />
SELECTION-SCREEN END OF BLOCK B03.<br />
   </div>
   <div class="codeComment">
************************************************************************<br />
*&nbsp;At&nbsp;SELECTION-SCREEN<br />
************************************************************************<br />
   </div>
   <div class="code">
AT SELECTION-SCREEN.<br />
<br />
   </div>
   <div class="codeComment">
************************************************************************<br />
*&nbsp;Start&nbsp;of&nbsp;Selection<br />
************************************************************************<br />
   </div>
   <div class="code">
START-OF-SELECTION.<br />
   </div>
   <div class="codeComment">
*&nbsp;取得数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_DATA.<br />
   </div>
   <div class="codeComment">
*&nbsp;保存数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_UPDATE_DATA&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;展示报表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_DIS_RESULT&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_DATA .<br />
&nbsp;&nbsp;REFRESH&nbsp;GT_DATA.<br />
<br />
&nbsp;&nbsp;GET&nbsp;TIME&nbsp;.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_MSG&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'相似款匹配开始，日期：'&nbsp;&&&nbsp;SY-DATUM&nbsp;.&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;'，时间：'&nbsp;&&&nbsp;SY-UZEIT&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_XSK.<br />
<br />
&nbsp;&nbsp;GET&nbsp;TIME&nbsp;.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_MSG&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'相似款匹配结束，日期：'&nbsp;&&&nbsp;SY-DATUM&nbsp;.&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;'，时间：'&nbsp;&&&nbsp;SY-UZEIT&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_XSK<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_XSK .<br />
&nbsp;&nbsp;DATA:&nbsp;LS_XNKH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_XNKH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_XNKH_ALL&nbsp;LIKE&nbsp;LS_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_XNKH_ALL&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_XNKH_TMP&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_XNKH.<br />
&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;LS_XNKH&gt;&nbsp;LIKE&nbsp;LS_XNKH&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_MATNR_1&nbsp;TYPE&nbsp;TY_MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MATNR_2&nbsp;TYPE&nbsp;TY_MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MATNR&nbsp;&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_MATNR_1.<br />
&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;LS_MATNR&gt;&nbsp;LIKE&nbsp;LS_MATNR_1&nbsp;.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_PP&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMRP0040_XSKPP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_PP&nbsp;TYPE&nbsp;ZMMRP0040_XSKPP.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LV_LINES_XNKH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_LINES_XNKH_ALL&nbsp;TYPE&nbsp;I.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得所有相似款匹配规则<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_PP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMRP0040_XSKPP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EX_PZ04&nbsp;IN&nbsp;S_PZ04&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得所有没有检查相似款的虚拟款号<br />
&nbsp;&nbsp;SELECT&nbsp;ZMMRP0210_BATCH~MATNR&nbsp;ZMMRP0210_BATCH~EX_XNKH&nbsp;ZMMRP0210_BATCH~EX_KCODE&nbsp;ZMMRP0210_BATCH~CHK_XSK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARA~EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMEX0010_MARA~EX_PZ01&nbsp;ZMMEX0010_MARA~EX_PZ04<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_XNKH<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMRP0210_BATCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;MARA&nbsp;ON&nbsp;ZMMRP0210_BATCH~MATNR&nbsp;=&nbsp;MARA~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMMEX0010_MARA&nbsp;ON&nbsp;ZMMRP0210_BATCH~MATNR&nbsp;=&nbsp;ZMMEX0010_MARA~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_PP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MARA~MATNR&nbsp;IN&nbsp;S_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;MARA~EXTWG&nbsp;IN&nbsp;S_EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_GJS&nbsp;&nbsp;IN&nbsp;S_GJS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_PZ01&nbsp;IN&nbsp;S_PZ01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_PZ02&nbsp;IN&nbsp;S_PZ02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_PZ03&nbsp;IN&nbsp;S_PZ03<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_PZ04&nbsp;=&nbsp;LT_PP-EX_PZ04<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_ZT01&nbsp;IN&nbsp;S_ZT01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_ZT02&nbsp;IN&nbsp;S_ZT02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_ZT03&nbsp;IN&nbsp;S_ZT03<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMRP0210_BATCH~CHK_XSK&nbsp;=&nbsp;''.&nbsp;"&nbsp;该字段为空表示该条记录没有检查过是否有相似款<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'没有需要匹配相似款的虚拟款号！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;REFRESH&nbsp;LT_XNKH_TMP&nbsp;.<br />
&nbsp;&nbsp;LT_XNKH_TMP[]&nbsp;=&nbsp;LT_XNKH&nbsp;.<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_XNKH&nbsp;.<br />
&nbsp;&nbsp;"&nbsp;只保留EXTWG(大类)、EX_PZ01(品种一级)和EX_PZ04(品种四级)<br />
&nbsp;&nbsp;MODIFY&nbsp;LT_XNKH_TMP&nbsp;FROM&nbsp;LS_XNKH&nbsp;TRANSPORTING&nbsp;MATNR&nbsp;EX_XNKH&nbsp;CHK_XSK&nbsp;WHERE&nbsp;MATNR&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;LT_XNKH_TMP&nbsp;BY&nbsp;EXTWG&nbsp;EX_PZ01&nbsp;EX_PZ04&nbsp;.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_XNKH_TMP&nbsp;COMPARING&nbsp;EXTWG&nbsp;EX_PZ01&nbsp;EX_PZ04.<br />
<br />
&nbsp;&nbsp;"&nbsp;取得相同大类、品种一级的所有虚拟款号<br />
&nbsp;&nbsp;"&nbsp;原理：A和B款相似的前提条件是至少大类和品种一级相同，否则都不用比较其他属性<br />
&nbsp;&nbsp;SELECT&nbsp;ZMMRP0210_BATCH~MATNR&nbsp;ZMMRP0210_BATCH~EX_XNKH&nbsp;ZMMRP0210_BATCH~EX_KCODE&nbsp;ZMMRP0210_BATCH~CHK_XSK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARA~EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMEX0010_MARA~EX_PZ01&nbsp;ZMMEX0010_MARA~EX_PZ04<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_XNKH_ALL<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMRP0210_BATCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;MARA&nbsp;ON&nbsp;ZMMRP0210_BATCH~MATNR&nbsp;=&nbsp;MARA~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMMEX0010_MARA&nbsp;ON&nbsp;ZMMRP0210_BATCH~MATNR&nbsp;=&nbsp;ZMMEX0010_MARA~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_XNKH_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MARA~EXTWG&nbsp;=&nbsp;LT_XNKH_TMP-EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_PZ01&nbsp;=&nbsp;LT_XNKH_TMP-EX_PZ01&nbsp;.<br />
&nbsp;&nbsp;"&nbsp;注意，这里不要着急对LT_XNKH_ALL进行排序和去重，后面有用<br />
<br />
&nbsp;&nbsp;"&nbsp;取得相同大类、品种一级的所有款式<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMMEX0010_MARA&nbsp;ON&nbsp;MARA~MATNR&nbsp;=&nbsp;ZMMEX0010_MARA~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_XNKH_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MARA~EXTWG&nbsp;=&nbsp;LT_XNKH_TMP-EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZMMEX0010_MARA~EX_PZ01&nbsp;=&nbsp;LT_XNKH_TMP-EX_PZ01&nbsp;.<br />
<br />
&nbsp;&nbsp;REFRESH&nbsp;LT_XNKH_TMP&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;将LT_XNKH中每个虚拟款号，在LT_XNKH_ALL中检查其是否已经匹配过<br />
&nbsp;&nbsp;"&nbsp;如果已经匹配过，则不用再匹配，仅需要最后Update表ZMMRP0210_BATCH中该虚拟款号的字段CHK_XSK为X<br />
&nbsp;&nbsp;"&nbsp;原因：表ZMMRP0210_BATCH中的主键是款号+批次，同一个款号下多个批次，因为克重段相同，所以虚拟款号<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;可能是相同的，只是批次创建有先有后，先创建的0001号批次的虚拟款号可能已经匹配过虚拟款号，所以后创建<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;的0002号批次虽然虚拟款号相同，但这条记录中的CHK_XSK还是为空，因此被选择到LT_XNKH中了<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因此对于0002号批次，如果在LT_XNKH_ALL中找到相同虚拟款号的记录，且已经匹配过了，所以后面就不需要对<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该虚拟款号再进行匹配，提高效率。<br />
&nbsp;&nbsp;"&nbsp;但是要考虑一种情况，如果LT_XNKH中的条数，与LT_XNKH_ALL中的条数相差无几，说明LT_XNKH_ALL中大部分记录<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;都是没有检查过的，在这种情况下做这个检查就没有意义，反而降低效率<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因此这里设置为LT_XNKH_ALL中的条数是LT_XNKH的两倍以上才进行这个检查<br />
&nbsp;&nbsp;SORT&nbsp;LT_XNKH&nbsp;BY&nbsp;MATNR&nbsp;EX_XNKH&nbsp;CHK_XSK.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_XNKH&nbsp;COMPARING&nbsp;MATNR&nbsp;EX_XNKH&nbsp;CHK_XSK.<br />
&nbsp;&nbsp;"&nbsp;注意，在这里对LT_XNKH_ALL表一定要带CHK_XSK进行比较和去重<br />
&nbsp;&nbsp;SORT&nbsp;LT_XNKH_ALL&nbsp;BY&nbsp;MATNR&nbsp;EX_XNKH&nbsp;CHK_XSK.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_XNKH_ALL&nbsp;COMPARING&nbsp;MATNR&nbsp;EX_XNKH&nbsp;CHK_XSK.<br />
<br />
&nbsp;&nbsp;LV_LINES_XNKH&nbsp;=&nbsp;LINES(&nbsp;LT_XNKH[]&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;LV_LINES_XNKH_ALL&nbsp;=&nbsp;LINES(&nbsp;LT_XNKH_ALL[]&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;(&nbsp;LV_LINES_XNKH_ALL&nbsp;/&nbsp;LV_LINES_XNKH&nbsp;)&nbsp;&gt;&nbsp;2&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_XNKH&nbsp;ASSIGNING&nbsp;&lt;LS_XNKH&gt;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_XNKH_ALL&nbsp;INTO&nbsp;LS_XNKH_ALL&nbsp;WITH&nbsp;KEY&nbsp;EX_XNKH&nbsp;=&nbsp;&lt;LS_XNKH&gt;-EX_XNKH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHK_XSK&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GRS_XNKH_UPD&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-SIGN&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-OPTION&nbsp;=&nbsp;'EQ'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&lt;LS_XNKH&gt;-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-HIGH&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GRS_XNKH_UPD&nbsp;TO&nbsp;GRT_XNKH_UPD&nbsp;.&nbsp;"&nbsp;该内表保存的是需要更新ZMMRP0210_BATCH的虚拟款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_XNKH&gt;-EX_XNKH&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;"&nbsp;删除不需要匹配相似款的虚拟款号<br />
&nbsp;&nbsp;DELETE&nbsp;LT_XNKH&nbsp;WHERE&nbsp;EX_XNKH&nbsp;=&nbsp;''&nbsp;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LT_XNKH[]&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'没有需要匹配相似款的虚拟款号！'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;经过上一步处理后，对LT_XNKH_ALL可以不考虑CHK_XSK进行排序和去重了<br />
&nbsp;&nbsp;SORT&nbsp;LT_XNKH_ALL&nbsp;BY&nbsp;MATNR&nbsp;EX_XNKH.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_XNKH_ALL&nbsp;COMPARING&nbsp;MATNR&nbsp;EX_XNKH.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_MATNR&nbsp;BY&nbsp;MATNR&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;LT_PP&nbsp;BY&nbsp;EX_PZ04&nbsp;.<br />
<br />
&nbsp;&nbsp;"&nbsp;计算每个款式的匹配码<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_MATNR&nbsp;ASSIGNING&nbsp;&lt;LS_MATNR&gt;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PP&nbsp;INTO&nbsp;LS_PP&nbsp;WITH&nbsp;KEY&nbsp;EX_PZ04&nbsp;=&nbsp;&lt;LS_MATNR&gt;-EX_PZ04&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;备注：A和B款相似的前提条件是至少大类（EXTWG）和品种一级(EX_PZ01)相同，<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;所以无论配置表中如何配置都要比较，必须添加到匹配码中<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;另外ZP15和ZP16是指是否要匹配克重段和指圈号，这两个属性是虚拟款号中的，在款式上不做匹配<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP02&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_GJS&nbsp;.&nbsp;"&nbsp;如果不比较该属性，则将该属性清空<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP04&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_PZ01&nbsp;.&nbsp;"&nbsp;品种一级<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP05&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_PZ02&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP06&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_PZ03&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP07&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_PZ04&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP08&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_PZ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP09&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_ZT01&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP10&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_ZT02&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP11&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_ZT03&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP12&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_TA01&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP13&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_TA02&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_PP-ZP14&nbsp;&lt;&gt;&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LS_MATNR&gt;-EX_XZ&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;&lt;LS_MATNR&gt;-EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_GJS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_PZ01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_PZ02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_PZ03<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_PZ04<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_PZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_ZT01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_ZT02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_ZT03<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_TA01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_TA02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_MATNR&gt;-EX_XZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;&lt;LS_MATNR&gt;-COMP_CODE&nbsp;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;对LT_XNKH中的每条记录，到LT_XNKH_ALL中匹配其相似虚拟款<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_XNKH&nbsp;INTO&nbsp;LS_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MATNR&nbsp;INTO&nbsp;LS_MATNR_1&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LS_XNKH-MATNR&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PP&nbsp;INTO&nbsp;LS_PP&nbsp;WITH&nbsp;KEY&nbsp;EX_PZ04&nbsp;=&nbsp;LS_XNKH-EX_PZ04&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;无论是否找到相似虚拟款，这条虚拟款号都已经执行过匹配了，所以要添加到LT_XNKH_UPD中<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;在后面要更新表ZMMRP0210_BATCH中的CHK_XSK字段为X<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GRS_XNKH_UPD&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-SIGN&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-OPTION&nbsp;=&nbsp;'EQ'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_XNKH-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GRS_XNKH_UPD-HIGH&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GRS_XNKH_UPD&nbsp;TO&nbsp;GRT_XNKH_UPD&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;该内表是实际执行过匹配的虚拟款号，在相似款结果保存之前，需要从表ZMMRP0040_XSK中<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;将这些虚拟款号的原有相似款结果删除<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GRS_XNKH_UPD&nbsp;TO&nbsp;GRT_XNKH_DEL&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_XNKH_ALL&nbsp;INTO&nbsp;LS_XNKH_ALL&nbsp;WHERE&nbsp;EXTWG&nbsp;=&nbsp;LS_XNKH-EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EX_PZ01&nbsp;=&nbsp;LS_XNKH-EX_PZ01&nbsp;&nbsp;"&nbsp;至少大类和品种一级要相同<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;MATNR&nbsp;&lt;&gt;&nbsp;LS_XNKH-MATNR.&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;同一款式下的虚拟款号不能相互成为虚拟款<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MATNR&nbsp;INTO&nbsp;LS_MATNR_2&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LS_XNKH_ALL-MATNR&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_MATNR_1-COMP_CODE&nbsp;=&nbsp;LS_MATNR_2-COMP_CODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;GS_DATA&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_PP-ZP16&nbsp;=&nbsp;'X'&nbsp;OR&nbsp;LS_PP-ZP17&nbsp;=&nbsp;'X'&nbsp;.&nbsp;"&nbsp;如果需要比较克重段或指圈号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_XNKH-EX_KCODE&nbsp;=&nbsp;LS_XNKH_ALL-EX_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZYKS&nbsp;=&nbsp;LS_XNKH-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZXSK&nbsp;=&nbsp;LS_XNKH_ALL-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_DATA&nbsp;TO&nbsp;GT_DATA&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;A是B的相似款，同理B也是A的相似款<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZYKS&nbsp;=&nbsp;LS_XNKH_ALL-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZXSK&nbsp;=&nbsp;LS_XNKH-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_DATA&nbsp;TO&nbsp;GT_DATA&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;不需要比较克重段或指圈号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZYKS&nbsp;=&nbsp;LS_XNKH-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZXSK&nbsp;=&nbsp;LS_XNKH_ALL-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_DATA&nbsp;TO&nbsp;GT_DATA&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;A是B的相似款，同理B也是A的相似款<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZYKS&nbsp;=&nbsp;LS_XNKH_ALL-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-ZXSK&nbsp;=&nbsp;LS_XNKH-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_DATA&nbsp;TO&nbsp;GT_DATA&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;GT_DATA&nbsp;BY&nbsp;ZYKS&nbsp;ZXSK&nbsp;.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;GT_DATA&nbsp;COMPARING&nbsp;ZYKS&nbsp;ZXSK&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;GRT_XNKH_UPD&nbsp;BY&nbsp;LOW&nbsp;.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;GRT_XNKH_UPD&nbsp;COMPARING&nbsp;LOW&nbsp;.<br />
<br />
&nbsp;&nbsp;LV_LINES_XNKH&nbsp;=&nbsp;LINES(&nbsp;GRT_XNKH_UPD&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;LV_LINES_XNKH_ALL&nbsp;=&nbsp;LINES(&nbsp;GT_DATA&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_MSG&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'本次共为'&nbsp;&&&nbsp;LV_LINES_XNKH&nbsp;.&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;'条虚拟款号匹配相似款，匹配结果共'&nbsp;&&&nbsp;LV_LINES_XNKH_ALL&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;'条！'&nbsp;.<br />
&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_UPDATE_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_UPDATE_DATA .<br />
&nbsp;&nbsp;DATA:&nbsp;LV_LINES&nbsp;TYPE&nbsp;I&nbsp;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;CBX_2&nbsp;=&nbsp;'X'&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_LINES&nbsp;=&nbsp;LINES(&nbsp;GT_DATA&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'您选择的是模拟执行，不需要保存数据!'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;'本次匹配相似款条数：'&nbsp;&&&nbsp;LV_LINES&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;GRT_XNKH_UPD&nbsp;中是这次执行过相似款匹配的虚拟款号，无论其是否找到相似款都在该表中<br />
&nbsp;&nbsp;IF&nbsp;GRT_XNKH_UPD[]&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'本次执行没有数据需要保存!'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;将ZMMRP0210_BATCH表中该虚拟款号的标志CHK_XSK设置为X<br />
&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;ZMMRP0210_BATCH&nbsp;SET&nbsp;CHK_XSK&nbsp;=&nbsp;'X'&nbsp;WHERE&nbsp;EX_XNKH&nbsp;IN&nbsp;GRT_XNKH_UPD&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_LINES&nbsp;=&nbsp;LINES(&nbsp;GRT_XNKH_UPD&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'表ZMMRP0210_BATCH中标志CHK_XSK更新成功，虚拟款号条数：'&nbsp;&&&nbsp;LV_LINES&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;从表ZMMRP0040_XSK中将这些虚拟款号原有的相似款数据删除<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;FROM&nbsp;ZMMRP0040_XSK&nbsp;WHERE&nbsp;ZYKS&nbsp;IN&nbsp;GRT_XNKH_DEL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GT_DATA[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_DATA&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-AEDAT&nbsp;=&nbsp;SY-DATUM&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-AEZET&nbsp;=&nbsp;SY-UZEIT&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DATA-AENAM&nbsp;=&nbsp;SY-UNAME&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_DATA&nbsp;FROM&nbsp;GS_DATA&nbsp;TRANSPORTING&nbsp;AEDAT&nbsp;AEZET&nbsp;AENAM&nbsp;WHERE&nbsp;ZYKS&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;更新数据库表<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMRP0040_XSK&nbsp;FROM&nbsp;TABLE&nbsp;GT_DATA&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_LINES&nbsp;=&nbsp;LINES(&nbsp;GT_DATA&nbsp;)&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZCB'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'000'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V1&nbsp;=&nbsp;'相似款保存到表ZMMRP0040_XSK中，条数：'&nbsp;&&&nbsp;LV_LINES&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V2&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V3&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MSG-MESSAGE_V4&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MSG&nbsp;TO&nbsp;GT_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_DIS_RESULT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_DIS_RESULT .<br />
&nbsp;&nbsp;IF&nbsp;CBX_1&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_WRITE_MSG&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_DIS_ALV&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_WRITE_MSG<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_WRITE_MSG .<br />
&nbsp;&nbsp;DATA&nbsp;LV_STR&nbsp;TYPE&nbsp;STRING&nbsp;.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_MSG&nbsp;INTO&nbsp;GS_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;GS_MSG-ID&nbsp;TYPE&nbsp;GS_MSG-TYPE&nbsp;NUMBER&nbsp;GS_MSG-NUMBER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_STR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;GS_MSG-MESSAGE_V1&nbsp;GS_MSG-MESSAGE_V2&nbsp;GS_MSG-MESSAGE_V3&nbsp;GS_MSG-MESSAGE_V4&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;LV_STR&nbsp;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_DIS_ALV<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_DIS_ALV .<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_BUILD_FIELDCAT.&nbsp;&nbsp;&nbsp;"&nbsp;设置显示字段属性<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_BUILD_LAYOUT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;设置屏幕布局<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_ALV_DISPLAY.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ALV显示<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_BUILD_FIELDCAT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置显示字段属性<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_BUILD_FIELDCAT .<br />
&nbsp;&nbsp;REFRESH&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ZYKS'&nbsp;'原款'&nbsp;&nbsp;&nbsp;30.<br />
&nbsp;&nbsp;PERFORM&nbsp;SUB_SET_FIELDS&nbsp;USING&nbsp;'ZXSK'&nbsp;'相似款'&nbsp;30.<br />
<br />
ENDFORM.                    " FRM_BUILD_FIELDCAT<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SUB_SET_FIELDS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SUB_SET_FIELDS USING I_FIELDNAME TYPE SLIS_FIELDNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_REPTEXT&nbsp;TYPE&nbsp;DD03P-REPTEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_OUTPUTLEN&nbsp;TYPE&nbsp;DD03P-OUTPUTLEN.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;I_FIELDNAME.<br />
&nbsp;&nbsp;GS_FIELDCAT-REPTEXT_DDIC&nbsp;=&nbsp;I_REPTEXT.<br />
&nbsp;&nbsp;GS_FIELDCAT-NO_ZERO&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;I_OUTPUTLEN.<br />
&nbsp;&nbsp;IF&nbsp;I_FIELDNAME&nbsp;=&nbsp;'BOX'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
ENDFORM.                    "SUB_SET_FIELDS<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_BUILD_LAYOUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置屏幕布局<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_BUILD_LAYOUT .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;输出长度的最优化设计<br />
*&nbsp;&nbsp;gs_layout-colwidth_optimize&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;gs_layout-box_fieldname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'BOX'.<br />
<br />
   </div>
   <div class="code">
ENDFORM.                    " FRM_BUILD_LAYOUT<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_ALV_DISPLAY<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALV显示<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_ALV_DISPLAY .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;调用ALV&nbsp;FUNCTION<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'FRM_PF_STATUS_SET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'FRM_USER_COMMAND'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_HTML_TOP_OF_PAGE&nbsp;=&nbsp;'HTML_TOP_OF_PAGE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_DATA.<br />
<br />
ENDFORM.                    " FRM_ALV_DISPLAY<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_PF_STATUS_SET<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置状态栏<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_PF_STATUS_SET USING RT_EXTAB TYPE SLIS_T_EXTAB.<br />
<br />
&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'STANDARD'.<br />
<br />
ENDFORM.                    " FRM_PF_STATUS_SET<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_USER_COMMAND<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定义按钮功能<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_USER_COMMAND  USING R_UCOMM LIKE SY-UCOMM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;G_GRID&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.&nbsp;"&nbsp;刷新数据<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;G_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;CHECK_CHANGED_DATA.<br />
&nbsp;&nbsp;IF&nbsp;NOT&nbsp;G_GRID&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;REFRESH_TABLE_DISPLAY.&nbsp;"refresh&nbsp;alv<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;''.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
<br />
ENDFORM.                    " FRM_USER_COMMAND<br />
<br />
FORM HTML_TOP_OF_PAGE USING CL_DD TYPE REF TO CL_DD_DOCUMENT.<br />
&nbsp;&nbsp;DATA&nbsp;LV_TEXT&nbsp;TYPE&nbsp;C&nbsp;LENGTH&nbsp;255&nbsp;.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_MSG&nbsp;INTO&nbsp;GS_MSG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;GS_MSG-ID&nbsp;TYPE&nbsp;GS_MSG-TYPE&nbsp;NUMBER&nbsp;GS_MSG-NUMBER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;GS_MSG-MESSAGE_V1&nbsp;GS_MSG-MESSAGE_V2&nbsp;GS_MSG-MESSAGE_V3&nbsp;GS_MSG-MESSAGE_V4&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_DD-&gt;ADD_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT&nbsp;=&nbsp;LV_TEXT&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_DD-&gt;NEW_LINE&nbsp;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM .<br />
<br />
   </div>
   <div class="codeComment">
*Text&nbsp;elements<br />
*----------------------------------------------------------<br />
*&nbsp;T01&nbsp;选择条件<br />
*&nbsp;T02&nbsp;动作<br />
*&nbsp;T03&nbsp;选择执行方式<br />
<br />
<br />
*Selection&nbsp;texts<br />
*----------------------------------------------------------<br />
*&nbsp;CBX_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以ALV显示相似款匹配结果（数据量大时请勿选择）<br />
*&nbsp;CBX_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;模拟执行，不将结果保存到数据库<br />
*&nbsp;P_MONAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销售统计月数<br />
*&nbsp;S_EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;商品大类<br />
*&nbsp;S_GJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贵金属材质<br />
*&nbsp;S_MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;商品编码<br />
*&nbsp;S_PZ01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;品种一级<br />
*&nbsp;S_PZ02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;品种二级<br />
*&nbsp;S_PZ03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;品种三级<br />
*&nbsp;S_PZ04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;品种四级<br />
*&nbsp;S_ZT01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主题一级<br />
*&nbsp;S_ZT02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主题二级<br />
*&nbsp;S_ZT03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主题三级<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
