<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>YZFIRP0130_F02</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: YZFIRP0130_F02</h2>
<h3> Description: Include ZFIRP0130_F02</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;包含&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YZFIRP0130_F02<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_FCODE_MANU<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;手工勾稽<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_FCODE_MANU .<br />
&nbsp;&nbsp;DATA:&nbsp;LV_SUBRC&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-SUBRC.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_PROCESS_MANU_CHECK&nbsp;CHANGING&nbsp;LV_SUBRC.<br />
&nbsp;&nbsp;IF&nbsp;LV_SUBRC&nbsp;EQ&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;'I'&nbsp;NUMBER&nbsp;SY-MSGNO&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SET_DATA_0100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_REFRESH_GRIDS.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    "frm_fcode_manu<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;frm_fcode_auto<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;自动勾稽<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_FCODE_AUTO.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_SUBRC&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-SUBRC.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_PROCESS_AUTO_CHECK&nbsp;CHANGING&nbsp;LV_SUBRC.<br />
&nbsp;&nbsp;IF&nbsp;LV_SUBRC&nbsp;EQ&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;I334&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S333.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SET_DATA_0100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_REFRESH_GRIDS.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    "frm_fcode_auto<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_FCODE_SAVE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_FCODE_SAVE .<br />
&nbsp;&nbsp;DATA:&nbsp;LV_SUBRC&nbsp;TYPE&nbsp;SY-SUBRC.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_SAVE_CHECK_RESULT&nbsp;CHANGING&nbsp;LV_SUBRC.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;'I'&nbsp;NUMBER&nbsp;SY-MSGNO&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S329.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " FRM_FCODE_SAVE<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;frm_fcode_reset<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消勾稽<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_FCODE_RESET.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_SUBRC&nbsp;TYPE&nbsp;SY-SUBRC.<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_PROCESS_RESET_CHECK&nbsp;CHANGING&nbsp;LV_SUBRC.<br />
&nbsp;&nbsp;IF&nbsp;LV_SUBRC&nbsp;EQ&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;'I'&nbsp;NUMBER&nbsp;SY-MSGNO&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SET_DATA_0100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_REFRESH_GRIDS.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    "frm_fcode_reset<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;frm_process_auto_check<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;处理自动勾稽<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_PROCESS_AUTO_CHECK CHANGING CV_SUBRC.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_SHKZG&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSEG-SHKZG.<br />
&nbsp;&nbsp;DATA:&nbsp;LF_DONE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_BANKCOPY_0100&nbsp;INTO&nbsp;WA_BANKCOPY_0100&nbsp;WHERE&nbsp;ZBVSTA&nbsp;EQ&nbsp;GC_UNPROCESSED<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZBCMON&nbsp;NE&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;wa_bankcopy_0100-zbcmon&nbsp;=&nbsp;0&nbsp;-&nbsp;wa_bankcopy_0100-zbcmon.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;WHERE&nbsp;ZBVSTA&nbsp;EQ&nbsp;GC_UNPROCESSED<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;budat&nbsp;&nbsp;EQ&nbsp;wa_bankcopy_0100-zbcdat<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;shkzg&nbsp;&nbsp;EQ&nbsp;lv_shkzg<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;MONAT&nbsp;&nbsp;=&nbsp;WA_BANKCOPY_0100-ZBCDAT+4(2)&nbsp;&nbsp;"add&nbsp;by&nbsp;erp-zhouxh&nbsp;on&nbsp;2010.1.15<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;DMBTR&nbsp;&nbsp;EQ&nbsp;WA_BANKCOPY_0100-ZBCMON.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_SAPDOC_0100&nbsp;FROM&nbsp;WA_SAPDOC_0100&nbsp;TRANSPORTING&nbsp;ZBVSTA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_CHANGED_0100&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;GV_CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LF_DONE&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_BANKCOPY-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_BANKCOPY&nbsp;FROM&nbsp;WA_BANKCOPY&nbsp;INDEX&nbsp;WA_BANKCOPY_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_SAPDOC&nbsp;FROM&nbsp;WA_SAPDOC&nbsp;INDEX&nbsp;WA_SAPDOC_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_BCRESULT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING:&nbsp;WA_BANKCOPY_0100&nbsp;TO&nbsp;WA_BCRESULT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC_0100&nbsp;&nbsp;&nbsp;TO&nbsp;WA_BCRESULT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_BCRESULT-CKNUM&nbsp;=&nbsp;GV_CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_BCRESULT&nbsp;TO&nbsp;GT_BCRESULT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_BANKCOPY_0100&nbsp;TO&nbsp;WA_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;WA_ZBCKNO_CHANGED&nbsp;INTO&nbsp;GT_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LF_DONE&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_TRUE.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    "frm_process_auto_check<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_PROCESS_MANU_CHECK<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_PROCESS_MANU_CHECK CHANGING CV_SUBRC.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ROW_1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_T_ROW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ROW_2&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_T_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ROW_1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ROW_2&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_AMT_BANK&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_AMT_SAP&nbsp;&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;2.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_SHKZG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSEG-SHKZG.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_GRID_1-&gt;GET_SELECTED_ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROW_1.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_GRID_2-&gt;GET_SELECTED_ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROW_2.<br />
<br />
   </div>
   <div class="codeComment">
*{&nbsp;注释&nbsp;by&nbsp;erp-zhouxh&nbsp;on&nbsp;2009.11.18<br />
*&nbsp;&nbsp;IF&nbsp;lt_row_1&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;cv_subrc&nbsp;=&nbsp;gc_false.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e321.<br />
*&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;CHECK&nbsp;cv_subrc&nbsp;EQ&nbsp;gc_true.<br />
*}<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LT_ROW_2&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E322&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
   </div>
   <div class="codeComment">
*{SAP凭证自对帐&nbsp;add&nbsp;by&nbsp;erp-zhouxh&nbsp;on&nbsp;2009.11.18<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LINES(&nbsp;LT_ROW_1&nbsp;)&nbsp;=&nbsp;0&nbsp;AND&nbsp;LINES(&nbsp;LT_ROW_2&nbsp;)&nbsp;GT&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_2&nbsp;INTO&nbsp;LS_ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;NE&nbsp;GC_UNPROCESSED&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;NE&nbsp;GC_PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E325&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;WA_SAPDOC_0100-DMBTR&nbsp;TO&nbsp;LV_AMT_SAP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_AMT_SAP&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000&nbsp;WITH&nbsp;'所选凭证金额'&nbsp;LV_AMT_SAP&nbsp;'不等于0!'&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_CHANGED_0100&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;GV_SAP_CHNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_2&nbsp;INTO&nbsp;LS_ROW_2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;INDEX&nbsp;LS_ROW_2-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_SAPDOC&nbsp;FROM&nbsp;WA_SAPDOC&nbsp;INDEX&nbsp;WA_SAPDOC_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_SAPDOC_0100&nbsp;TO&nbsp;WA_YZFIRP0130D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-CKNUM&nbsp;=&nbsp;GV_SAP_CHNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-CRNAM&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-CRDAT&nbsp;=&nbsp;SY-DATUM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_YZFIRP0130D&nbsp;TO&nbsp;GT_YZFIRP0130D_CHANGED.&nbsp;CLEAR&nbsp;WA_YZFIRP0130D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*}add:end<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LINES(&nbsp;LT_ROW_1&nbsp;)&nbsp;GT&nbsp;1&nbsp;AND&nbsp;LINES(&nbsp;LT_ROW_2&nbsp;)&nbsp;GT&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E323&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;对帐单:SAP凭证项目&nbsp;-&nbsp;1:N<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LINES(&nbsp;LT_ROW_1&nbsp;)&nbsp;EQ&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ROW_1&nbsp;INTO&nbsp;LS_ROW&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_BANKCOPY_0100&nbsp;INTO&nbsp;WA_BANKCOPY_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_BANKCOPY_0100-ZBVSTA&nbsp;NE&nbsp;GC_UNPROCESSED&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BANKCOPY_0100-ZBVSTA&nbsp;NE&nbsp;GC_PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E324&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_AMT_BANK&nbsp;=&nbsp;WA_BANKCOPY_0100-ZBCMON.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_2&nbsp;INTO&nbsp;LS_ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;NE&nbsp;GC_UNPROCESSED&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;NE&nbsp;GC_PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E325&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;WA_SAPDOC_0100-DMBTR&nbsp;TO&nbsp;LV_AMT_SAP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_SHKZG&nbsp;EQ&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SHKZG&nbsp;=&nbsp;WA_SAPDOC_0100-SHKZG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LV_SHKZG&nbsp;NE&nbsp;WA_SAPDOC_0100-SHKZG.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv_subrc&nbsp;=&nbsp;gc_false.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;W337&nbsp;INTO&nbsp;DUMMY.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;对帐单:SAP凭证项目&nbsp;-&nbsp;N:1<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_1&nbsp;INTO&nbsp;LS_ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_BANKCOPY_0100&nbsp;INTO&nbsp;WA_BANKCOPY_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_BANKCOPY_0100-ZBVSTA&nbsp;NE&nbsp;GC_UNPROCESSED&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BANKCOPY_0100-ZBVSTA&nbsp;NE&nbsp;GC_PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E324&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_SHKZG&nbsp;EQ&nbsp;SPACE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_BANKCOPY_0100-ZBCMON&nbsp;LT&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_SHKZG&nbsp;EQ&nbsp;'H'&nbsp;AND&nbsp;WA_BANKCOPY_0100-ZBCMON&nbsp;GT&nbsp;0&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SHKZG&nbsp;EQ&nbsp;'S'&nbsp;AND&nbsp;WA_BANKCOPY_0100-ZBCMON&nbsp;LT&nbsp;0&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv_subrc&nbsp;=&nbsp;gc_false.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;W337&nbsp;INTO&nbsp;DUMMY.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;WA_BANKCOPY_0100-ZBCMON&nbsp;TO&nbsp;LV_AMT_BANK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ROW_2&nbsp;INTO&nbsp;LS_ROW&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;NE&nbsp;GC_UNPROCESSED&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;NE&nbsp;GC_PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E324&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;wa_sapdoc_0100-shkzg&nbsp;EQ&nbsp;'H'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_amt_sap&nbsp;=&nbsp;0&nbsp;-&nbsp;wa_sapdoc_0100-dmbtr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LV_AMT_SAP&nbsp;=&nbsp;WA_SAPDOC_0100-DMBTR.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;判断金额<br />
*&nbsp;&nbsp;lv_amt_sap&nbsp;=&nbsp;0&nbsp;-&nbsp;lv_amt_sap.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LV_AMT_SAP&nbsp;NE&nbsp;LV_AMT_BANK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E326&nbsp;WITH&nbsp;LV_AMT_BANK&nbsp;LV_AMT_SAP&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;暂存结果<br />
   </div>
   <div class="code">
&nbsp;&nbsp;GV_CHANGED_0100&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;GV_CKNUM.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_1&nbsp;INTO&nbsp;LS_ROW_1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_BANKCOPY_0100&nbsp;INTO&nbsp;WA_BANKCOPY_0100&nbsp;INDEX&nbsp;LS_ROW_1-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_BANKCOPY-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_BANKCOPY&nbsp;FROM&nbsp;WA_BANKCOPY&nbsp;INDEX&nbsp;WA_BANKCOPY_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_2&nbsp;INTO&nbsp;LS_ROW_2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;INDEX&nbsp;LS_ROW_2-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_SAPDOC&nbsp;FROM&nbsp;WA_SAPDOC&nbsp;INDEX&nbsp;WA_SAPDOC_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_BCRESULT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING:&nbsp;WA_BANKCOPY_0100&nbsp;TO&nbsp;WA_BCRESULT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC_0100&nbsp;&nbsp;&nbsp;TO&nbsp;WA_BCRESULT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BCRESULT-CKNUM&nbsp;=&nbsp;GV_CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_BCRESULT&nbsp;TO&nbsp;GT_BCRESULT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_BANKCOPY_0100&nbsp;TO&nbsp;WA_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;WA_ZBCKNO_CHANGED&nbsp;INTO&nbsp;GT_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.                    "FRM_PROCESS_MANU_CHECK<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;frm_process_reset_check<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消勾稽<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_PROCESS_RESET_CHECK CHANGING CV_SUBRC.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ROW_1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_T_ROW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ROW_2&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_T_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ROW_1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ROW_2&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_ROW.<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;LT_CKNUM_RESET&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CKNUM&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LT_CKNUM_RESET.<br />
<br />
   </div>
   <div class="codeComment">
*{&nbsp;add&nbsp;by&nbsp;erp-zhouxh<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;LV_AMT_BANK&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_AMT_SAP&nbsp;&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;2.<br />
   </div>
   <div class="codeComment">
*}<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_GRID_1-&gt;GET_SELECTED_ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROW_1.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_GRID_2-&gt;GET_SELECTED_ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROW_2.<br />
&nbsp;&nbsp;IF&nbsp;LT_ROW_1&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;LT_ROW_2&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E330&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;对帐单<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_1&nbsp;INTO&nbsp;LS_ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_BANKCOPY_0100&nbsp;INTO&nbsp;WA_BANKCOPY_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;WA_BANKCOPY_0100-ZBVSTA&nbsp;EQ&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;WA_BANKCOPY_0100-CKNUM&nbsp;GT&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;WA_BANKCOPY_0100-ZBCMON&nbsp;TO&nbsp;LV_AMT_BANK.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CKNUM_RESET-CKNUM&nbsp;=&nbsp;WA_BANKCOPY_0100-CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LT_CKNUM_RESET.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;SAP凭证项目<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_2&nbsp;INTO&nbsp;LS_ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;EQ&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;WA_SAPDOC_0100-DMBTR&nbsp;TO&nbsp;LV_AMT_SAP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;WA_SAPDOC_0100-CKNUM&nbsp;GT&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CKNUM_RESET-CKNUM&nbsp;=&nbsp;WA_SAPDOC_0100-CKNUM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LT_CKNUM_RESET.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;{判断金额&nbsp;&nbsp;add&nbsp;by&nbsp;erp-zhouxh<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LV_AMT_SAP&nbsp;NE&nbsp;LV_AMT_BANK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E326&nbsp;WITH&nbsp;LV_AMT_BANK&nbsp;LV_AMT_SAP&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LINES(&nbsp;LT_ROW_1&nbsp;)&nbsp;=&nbsp;0&nbsp;AND&nbsp;LINES(&nbsp;LT_ROW_2&nbsp;)&nbsp;GT&nbsp;1.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_CKNUM_RESET[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E332&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;CV_SUBRC&nbsp;EQ&nbsp;GC_TRUE.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW_2&nbsp;INTO&nbsp;LS_ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;INDEX&nbsp;LS_ROW-INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;WA_SAPDOC_0100-ZBVSTA&nbsp;EQ&nbsp;GC_PROCESSED.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC-ZBVSTA&nbsp;=&nbsp;GC_UNPROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_SAPDOC&nbsp;FROM&nbsp;WA_SAPDOC&nbsp;INDEX&nbsp;WA_SAPDOC_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_SAPDOC_0100&nbsp;TO&nbsp;WA_YZFIRP0130D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-ZBVSTA&nbsp;=&nbsp;GC_UNPROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-CKNUM&nbsp;=&nbsp;GV_SAP_CHNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-CRNAM&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_YZFIRP0130D-CRDAT&nbsp;=&nbsp;SY-DATUM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_YZFIRP0130D&nbsp;TO&nbsp;GT_YZFIRP0130D_CHANGED.&nbsp;CLEAR&nbsp;WA_YZFIRP0130D.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&gt;}<br />
<br />
*&gt;{&nbsp;注释by&nbsp;erp-zhouxh<br />
*&nbsp;&nbsp;IF&nbsp;lt_cknum_reset[]&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;cv_subrc&nbsp;=&nbsp;gc_false.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e332&nbsp;INTO&nbsp;dummy.<br />
*&nbsp;&nbsp;ENDIF.<br />
*CHECK&nbsp;cv_subrc&nbsp;EQ&nbsp;gc_true.<br />
*&gt;}<br />
<br />
*&gt;取消勾稽关系<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_CKNUM_RESET.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_CKNUM_RESET.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;NEW&nbsp;CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_BCRESULT&nbsp;WHERE&nbsp;CKNUM&nbsp;EQ&nbsp;LT_CKNUM_RESET-CKNUM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_BANKCOPY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BANKCOPY-ZBVSTA&nbsp;=&nbsp;GC_UNPROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BANKCOPY-CKNUM&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_BANKCOPY_0100&nbsp;INTO&nbsp;WA_BANKCOPY_0100&nbsp;WHERE&nbsp;CKNUM&nbsp;EQ&nbsp;LT_CKNUM_RESET-CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_BANKCOPY&nbsp;FROM&nbsp;WA_BANKCOPY&nbsp;INDEX&nbsp;WA_BANKCOPY_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA&nbsp;CKNUM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_BANKCOPY_0100&nbsp;TO&nbsp;WA_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;WA_ZBCKNO_CHANGED&nbsp;INTO&nbsp;GT_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_SAPDOC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC-ZBVSTA&nbsp;=&nbsp;GC_UNPROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_SAPDOC-CKNUM&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_SAPDOC_0100&nbsp;INTO&nbsp;WA_SAPDOC_0100&nbsp;WHERE&nbsp;CKNUM&nbsp;EQ&nbsp;LT_CKNUM_RESET-CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_SAPDOC&nbsp;FROM&nbsp;WA_SAPDOC&nbsp;INDEX&nbsp;WA_SAPDOC_0100-GLINDX&nbsp;TRANSPORTING&nbsp;ZBVSTA&nbsp;CKNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;GC_TRUE.<br />
&nbsp;&nbsp;GV_CHANGED_0100&nbsp;=&nbsp;'X'.<br />
ENDFORM.                    "frm_process_reset_check<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;frm_refresh_grids<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_REFRESH_GRIDS.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_STABLE&nbsp;TYPE&nbsp;LVC_S_STBL.<br />
&nbsp;&nbsp;LS_STABLE&nbsp;=&nbsp;'XX'.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_GRID_1-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;=&nbsp;LS_STABLE.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_GRID_2-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;=&nbsp;LS_STABLE.<br />
ENDFORM.                    "frm_refresh_grids<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SAVE_CHECK_RESULT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存对帐结果<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_SAVE_CHECK_RESULT CHANGING CV_SUBRC.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_YZFIRP0130A&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;YZFIRP0130A.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_YZFIRP0130B&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;YZFIRP0130B.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_YZFIRP0130C_I&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;YZFIRP0130C.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"insert<br />
&nbsp;&nbsp;DATA:&nbsp;LT_YZFIRP0130C_D&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;YZFIRP0130C.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"delete<br />
&nbsp;&nbsp;DATA:&nbsp;LS_YZFIRP0130A&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;YZFIRP0130A.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_YZFIRP0130B&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;YZFIRP0130B.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_YZFIRP0130C&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;YZFIRP0130C.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*{&nbsp;add&nbsp;by&nbsp;erp-zhouxh<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;GT_ZBCKNO_CHANGED[]&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;GT_YZFIRP0130D_CHANGED[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E327&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*}<br />
<br />
*{&nbsp;注释&nbsp;by&nbsp;erp-zhouxh<br />
*&nbsp;&nbsp;IF&nbsp;gt_zbckno_changed&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e327&nbsp;INTO&nbsp;dummy.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;cv_subrc&nbsp;=&nbsp;4.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
*&nbsp;&nbsp;ENDIF.<br />
*}<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZBCKNO_CHANGED&nbsp;INTO&nbsp;WA_ZBCKNO_CHANGED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;LS_YZFIRP0130A,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_YZFIRP0130B,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_YZFIRP0130C.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_BANKCOPY&nbsp;INTO&nbsp;WA_BANKCOPY&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;&nbsp;=&nbsp;WA_ZBCKNO_CHANGED-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGRPID&nbsp;=&nbsp;WA_ZBCKNO_CHANGED-ZGRPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZBCKNO&nbsp;=&nbsp;WA_ZBCKNO_CHANGED-ZBCKNO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_YZFIRP0130A&nbsp;INTO&nbsp;WA_YZFIRP0130A&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;&nbsp;=&nbsp;WA_BANKCOPY-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGRPID&nbsp;=&nbsp;WA_BANKCOPY-ZGRPID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_YZFIRP0130B&nbsp;INTO&nbsp;WA_YZFIRP0130B&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;&nbsp;=&nbsp;WA_BANKCOPY-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGRPID&nbsp;=&nbsp;WA_BANKCOPY-ZGRPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZBCKNO&nbsp;=&nbsp;WA_BANKCOPY-ZBCKNO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;对帐组状态<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_YZFIRP0130A&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;&nbsp;=&nbsp;WA_YZFIRP0130A-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGRPID&nbsp;=&nbsp;WA_YZFIRP0130A-ZGRPID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_YZFIRP0130A.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_YZFIRP0130A&nbsp;TO&nbsp;LS_YZFIRP0130A.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_BANKCOPY&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;&nbsp;=&nbsp;WA_BANKCOPY-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGRPID&nbsp;=&nbsp;WA_BANKCOPY-ZGRPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZBVSTA&nbsp;=&nbsp;GC_UNPROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_YZFIRP0130A-ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_BANKCOPY&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS&nbsp;WITH&nbsp;KEY&nbsp;HKONT&nbsp;&nbsp;=&nbsp;WA_BANKCOPY-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGRPID&nbsp;=&nbsp;WA_BANKCOPY-ZGRPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZBVSTA&nbsp;=&nbsp;GC_PROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_YZFIRP0130A-ZBVSTA&nbsp;=&nbsp;GC_UNPROCESSED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_YZFIRP0130A-ZBVSTA&nbsp;=&nbsp;GC_PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE:&nbsp;SY-UNAME&nbsp;TO&nbsp;LS_YZFIRP0130A-CHNAM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SY-DATUM&nbsp;TO&nbsp;LS_YZFIRP0130A-CHDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_YZFIRP0130A&nbsp;TO&nbsp;LT_YZFIRP0130A.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;对帐单状态<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_YZFIRP0130B.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_YZFIRP0130B&nbsp;TO&nbsp;LS_YZFIRP0130B.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE:&nbsp;WA_BANKCOPY-ZBVSTA&nbsp;TO&nbsp;LS_YZFIRP0130B-ZBVSTA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SY-UNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_YZFIRP0130B-CHNAM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SY-DATUM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_YZFIRP0130B-CHDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_YZFIRP0130B&nbsp;TO&nbsp;LT_YZFIRP0130B.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;对帐结果<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_YZFIRP0130C.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_ZBCKNO_CHANGED&nbsp;TO&nbsp;LS_YZFIRP0130C.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_YZFIRP0130C&nbsp;TO&nbsp;LT_YZFIRP0130C_D.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_BCRESULT&nbsp;INTO&nbsp;WA_BCRESULT&nbsp;WHERE&nbsp;HKONT&nbsp;&nbsp;EQ&nbsp;WA_BANKCOPY-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZGRPID&nbsp;EQ&nbsp;WA_BANKCOPY-ZGRPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZBCKNO&nbsp;EQ&nbsp;WA_BANKCOPY-ZBCKNO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_BCRESULT&nbsp;TO&nbsp;LS_YZFIRP0130C.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE:&nbsp;&nbsp;SY-UNAME&nbsp;&nbsp;TO&nbsp;LS_YZFIRP0130C-CRNAM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SY-DATUM&nbsp;&nbsp;TO&nbsp;LS_YZFIRP0130C-CRDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_YZFIRP0130C&nbsp;TO&nbsp;LT_YZFIRP0130C_I.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&gt;更新数据库<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MODIFY&nbsp;YZFIRP0130A&nbsp;FROM&nbsp;TABLE&nbsp;LT_YZFIRP0130A.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E328&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;MODIFY&nbsp;YZFIRP0130B&nbsp;FROM&nbsp;TABLE&nbsp;LT_YZFIRP0130B.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E328&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_YZFIRP0130C_D&nbsp;INTO&nbsp;LS_YZFIRP0130C.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;FROM&nbsp;YZFIRP0130C&nbsp;WHERE&nbsp;HKONT&nbsp;&nbsp;EQ&nbsp;LS_YZFIRP0130C-HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZGRPID&nbsp;EQ&nbsp;LS_YZFIRP0130C-ZGRPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZBCKNO&nbsp;EQ&nbsp;LS_YZFIRP0130C-ZBCKNO.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;INSERT&nbsp;YZFIRP0130C&nbsp;FROM&nbsp;TABLE&nbsp;LT_YZFIRP0130C_I.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E328&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;MODIFY&nbsp;YZFIRP0130D&nbsp;FROM&nbsp;TABLE&nbsp;GT_YZFIRP0130D_CHANGED.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E328&nbsp;INTO&nbsp;DUMMY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GV_CHANGED_0100.<br />
&nbsp;&nbsp;REFRESH:&nbsp;GT_ZBCKNO_CHANGED.<br />
<br />
&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
&nbsp;&nbsp;CV_SUBRC&nbsp;=&nbsp;0.<br />
ENDFORM.                    " FRM_SAVE_CHECK_RESULT<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
