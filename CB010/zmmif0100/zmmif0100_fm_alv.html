<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZMMIF0100_FM_ALV</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMIF0100_FM_ALV</h2>
<h3> Description: Include ZMMIF0100_FM_ALV</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;包含&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0100_FM_ALV<br />
*&---------------------------------------------------------------------*<br />
<br />
<br />
*&-----------------------------------------------*<br />
*&取数（具体）<br />
*&-----------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_DATA USING ZBL1.           "调用函数取数<br />
&nbsp;&nbsp;SELECT&nbsp;A~ZPDBH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点表编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZFLAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"门店<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LGORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"库存地<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZBS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下传POS标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZBC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"已保存<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZSH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"已审核<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZDJRQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"建表日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZCJR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"建表人<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZGGR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"更改人<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZGGRQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"更改日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZSHR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"审核人<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZPDRQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点日期（POS盘点日期）<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZMDKCD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"序列号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~CLABS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZITEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点表行项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZBQMC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZSPTM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品条码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZCKLSJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZPDYGH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点员工号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZPOSITEM&nbsp;&nbsp;&nbsp;&nbsp;"Pos盘点行项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZPOSPDSL&nbsp;&nbsp;&nbsp;&nbsp;"POS盘点数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZSPS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"实盘数<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZPDCYS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"差异数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZZKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZDPJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MEINS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;基本计量单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~XCHPF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次管理需求的标识<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZJSZBM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"检测站编号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZCT1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"抽屉1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZCT2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"抽屉2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~WERKS_SH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"收货地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ZZT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"在途标识<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购凭证号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZSPBM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品包码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZFPH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"分配号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ZJZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单品克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;ZMMIF0150_PDHEAD&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_PDITEM&nbsp;AS&nbsp;B&nbsp;ON&nbsp;A~ZPDBH&nbsp;EQ&nbsp;B~ZPDBH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARA&nbsp;AS&nbsp;C&nbsp;ON&nbsp;B~MATNR&nbsp;EQ&nbsp;C~MATNR<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~ZPDBH&nbsp;EQ&nbsp;ZBL1.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;'G'&nbsp;AND&nbsp;WA_TABLE-XCHPF&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZMS&nbsp;=&nbsp;WA_TABLE-ZDPJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;'G'&nbsp;AND&nbsp;WA_TABLE-XCHPF&nbsp;=&nbsp;'&nbsp;'&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZMS&nbsp;=&nbsp;WA_TABLE-ZZKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZMS&nbsp;=&nbsp;WA_TABLE-ZDPJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZPDCYS&nbsp;=&nbsp;WA_TABLE-ZSPS&nbsp;-&nbsp;WA_TABLE-ZZMS.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CLOI_PUT_SIGN_IN_FRONT'&nbsp;"负号提前<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;=&nbsp;WA_TABLE-ZPDCYS.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZPDCYS&nbsp;ZZMS.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;处理完毕，清空工作区<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;按&nbsp;商品条码&nbsp;汇总数据&nbsp;排序<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;BY&nbsp;ZSPTM.<br />
   </div>
   <div class="codeComment">
*&nbsp;序号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZNO&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;ZNO.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&-----------------------------------------------*<br />
*&判断审核状态，给变量（ZBL）赋值。<br />
*&-----------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_PDSHZT USING ZBL1.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA&nbsp;LT_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMIF0150_PDHEAD.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;LW_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_PDHEAD.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ZSH&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;&nbsp;LW_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;ZMMIF0150_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZPDBH&nbsp;EQ&nbsp;ZBL1.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_PDHEAD&nbsp;INTO&nbsp;LW_PDHEAD.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZSH&nbsp;=&nbsp;'X'."判断是否已审核，如果已审核ZBL为空&nbsp;其他情况ZBL=X<br />
&nbsp;&nbsp;&nbsp;&nbsp;ZBL&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ZBL&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&-----------------------------------------------*<br />
*&显示ALV。第二个界面<br />
*&-----------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_SHOW USING I_EDIT.  "定义这个显示函数<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;IT_FIELDCAT[].&nbsp;&nbsp;"清空内表<br />
<br />
   </div>
   <div class="codeComment">
**--------------打勾用------------------------<br />
*&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"清空工作区<br />
*&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内表表名<br />
*&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'SEL_COL'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内表字段名，必须大写<br />
*&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'&nbsp;'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"项目表题目名称<br />
*&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"界面增加一列CHECKBOX，属性已被选中<br />
*&nbsp;&nbsp;WA_FIELDCAT-CHECKBOX&nbsp;&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"在设置ALV列属性的时候对这个字段赋值<br />
*&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"把工作区添加到内表<br />
**--------------打勾用------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZNO'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'序号'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIX_COLUMN&nbsp;=&nbsp;'X'."冻结字段<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZPDBH'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'盘点表编码'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIX_COLUMN&nbsp;=&nbsp;'X'."冻结字段<br />
&nbsp;&nbsp;WA_FIELDCAT-INTLEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'18'.""内部长度<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELN'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'转储单号'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIX_COLUMN&nbsp;=&nbsp;'X'."冻结字段<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZZT'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'在途标识'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品款号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CHARG'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'批号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPTM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品条码'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPBM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品包码'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZBQMC'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'标签名称'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZJSZBM&nbsp;'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'检测站编号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZCT1'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'抽屉1'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZCT2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'抽屉2'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WERKS_SH'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'收货地点'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZCKLSJ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'参考零售价'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CLABS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'数量'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'基本计量单位'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MARA'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZPOSITEM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'POS盘点行项目'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZPOSPDSL'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'POS盘点数量'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZZMS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'账面数'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'实盘数'.<br />
&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;I_EDIT."添加这行后，实盘数字段&nbsp;整列变为可编辑状态。<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'ZMMIF0150_PDITEM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_FIELDNAME&nbsp;=&nbsp;'ZSPS'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZPDCYS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'差异数'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZPDYGH'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'盘点员工号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZGGR'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'更改人'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZGGRQ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'更改日期'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
*&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
*&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZBC'.<br />
*&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'保存状态'.<br />
*&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSH'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'审核状态'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSHR'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'审核人'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;L_ALVCOLOR&nbsp;TYPE&nbsp;SLIS_SPECIALCOL_ALV.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-ZPDCYS&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-FIELDNAME&nbsp;=&nbsp;'ZPDCYS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-COLOR-COL&nbsp;=&nbsp;6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;colour&nbsp;number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-COLOR-INT&nbsp;=&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;intensified&nbsp;flag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-NOKEYCOL&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;key&nbsp;column&nbsp;flag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;L_ALVCOLOR&nbsp;TO&nbsp;WA_TABLE-COLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&nbsp;WA_TABLE-COLTAB[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;COLTAB.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_LAYOUT.<br />
&nbsp;&nbsp;WA_LAYOUT-COLTAB_FIELDNAME&nbsp;=&nbsp;'COLTAB'.&nbsp;&nbsp;&nbsp;"自定义颜色GE<br />
<br />
&nbsp;&nbsp;WA_LAYOUT-COLWIDTH_OPTIMIZE&nbsp;=&nbsp;'X'.&nbsp;&nbsp;"列宽度优化（宽度自动调整）<br />
&nbsp;&nbsp;WA_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"前面补零，补前导零<br />
&nbsp;&nbsp;WA_LAYOUT-NO_INPUT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;WA_LAYOUT-BOX_FIELDNAME&nbsp;=&nbsp;'SEL_COL'."选择&nbsp;框<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID&nbsp;&nbsp;&nbsp;&nbsp;"传入程序ID，系统程序变量ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;"传入三个参数布局<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_FIELDCAT[]&nbsp;"内容输出<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'PF_STATUS_SET'&nbsp;&nbsp;"回调状态&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;设置按钮<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'USER_COMMAND'&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;回调用户命令&nbsp;&nbsp;&nbsp;&nbsp;按钮的动作或者屏幕双击时<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_TABLE&nbsp;&nbsp;"输出的数据信息<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
ENDFORM.<br />
<br />
FORM USER_COMMAND USING R_UCOMM LIKE SY-UCOMM                 "做好自定义按钮的准备<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
<br />
&nbsp;&nbsp;FREE&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
<br />
&nbsp;&nbsp;"按下按钮各自执行函数<br />
&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN'BTN_RESH'."刷新按钮<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_DATA&nbsp;&nbsp;USING&nbsp;WA_TABLE-ZPDBH.&nbsp;&nbsp;&nbsp;&nbsp;"取数（具体）<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_PDSHZT&nbsp;USING&nbsp;WA_TABLE-ZPDBH.&nbsp;&nbsp;&nbsp;"判断审核状态，给变量（ZBL）赋值。<br />
<br />
***************************判断颜色***************************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;L_ALVCOLOR&nbsp;TYPE&nbsp;SLIS_SPECIALCOL_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-ZPDCYS&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-FIELDNAME&nbsp;=&nbsp;'ZPDCYS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-COLOR-COL&nbsp;=&nbsp;6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;colour&nbsp;number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-COLOR-INT&nbsp;=&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;intensified&nbsp;flag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-NOKEYCOL&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;key&nbsp;column&nbsp;flag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;L_ALVCOLOR&nbsp;TO&nbsp;WA_TABLE-COLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&nbsp;WA_TABLE-COLTAB[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;COLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
***************************判断颜色***************************************<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_SHOW&nbsp;&nbsp;USING&nbsp;ZBL.&nbsp;&nbsp;&nbsp;&nbsp;"调用函数显示<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'刷新'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_BACK'."返回按钮<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;S_ZPDBH-LOW&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;8000."LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0."LEAVE&nbsp;LIST-PROCESSING.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;S_ZDJRQ[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_DATA1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_SHOW1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_UP'."上一步按钮<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;8000.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_FZ'."赋值按钮（全部赋值&nbsp;实盘数=账面数）<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_FZ_ALL&nbsp;USING&nbsp;WA_TABLE-ZPDBH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;&nbsp;'BTN_SAVE'."保存按钮<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_SAVE&nbsp;USING&nbsp;WA_TABLE-ZPDBH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;&nbsp;'BTN_XZ'."下载更新按钮<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_XZ&nbsp;USING&nbsp;WA_TABLE-ZPDBH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;&nbsp;'BTN_SH'."审核按钮<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_JCSJ&nbsp;USING&nbsp;WA_TABLE-ZPDBH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_PRINT'."打印<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_PRINT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_ALL'.&nbsp;"全选<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_CANCEL'."取消全选<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CANCEL_ALL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_FZ2'."赋值按钮（根据打勾赋值&nbsp;实盘数=账面数）<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_FZ_SEL&nbsp;USING&nbsp;WA_TABLE-ZPDBH.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDCASE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;REFRESH_TABLE_DISPLAY.<br />
   </div>
   <div class="codeComment">
*设置刷新<br />
   </div>
   <div class="code">
&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*保证行、列位置在自动刷新时不变<br />
   </div>
   <div class="code">
&nbsp;&nbsp;RS_SELFIELD-COL_STABLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;RS_SELFIELD-ROW_STABLE&nbsp;=&nbsp;'X'.<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*-----------------按钮--------------------<br />
   </div>
   <div class="code">
"以下是建立小图标用的语句<br />
FORM PF_STATUS_SET USING P_EXTAB TYPE SLIS_T_EXTAB..<br />
&nbsp;&nbsp;"Set&nbsp;the&nbsp;Button&nbsp;using&nbsp;the&nbsp;staus<br />
&nbsp;&nbsp;"Copy&nbsp;the&nbsp;Standard&nbsp;status&nbsp;from&nbsp;the&nbsp;program&nbsp;SAPLKKBL&nbsp;status<br />
&nbsp;&nbsp;"&nbsp;STANDARD&nbsp;using&nbsp;SE41,&nbsp;and&nbsp;use&nbsp;that&nbsp;here.<br />
&nbsp;&nbsp;"Pf&nbsp;status<br />
&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZMMIF0100_PF'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"双击设置自己的按钮<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*-----------------按钮--------------------<br />
<br />
<br />
*---------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存函数<br />
*---------------------------------------------------<br />
   </div>
   <div class="code">
FORM FM_SAVE USING ZBL1.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;LT_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMIF0150_PDHEAD.<br />
&nbsp;&nbsp;DATA&nbsp;LW_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_PDHEAD.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;ZSH&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;ZMMIF0150_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZPDBH&nbsp;EQ&nbsp;ZBL1.<br />
   </div>
   <div class="codeComment">
*检查是否已审核，如果已审核不让保存<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PDHEAD&nbsp;INTO&nbsp;&nbsp;LW_PDHEAD&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZSH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'该盘点单号已审核,不能修改.'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZPDCYS&nbsp;=&nbsp;WA_TABLE-ZSPS&nbsp;-&nbsp;WA_TABLE-ZZMS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZGGR&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZGGRQ&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZBC&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZGGR&nbsp;ZGGRQ&nbsp;ZBC&nbsp;ZPDCYS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_TABLE&nbsp;TO&nbsp;WA_PDHEAD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_PDHEAD&nbsp;TO&nbsp;IT_PDHEAD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDHEAD.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'盘点表：'&nbsp;WA_TABLE-ZPDBH&nbsp;'已保存成功.'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_DATA&nbsp;&nbsp;USING&nbsp;WA_TABLE-ZPDBH.&nbsp;&nbsp;&nbsp;&nbsp;"取数（具体）<br />
*&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_PDSHZT&nbsp;USING&nbsp;WA_TABLE-ZPDBH.&nbsp;&nbsp;&nbsp;"判断审核状态，给变量（ZBL）赋值。<br />
*&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_SHOW&nbsp;&nbsp;USING&nbsp;ZBL.&nbsp;&nbsp;&nbsp;&nbsp;"调用函数显示<br />
<br />
***************************判断颜色***************************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;L_ALVCOLOR&nbsp;TYPE&nbsp;SLIS_SPECIALCOL_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-ZPDCYS&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-FIELDNAME&nbsp;=&nbsp;'ZPDCYS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-COLOR-COL&nbsp;=&nbsp;6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;colour&nbsp;number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-COLOR-INT&nbsp;=&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;intensified&nbsp;flag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ALVCOLOR-NOKEYCOL&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&lt;---&nbsp;key&nbsp;column&nbsp;flag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;L_ALVCOLOR&nbsp;TO&nbsp;WA_TABLE-COLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&nbsp;WA_TABLE-COLTAB[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;COLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
***************************判断颜色***************************************<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;下载更新函数<br />
*---------------------------------------------------<br />
   </div>
   <div class="code">
FORM FM_XZ USING ZBL1.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;LT_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMIF0150_PDHEAD.<br />
&nbsp;&nbsp;DATA&nbsp;LW_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_PDHEAD.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;ZFLAG&nbsp;ZSH&nbsp;ZPDBH&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;ZMMIF0150_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZPDBH&nbsp;EQ&nbsp;ZBL1.<br />
<br />
   </div>
   <div class="codeComment">
*判断是否已经审核，如果已经审核则不能修改。<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PDHEAD&nbsp;INTO&nbsp;&nbsp;LW_PDHEAD&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZSH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该盘点单号已审核,不能修改.'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT."&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*判断是否是POS盘点，如果是（X）则执行下载更新，如果不是（&nbsp;）则提示该盘点单号不使用POS端手持设备进行盘点。<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZFLAG&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*调用盘点表触发回归函数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmmif0150_fm_output/zmmif0150_fm_output.html">'ZMMIF0150_FM_OUTPUT'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IM_ZPDBH&nbsp;=&nbsp;LW_PDHEAD-ZPDBH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IM_WAIT&nbsp;&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZBC&nbsp;=&nbsp;'&nbsp;'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZPDCYS&nbsp;='&nbsp;'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZBC."&nbsp;ZPDCYS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDHEAD.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDITEM.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDHEAD.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDITEM.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'下载/更新盘点表：'&nbsp;WA_TABLE-ZPDBH'请求已发送成功'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该盘点单号不使用POS端手持设备进行盘点'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT."LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;检查数据并审核函数<br />
*---------------------------------------------------<br />
   </div>
   <div class="code">
FORM FM_JCSJ USING ZBL1.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;检查是否已经保存<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;LT_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMIF0150_PDHEAD.<br />
&nbsp;&nbsp;DATA&nbsp;LW_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_PDHEAD.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;ZBC&nbsp;ZSH&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;ZMMIF0150_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZPDBH&nbsp;&nbsp;EQ&nbsp;ZBL1.<br />
   </div>
   <div class="codeComment">
*判断是否已经审核，如果已经审核则不能修改。<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PDHEAD&nbsp;INTO&nbsp;&nbsp;LW_PDHEAD&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZSH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该盘点单号已审核'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZBC&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先保存数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;L_COUNT&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.&nbsp;&nbsp;&nbsp;&nbsp;"计数器<br />
   </div>
   <div class="codeComment">
*&nbsp;检查是否还有差异数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_COUNT&nbsp;=&nbsp;L_COUNT&nbsp;+&nbsp;WA_TABLE-ZPDCYS.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;L_COUNT&nbsp;&lt;&gt;&nbsp;0."&nbsp;如果计数器不等于0表示还有差异数，弹出对话框提示&nbsp;。<br />
   </div>
   <div class="codeComment">
*----------------弹出对话框函数-----------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;:&nbsp;L_ANSWER(01)&nbsp;TYPE&nbsp;C.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_CONFIRM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TITLEBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'确认'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_QUESTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'该盘点单号仍有差异，是否继续审核'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_BUTTON_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'是'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_BUTTON_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'否'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISPLAY_CANCEL_BUTTON&nbsp;=&nbsp;'&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_BUTTON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'2'&nbsp;"默认为2（否）<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_COLUMN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;25<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSWER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_ANSWER.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_ANSWER&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSHR&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZSHR&nbsp;ZSH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_TABLE&nbsp;TO&nbsp;WA_PDHEAD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_PDHEAD&nbsp;TO&nbsp;IT_PDHEAD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDHEAD.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_SHOW&nbsp;USING&nbsp;'&nbsp;'."重新&nbsp;执行ALV_SHOW&nbsp;目的：把实盘数列变为不可编辑状态。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ANSWER&nbsp;=&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*----------------弹出对话框函数-----------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ELSE."&nbsp;如果计数器等于0表示没有差异数，更改审核状态及记录审核人。<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSHR&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZSHR&nbsp;ZSH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_TABLE&nbsp;TO&nbsp;WA_PDHEAD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_PDHEAD&nbsp;TO&nbsp;IT_PDHEAD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDHEAD.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_SHOW&nbsp;USING&nbsp;'&nbsp;'."重新&nbsp;执行ALV_SHOW&nbsp;目的：把实盘数列变为不可编辑状态。<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;赋值全部（条件当为非POS盘点时执行赋值&nbsp;实盘数=账面数(2015.10.15李佳提出取消判断条件，改为按下赋值全部按钮对其全部赋值)）<br />
*---------------------------------------------------<br />
   </div>
   <div class="code">
FORM FM_FZ_ALL USING ZBL1.<br />
   </div>
   <div class="codeComment">
**--------------刷新缺--------------------<br />
*&nbsp;&nbsp;DATA:<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_GRID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.<br />
**&nbsp;刷新缺<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;L_GRID.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;L_GRID-&gt;CHECK_CHANGED_DATA.<br />
**--------------刷新缺--------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;LT_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMIF0150_PDHEAD.<br />
&nbsp;&nbsp;DATA&nbsp;LW_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_PDHEAD.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;ZFLAG&nbsp;ZSH&nbsp;ZPDBH&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;ZMMIF0150_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZPDBH&nbsp;EQ&nbsp;ZBL1.<br />
<br />
   </div>
   <div class="codeComment">
*判断是否已经审核，如果已经审核则不能修改。<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PDHEAD&nbsp;INTO&nbsp;&nbsp;LW_PDHEAD&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZSH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该盘点单号已审核,不能修改.'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT."&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*判断是否是POS盘点，如果是（空）则执行赋值&nbsp;实盘数=账面数，如果不是（X）则提示该盘点单号是使用POS端手持设备进行盘点。“2015.10.15&nbsp;李佳提出不判断是否是POS盘点，来执行赋值。<br />
*&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZFLAG&nbsp;=&nbsp;'&nbsp;'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSPS&nbsp;=&nbsp;WA_TABLE-ZZMS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZBC&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZSPS&nbsp;ZBC.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDHEAD.<br />
&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDHEAD.<br />
   </div>
   <div class="codeComment">
*<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该盘点单号为POS端手持设备进行盘点'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXIT."LEAVE&nbsp;LIST-PROCESSING.<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;赋值2（2015.10.15崔晨提出根据用户打勾项进行赋值）<br />
*---------------------------------------------------<br />
   </div>
   <div class="code">
FORM FM_FZ_SEL USING ZBL1.<br />
   </div>
   <div class="codeComment">
**--------------刷新缺--------------------<br />
*&nbsp;&nbsp;DATA:<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_GRID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.<br />
**&nbsp;刷新缺<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;L_GRID.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;L_GRID-&gt;CHECK_CHANGED_DATA.<br />
**--------------刷新缺--------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;LT_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMIF0150_PDHEAD.<br />
&nbsp;&nbsp;DATA&nbsp;LW_PDHEAD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_PDHEAD.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;ZFLAG&nbsp;ZSH&nbsp;ZPDBH&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;ZMMIF0150_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZPDBH&nbsp;EQ&nbsp;ZBL1.<br />
<br />
   </div>
   <div class="codeComment">
*判断是否已经审核，如果已经审核则不能修改。<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PDHEAD&nbsp;INTO&nbsp;&nbsp;LW_PDHEAD&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;IF&nbsp;LW_PDHEAD-ZSH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该盘点单号已审核,不能修改.'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT."&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*根据ALV打勾的选择进行赋值。<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-SEL_COL&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSPS&nbsp;=&nbsp;WA_TABLE-ZZMS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZBC&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZSPS&nbsp;ZBC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDHEAD.<br />
&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;TABLE&nbsp;IT_PDHEAD.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;打印<br />
*---------------------------------------------------<br />
   </div>
   <div class="code">
FORM FM_PRINT.<br />
<br />
   </div>
   <div class="codeComment">
**--------------刷新缺--------------------<br />
*&nbsp;&nbsp;DATA:<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_GRID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.<br />
**&nbsp;刷新缺<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;L_GRID.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;L_GRID-&gt;CHECK_CHANGED_DATA.<br />
**--------------刷新缺--------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RSPOPNAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_FUNC_NAME&nbsp;TYPE&nbsp;RS38L_FNAM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LST_CONTROL&nbsp;&nbsp;TYPE&nbsp;SSFCTRLOP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LST_PRINT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SSFCOMPOP.<br />
<br />
&nbsp;&nbsp;CLEAR:IT_SMF_TABLE[].&nbsp;&nbsp;"清空内表<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;数据筛选<br />
*-------------------------------把X传到IT_TABLE中,删除重复----------------------*<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-SEL_COL&nbsp;=&nbsp;'&nbsp;'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;SEL_COL.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TABLE1&nbsp;INTO&nbsp;WA_TABLE1&nbsp;WITH&nbsp;KEY&nbsp;MBLNR&nbsp;=&nbsp;WA_TABLE-MBLNR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE1-SEL_COL&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-SEL_COL&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;SEL_COL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*&nbsp;&nbsp;IT_SMF_TABLE&nbsp;=&nbsp;IT_TABLE.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_SMF_TABLE.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;IT_SMF_TABLE&nbsp;WHERE&nbsp;SEL_COL&nbsp;&lt;&gt;&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR:WA_TABLE1.<br />
*&nbsp;&nbsp;CLEAR:WA_TABLE.<br />
<br />
<br />
**--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;IT_SMF_TABLE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'请选择打印数据'.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;BREAK-POINT."断点<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'SSF_FUNCTION_MODULE_NAME'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"两个函数连调的原因是，SMARTFORMS会将你定义的名转成系统内的名字<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZMMIF0100_SF'&nbsp;&nbsp;&nbsp;"SMARTFORMS（表格设计）&nbsp;时自己的程序名<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FM_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_FUNC_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"系统内的SMARTFORMS表名，系统自动生成30字符长<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_FORM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_FUNCTION_MODULE&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;LST_CONTROL-NO_DIALOG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LST_CONTROL-PREVIEW&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LST_CONTROL-LANGU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-LANGU.<br />
&nbsp;&nbsp;LST_PRINT-TDDEST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZP01'.<br />
&nbsp;&nbsp;LST_PRINT-TDIMMED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;LW_FUNC_NAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTROL_PARAMETERS&nbsp;=&nbsp;LST_CONTROL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER_SETTINGS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SPACE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT_OPTIONS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LST_PRINT<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_CONT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_SMF_TABLE&nbsp;&nbsp;&nbsp;"在SMARTFORMS中定义的内表与<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;内表&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;smartforms的内表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMATTING_ERROR&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTERNAL_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEND_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER_CANCELED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'系统错误'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
FORM ALL.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-SEL_COL&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;SEL_COL.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
FORM CANCEL_ALL.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-SEL_COL&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;SEL_COL.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
FORM SX.<br />
&nbsp;&nbsp;FREE&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
<br />
<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
