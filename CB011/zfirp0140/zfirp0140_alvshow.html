<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZFIRP0140_ALVSHOW</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZFIRP0140_ALVSHOW</h2>
<h3> Description: Include ALV显示</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;包含&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZFIRP0140_ALVSHOW<br />
*&---------------------------------------------------------------------*<br />
<br />
*&---------------------------------------------------------------------*<br />
*&显示费用的ALV显示<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_ALVSHOW_01 USING I_EDIT TYPE C.     "做好自定义按包的准备<br />
<br />
&nbsp;&nbsp;GL_CHECK&nbsp;=&nbsp;I_EDIT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;IT_FIELDCAT[].&nbsp;&nbsp;&nbsp;"清空内存<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_ITEM2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZJSD_NO'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'结算单号'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;ABAP_FALSE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_ITEM2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZITEM_NO'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'行号'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;&nbsp;'&nbsp;'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_ITEM2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZFYMC'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'费用名称'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;ABAP_FALSE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_ITEM2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WRBTR'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'金额'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_HEADER.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;WITH&nbsp;KEY&nbsp;FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;WA_TAB_HEADER-ZJSZT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;&nbsp;I_EDIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'3'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_TABNAME&nbsp;=&nbsp;'VBRP'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_FIELDNAME&nbsp;=&nbsp;'KZWI1'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_ITEM2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZYISHOU'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'收费状态'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;&nbsp;I_EDIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
&nbsp;&nbsp;WA_FIELDCAT-CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_ITEM2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZHKBZ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'货扣标志'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;&nbsp;I_EDIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
&nbsp;&nbsp;WA_FIELDCAT-CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_LAYOUT.<br />
&nbsp;&nbsp;WA_LAYOUT-COLWIDTH_OPTIMIZE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;WA_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;WA_LAYOUT-NO_INPUT&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_LAYOUT-EDIT&nbsp;=&nbsp;ABAP_TRUE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"全部可编辑<br />
<br />
<br />
*　alv&nbsp;显示回调函数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_FIELDCAT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'PF_STATUS_SET_01'&nbsp;&nbsp;&nbsp;&nbsp;"状态栏控制<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'USER_COMMAND_01'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用户命令控制<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_TAB_ITEM2<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*用户事件01<br />
   </div>
   <div class="code">
FORM USER_COMMAND_01 USING R_UCOMM LIKE SY-UCOMM     "做好自定义按包的准备<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
&nbsp;&nbsp;DATA:IT_TAB_ITEM21&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZFIRP0140_ITEM2.<br />
&nbsp;&nbsp;FREE&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SAVE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NUM1&nbsp;=&nbsp;600.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ADD_DEL_FY&nbsp;USING&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_MODIFY_FYZT&nbsp;USING&nbsp;'已添加'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'费用表已保存'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'DEL'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_MODIFY_FYZT&nbsp;USING&nbsp;'未添加'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ADD_DEL_FY&nbsp;USING&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'费用表已删除'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_UPNAM.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*显示按钮01<br />
   </div>
   <div class="code">
FORM PF_STATUS_SET_01 USING P_EXTAB TYPE SLIS_T_EXTAB..<br />
&nbsp;&nbsp;"Set&nbsp;the&nbsp;Button&nbsp;using&nbsp;the&nbsp;staus<br />
&nbsp;&nbsp;"Copy&nbsp;the&nbsp;Standard&nbsp;status&nbsp;from&nbsp;the&nbsp;program&nbsp;SAPLKKBL&nbsp;status<br />
&nbsp;&nbsp;"&nbsp;STANDARD&nbsp;using&nbsp;SE41,&nbsp;and&nbsp;use&nbsp;that&nbsp;here.<br />
&nbsp;&nbsp;"Pf&nbsp;status<br />
&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAVE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'DEL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_01'&nbsp;EXCLUDING&nbsp;P_EXTAB.<br />
&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_01'&nbsp;EXCLUDING&nbsp;P_EXTAB.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&显示结算报表ALV显示<br />
*&---------------------------------------------------------------------*<br />
*结算报表&nbsp;表头ALV<br />
   </div>
   <div class="code">
FORM FM_ALVSHOW_02.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;IT_FIELDCAT[].&nbsp;&nbsp;&nbsp;"清空内存<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_HEADER'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZJSD_NO'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'结算单号'.<br />
&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-EDIT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
   </div>
   <div class="code">
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_HEADER'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LIFNR'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'供应商'.<br />
&nbsp;&nbsp;WA_FIELDCAT-NO_ZERO&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"不显示前置零<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;ADD_ALV:<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;'ZJSD_NO'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算单号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;'LIFNR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'供应商'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;'2',<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;'ZPO_BUKRS'&nbsp;&nbsp;&nbsp;'采购公司代码'&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;3,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;'ZJSZQ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算周期'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;4,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;'EWBEZ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'商品大类'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;5,&nbsp;&nbsp;"&nbsp;'EXTWG'<br />
&nbsp;&nbsp;&nbsp;&nbsp;'RBTXT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'小类'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;6,&nbsp;&nbsp;&nbsp;"&nbsp;'RAUBE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZDAYS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'天数'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;7,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZSTART_DATE'&nbsp;'开始时间'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;8,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZEND_DATE'&nbsp;&nbsp;&nbsp;'结束时间'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;9,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZZZ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'总重'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;&nbsp;10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZZJS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'总件数'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;&nbsp;11,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZXSZJE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'销售总金额'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;&nbsp;12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZCKZJE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'参考价总金额'&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;&nbsp;12,<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;'ZZJSJE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'含税结算总金额'&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;&nbsp;12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZZJE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算总金额'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;13,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZFYZT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'费用状态'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;14,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZFAPIAO1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'收到发票'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;15,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;'GJAHR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'会计年度'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;16,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;'BUDAT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'过账日期'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;17,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;'BELNR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'发票编号'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;'ZWAIBU_NO'&nbsp;&nbsp;&nbsp;'外部发票号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;18,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;'BVORG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'公司间凭证编号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;19,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;'ZFK1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'付款状态'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;&nbsp;20,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;'ZFKJE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'付款金额'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;21,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;'ZJSZT1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算状态'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;22,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ADNAM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'创建人'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;23,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ADDAT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'创建日期'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;24,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ADTIM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'创建时间'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;25,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'UPNAM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'修改人'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;26,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'UPDAT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'修改日期'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;27,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'UPTIM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'修改时间'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;28,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ZSH1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'审核状态'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;29,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'SHNAM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'审核人'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;30,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'SHDAT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'审核日期'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;31,<br />
&nbsp;&nbsp;&nbsp;&nbsp;'SHTIM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'审核时间'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_HEADER'&nbsp;32<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_LAYOUT.<br />
&nbsp;&nbsp;WA_LAYOUT-COLWIDTH_OPTIMIZE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;WA_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_LAYOUT-NO_INPUT&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_LAYOUT-LIGHTS_FIELDNAME&nbsp;=&nbsp;'ZLIGHT'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"状态灯<br />
&nbsp;&nbsp;WA_LAYOUT-BOX_FIELDNAME&nbsp;=&nbsp;'FLAG'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"选择行头按钮<br />
&nbsp;&nbsp;WA_LAYOUT-TOTALS_BEFORE_ITEMS&nbsp;=&nbsp;ABAP_TRUE.<br />
<br />
   </div>
   <div class="codeComment">
*　alv&nbsp;显示回调函数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_FIELDCAT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'PF_STATUS_SET_02'&nbsp;&nbsp;&nbsp;&nbsp;"状态栏控制<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'USER_COMMAND_02'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用户命令控制<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_FALSE<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_TAB_HEADER<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*用户事件02<br />
   </div>
   <div class="code">
FORM USER_COMMAND_02 USING R_UCOMM LIKE SY-UCOMM     "做好自定义按包的准备<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
&nbsp;&nbsp;FREE&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_BK'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_INIT.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'&IC1'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"双击事件<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;INDEX&nbsp;RS_SELFIELD-TABINDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;IT_TAB_HEADER&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;AND&nbsp;RS_SELFIELD-FIELDNAME&nbsp;EQ&nbsp;'ZJSD_NO'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;NUM1&nbsp;=&nbsp;700.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ALV.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;IT_ALV_TAB&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'未找到相关未结算商品'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_MOVE.<br />
**行项目检查<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CHECK_ITEM1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;IT_TAB_ITEM1&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'未找到相关未结算商品'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_BMZH&nbsp;USING&nbsp;'I'.&nbsp;&nbsp;"编码转描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ZHYH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ALVSHOW_03.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"调用显示行项目ALV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;NUM1&nbsp;NE&nbsp;700.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ITEM1&nbsp;USING&nbsp;WA_TAB_HEADER-ZJSD_NO.<br />
   </div>
   <div class="codeComment">
*编码转描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_BMZH&nbsp;USING&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ALVSHOW_03.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"调用显示行项目ALV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'DELE'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"删除结算单表头<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ITEM2_PBO&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先选取一条结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'不能选择多个结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
***********************************************************************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;INDEX&nbsp;RS_SELFIELD-TABINDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TAB_HEADER-ZFAPIAO&nbsp;NE&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'已发票校验的结算单不能删除'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_TAB_HEADER-ZSH&nbsp;NE&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'已审核的结算单不能删除'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
***********************************************************************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_WINDOWS&nbsp;USING&nbsp;'是否删除该结算单。'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_ANSWER&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_DELETE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请求已撤销'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'COST'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"添加费用<br />
   </div>
   <div class="codeComment">
*检查按钮<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ITEM2_PBO&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先选取一条结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'不能选择多个结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*检查费用状态<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CHECK_COST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'已生成费用表,请点击编辑进入'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*取费用数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_ITEM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ALVSHOW_01&nbsp;USING&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先维护配置表数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'EDIT'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"编辑费用表<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ITEM2_PBO&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先选取一条结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'不能选择多个结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_MODIFY_ITEM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;IT_TAB_ITEM2&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先添加费用'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ALVSHOW_01&nbsp;USING&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SHOW'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"显示费用表<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'这是显示按钮'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ITEM2_PBO&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先选取一条结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'不能选择多个结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_MODIFY_ITEM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;IT_TAB_ITEM2&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先添加费用'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ALVSHOW_01&nbsp;USING&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SH'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"审核<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ITEM2_PBO&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先选取一条结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'不能选择多个结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_SH_CREATE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'CXSH'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"取消审核<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ITEM2_PBO&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先选取一条结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'不能选择多个结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该功能未开发'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_DEL_SH.<br />
<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
   </div>
   <div class="codeComment">
*设置刷新<br />
   </div>
   <div class="code">
&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*保证行、列位置在自动刷新时不变<br />
   </div>
   <div class="code">
&nbsp;&nbsp;RS_SELFIELD-COL_STABLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;RS_SELFIELD-ROW_STABLE&nbsp;=&nbsp;'X'.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*显示按钮02<br />
   </div>
   <div class="code">
FORM PF_STATUS_SET_02 USING P_EXTAB TYPE SLIS_T_EXTAB..<br />
&nbsp;&nbsp;"Set&nbsp;the&nbsp;Button&nbsp;using&nbsp;the&nbsp;staus<br />
&nbsp;&nbsp;"Copy&nbsp;the&nbsp;Standard&nbsp;status&nbsp;from&nbsp;the&nbsp;program&nbsp;SAPLKKBL&nbsp;status<br />
&nbsp;&nbsp;"&nbsp;STANDARD&nbsp;using&nbsp;SE41,&nbsp;and&nbsp;use&nbsp;that&nbsp;here.<br />
&nbsp;&nbsp;"Pf&nbsp;status<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA:&nbsp;LS_SLIS_EXTAB&nbsp;TYPE&nbsp;SLIS_EXTAB,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR80.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;NUM1&nbsp;=&nbsp;800.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"显示<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'COST'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'EDIT'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'DELE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SH'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'CXSH'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&DATA_SAVE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_02'&nbsp;EXCLUDING&nbsp;P_EXTAB.<br />
&nbsp;&nbsp;ELSEIF&nbsp;NUM1&nbsp;=&nbsp;700.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"生成<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SH'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'CXSH'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&DATA_SAVE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'DELE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_02'&nbsp;EXCLUDING&nbsp;P_EXTAB.<br />
<br />
&nbsp;&nbsp;ELSEIF&nbsp;NUM1&nbsp;=&nbsp;600.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"编辑<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&DATA_SAVE'&nbsp;)<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'DELE'&nbsp;)<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_02'&nbsp;EXCLUDING&nbsp;P_EXTAB.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;ELSEIF&nbsp;NUM1&nbsp;=&nbsp;900.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'COST'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&DATA_SAVE'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'DELE'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_02'&nbsp;EXCLUDING&nbsp;P_EXTAB.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*-----------------------------------------------------------------------------------------------------------<br />
*结算报表&nbsp;行项目ALV<br />
   </div>
   <div class="code">
FORM FM_ALVSHOW_03.<br />
&nbsp;&nbsp;DATA:&nbsp;T_FIELDCAT&nbsp;TYPE&nbsp;LVC_T_FCAT.<br />
&nbsp;&nbsp;DATA:&nbsp;A_FIELDCAT&nbsp;TYPE&nbsp;LVC_S_FCAT.<br />
&nbsp;&nbsp;DATA:&nbsp;X_LAYOUT&nbsp;TYPE&nbsp;LVC_S_LAYO.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA:L_POS&nbsp;TYPE&nbsp;I&nbsp;VALUE&nbsp;0.<br />
<br />
*-------------20160320&nbsp;MODIFY&nbsp;BY&nbsp;LINAN--------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_HTH.<br />
   </div>
   <div class="codeComment">
*-----------------------END-------------------------------<br />
<br />
*定义ALV显示宏<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DEFINE&nbsp;ADD_ALV1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;A_FIELDCAT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;L_POS&nbsp;=&nbsp;L_POS&nbsp;+&nbsp;1.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;&4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;&3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-FIELDNAME&nbsp;=&nbsp;&1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;&2..<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-EDIT&nbsp;=&nbsp;ABAP_TRUE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;'5'.<br />
*&nbsp;&nbsp;&nbsp;A_FIELDCAT-REF_FIELD&nbsp;=&nbsp;'VBELN'.<br />
*&nbsp;&nbsp;&nbsp;A_FIELDCAT-REF_TABLE&nbsp;=&nbsp;'VBAK'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;IF&nbsp;&4&nbsp;&lt;&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-FIX_COLUMN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;A_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZYHJG'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-EMPHASIZE&nbsp;=&nbsp;'C410'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;A_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'KUNAG'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'VBRK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'KUNAG'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;A_FIELDCAT&nbsp;TO&nbsp;T_FIELDCAT.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;T_FIELDCAT[].&nbsp;&nbsp;&nbsp;"清空内存<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR:&nbsp;L_POS.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;A_FIELDCAT.<br />
&nbsp;&nbsp;A_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;A_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'ZGYSDM'.<br />
&nbsp;&nbsp;A_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'IT_TAB_ITEM1'.<br />
&nbsp;&nbsp;A_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'供应商'.&nbsp;"<br />
&nbsp;&nbsp;A_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'MSEG'.<br />
&nbsp;&nbsp;A_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'LIFNR'.<br />
&nbsp;&nbsp;APPEND&nbsp;&nbsp;A_FIELDCAT&nbsp;&nbsp;TO&nbsp;T_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;A_FIELDCAT.<br />
&nbsp;&nbsp;A_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;38.<br />
&nbsp;&nbsp;A_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'VRKME'.<br />
&nbsp;&nbsp;A_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'IT_TAB_ITEM1'.<br />
&nbsp;&nbsp;A_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'单位'.&nbsp;"<br />
&nbsp;&nbsp;A_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'MARA'.<br />
&nbsp;&nbsp;A_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;APPEND&nbsp;&nbsp;A_FIELDCAT&nbsp;&nbsp;TO&nbsp;T_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;A_FIELDCAT.<br />
&nbsp;&nbsp;A_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;23.<br />
&nbsp;&nbsp;A_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TAB_ITEM1'.<br />
&nbsp;&nbsp;A_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZYHFT'&nbsp;.<br />
&nbsp;&nbsp;A_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'优惠分摊'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WA_FIELDCAT-HOTSPOT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"下划线选取<br />
   </div>
   <div class="code">
&nbsp;&nbsp;A_FIELDCAT-EDIT&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"开放编辑<br />
&nbsp;&nbsp;A_FIELDCAT-REF_TABLE&nbsp;&nbsp;=&nbsp;'ZFIRP0140_ITEM1'.<br />
&nbsp;&nbsp;A_FIELDCAT-REF_FIELD&nbsp;&nbsp;=&nbsp;'ZYHFT'.<br />
&nbsp;&nbsp;APPEND&nbsp;A_FIELDCAT&nbsp;TO&nbsp;T_FIELDCAT.<br />
<br />
&nbsp;&nbsp;ADD_ALV1:<br />
<br />
&nbsp;&nbsp;&nbsp;'ZJSD_NO'&nbsp;&nbsp;&nbsp;&nbsp;'结算单号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,<br />
&nbsp;&nbsp;&nbsp;'ZITEM_NO'&nbsp;&nbsp;&nbsp;'行项目号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;'VBELN'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'收入凭证'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3,<br />
&nbsp;&nbsp;&nbsp;'POSNR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'小票行项目'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4,<br />
&nbsp;&nbsp;&nbsp;'ZSA_BUKRS'&nbsp;&nbsp;'销售公司代码'&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5,<br />
<br />
&nbsp;&nbsp;&nbsp;'SORTL'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'门店名称'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6,&nbsp;&nbsp;"&nbsp;'KUNAG'<br />
&nbsp;&nbsp;&nbsp;'SERV_TYPE'&nbsp;&nbsp;'业务类型'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7,<br />
&nbsp;&nbsp;&nbsp;'XBLNR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'POS小票号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8,<br />
&nbsp;&nbsp;&nbsp;'AUFNR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'内部订单号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;'ZGYSDM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'供应商'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;'WERKS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'采购地点'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11,<br />
&nbsp;&nbsp;&nbsp;'MBLNR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'入库单号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12,<br />
&nbsp;&nbsp;&nbsp;'ZPO_BUKRS'&nbsp;&nbsp;'采购公司代码'&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13,<br />
<br />
&nbsp;&nbsp;&nbsp;'EWBEZ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'大类'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14,&nbsp;&nbsp;"&nbsp;'EXTWG'<br />
&nbsp;&nbsp;&nbsp;'RBTXT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'小类'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15,&nbsp;&nbsp;"&nbsp;'RAUBE'<br />
&nbsp;&nbsp;&nbsp;'MATNR'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'商品编码'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16,<br />
&nbsp;&nbsp;&nbsp;'CHARG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'商品批次'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17,<br />
&nbsp;&nbsp;&nbsp;'ZSPTM'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'商品条码'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17,<br />
&nbsp;&nbsp;&nbsp;'ARKTX'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'商品名称'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18,<br />
&nbsp;&nbsp;&nbsp;'FKDAT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'销售日期'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19,<br />
&nbsp;&nbsp;&nbsp;'KZWI1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'实销价格'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20,<br />
&nbsp;&nbsp;&nbsp;'KZWI6'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'参考零售价'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;21,<br />
&nbsp;&nbsp;&nbsp;'ZYHJG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'优惠价格'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22,<br />
&nbsp;&nbsp;&nbsp;'ZZHYH'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'综合优惠'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;24,<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;'ZYHJE1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'优惠分摊'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;'41',<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;'BMTXT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算方式'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;24,&nbsp;&nbsp;&nbsp;"&nbsp;'ZLYJSFS'<br />
&nbsp;&nbsp;&nbsp;'ZJSJJ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算克金价'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25,<br />
&nbsp;&nbsp;&nbsp;'ZJSKGF'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算克工费'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;26,<br />
&nbsp;&nbsp;&nbsp;'ZJSDKZ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算克倒扣工费'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;27,<br />
&nbsp;&nbsp;&nbsp;'ZLYJSYKJ'&nbsp;&nbsp;&nbsp;'结算一口价'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;28,<br />
&nbsp;&nbsp;&nbsp;'ZJSKL'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算扣率'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;29,<br />
&nbsp;&nbsp;&nbsp;'ZB00'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'投资克基础价'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;30,<br />
&nbsp;&nbsp;&nbsp;'ZKSG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'销售克工费档加价'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;31,<br />
&nbsp;&nbsp;&nbsp;'ZD01'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'以旧换新抵值'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;32,<br />
<br />
&nbsp;&nbsp;&nbsp;'GJSCZ_TEXT'&nbsp;'贵金属材质'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;33,&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;'ZGJSCZ'<br />
&nbsp;&nbsp;&nbsp;'ZGYSSPTM'&nbsp;&nbsp;&nbsp;'供应商商品条码'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;34,<br />
&nbsp;&nbsp;&nbsp;'ZXQZSZL'&nbsp;&nbsp;&nbsp;&nbsp;'主石大小'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;35,<br />
&nbsp;&nbsp;&nbsp;'ZZS1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'证书'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;36,<br />
&nbsp;&nbsp;&nbsp;'ZXSJS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'件数'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;37,<br />
&nbsp;&nbsp;&nbsp;'ZXSKZ'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'克重'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;38,<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;'VRKME'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'单位'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;'38',<br />
*&nbsp;&nbsp;&nbsp;'FKIMG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'数量'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;'39',<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;'ZJSCB'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'结算成本金额'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;39,<br />
&nbsp;&nbsp;&nbsp;'ZJSJE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'供应商结算金额'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40,<br />
&nbsp;&nbsp;&nbsp;'ZHTH'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'合同号'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'IT_TAB_ITEM1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;41<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TAB_ITEM1&nbsp;INTO&nbsp;WA_TAB_ITEM1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_EDIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_EDIT-FIELDNAME&nbsp;=&nbsp;'ZYHFT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_EDIT-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LS_EDIT&nbsp;INTO&nbsp;TABLE&nbsp;WA_TAB_ITEM1-STYLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TAB_ITEM1&nbsp;FROM&nbsp;WA_TAB_ITEM1&nbsp;TRANSPORTING&nbsp;STYLE.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;X_LAYOUT.<br />
&nbsp;&nbsp;X_LAYOUT-CWIDTH_OPT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;X_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;X_LAYOUT-EDIT&nbsp;=&nbsp;'&nbsp;'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;X_LAYOUT-BOX_FNAME&nbsp;=&nbsp;'FLAG'.<br />
&nbsp;&nbsp;X_LAYOUT-STYLEFNAME&nbsp;=&nbsp;'STYLE'.<br />
&nbsp;&nbsp;X_LAYOUT-SEL_MODE&nbsp;=&nbsp;'D'.<br />
&nbsp;&nbsp;X_LAYOUT-TOTALS_BEF&nbsp;=&nbsp;ABAP_TRUE.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY_LVC'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT_LVC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;X_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT_LVC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;T_FIELDCAT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'PF_STATUS_SET_03'&nbsp;&nbsp;&nbsp;&nbsp;"状态栏控制<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'USER_COMMAND_03'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用户命令控制<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_FALSE<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_TAB_ITEM1<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*用户事件03<br />
   </div>
   <div class="code">
FORM USER_COMMAND_03 USING R_UCOMM LIKE SY-UCOMM     "做好自定义按包的准备<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
&nbsp;&nbsp;FREE&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;REF_GRID.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_HEADER_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SAVE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_SAVE_YHFT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_SAVE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'EDIT1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_ITEM2_PBO&nbsp;USING&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'请先选取一条结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;L_NUM2&nbsp;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'不能选择多件商品'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_EDIT_YHFT."&nbsp;USING&nbsp;RS_SELFIELD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'只能编辑结算方式为&nbsp;联营:扣率&nbsp;并且没有审核的项'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SAVE1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_SAVE_YHFT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'DEL1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_ITEM1&nbsp;INTO&nbsp;WA_TAB_ITEM1&nbsp;WITH&nbsp;KEY&nbsp;FLAG&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_WINDOWS&nbsp;USING&nbsp;'删除后将无法恢复,是否删除这些项目。'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_ANSWER&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_DEL_ROWS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'操作已取消'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'请先选中至少一条行项目'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*保证行、列位置在自动刷新时不变<br />
   </div>
   <div class="code">
&nbsp;&nbsp;RS_SELFIELD-COL_STABLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;RS_SELFIELD-ROW_STABLE&nbsp;=&nbsp;'X'.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*显示按钮03<br />
   </div>
   <div class="code">
FORM PF_STATUS_SET_03 USING P_EXTAB TYPE SLIS_T_EXTAB.<br />
&nbsp;&nbsp;"Set&nbsp;the&nbsp;Button&nbsp;using&nbsp;the&nbsp;staus<br />
&nbsp;&nbsp;"Copy&nbsp;the&nbsp;Standard&nbsp;status&nbsp;from&nbsp;the&nbsp;program&nbsp;SAPLKKBL&nbsp;status<br />
&nbsp;&nbsp;"&nbsp;STANDARD&nbsp;using&nbsp;SE41,&nbsp;and&nbsp;use&nbsp;that&nbsp;here.<br />
&nbsp;&nbsp;"Pf&nbsp;status<br />
&nbsp;&nbsp;CLEAR&nbsp;P_EXTAB.<br />
<br />
&nbsp;&nbsp;IF&nbsp;NUM1&nbsp;=&nbsp;800.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'EDIT1'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAVE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAVE1'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAV1'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'DEL1'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_03'EXCLUDING&nbsp;P_EXTAB.<br />
&nbsp;&nbsp;ELSEIF&nbsp;NUM1&nbsp;=&nbsp;600.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_ITEM1&nbsp;INTO&nbsp;WA_TAB_ITEM1&nbsp;INDEX&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;WITH&nbsp;KEY&nbsp;ZJSD_NO&nbsp;=&nbsp;WA_TAB_ITEM1-ZJSD_NO.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TAB_HEADER-ZSH&nbsp;NE&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAVE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_TAB_HEADER-ZSH&nbsp;EQ&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAVE'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'DEL1'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;"删除行项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'EDIT1'&nbsp;)&nbsp;&nbsp;&nbsp;"编辑优惠分摊<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAVE1'&nbsp;)&nbsp;&nbsp;&nbsp;"保存优惠分摊<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_03'EXCLUDING&nbsp;P_EXTAB.<br />
&nbsp;&nbsp;ELSEIF&nbsp;NUM1&nbsp;=&nbsp;700.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'SAV1'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZFIRP0140_PF_03'EXCLUDING&nbsp;P_EXTAB.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*删除自建表数据<br />
   </div>
   <div class="code">
FORM FM_DELETE .<br />
<br />
&nbsp;&nbsp;IF&nbsp;IT_TAB_HEADER&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;WITH&nbsp;KEY&nbsp;FLAG&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.&nbsp;"AND&nbsp;WA_TAB_HEADER-ZFAPIAO&nbsp;EQ&nbsp;1."&nbsp;AND&nbsp;WA_TAB_HEADER-ZSH&nbsp;IS&nbsp;INITIAL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;WA_TAB_HEADER1,IT_TAB_ITEM11[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZFIRP0140_ITEM2&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_TAB_ITEM21<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZJSD_NO&nbsp;=&nbsp;WA_TAB_HEADER-ZJSD_NO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ZFIRP0140_ITEM2&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_ITEM21.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_TAB_HEADER&nbsp;TO&nbsp;WA_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ZFIRP0140_HEADER&nbsp;FROM&nbsp;WA_TAB_HEADER1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZFIRP0140_ITEM1&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_TAB_ITEM11<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZJSD_NO&nbsp;EQ&nbsp;WA_TAB_HEADER-ZJSD_NO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ZFIRP0140_ITEM1&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_ITEM11.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;IT_TAB_HEADER&nbsp;WHERE&nbsp;ZJSD_NO&nbsp;=&nbsp;WA_TAB_HEADER-ZJSD_NO.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'已发票校验的结算单不能删除'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'结算单已删除'.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*编辑优惠分摊<br />
   </div>
   <div class="code">
FORM FM_EDIT_YHFT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GL_CHECK&nbsp;.<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;FS_HEAD&gt;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;IT_TAB_ITEM1.<br />
<br />
&nbsp;&nbsp;IF&nbsp;IT_TAB_ITEM1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_ITEM1.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TAB_ITEM1&nbsp;ASSIGNING&nbsp;&lt;FS_HEAD&gt;.&nbsp;"WHERE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_HEAD&gt;-FLAG&nbsp;=&nbsp;ABAP_TRUE&nbsp;.<br />
   </div>
   <div class="codeComment">
*记录编辑的行项目号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABIX-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABIX-OPTION&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABIX-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_TABIX&nbsp;TO&nbsp;RT_TABIX.<br />
   </div>
   <div class="codeComment">
*改变行项目编辑状态<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TMP_HEADER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TMP_HEADER&nbsp;WITH&nbsp;KEY&nbsp;&lt;FS_HEAD&gt;-ZJSD_NO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TAB_ITEM1-ZLYJSFS&nbsp;EQ&nbsp;'Z07'&nbsp;AND&nbsp;WA_TMP_HEADER-ZSH&nbsp;EQ&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_EDIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EDIT-FIELDNAME&nbsp;=&nbsp;'ZYHFT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EDIT-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_ENABLED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_ITEM1-STYLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LS_EDIT&nbsp;INTO&nbsp;TABLE&nbsp;WA_TAB_ITEM1-STYLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TAB_ITEM1&nbsp;FROM&nbsp;WA_TAB_ITEM1&nbsp;TRANSPORTING&nbsp;STYLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GL_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*保存分摊优惠<br />
   </div>
   <div class="code">
FORM FM_SAVE_YHFT.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GL_CHECK.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TAB_ITEM1&nbsp;INTO&nbsp;WA_TAB_ITEM1&nbsp;WHERE&nbsp;ZLYJSFS&nbsp;=&nbsp;'Z07'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TAB_ITEM1-ZYHJG&nbsp;-&nbsp;WA_TAB_ITEM1-ZYHFT&nbsp;&gt;=&nbsp;0.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_EDIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_EDIT-FIELDNAME&nbsp;=&nbsp;'ZYHFT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_EDIT-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_ITEM1-STYLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LS_EDIT&nbsp;INTO&nbsp;TABLE&nbsp;WA_TAB_ITEM1-STYLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TAB_ITEM1&nbsp;FROM&nbsp;WA_TAB_ITEM1&nbsp;TRANSPORTING&nbsp;STYLE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_Z07&nbsp;USING&nbsp;'2'.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'错误的优惠分摊数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ELSEIF&nbsp;NUM1&nbsp;NE&nbsp;700.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_HEADER_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_HEADER&nbsp;TO&nbsp;IT_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_ITEM1&nbsp;TO&nbsp;IT_TAB_ITEM11.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_HEADER&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_ITEM1&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_ITEM11.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'结算单'&nbsp;&&&nbsp;WA_TAB_HEADER-ZJSD_NO&nbsp;&&&nbsp;'优惠分摊保存成功'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_UPNAM.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*弹窗确认<br />
   </div>
   <div class="code">
FORM FM_WINDOWS USING I_TEXT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;L_ANSWER.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_CONFIRM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TITLEBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'确认'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_QUESTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;I_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_BUTTON_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'是'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_BUTTON_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'否'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISPLAY_CANCEL_BUTTON&nbsp;=&nbsp;'&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_BUTTON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'2'&nbsp;"默认为2（否）<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_COLUMN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;25<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSWER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_ANSWER<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*删除费用时更新抬头<br />
   </div>
   <div class="code">
FORM FM_MODIFY_FYZT USING I_FYZT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_ITEM2.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_ITEM2&nbsp;INTO&nbsp;WA_TAB_ITEM2&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_HEADER.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;WITH&nbsp;KEY&nbsp;ZJSD_NO&nbsp;=&nbsp;WA_TAB_ITEM2-ZJSD_NO.<br />
&nbsp;&nbsp;WA_TAB_HEADER-ZFYZT&nbsp;=&nbsp;I_FYZT.<br />
&nbsp;&nbsp;MODIFY&nbsp;IT_TAB_HEADER&nbsp;FROM&nbsp;WA_TAB_HEADER&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;ZFYZT.<br />
<br />
&nbsp;&nbsp;IF&nbsp;NUM1&nbsp;=&nbsp;600.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_HEADER&nbsp;TO&nbsp;IT_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_HEADER&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_HEADER1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*添加删除费用<br />
   </div>
   <div class="code">
FORM FM_ADD_DEL_FY USING I_FY.<br />
&nbsp;&nbsp;IF&nbsp;I_FY&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_ITEM2&nbsp;TO&nbsp;IT_TAB_ITEM21.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_ITEM2&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_ITEM21.<br />
&nbsp;&nbsp;ELSEIF&nbsp;I_FY&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_ITEM2&nbsp;TO&nbsp;IT_TAB_ITEM21.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ZFIRP0140_ITEM2&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_ITEM21.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;IT_TAB_ITEM2[].<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*更新修改者信息<br />
   </div>
   <div class="code">
FORM FM_UPNAM.<br />
&nbsp;&nbsp;IF&nbsp;NUM1&nbsp;NE&nbsp;700.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-UPNAM&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-UPDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-UPTIM&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TAB_HEADER&nbsp;FROM&nbsp;WA_TAB_HEADER&nbsp;TRANSPORTING&nbsp;UPNAM&nbsp;UPDAT&nbsp;UPTIM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*用户名转换<br />
   </div>
   <div class="code">
FORM FM_GET_USRNAME CHANGING CU_NAME. " USING FU_UNAME<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_NAME&nbsp;&nbsp;TYPE&nbsp;CHAR80,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PERNO&nbsp;TYPE&nbsp;AD_PERSNUM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ADRP&nbsp;TYPE&nbsp;ADRP.<br />
   </div>
   <div class="codeComment">
*&nbsp;取人员编码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;PERSNUMBER<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_PERNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;USR21<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;BNAME&nbsp;=&nbsp;CU_NAME."&nbsp;FU_UNAME.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;取人名称<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_ADRP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ADRP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;PERSNUMBER&nbsp;=&nbsp;L_PERNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;DATE_FROM&nbsp;&lt;=&nbsp;SY-DATUM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;DATE_TO&nbsp;&nbsp;&nbsp;&gt;=&nbsp;SY-DATUM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LW_ADRP-NAME_LAST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ADRP-NAME_FIRST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_NAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CU_NAME&nbsp;=&nbsp;L_NAME.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*审核功能<br />
   </div>
   <div class="code">
FORM FM_SH_CREATE.  "生成审核<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_HEADER.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;WITH&nbsp;KEY&nbsp;FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
*检查审核状态<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ZSH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZFIRP0140_HEADER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_ZSH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZJSD_NO&nbsp;=&nbsp;WA_TAB_HEADER-ZJSD_NO.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_ZSH&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-ZSH&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-SHNAM&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-SHDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-SHTIM&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;IT_TAB_HEADER&nbsp;FROM&nbsp;WA_TAB_HEADER&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;ZSH&nbsp;SHNAM&nbsp;SHDAT&nbsp;SHTIM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_TAB_HEADER&nbsp;TO&nbsp;WA_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_HEADER&nbsp;FROM&nbsp;WA_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该结算单已审核,请不要重复审核'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_BMZH&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'审核完成'.<br />
<br />
ENDFORM.<br />
<br />
FORM FM_CHECK_SH.  "检查审核状态<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
FORM FM_DEL_SH.    "取消审核<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_HEADER.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;INTO&nbsp;WA_TAB_HEADER&nbsp;WITH&nbsp;KEY&nbsp;FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
*检查审核状态<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ZSH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZFIRP0140_HEADER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_ZSH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZJSD_NO&nbsp;=&nbsp;WA_TAB_HEADER-ZJSD_NO.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_ZSH&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;WA_TAB_HEADER-ZFAPIAO&nbsp;EQ&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-ZSH&nbsp;&nbsp;&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-SHNAM&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-SHDAT&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-SHTIM&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-UPNAM&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-UPDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_HEADER-UPTIM&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;IT_TAB_HEADER&nbsp;FROM&nbsp;WA_TAB_HEADER&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;ZSH&nbsp;UPNAM&nbsp;UPDAT&nbsp;UPTIM&nbsp;SHNAM&nbsp;SHDAT&nbsp;SHTIM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;WA_TAB_HEADER&nbsp;TO&nbsp;WA_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_HEADER&nbsp;FROM&nbsp;WA_TAB_HEADER1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;L_ZSH&nbsp;=&nbsp;'&nbsp;'&nbsp;AND&nbsp;WA_TAB_HEADER-ZFAPIAO&nbsp;EQ&nbsp;1..<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'该结算单未审核,无法撤销审核'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&nbsp;L_ZSH&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;WA_TAB_HEADER-ZFAPIAO&nbsp;NE&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'已发票校验的结算单,无法撤销审核'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_BMZH&nbsp;USING&nbsp;'H'.<br />
&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'撤销审核完成'.<br />
<br />
ENDFORM.<br />
<br />
FORM FM_GET_SPTM.<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_BATCH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPTM&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-ZSPTM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_BATCH.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_SPTM&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_BATCH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_SPTM&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_BATCH,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MACH&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_BATCH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MACH&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_BATCH.<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;WA_TAB_ITEM1&gt;&nbsp;TYPE&nbsp;STRU_ITEM1.<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_ITEM1&nbsp;TO&nbsp;LT_MACH.<br />
&nbsp;&nbsp;SORT&nbsp;LT_MACH&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_MACH&nbsp;COMPARING&nbsp;MATNR&nbsp;CHARG.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPTM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMRP0210_BATCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_SPTM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_MACH<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;EQ&nbsp;LT_MACH-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CHARG&nbsp;EQ&nbsp;LT_MACH-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_SPTM&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TAB_ITEM1&nbsp;ASSIGNING&nbsp;&lt;WA_TAB_ITEM1&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_SPTM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_SPTM&nbsp;INTO&nbsp;LS_SPTM&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;WA_TAB_ITEM1&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;&lt;WA_TAB_ITEM1&gt;-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_TAB_ITEM1&gt;-ZSPTM&nbsp;=&nbsp;LS_SPTM-ZSPTM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
FORM FM_DEL_ROWS.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_TMP&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_ITEM1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_TMP&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_ITEM1.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_HEAD&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_HEADER.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;LS_ITEM1&gt;&nbsp;TYPE&nbsp;STRU_ITEM1.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;LS_HEADER&gt;&nbsp;TYPE&nbsp;STRU_HEADER.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;1.删除功能实现<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LT_TMP&nbsp;=&nbsp;IT_TAB_ITEM1.<br />
&nbsp;&nbsp;DELETE&nbsp;IT_TAB_ITEM1&nbsp;WHERE&nbsp;FLAG&nbsp;EQ&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;IF&nbsp;IT_TAB_ITEM1&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_TAB_ITEM1&nbsp;=&nbsp;LT_TMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'如果要全部删除请从抬头表删除结算单'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;2.对行项目内表行项目序号更新,对抬头内表合计金额,修改人等更新<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TAB_ITEM1&nbsp;ASSIGNING&nbsp;&lt;LS_ITEM1&gt;.&nbsp;&nbsp;"更新行项目号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_ITEM1&gt;-ZITEM_NO&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_HEADER_SUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"更新表头汇总值<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_ITEM1&nbsp;INTO&nbsp;LS_TMP&nbsp;INDEX&nbsp;1.&nbsp;"更新表头修改人信息<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_HEADER&nbsp;ASSIGNING&nbsp;&lt;LS_HEADER&gt;&nbsp;WITH&nbsp;KEY&nbsp;ZJSD_NO&nbsp;=&nbsp;LS_TMP-ZJSD_NO.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.&nbsp;"更新修改人信息<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_HEADER&gt;-UPNAM&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_HEADER&gt;-UPDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_HEADER&gt;-UPTIM&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;3.对自建表抬头进行更新,自建表行项目进行删除和更新<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_HEADER&nbsp;TO&nbsp;IT_TAB_HEADER1.<br />
&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_HEADER&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_HEADER1.<br />
&nbsp;&nbsp;"删除自建表<br />
&nbsp;&nbsp;CLEAR&nbsp;IT_TAB_ITEM11[].<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LT_TMP&nbsp;TO&nbsp;IT_TAB_ITEM11.<br />
&nbsp;&nbsp;DELETE&nbsp;ZFIRP0140_ITEM1&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_ITEM11.<br />
&nbsp;&nbsp;"更新自建表<br />
&nbsp;&nbsp;CLEAR&nbsp;IT_TAB_ITEM11[].<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_ITEM1&nbsp;TO&nbsp;IT_TAB_ITEM11.<br />
&nbsp;&nbsp;MODIFY&nbsp;ZFIRP0140_ITEM1&nbsp;FROM&nbsp;TABLE&nbsp;IT_TAB_ITEM11.<br />
<br />
&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'项目已删除'.<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*-------------------20160320&nbsp;MODIFY&nbsp;BY&nbsp;LINAN-------------------<br />
   </div>
   <div class="code">
FORM FM_GET_HTH.<br />
<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_HTH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;TYPE&nbsp;CHARG_D,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZHTH&nbsp;&nbsp;TYPE&nbsp;ZDE_ZXQPSBM4,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_HTH,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_CABN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATINN&nbsp;TYPE&nbsp;CABN-ATINN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATNAM&nbsp;TYPE&nbsp;CABN-ATNAM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_CABN,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_AUSP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATINN&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;AUSP-ATINN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATWRT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;AUSP-ATWRT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJEK&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;AUSP-OBJEK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUOBJ_BM&nbsp;TYPE&nbsp;MCH1-CUOBJ_BM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_AUSP,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_MCH1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCH1-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCH1-CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUOBJ_BM&nbsp;TYPE&nbsp;MCH1-CUOBJ_BM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJEK&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;AUSP-OBJEK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_MCH1.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_CHARG&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ZHTH&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_HTH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZHTH&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_HTH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CABN&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_CABN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CABN&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_CABN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_AUSP&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_AUSP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_AUSP&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_AUSP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MCH1&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MCH1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MCH1&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_MCH1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_TAB&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_ALV.<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;WA_TAB_ITEM1&gt;&nbsp;TYPE&nbsp;STRU_ITEM1.<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TAB_ITEM1[]&nbsp;TO&nbsp;LT_CHARG.<br />
&nbsp;&nbsp;SORT&nbsp;LT_CHARG&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_CHARG&nbsp;COMPARING&nbsp;MATNR&nbsp;CHARG.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;取批次特性字段对应的内部特性<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ATINN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATNAM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;CABN<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LS_CABN<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ATNAM&nbsp;EQ&nbsp;'ZXQPSBM4'.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;通过物料批次取出特性对象编码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUOBJ_BM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUOBJ_BM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MCH1<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_MCH1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_CHARG-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CHARG&nbsp;=&nbsp;LT_CHARG-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取所有符合条件的所有合同号<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_MCH1&nbsp;INTO&nbsp;LS_MCH1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_MCH1-OBJEK&nbsp;=&nbsp;LS_MCH1-CUOBJ_BM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;LT_MCH1&nbsp;FROM&nbsp;LS_MCH1&nbsp;TRANSPORTING&nbsp;OBJEK.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;ATINN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATWRT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJEK<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJEK<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;AUSP<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_AUSP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_MCH1<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;OBJEK&nbsp;=&nbsp;LT_MCH1-OBJEK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ATINN&nbsp;=&nbsp;LS_CABN-ATINN<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ATWRT&nbsp;IN&nbsp;S_ZHTH[]<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LT_AUSP&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_MCH1&nbsp;BY&nbsp;OBJEK.<br />
&nbsp;&nbsp;SORT&nbsp;LT_AUSP&nbsp;BY&nbsp;OBJEK.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_MCH1&nbsp;INTO&nbsp;LS_MCH1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_AUSP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_AUSP&nbsp;INTO&nbsp;LS_AUSP&nbsp;WITH&nbsp;KEY&nbsp;OBJEK&nbsp;=&nbsp;LS_MCH1-OBJEK&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_ZHTH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZHTH-MATNR&nbsp;=&nbsp;LS_MCH1-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZHTH-CHARG&nbsp;=&nbsp;LS_MCH1-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZHTH-ZHTH&nbsp;&nbsp;=&nbsp;LS_AUSP-ATWRT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZHTH&nbsp;TO&nbsp;LT_ZHTH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_ZHTH&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TAB_ITEM1&nbsp;ASSIGNING&nbsp;&lt;WA_TAB_ITEM1&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_ZHTH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZHTH&nbsp;INTO&nbsp;LS_ZHTH&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;WA_TAB_ITEM1&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;&lt;WA_TAB_ITEM1&gt;-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_TAB_ITEM1&gt;-ZHTH&nbsp;=&nbsp;LS_ZHTH-ZHTH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*-----------------------------END------------------------------<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
