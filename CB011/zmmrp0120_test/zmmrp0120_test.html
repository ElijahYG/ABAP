<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZMMRP0120_TEST</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMRP0120_TEST</h2>
<h3> Description: 提货检验单测试</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="code">
REPORT ZMMRP0120_TEST.<br />
<br />
TYPES:<br />
&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;TY_DETAIL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;EBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR10,&nbsp;&nbsp;"PO号<br />
&nbsp;&nbsp;&nbsp;&nbsp;EBELP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR6,&nbsp;&nbsp;&nbsp;"行号<br />
&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR10,&nbsp;&nbsp;"供应商<br />
&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;WERKS_D,&nbsp;"供货地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;NAME1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR30,&nbsp;&nbsp;"供应商描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKKO-BEDAT,&nbsp;&nbsp;&nbsp;"日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR18,&nbsp;&nbsp;"商品编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;MAKTX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR40,&nbsp;&nbsp;"商品描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;MENGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR18,&nbsp;&nbsp;"数量/克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;MENGE_I&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKPO-MENGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MENGE_SUM&nbsp;TYPE&nbsp;CHAR30,&nbsp;&nbsp;"数量合计<br />
&nbsp;&nbsp;&nbsp;&nbsp;MEINS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR10,&nbsp;&nbsp;"单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;NETPR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR18,&nbsp;&nbsp;"单价<br />
&nbsp;&nbsp;&nbsp;&nbsp;NETWR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR18,&nbsp;&nbsp;"采购价<br />
&nbsp;&nbsp;&nbsp;&nbsp;NETWR_I&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKPO-NETWR,&nbsp;"采购价（内部形式）<br />
&nbsp;&nbsp;&nbsp;&nbsp;NETWR_SUM&nbsp;TYPE&nbsp;CHAR18,&nbsp;&nbsp;"采购价合计<br />
&nbsp;&nbsp;&nbsp;&nbsp;DPAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR30,&nbsp;&nbsp;"页码<br />
&nbsp;&nbsp;&nbsp;&nbsp;ERNAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKKO-ERNAM,&nbsp;"制单人<br />
   </div>
   <div class="codeComment">
************以下是格式化数据需要用到的字段，请勿修改*********<br />
****S开头的表示你对该行数据的要求***********<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;STYPE	&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR2,&nbsp;"数据行类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;SLINE	&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数据所占行<br />
&nbsp;&nbsp;&nbsp;&nbsp;STITLE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,&nbsp;"是否先输出抬头<br />
&nbsp;&nbsp;&nbsp;&nbsp;ST_LINE	&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"抬头所占行<br />
&nbsp;&nbsp;&nbsp;&nbsp;SBLANK&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"抬头输出前是否输出空行<br />
&nbsp;&nbsp;&nbsp;&nbsp;SNEWPAGE&nbsp;&nbsp;TYPE&nbsp;CHAR1,&nbsp;"数据输出之前是否强制换页<br />
   </div>
   <div class="codeComment">
****R开头的表示计算后的标识符<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;RNEW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,&nbsp;"页眉<br />
&nbsp;&nbsp;&nbsp;&nbsp;REND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,&nbsp;"页脚<br />
&nbsp;&nbsp;&nbsp;&nbsp;RPAGE	&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前页号<br />
&nbsp;&nbsp;&nbsp;&nbsp;RPAGES&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总页号<br />
&nbsp;&nbsp;&nbsp;&nbsp;RFSPACE	&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数据输出之前的空白行<br />
&nbsp;&nbsp;&nbsp;&nbsp;RESPACE	&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数据输出之后的空白行<br />
&nbsp;&nbsp;&nbsp;&nbsp;RTITLE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,&nbsp;"是否输出抬头<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;TY_DETAIL,<br />
   </div>
   <div class="codeComment">
****页面信息<br />
   </div>
   <div class="code">
&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;TY_PAGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LINES&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"页面行数<br />
&nbsp;&nbsp;&nbsp;&nbsp;TITLE&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"页眉所占行<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOOTER&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"页脚所占行<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;TY_PAGE,<br />
&nbsp;&nbsp;TYT_DETAIL&nbsp;TYPE&nbsp;TY_DETAIL&nbsp;OCCURS&nbsp;0.<br />
<br />
DATA:<br />
&nbsp;&nbsp;T_EBELN&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMRP0200&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;W_EBELN&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMRP0200,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;GT_DETAIL&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;TY_DETAIL,<br />
&nbsp;&nbsp;GW_DETAIL&nbsp;TYPE&nbsp;&nbsp;TY_DETAIL,<br />
&nbsp;&nbsp;GT_SPACE&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRING_TABLE,<br />
&nbsp;&nbsp;GW_SPACE&nbsp;&nbsp;TYPE&nbsp;&nbsp;STRING,<br />
&nbsp;&nbsp;G_TABIX&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;I.<br />
<br />
   </div>
   <div class="codeComment">
************************************************************************************************<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Direct&nbsp;by&nbsp;Quan.Li<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&简单换页的smartform输出之前，对内表进行格式化<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_FORMAT USING FU_DETAIL  TYPE TYT_DETAIL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FU_PAGE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_PAGE.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;&nbsp;&nbsp;TYPE&nbsp;TY_DETAIL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_PRE&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_DETAIL,&nbsp;&nbsp;"上一行<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_NEXT&gt;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_DETAIL.&nbsp;&nbsp;"下一行<br />
<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_DETAIL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_NEW_TYPE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,&nbsp;"是否为新的数据类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DATA_LINE&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数据行所占行数<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FIELD_LINE&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"列名所占行数<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内表当前索引<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_INDEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"临时索引<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_COL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前列<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TAB_LINE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内表条数<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FIRST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LAST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PRE_LINE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前页码<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前条数<br />
   </div>
   <div class="codeComment">
*&nbsp;STEP1：清空标示符<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;FU_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_DETAIL&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RNEW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-REND,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RPAGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RPAGES,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RFSPACE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RESPACE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RTITLE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;STEP2:计算标示符<br />
   </div>
   <div class="code">
&nbsp;&nbsp;L_TAB_LINE&nbsp;=&nbsp;LINES(&nbsp;FU_DETAIL&nbsp;).<br />
&nbsp;&nbsp;L_PAGE&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;FU_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_DETAIL&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;SY-TABIX.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;STEP1：计算前一条数据和后一条数据<br />
*&nbsp;&nbsp;&nbsp;读取前一条数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TABIX&nbsp;&lt;&gt;&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_INDEX&nbsp;=&nbsp;L_TABIX&nbsp;-&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;FU_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_PRE&gt;&nbsp;INDEX&nbsp;L_INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;FU_PAGE-TITLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RNEW&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;读取后一条数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TABIX&nbsp;&lt;&gt;&nbsp;L_TAB_LINE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_INDEX&nbsp;=&nbsp;L_TABIX&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;FU_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_NEXT&gt;&nbsp;INDEX&nbsp;L_INDEX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;STEP2：如果需要强制换页，则补充上一行的空格<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_DETAIL&gt;-SNEWPAGE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TABIX&nbsp;&lt;&gt;&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_PRE&gt;-RESPACE&nbsp;=&nbsp;FU_PAGE-LINES&nbsp;-&nbsp;L_LINE&nbsp;-&nbsp;FU_PAGE-FOOTER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_PRE&gt;-REND&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_PRE&gt;-RPAGE&nbsp;&nbsp;&nbsp;=&nbsp;L_PAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RNEW&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_DETAIL&gt;-STITLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RTITLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_PAGE&nbsp;=&nbsp;L_PAGE&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;FU_PAGE-TITLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;STEP3：计算当前行需要占用的行数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_DATA_LINE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DATA_LINE&nbsp;=&nbsp;&lt;FS_DETAIL&gt;-SLINE.&nbsp;"加数据行<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;判定是否需要先输出抬头<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_NEW_TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_DETAIL&gt;-STITLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TABIX&nbsp;&lt;&gt;&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_PRE&gt;-STYPE&nbsp;&lt;&gt;&nbsp;&lt;FS_DETAIL&gt;-STYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_NEW_TYPE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_NEW_TYPE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新的行类型<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_NEW_TYPE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DATA_LINE&nbsp;=&nbsp;L_DATA_LINE&nbsp;+&nbsp;&lt;FS_DETAIL&gt;-ST_LINE&nbsp;+&nbsp;&lt;FS_DETAIL&gt;-SBLANK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;STEP4:判定是否换页<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;L_PRE_LINE&nbsp;&nbsp;=&nbsp;L_LINE&nbsp;+&nbsp;L_DATA_LINE&nbsp;+&nbsp;FU_PAGE-FOOTER.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;大于，需要强制换页<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_PRE_LINE&nbsp;&gt;&nbsp;FU_PAGE-LINES.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编辑上一行的数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_PRE&gt;-REND&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_PRE&gt;-RESPACE&nbsp;=&nbsp;&lt;FS_PRE&gt;-RESPACE&nbsp;+&nbsp;FU_PAGE-LINES&nbsp;-&nbsp;L_LINE&nbsp;-&nbsp;FU_PAGE-FOOTER.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编辑当前行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_PAGE&nbsp;=&nbsp;L_PAGE&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RNEW&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RPAGE&nbsp;=&nbsp;L_PAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_NEW_TYPE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RTITLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DATA_LINE&nbsp;=&nbsp;L_DATA_LINE&nbsp;-&nbsp;&lt;FS_DETAIL&gt;-SBLANK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_DETAIL&gt;-STITLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RTITLE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_DATA_LINE&nbsp;=&nbsp;L_DATA_LINE&nbsp;+&nbsp;&lt;FS_DETAIL&gt;-ST_LINE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;FU_PAGE-TITLE&nbsp;+&nbsp;L_DATA_LINE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;小于，则继续输出<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;L_LINE&nbsp;+&nbsp;L_DATA_LINE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RPAGE&nbsp;=&nbsp;L_PAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_NEW_TYPE&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数据输出之前的空白行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RFSPACE&nbsp;=&nbsp;&lt;FS_DETAIL&gt;-SBLANK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RTITLE&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;最后一页，则输出空白行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TABIX&nbsp;=&nbsp;L_TAB_LINE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RESPACE&nbsp;=&nbsp;&lt;FS_DETAIL&gt;-RESPACE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;FU_PAGE-LINES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;L_LINE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;FU_PAGE-FOOTER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-REND&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;填充pages字段<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;FU_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_DETAIL&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-RPAGES&nbsp;=&nbsp;L_PAGE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
<br />
FORM FM_CLEAR_ZERO USING FU_P FU_STR.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_P4(10)&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;4,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_P3(10)&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_P2(10)&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_P1(10)&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_P0(10)&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_STR&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR100&nbsp;.<br />
&nbsp;&nbsp;L_P4&nbsp;&nbsp;=&nbsp;FU_P.<br />
&nbsp;&nbsp;L_P3&nbsp;&nbsp;=&nbsp;FU_P.<br />
&nbsp;&nbsp;L_P2&nbsp;&nbsp;=&nbsp;FU_P.<br />
&nbsp;&nbsp;L_P1&nbsp;&nbsp;=&nbsp;FU_P.<br />
&nbsp;&nbsp;L_P0&nbsp;&nbsp;=&nbsp;FU_P.<br />
&nbsp;&nbsp;IF&nbsp;L_P4&nbsp;&lt;&gt;&nbsp;L_P3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;L_P4&nbsp;TO&nbsp;L_STR.<br />
&nbsp;&nbsp;ELSEIF&nbsp;L_P3&nbsp;&lt;&gt;&nbsp;L_P2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;L_P3&nbsp;TO&nbsp;L_STR.<br />
&nbsp;&nbsp;ELSEIF&nbsp;L_P2&nbsp;&lt;&gt;&nbsp;L_P1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;L_P2&nbsp;TO&nbsp;L_STR.<br />
&nbsp;&nbsp;ELSEIF&nbsp;L_P1&nbsp;&lt;&gt;&nbsp;L_P0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;L_P1&nbsp;TO&nbsp;L_STR.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;L_P0&nbsp;TO&nbsp;L_STR.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;CONDENSE&nbsp;L_STR&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;FU_STR&nbsp;=&nbsp;L_STR.<br />
ENDFORM.<br />
<br />
<br />
FORM FM_GET_USRNAME USING FU_UNAME CHANGING CU_NAME.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_NAME&nbsp;&nbsp;TYPE&nbsp;CHAR80,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PERNO&nbsp;TYPE&nbsp;AD_PERSNUM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_ADRP&nbsp;TYPE&nbsp;ADRP.<br />
   </div>
   <div class="codeComment">
*&nbsp;取人员编码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;PERSNUMBER<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_PERNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;USR21<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;BNAME&nbsp;=&nbsp;FU_UNAME.<br />
   </div>
   <div class="codeComment">
*&nbsp;取人名称<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LW_ADRP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ADRP<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;PERSNUMBER&nbsp;=&nbsp;L_PERNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;DATE_FROM&nbsp;&lt;=&nbsp;SY-DATUM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;DATE_TO&nbsp;&nbsp;&nbsp;&gt;=&nbsp;SY-DATUM<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;LW_ADRP-NAME_LAST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_ADRP-NAME_FIRST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_NAME.<br />
&nbsp;&nbsp;CU_NAME&nbsp;=&nbsp;L_NAME.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
************************************************************************************************<br />
<br />
   </div>
   <div class="code">
FIELD-SYMBOLS &lt;FS_DETAIL&gt; TYPE TY_DETAIL.<br />
<br />
DATA:<br />
&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_PO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;EBELN&nbsp;TYPE&nbsp;EKKO-EBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;EBELP&nbsp;TYPE&nbsp;EKPO-EBELP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;TYPE&nbsp;EKKO-LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;RESWK&nbsp;TYPE&nbsp;EKKO-RESWK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;EKPO-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BSART&nbsp;TYPE&nbsp;EKKO-BSART,<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEDAT&nbsp;TYPE&nbsp;EKKO-BEDAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MENGE&nbsp;TYPE&nbsp;EKPO-MENGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MEINS&nbsp;TYPE&nbsp;EKPO-MEINS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;NETPR&nbsp;TYPE&nbsp;EKPO-NETPR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;NETWR&nbsp;TYPE&nbsp;EKPO-NETWR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;ERNAM&nbsp;TYPE&nbsp;EKKO-ERNAM,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_PO,<br />
&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_LFA1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;TYPE&nbsp;LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;NAME1&nbsp;TYPE&nbsp;NAME1,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_LFA1,<br />
&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_MAKT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;MAKTX&nbsp;TYPE&nbsp;MAKTX,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_MAKT,<br />
&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;LW_T001W,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;TYPE&nbsp;WERKS_D,<br />
&nbsp;&nbsp;&nbsp;&nbsp;NAME1&nbsp;TYPE&nbsp;T001W-NAME1,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;LW_T001W,<br />
&nbsp;&nbsp;LT_T001W&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_T001W&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;LT_LFA1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_LFA1&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;LT_MAKT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_MAKT&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;LT_PO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LW_PO&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;LT_PO_TMP&nbsp;&nbsp;&nbsp;LIKE&nbsp;LT_PO,<br />
&nbsp;&nbsp;L_TABIX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-TABIX,<br />
&nbsp;&nbsp;L_SUM1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKPO-NETWR,<br />
&nbsp;&nbsp;L_SUM2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKPO-MENGE,<br />
&nbsp;&nbsp;L_MENGE_SUM&nbsp;TYPE&nbsp;CHAR18,<br />
&nbsp;&nbsp;L_NETWR_SUM&nbsp;TYPE&nbsp;CHAR18,<br />
&nbsp;&nbsp;LW_DETAIL&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_DETAIL,<br />
&nbsp;&nbsp;LT_DETAIL&nbsp;&nbsp;&nbsp;TYPE&nbsp;TYT_DETAIL,<br />
&nbsp;&nbsp;LT_DETAIL2&nbsp;&nbsp;TYPE&nbsp;TYT_DETAIL,<br />
&nbsp;&nbsp;LW_PAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TY_PAGE.<br />
<br />
   </div>
   <div class="codeComment">
**************************************************************<br />
*STEP1:给内表赋值<br />
**************************************************************<br />
   </div>
   <div class="code">
FORM FM_GETDATA.<br />
   </div>
   <div class="codeComment">
*&nbsp;STEP1.1:取数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;T_EBELN[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;取PO<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;A~EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~RESWK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BSART<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BEDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~NETPR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~NETWR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~ERNAM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_PO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;EKKO&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;EKPO&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~EBELN&nbsp;=&nbsp;B~EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;T_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~EBELN&nbsp;=&nbsp;T_EBELN-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;取供应商描述及商品描述<br />
*&nbsp;&nbsp;&nbsp;取供应商<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LT_PO_TMP&nbsp;=&nbsp;LT_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_PO_TMP&nbsp;WHERE&nbsp;LIFNR&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_PO_TMP&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_PO_TMP&nbsp;COMPARING&nbsp;LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_PO_TMP&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_PO_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;LT_PO_TMP-LIFNR<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;取供货工厂描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LT_PO_TMP&nbsp;=&nbsp;LT_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_PO_TMP&nbsp;WHERE&nbsp;RESWK&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_PO_TMP&nbsp;BY&nbsp;RESWK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_PO_TMP&nbsp;COMPARING&nbsp;RESWK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_PO_TMP&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAME1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;T001W<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_T001W<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_PO_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;=&nbsp;LT_PO_TMP-RESWK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;取商品描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LT_PO_TMP&nbsp;=&nbsp;LT_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_PO_TMP&nbsp;WHERE&nbsp;MATNR&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_PO_TMP&nbsp;BY&nbsp;MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_PO_TMP&nbsp;COMPARING&nbsp;MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_PO_TMP&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAKTX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MAKT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_MAKT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_PO_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_PO_TMP-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SPRAS&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;STEP1.2:整理数据到输出内表GT_DETAIL<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;LT_LFA1&nbsp;&nbsp;BY&nbsp;LIFNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_MAKT&nbsp;&nbsp;BY&nbsp;MATNR.<br />
&nbsp;&nbsp;SORT&nbsp;LT_T001W&nbsp;BY&nbsp;WERKS.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_PO&nbsp;INTO&nbsp;LW_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-EBELN&nbsp;=&nbsp;LW_PO-EBELN.&nbsp;&nbsp;&nbsp;"PO号<br />
&nbsp;&nbsp;&nbsp;&nbsp;"行号<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_OUTPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;LW_PO-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;LW_DETAIL-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"供应商<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_OUTPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;LW_PO-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;LW_DETAIL-LIFNR.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-WERKS&nbsp;=&nbsp;LW_PO-RESWK.&nbsp;&nbsp;&nbsp;"供货地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LW_PO-LIFNR&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_LFA1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_LFA1&nbsp;INTO&nbsp;LW_LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;LW_PO-LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-NAME1&nbsp;=&nbsp;LW_LFA1-NAME1."供应商描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_T001W.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_T001W&nbsp;INTO&nbsp;LW_T001W<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;WERKS&nbsp;=&nbsp;LW_PO-RESWK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-NAME1&nbsp;=&nbsp;LW_T001W-NAME1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-LIFNR&nbsp;=&nbsp;LW_PO-RESWK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-BEDAT&nbsp;=&nbsp;LW_PO-BEDAT.&nbsp;&nbsp;&nbsp;"日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-MATNR&nbsp;=&nbsp;LW_PO-MATNR.&nbsp;&nbsp;&nbsp;"商品编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LW_MAKT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MAKT&nbsp;INTO&nbsp;LW_MAKT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LW_PO-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-MAKTX&nbsp;=&nbsp;LW_MAKT-MAKTX.&nbsp;&nbsp;&nbsp;"商品描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CLEAR_ZERO&nbsp;USING&nbsp;LW_PO-MENGE&nbsp;LW_DETAIL-MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;"数量/克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_CUNIT_OUTPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_PO-MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_DETAIL-MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIT_NOT_FOUND&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CLEAR_ZERO&nbsp;USING&nbsp;LW_PO-NETPR&nbsp;LW_DETAIL-NETPR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单价<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CLEAR_ZERO&nbsp;USING&nbsp;LW_PO-NETWR&nbsp;LW_DETAIL-NETWR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单价<br />
&nbsp;&nbsp;&nbsp;&nbsp;"采购价<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-NETWR_I&nbsp;=&nbsp;LW_PO-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"数量/克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DETAIL-MENGE_I&nbsp;=&nbsp;LW_PO-MENGE.&nbsp;"内部形式<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;制单人<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_GET_USRNAME&nbsp;USING&nbsp;LW_PO-ERNAM&nbsp;CHANGING&nbsp;LW_DETAIL-ERNAM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LW_DETAIL&nbsp;TO&nbsp;GT_DETAIL.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
**************************************************************<br />
*STEP2:设定格式化参数<br />
**************************************************************<br />
*&nbsp;页面基本信息<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LW_PAGE-LINES&nbsp;&nbsp;=&nbsp;38.&nbsp;&nbsp;"页面总共有多少行<br />
&nbsp;&nbsp;LW_PAGE-TITLE&nbsp;&nbsp;=&nbsp;4.&nbsp;&nbsp;&nbsp;"页眉占几行<br />
&nbsp;&nbsp;LW_PAGE-FOOTER&nbsp;=&nbsp;3.&nbsp;&nbsp;&nbsp;"页脚占几行：合计行+制单行+页码行<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;测试二：页眉、固定首页、行项目、固定尾页、页脚<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_DETAIL&gt;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-STYPE&nbsp;=&nbsp;'D1'.&nbsp;"数据行类型<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-SLINE&nbsp;=&nbsp;1.&nbsp;&nbsp;&nbsp;&nbsp;"数据所占行<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-STITLE&nbsp;=&nbsp;'X'.&nbsp;"是否先输出抬头<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-ST_LINE&nbsp;=&nbsp;1.&nbsp;&nbsp;"抬头所占行<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
**************************************************************<br />
*STEP3:格式化参数<br />
**************************************************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;T_EBELN.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;按采购订单号格式化<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LT_DETAIL&nbsp;=&nbsp;GT_DETAIL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_DETAIL&nbsp;WHERE&nbsp;EBELN&nbsp;&lt;&gt;&nbsp;T_EBELN-EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_FORMAT&nbsp;USING&nbsp;LT_DETAIL&nbsp;LW_PAGE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;计算合计行<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SUM2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SUM1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_DETAIL&nbsp;INTO&nbsp;LW_DETAIL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SUM1&nbsp;=&nbsp;L_SUM1&nbsp;+&nbsp;LW_DETAIL-NETWR_I.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SUM2&nbsp;=&nbsp;L_SUM2&nbsp;+&nbsp;LW_DETAIL-MENGE_I.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CLEAR_ZERO&nbsp;USING&nbsp;L_SUM1&nbsp;L_NETWR_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CLEAR_ZERO&nbsp;USING&nbsp;L_SUM2&nbsp;L_MENGE_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_DETAIL&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-NETWR_SUM&nbsp;=&nbsp;L_NETWR_SUM.&nbsp;"价格合计<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_DETAIL&gt;-MENGE_SUM&nbsp;=&nbsp;L_MENGE_SUM.&nbsp;"数量合计<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;追加到输出<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LINES&nbsp;OF&nbsp;LT_DETAIL&nbsp;TO&nbsp;LT_DETAIL2.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;更新内表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;GT_DETAIL&nbsp;=&nbsp;LT_DETAIL2.<br />
   </div>
   <div class="codeComment">
*&nbsp;编辑页码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_C1&nbsp;TYPE&nbsp;CHAR10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_C2&nbsp;TYPE&nbsp;CHAR10.<br />
   </div>
   <div class="codeComment">
*&nbsp;画面数据显示格式化<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_DETAIL&nbsp;ASSIGNING&nbsp;&lt;FS_DETAIL&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;&lt;FS_DETAIL&gt;-RPAGE&nbsp;TO&nbsp;L_C1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;&lt;FS_DETAIL&gt;-RPAGES&nbsp;TO&nbsp;L_C2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;L_C1&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;L_C2&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'页码：第'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_C1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'页/共'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_C2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'页'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;&lt;FS_DETAIL&gt;-DPAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;&lt;FS_DETAIL&gt;-DPAGE&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
