<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZSDRP0020</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZSDRP0020</h2>
<h3> Description: 供应商和公司间交易结算表（联营结算报表）</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;REPORT&nbsp;&nbsp;ZSDRP0040<br />
*&&nbsp;Application&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;SD-RP-0040<br />
*&&nbsp;Subject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;供应商和公司间交易结算表(联营结算报表)<br />
*&&nbsp;Author&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;LINAN<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUTHOR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIPTION<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----------&nbsp;&nbsp;&nbsp;&nbsp;-----------------<br />
*&&nbsp;2015/07/22&nbsp;&nbsp;&nbsp;&nbsp;LINAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initial<br />
*&---------------------------------------------------------------------*<br />
<br />
   </div>
   <div class="code">
REPORT ZSDRP0020.<br />
<br />
include <a href ="zsdrp0020_old.html">ZSDRP0020_OLD</a>.<br />
<br />
TABLES:VBRK,VBRP,MESG,T001W,T001K,LFA1,MARA,KONV,EKBE,EKPO,ZSDRP0020_KLTZ,ZMM_CHARACTERS.<br />
<br />
TYPE-POOLS: SLIS.               "ALV显示使用到的共享池<br />
<br />
DATA: IT_FIELDCAT    TYPE    SLIS_T_FIELDCAT_ALV.<br />
DATA: WA_FIELDCAT    TYPE    SLIS_FIELDCAT_ALV.<br />
DATA: WA_LAYOUT      TYPE    SLIS_LAYOUT_ALV.<br />
   </div>
   <div class="codeComment">
*自定义按钮相关<br />
*DATA:&nbsp;GD_REPID&nbsp;LIKE&nbsp;SY-REPID,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REF_GRID&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.<br />
*&---------------------------------------------------------------------*<br />
*&全局定义<br />
*&---------------------------------------------------------------------*<br />
**定义ALV显示结构<br />
*TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_ALV,<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-BUKRS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售公司代码<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-KUNAG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"门店编码<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERV_TYPE&nbsp;TYPE&nbsp;CHAR10,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"业务类型<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-VBELN,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"收入凭证<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XBLNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-XBLNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"POS单号<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-AUFNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内部订单号<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POSNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-POSNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"行项目号<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGYSDM&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFA1-LIFNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-WERKS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购地点<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MBLNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-MBLNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"入库单号<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_BUKRS&nbsp;&nbsp;TYPE&nbsp;EKPO-BUKRS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购公司代码<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-EXTWG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAUBE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-RAUBE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品小类<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品编码<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-CHARG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品批次<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARKTX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-ARKTX,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品名称<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FKIMG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-FKIMG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VRKME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-VRKME,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单位<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FKDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-FKDAT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售日期<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"实销价格<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VKP0&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YHJG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"优惠价格<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZLYJSFS&nbsp;&nbsp;&nbsp;TYPE&nbsp;CHAR3,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算方式<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSJJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZLYJSYKJ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克金价<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSKGF&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZJSKGF,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克工费<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSDKZ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZJSDKZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克倒扣工费<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZLYJSYKJ&nbsp;&nbsp;TYPE&nbsp;ZLYJSYKJ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算一口价<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSKL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZJSKL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算扣率<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZB00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"投资克基础价<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售克工费档加价<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZD01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"以旧换新抵值<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSJE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商结算金额<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_ALV.<br />
<br />
   </div>
   <div class="code">
TYPES: BEGIN OF ZSDRP0020_ALV1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;structure&nbsp;<a&nbsp;href&nbsp;="zsdrp0020_alv/dictionary-zsdrp0020_alv.html">ZSDRP0020_ALV</a>.<br />
TYPES:  NAME1 TYPE LFA1-NAME1.<br />
TYPES:  NAME2 TYPE LFA1-NAME1.<br />
TYPES: END OF ZSDRP0020_ALV1.<br />
<br />
   </div>
   <div class="codeComment">
*定义批次特性取数结构<br />
   </div>
   <div class="code">
TYPES: BEGIN OF STRU_MA_CH,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-CHARG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-BUKRS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-KUNAG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"门店编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-WERKS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-VBELN,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"收入凭证<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_POSNUM&nbsp;TYPE&nbsp;VBRK-EX_POSNUM,&nbsp;"POS单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARKTX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-ARKTX,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品名称<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FKIMG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-FKIMG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VRKME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-VRKME,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单位<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHKZG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-SHKZG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"退货标识<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FKDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-FKDAT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"实销价格<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI2,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品成本(POS发票)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI3,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商场回款<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI4,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"优惠合计<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI5,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI6,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签价/零售价<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POSNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-POSNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"行项目号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-AUFNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内部订单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERV_TYPE&nbsp;TYPE&nbsp;CHAR10,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"业务类型<br />
   </div>
   <div class="codeComment">
*取销售条件类型<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KNUMV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-KNUMV,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单据条件数<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZB00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"投资克基础价<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售克工费档加价<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZD01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"以旧换新抵值<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VKP0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_MA_CH.<br />
   </div>
   <div class="codeComment">
*定义批次特性计算结构<br />
   </div>
   <div class="code">
TYPES: BEGIN OF STRU_CHARACTER,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-CHARG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGYSDM&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFA1-LIFNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-WERKS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MBLNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-MBLNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"入库单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZLYJSFS&nbsp;&nbsp;TYPE&nbsp;CHAR3,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算方式<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSJJ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZLYJSYKJ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克金价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSKGF&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZJSKGF,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克工费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSDKZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZJSDKZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克倒扣工费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZLYJSYKJ&nbsp;TYPE&nbsp;ZLYJSYKJ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算一口价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSKL&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZJSKL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算扣率<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZB00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"投资克基础价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售克工费档加价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZD01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"以旧换新抵值<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZJZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"金重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTWG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-EXTWG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAUBE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-RAUBE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品小类<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KUNAG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-KUNAG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"门店编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMBLNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKBE-BELNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品凭证编号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MJAHR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKBE-GJAHR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品凭证年度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EBELN&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;EKBE-EBELN,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购订单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_BUKRS&nbsp;TYPE&nbsp;EKPO-BUKRS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSJE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商结算金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZBQMC&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_CHARACTERS-ZBQMC,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATKL&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-MATKL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品组<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZXSKZ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-FKIMG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZXSJS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-FKIMG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FKIMG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-FKIMG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VRKME&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-VRKME,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单位<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VKP0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZCKLSJ&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KZWI6&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRP-KZWI1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_CHARACTER.<br />
   </div>
   <div class="codeComment">
*定义ALV显示表<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;IT_ALV_TAB&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZSDRP0020_ALV,<br />
&nbsp;&nbsp;WA_ALV_TAB&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSDRP0020_ALV1,<br />
&nbsp;&nbsp;GT_ALV_TAB&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZSDRP0020_ALV1.<br />
   </div>
   <div class="codeComment">
*定义存BRK,VBRP等相关取数表<br />
   </div>
   <div class="code">
DATA:<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;LT_VBELN&nbsp;&nbsp;&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBELN,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IT_MACHTAB&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MA_CH,<br />
&nbsp;&nbsp;WA_MACHTAB&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_MA_CH.<br />
DATA:<br />
&nbsp;&nbsp;IT_TAB_CAL1&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZSDRP0020_CAL,<br />
&nbsp;&nbsp;IT_MACHTAB1&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MA_CH.<br />
   </div>
   <div class="codeComment">
*定义存批次特性表<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;IT_CHARG1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;IT_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;WA_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;IT_CHARACTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_CHARACTER,<br />
&nbsp;&nbsp;WA_CHARACTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_CHARACTER,<br />
&nbsp;&nbsp;WA_TMP_CHARACTER&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_CHARACTER.<br />
   </div>
   <div class="codeComment">
*定义取值用表<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;IT_TAB_CAL&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZSDRP0020_CAL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"联营商品结算输入输出表<br />
&nbsp;&nbsp;WA_TAB_CAL&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSDRP0020_CAL.<br />
   </div>
   <div class="codeComment">
*定义字段符号相关<br />
*DATA:&nbsp;FIELD&nbsp;TYPE&nbsp;CHAR50.<br />
*FIELD-SYMBOLS:&nbsp;&lt;WA&gt;.<br />
*定义ALV显示宏<br />
   </div>
   <div class="code">
DEFINE ADD_ALV.<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;&4.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;&3.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;&1.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;&2.<br />
&nbsp;&nbsp;WA_FIELDCAT-NO_ZERO&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
END-OF-DEFINITION.<br />
   </div>
   <div class="codeComment">
*全局检查变量<br />
   </div>
   <div class="code">
DATA GL_CHECK TYPE CHAR1.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&选择屏幕<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
SELECTION-SCREEN BEGIN OF BLOCK BLK01 WITH FRAME TITLE TEXT-001.<br />
<br />
SELECT-OPTIONS:S_BUKRS  FOR VBRK-BUKRS OBLIGATORY DEFAULT '8000'.    "公司代码<br />
SELECT-OPTIONS:S_FKDAT  FOR VBRK-FKDAT OBLIGATORY.                   "日期<br />
SELECT-OPTIONS:S_KUNAG  FOR VBRK-KUNAG.                              "门店编码<br />
SELECT-OPTIONS:S_VBELN  FOR VBRK-VBELN.                              "凭证号(收入凭证)<br />
SELECT-OPTIONS:S_LIFNR  FOR LFA1-LIFNR.                              "供应商<br />
SELECT-OPTIONS:S_LYJSFS  FOR ZMM_CHARACTERS-ZLYJSFS.                 "联营结算方式<br />
SELECT-OPTIONS:S_MATNR  FOR VBRP-MATNR.                              "物料号<br />
SELECT-OPTIONS:S_EXTWG  FOR MARA-EXTWG.                              "商品大类<br />
SELECT-OPTIONS:S_RAUBE  FOR MARA-RAUBE.                              "商品小类<br />
<br />
SELECTION-SCREEN END OF BLOCK BLK01.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&初始化<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
INITIALIZATION.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_INIT.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&程序开始&nbsp;F8<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
START-OF-SELECTION.<br />
   </div>
   <div class="codeComment">
*取数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_DATA.<br />
<br />
   </div>
   <div class="codeComment">
*通过配置表筛选商品<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_ZSDRP0020_DD.<br />
<br />
   </div>
   <div class="codeComment">
*计算<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_CAL_DATA.<br />
   </div>
   <div class="codeComment">
**取批次特性<br />
*&nbsp;&nbsp;PERFORM&nbsp;FM_CHARG.<br />
***批次有问题时处理<br />
**&nbsp;&nbsp;PERFORM&nbsp;FM_ERROR.<br />
**计算<br />
*&nbsp;&nbsp;PERFORM&nbsp;FM_CAL_DATA.<br />
*整理ALV<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_ARRANGE_ALV.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_BM.<br />
   </div>
   <div class="codeComment">
***20151209&nbsp;CHANGE&nbsp;BY&nbsp;LINAN&nbsp;判断电商优惠价格是否为0****<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_CHECK_YH.<br />
   </div>
   <div class="codeComment">
*以旧换新销售类型判断<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_SERV_TYPE.<br />
   </div>
   <div class="codeComment">
*ALV显示<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_ALVSHOW.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;IT_ALV_TAB.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GT_ALV_TAB&nbsp;TO&nbsp;IT_ALV_TAB.<br />
&nbsp;&nbsp;EXPORT&nbsp;IT_ALV_TAB&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'ZSDRP0020_ALV'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"写道0020里<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&设置导出参数<br />
*&---------------------------------------------------------------------*<br />
*SET&nbsp;PARAMETER&nbsp;ID&nbsp;'SD1'&nbsp;FIELD&nbsp;WA_ALV_TAB-VBELN.<br />
*&---------------------------------------------------------------------*<br />
*&初始化：清空全局变量<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_INIT.<br />
&nbsp;&nbsp;CLEAR:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_CHARACTER,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_MACHTAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_ALV_TAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GT_ALV_TAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&取数<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_DATA.<br />
   </div>
   <div class="codeComment">
*取MSEG相关数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_MSEG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-CHARG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-AUFNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内部订单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWART&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-BWART,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"移动类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-WERKS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-BUKRS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERV_TYPE&nbsp;&nbsp;TYPE&nbsp;CHAR10,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"业务类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWKEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;T001W-BWKEY,&nbsp;&nbsp;&nbsp;&nbsp;"评估范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MENGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-MENGE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MEINS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-MEINS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHKZG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MSEG-SHKZG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"借贷标识,是否是退货的标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUDAT_MKPF&nbsp;TYPE&nbsp;MKPF-BUDAT,&nbsp;&nbsp;&nbsp;&nbsp;"过账日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_MSEG.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_MSEGTAB&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MSEG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MSEGTAB&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_MSEG.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_BWART&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;BWART,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_BWART&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;&nbsp;IT_BWART.<br />
   </div>
   <div class="codeComment">
*给移动类型赋值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DEFINE&nbsp;DF_ADD_BWART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_BWART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_BWART-SIGN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_BWART-OPTION&nbsp;&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_BWART-LOW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_BWART&nbsp;TO&nbsp;IT_BWART.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
<br />
&nbsp;&nbsp;DF_ADD_BWART:<br />
&nbsp;&nbsp;'Z61','Z62'.<br />
   </div>
   <div class="codeComment">
*取MSEG相关数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_MSEGTAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BUDAT_MKPF&nbsp;IN&nbsp;S_FKDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;MATNR&nbsp;IN&nbsp;S_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BWART&nbsp;IN&nbsp;IT_BWART.<br />
   </div>
   <div class="codeComment">
*取销售公司代码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MSEGTAB&nbsp;INTO&nbsp;WA_MSEGTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BWKEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;T001W<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;WA_MSEGTAB-BWKEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;EQ&nbsp;WA_MSEGTAB-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MSEGTAB&nbsp;FROM&nbsp;WA_MSEGTAB&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;BWKEY.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MSEGTAB&nbsp;INTO&nbsp;WA_MSEGTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;T001K<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;WA_MSEGTAB-BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BWKEY&nbsp;EQ&nbsp;WA_MSEGTAB-BWKEY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MSEGTAB&nbsp;FROM&nbsp;WA_MSEGTAB&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;BUKRS.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*计算业务类型<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MSEGTAB&nbsp;INTO&nbsp;WA_MSEGTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MSEGTAB-BWART&nbsp;EQ&nbsp;'Z61'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_MSEGTAB-SERV_TYPE&nbsp;=&nbsp;'组合商品'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_MSEGTAB-BWART&nbsp;EQ&nbsp;'Z62'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_MSEGTAB-SERV_TYPE&nbsp;=&nbsp;'拆分商品'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MSEGTAB&nbsp;FROM&nbsp;WA_MSEGTAB&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;SERV_TYPE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*从VBRK取凭证号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;VBRP&nbsp;AS&nbsp;A&nbsp;INNER&nbsp;JOIN&nbsp;VBRK&nbsp;AS&nbsp;B&nbsp;ON&nbsp;A~VBELN&nbsp;EQ&nbsp;B~VBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_MACHTAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;B~BUKRS&nbsp;IN&nbsp;S_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~FKDAT&nbsp;IN&nbsp;S_FKDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~KUNAG&nbsp;IN&nbsp;S_KUNAG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MATNR&nbsp;IN&nbsp;S_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~VBELN&nbsp;IN&nbsp;S_VBELN.<br />
   </div>
   <div class="codeComment">
**取销售条件类型<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KBETR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KONV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;WA_MACHTAB-ZB00<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KNUMV&nbsp;EQ&nbsp;WA_MACHTAB-KNUMV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KSCHL&nbsp;EQ&nbsp;'ZB00'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MACHTAB&nbsp;FROM&nbsp;WA_MACHTAB&nbsp;TRANSPORTING&nbsp;ZB00.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KBETR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KONV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;WA_MACHTAB-ZKSG<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KNUMV&nbsp;EQ&nbsp;WA_MACHTAB-KNUMV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KSCHL&nbsp;EQ&nbsp;'ZKSG'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MACHTAB&nbsp;FROM&nbsp;WA_MACHTAB&nbsp;TRANSPORTING&nbsp;ZKSG.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KBETR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KONV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;WA_MACHTAB-ZD01<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KNUMV&nbsp;EQ&nbsp;WA_MACHTAB-KNUMV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KSCHL&nbsp;EQ&nbsp;'ZD01'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MACHTAB&nbsp;FROM&nbsp;WA_MACHTAB&nbsp;TRANSPORTING&nbsp;ZKSG.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KBETR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KONV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;WA_MACHTAB-VKP0<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KNUMV&nbsp;EQ&nbsp;WA_MACHTAB-KNUMV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KSCHL&nbsp;EQ&nbsp;'VKP0'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MACHTAB&nbsp;FROM&nbsp;WA_MACHTAB&nbsp;TRANSPORTING&nbsp;VKP0.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*更改&nbsp;MSEG-SHKZG&nbsp;的值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MSEGTAB&nbsp;INTO&nbsp;WA_MSEGTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_MSEGTAB-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_MSEGTAB-SHKZG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MSEGTAB&nbsp;FROM&nbsp;WA_MSEGTAB&nbsp;TRANSPORTING&nbsp;SHKZG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*整合批次表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MSEGTAB&nbsp;INTO&nbsp;WA_MSEGTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_MACHTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-AUFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-AUFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-SERV_TYPE&nbsp;=&nbsp;WA_MSEGTAB-SERV_TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-FKIMG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-VRKME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-SHKZG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-SHKZG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-FKDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-BUDAT_MKPF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MSEGTAB-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_MACHTAB&nbsp;TO&nbsp;IT_MACHTAB.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*删除批次为空的行项目<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DELETE&nbsp;IT_MACHTAB[]&nbsp;WHERE&nbsp;CHARG&nbsp;IS&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
**取商品名称<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MAKTX&nbsp;FROM&nbsp;MAKT&nbsp;INTO&nbsp;WA_MACHTAB-ARKTX&nbsp;WHERE&nbsp;MATNR&nbsp;EQ&nbsp;WA_MACHTAB-MATNR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MACHTAB&nbsp;FROM&nbsp;WA_MACHTAB&nbsp;TRANSPORTING&nbsp;ARKTX.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&计算<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_CAL_DATA.<br />
   </div>
   <div class="codeComment">
*定义存批次特性内表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_CHARACTERS&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_CHARACTERS&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_MACHTAB_TM&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MA_CH,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_LYJSFS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHAR3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_LYJSFS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_LYJSFS.<br />
<br />
   </div>
   <div class="codeComment">
*给联营结算方式赋值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DEFINE&nbsp;DF_ADD_LYJSFS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_LYJSFS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_LYJSFS-SIGN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_LYJSFS-OPTION&nbsp;&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_LYJSFS-LOW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_LYJSFS&nbsp;TO&nbsp;IT_LYJSFS.<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
&nbsp;&nbsp;IF&nbsp;S_LYJSFS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DF_ADD_LYJSFS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Z04','Z05','Z06','Z07','Z10','Z11','Z12'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_LYJSFS&nbsp;&nbsp;=&nbsp;&nbsp;S_LYJSFS[].<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*********************************************************************************<br />
*筛选联营结算商品<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_MACHTAB&nbsp;TO&nbsp;IT_CHARG.<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zsdrp0020_fm_01/zsdrp0020_fm_01.html">'ZSDRP0020_FM_01'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARACTERS&nbsp;=&nbsp;IT_CHARACTERS.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;IT_CHARACTERS&nbsp;WHERE&nbsp;ZLYJSFS&nbsp;NOT&nbsp;IN&nbsp;IT_LYJSFS.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_MACHTAB&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_CHARACTERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_CHARACTERS&nbsp;INTO&nbsp;WA_CHARACTERS&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;WA_MACHTAB-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;WA_MACHTAB-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_MACHTAB&nbsp;TO&nbsp;IT_MACHTAB_TM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;IT_MACHTAB.<br />
&nbsp;&nbsp;IT_MACHTAB&nbsp;=&nbsp;IT_MACHTAB_TM.<br />
   </div>
   <div class="codeComment">
***********************************************************************************<br />
<br />
*整理传入表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_CAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-WERKS&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-FKDAT&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-FKDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-MATNR&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-CHARG&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-FKIMG&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-FKIMG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-SHKZG&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-SHKZG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-ZTZKJCJ_IN&nbsp;=&nbsp;WA_MACHTAB-KZWI5.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TAB_CAL-ZCKLSJ_IN&nbsp;&nbsp;=&nbsp;WA_MACHTAB-KZWI6.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_TAB_CAL&nbsp;TO&nbsp;IT_TAB_CAL.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*调用计算函数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zsdrp0020_fm/zsdrp0020_fm.html">'ZSDRP0020_FM'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CT_TABLE&nbsp;=&nbsp;IT_TAB_CAL.<br />
   </div>
   <div class="codeComment">
*删除不需要的项<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DELETE&nbsp;IT_TAB_CAL&nbsp;WHERE&nbsp;ZLYJSFS&nbsp;NOT&nbsp;IN&nbsp;IT_LYJSFS.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&ALV显示<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_ALVSHOW.<br />
<br />
   </div>
   <div class="codeComment">
*判断是否有值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;GT_ALV_TAB&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GL_CHECK&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'没有找到符合条件的数据'DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;IT_FIELDCAT[].&nbsp;&nbsp;&nbsp;"清空内存<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
*&nbsp;&nbsp;WA_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;18.<br />
*&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'VRKME'.<br />
*&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'GT_ALV_TAB'.<br />
*&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;'单位'.&nbsp;"<br />
*&nbsp;&nbsp;WA_FIELDCAT-REF_TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MARA'.<br />
*&nbsp;&nbsp;WA_FIELDCAT-REF_FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
*&nbsp;&nbsp;APPEND&nbsp;&nbsp;WA_FIELDCAT&nbsp;&nbsp;TO&nbsp;&nbsp;IT_FIELDCAT.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ADD_ALV:<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;'XUHAO'&nbsp;&nbsp;&nbsp;'序号'&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;'1',<br />
   </div>
   <div class="code">
&nbsp;&nbsp;'ZBUKRS_SAL'&nbsp;'销售公司代码'&nbsp;'GT_ALV_TAB'&nbsp;'1',<br />
<br />
&nbsp;&nbsp;'SORTL'&nbsp;&nbsp;'销售门店'&nbsp;'GT_ALV_TAB'&nbsp;'2',&nbsp;&nbsp;"&nbsp;&nbsp;'KUNAG'<br />
<br />
&nbsp;&nbsp;'SERV_TYPE'&nbsp;'业务类型'&nbsp;'GT_ALV_TAB'&nbsp;'3',<br />
&nbsp;&nbsp;'VBELN'&nbsp;'收入凭证'&nbsp;'GT_ALV_TAB'&nbsp;'4',<br />
<br />
&nbsp;&nbsp;'XBLNR'&nbsp;'POS单号'&nbsp;'GT_ALV_TAB'&nbsp;'5',<br />
&nbsp;&nbsp;'AUFNR'&nbsp;'内部订单号'&nbsp;'GT_ALV_TAB'&nbsp;'6',<br />
&nbsp;&nbsp;'POSNR'&nbsp;'行项目号'&nbsp;'GT_ALV_TAB'&nbsp;'7',<br />
<br />
&nbsp;&nbsp;'ZGYSDM'&nbsp;'供应商'&nbsp;'GT_ALV_TAB'&nbsp;'8',<br />
&nbsp;&nbsp;'NAME1'&nbsp;'供应商描述'&nbsp;'GT_ALV_TAB'&nbsp;'8',<br />
<br />
&nbsp;&nbsp;'ZWERKS_PUR'&nbsp;'采购地点'&nbsp;'GT_ALV_TAB'&nbsp;'9',&nbsp;&nbsp;"&nbsp;'WERKS'<br />
&nbsp;&nbsp;'MBLNR'&nbsp;'入库单号'&nbsp;'GT_ALV_TAB'&nbsp;'10',<br />
&nbsp;&nbsp;'ZBUKRS_PUR'&nbsp;'采购公司代码'&nbsp;'GT_ALV_TAB'&nbsp;'11',&nbsp;&nbsp;"&nbsp;'PO_BUKRS'<br />
<br />
&nbsp;&nbsp;&nbsp;'EWBEZ'&nbsp;'商品大类'&nbsp;'GT_ALV_TAB'&nbsp;'12',&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;'EXTWG'<br />
&nbsp;&nbsp;&nbsp;'RBTXT'&nbsp;'商品小类'&nbsp;'GT_ALV_TAB'&nbsp;'13',&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;'RAUBE'<br />
<br />
&nbsp;&nbsp;'MATNR'&nbsp;'商品编码'&nbsp;'GT_ALV_TAB'&nbsp;'14',<br />
&nbsp;&nbsp;'NAME2'&nbsp;'商品名称'&nbsp;'GT_ALV_TAB'&nbsp;'14',<br />
&nbsp;&nbsp;'CHARG'&nbsp;'商品批次'&nbsp;'GT_ALV_TAB'&nbsp;'15',<br />
&nbsp;&nbsp;'ARKTX'&nbsp;'标签名称'&nbsp;'GT_ALV_TAB'&nbsp;'16',<br />
<br />
&nbsp;&nbsp;'ZXSJS'&nbsp;'销售件数'&nbsp;'GT_ALV_TAB'&nbsp;'17',<br />
&nbsp;&nbsp;'ZXSKZ'&nbsp;'销售克重'&nbsp;'GT_ALV_TAB'&nbsp;'18',<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;'FKIMG'&nbsp;'数量'&nbsp;'GT_ALV_TAB'&nbsp;'17',<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;'FKDAT'&nbsp;'销售日期'&nbsp;'GT_ALV_TAB'&nbsp;'19',<br />
&nbsp;&nbsp;'KZWI1'&nbsp;'实销价格'&nbsp;'GT_ALV_TAB'&nbsp;'20',<br />
&nbsp;&nbsp;'KZWI6'&nbsp;'参考零售价'&nbsp;'GT_ALV_TAB'&nbsp;'21',&nbsp;&nbsp;"&nbsp;'VKP0'<br />
&nbsp;&nbsp;'ZYHJG'&nbsp;'优惠价格'&nbsp;'GT_ALV_TAB'&nbsp;'22',<br />
&nbsp;&nbsp;'ZD01'&nbsp;'以旧换新抵值'&nbsp;'GT_ALV_TAB'&nbsp;'23',<br />
<br />
&nbsp;&nbsp;'BMTXT'&nbsp;'结算方式'&nbsp;'GT_ALV_TAB'&nbsp;'24',&nbsp;"&nbsp;'ZLYJSFS'<br />
<br />
&nbsp;&nbsp;'ZJSJJ'&nbsp;'结算克金价'&nbsp;'GT_ALV_TAB'&nbsp;'25',<br />
&nbsp;&nbsp;'ZJSKGF'&nbsp;'结算克工费'&nbsp;'GT_ALV_TAB'&nbsp;'26',<br />
&nbsp;&nbsp;'ZJSDKZ'&nbsp;'结算克倒扣工费'&nbsp;'GT_ALV_TAB'&nbsp;'27',<br />
&nbsp;&nbsp;'ZLYJSYKJ'&nbsp;'结算一口价'&nbsp;'GT_ALV_TAB'&nbsp;'28',<br />
&nbsp;&nbsp;'ZJSKL'&nbsp;'结算扣率'&nbsp;'GT_ALV_TAB'&nbsp;'29',<br />
&nbsp;&nbsp;'ZB00'&nbsp;'投资克基础价'&nbsp;'GT_ALV_TAB'&nbsp;'30',<br />
&nbsp;&nbsp;'ZKSG'&nbsp;'销售克工费档加价'&nbsp;'GT_ALV_TAB'&nbsp;'31',<br />
<br />
&nbsp;&nbsp;'ZEKORG_PUR'&nbsp;'采购地点的采购组织'&nbsp;'GT_ALV_TAB'&nbsp;32,<br />
&nbsp;&nbsp;'ZVKORG_PUR'&nbsp;'采购地点的销售组织'&nbsp;'GT_ALV_TAB'&nbsp;33,<br />
&nbsp;&nbsp;'ZWERKS_PUR'&nbsp;'采购地点'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;34,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;'ZBUKRS_SAL'&nbsp;'销售公司'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;35,<br />
*&nbsp;&nbsp;'ZWERKS_SAL'&nbsp;'销售地点'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;36,<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;'ZIC'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'是否跨公司'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;37,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;'ZPUR_AMT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'采购金额'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;38,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;'ZPUR_TAX'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'采购税率'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;39,<br />
&nbsp;&nbsp;'ZPUR_COST'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'采购成本'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;40,<br />
&nbsp;&nbsp;'ZIC_ADD_RATE'&nbsp;&nbsp;'公司间加价率'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;41,<br />
&nbsp;&nbsp;'ZIC_ADD_PRIC'&nbsp;&nbsp;'公司间加价克单价'&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;42,<br />
&nbsp;&nbsp;'ZIC_AMT'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'公司间采购/销售金额'&nbsp;'GT_ALV_TAB'&nbsp;43,<br />
&nbsp;&nbsp;'ZIC_SAL_COST'&nbsp;&nbsp;'公司间销售成本'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;44,<br />
&nbsp;&nbsp;'ZIC_PUR_COST'&nbsp;&nbsp;'公司间采购成本'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;45,<br />
&nbsp;&nbsp;'ZSAL_COST'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'最终销售成本'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'GT_ALV_TAB'&nbsp;46,<br />
<br />
&nbsp;&nbsp;'ZJSJE'&nbsp;'供应商结算金额'&nbsp;'GT_ALV_TAB'&nbsp;50.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;'MATKL'&nbsp;'商品组'&nbsp;'GT_ALV_TAB'&nbsp;'33'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_LAYOUT-COLWIDTH_OPTIMIZE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;WA_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;WA_LAYOUT-TOTALS_BEFORE_ITEMS&nbsp;=&nbsp;'X'.<br />
<br />
   </div>
   <div class="codeComment">
*　alv&nbsp;显示回调函数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_FIELDCAT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'PF_STATUS_SET'&nbsp;&nbsp;&nbsp;&nbsp;"状态栏控制<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'USER_COMMAND'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用户命令控制<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_ALV_TAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&整理ALV内表<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_ARRANGE_ALV.<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_KONV,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KNUMV&nbsp;TYPE&nbsp;KONV-KNUMV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KPOSN&nbsp;TYPE&nbsp;KONV-KPOSN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KBETR&nbsp;TYPE&nbsp;KONV-KBETR,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_KONV.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;WA_TMP_ALV&nbsp;TYPE&nbsp;&nbsp;ZSDRP0020_ALV,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_KONV&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_KONV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_HZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_KONV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_KONV&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_KONV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TMP_K&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_KONV.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;L_NUM&nbsp;&nbsp;TYPE&nbsp;NUM4,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZF94&nbsp;TYPE&nbsp;ZDE_ZJE.<br />
<br />
   </div>
   <div class="codeComment">
*取销售条件类型:以旧换新抵值<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KBETR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KONV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;WA_MACHTAB-ZD01<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KNUMV&nbsp;EQ&nbsp;WA_MACHTAB-KNUMV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KSCHL&nbsp;EQ&nbsp;'ZF94'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MACHTAB&nbsp;FROM&nbsp;WA_MACHTAB&nbsp;TRANSPORTING&nbsp;ZD01.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;KNUMV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KPOSN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KBETR<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;IT_KONV<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;KONV<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_MACHTAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KNUMV&nbsp;=&nbsp;IT_MACHTAB-KNUMV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KPOSN&nbsp;=&nbsp;IT_MACHTAB-POSNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KSCHL&nbsp;=&nbsp;'ZF94'.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_KONV&nbsp;BY&nbsp;KNUMV&nbsp;KPOSN.<br />
&nbsp;&nbsp;SORT&nbsp;IT_MACHTAB&nbsp;BY&nbsp;KNUMV&nbsp;POSNR.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_KONV&nbsp;INTO&nbsp;WA_TMP_K.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_KONV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_KONV&nbsp;=&nbsp;WA_TMP_K.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ZF94&nbsp;=&nbsp;L_ZF94&nbsp;+&nbsp;WA_KONV-KBETR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;END&nbsp;OF&nbsp;KPOSN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TMP_K-KNUMV&nbsp;=&nbsp;WA_KONV-KNUMV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TMP_K-KPOSN&nbsp;=&nbsp;WA_KONV-KPOSN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TMP_K-KBETR&nbsp;=&nbsp;L_ZF94.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_TMP_K&nbsp;TO&nbsp;IT_HZ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_ZF94.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_KONV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_HZ&nbsp;INTO&nbsp;WA_KONV&nbsp;WITH&nbsp;KEY&nbsp;KNUMV&nbsp;=&nbsp;WA_MACHTAB-KNUMV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KPOSN&nbsp;=&nbsp;WA_MACHTAB-POSNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_MACHTAB-ZD01&nbsp;=&nbsp;WA_KONV-KBETR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_MACHTAB&nbsp;FROM&nbsp;WA_MACHTAB&nbsp;TRANSPORTING&nbsp;ZD01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;L_NUM.<br />
&nbsp;&nbsp;SORT&nbsp;IT_TAB_CAL&nbsp;BY&nbsp;SHKZG&nbsp;ZTZKJCJ_IN&nbsp;ZCKLSJ_IN&nbsp;WERKS&nbsp;FKDAT&nbsp;MATNR&nbsp;CHARG&nbsp;FKIMG.<br />
   </div>
   <div class="codeComment">
*将IT_TAB_CAL整合到ALV<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TAB_CAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TAB_CAL&nbsp;INTO&nbsp;WA_TAB_CAL&nbsp;WITH&nbsp;KEY&nbsp;SHKZG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;WA_MACHTAB-SHKZG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"退货标识<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZTZKJCJ_IN&nbsp;=&nbsp;&nbsp;WA_MACHTAB-KZWI5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"投资克基础价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZCKLSJ_IN&nbsp;&nbsp;=&nbsp;&nbsp;WA_MACHTAB-KZWI6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;WA_MACHTAB-WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FKDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;WA_MACHTAB-FKDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"过账日期/销售日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;WA_MACHTAB-MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料编号/款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;WA_MACHTAB-CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FKIMG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;WA_MACHTAB-FKIMG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_ALV_TAB.<br />
   </div>
   <div class="codeComment">
*取数数据&nbsp;&nbsp;合并<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;WA_MACHTAB-SERV_TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-AUFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-AUFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-XBLNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-EX_POSNUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-VBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZD01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-ZD01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-POSNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-POSNR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-KZWI1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-KZWI2&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-KZWI3&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-KZWI4&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-KZWI5&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_MACHTAB-KZWI6&nbsp;.<br />
<br />
*批次计算属性数据&nbsp;&nbsp;合并<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-WERKS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-FKDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-FKDAT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售日期<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-MATNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"物料编号/款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-CHARG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-FKIMG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-FKIMG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-SHKZG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-SHKZG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"退货项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZTZKJCJ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZTZKJCJ_OUT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"投资克基础价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZCKLSJ&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZCKLSJ_OUT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
   </div>
   <div class="codeComment">
****20151209&nbsp;change&nbsp;by&nbsp;linan****<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZCKLSJ_OUT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
   </div>
   <div class="codeComment">
*********end&nbsp;change******<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZLYJSFS&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZLYJSFS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"联营结算方式<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-SFLY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-SFLY.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"是否联营<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-EXTWG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-RAUBE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-RAUBE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ARKTX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZBQMC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZGYSDM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZGYSDM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZJZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单品金重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZJSJJ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZJSJJ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克金价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZJSKGF&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZJSKGF.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克工费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZJSDKZ&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZJSDKZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算克倒扣值<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZLYJSYKJ&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZLYJSYKJ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"联营结算一口价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZJSKL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZJSKL.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算扣率<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZXSKGFD&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZXSKGFD.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售克工费档<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZKLTZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZJSKL_WERKS.&nbsp;&nbsp;&nbsp;"扣率调整<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZXSKGF&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZXSKGF.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售克工费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZXSJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZXSJS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZXSKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZXSKZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-MEINS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-MEINS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"基本计量单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-MBLNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-MBLNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品凭证编号/入库单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-MJAHR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-MJAHR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品凭证年度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-PO_BUKRS&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZBUKRS_PUR.&nbsp;&nbsp;&nbsp;&nbsp;"采购公司<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-BUKRS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZBUKRS_SAL.&nbsp;&nbsp;&nbsp;&nbsp;"销售公司<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-WERKS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZWERKS_SAL.&nbsp;&nbsp;&nbsp;&nbsp;"销售地点<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZWERKS_SAL_TAX&nbsp;=&nbsp;WA_TAB_CAL-ZWERKS_SAL_TAX.&nbsp;&nbsp;&nbsp;"销售地点税分类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KUNAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-KUNNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"门店编号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZIC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZIC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"是否跨公司<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZJSJE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZPUR_AMT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"结算金额/采购金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZPUR_TAX&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZPUR_TAX.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购税率<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZPUR_COST&nbsp;=&nbsp;WA_TAB_CAL-ZPUR_COST.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购成本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZIC_ADD_RATE&nbsp;=&nbsp;WA_TAB_CAL-ZIC_ADD_RATE.&nbsp;&nbsp;&nbsp;&nbsp;"公司间加价率<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZIC_ADD_PRIC&nbsp;=&nbsp;WA_TAB_CAL-ZIC_ADD_PRIC.&nbsp;&nbsp;&nbsp;&nbsp;"公司间加价克单价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZIC_AMT&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZIC_AMT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"公司间采购/销售金额<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZIC_SAL_COST&nbsp;=&nbsp;WA_TAB_CAL-ZIC_SAL_COST.&nbsp;&nbsp;&nbsp;&nbsp;"公司间销售成本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZIC_PUR_COST&nbsp;=&nbsp;WA_TAB_CAL-ZIC_PUR_COST.&nbsp;&nbsp;&nbsp;&nbsp;"公司间采购成本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZSAL_COST&nbsp;=&nbsp;WA_TAB_CAL-ZSAL_COST.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"最终销售成本<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZBUKRS_PUR&nbsp;=&nbsp;WA_TAB_CAL-ZBUKRS_PUR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购公司<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZEKORG_PUR&nbsp;=&nbsp;WA_TAB_CAL-ZEKORG_PUR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购地点的采购组织<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZVKORG_PUR&nbsp;=&nbsp;WA_TAB_CAL-ZVKORG_PUR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购地点的销售组织<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZWERKS_PUR&nbsp;=&nbsp;WA_TAB_CAL-ZWERKS_PUR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"采购地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZBUKRS_SAL&nbsp;=&nbsp;WA_TAB_CAL-ZBUKRS_SAL.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售公司<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZWERKS_SAL&nbsp;=&nbsp;WA_TAB_CAL-ZWERKS_SAL.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"销售地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_ALV_TAB-ZXSKZ&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZB00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TAB_CAL-ZTZKJCJ_OUT&nbsp;/&nbsp;WA_ALV_TAB-ZXSKZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"投资克基础价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_ALV_TAB&nbsp;TO&nbsp;GT_ALV_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*----------------------------------------------------------------------------------------------------------------------<br />
*删除不需要的项<br />
*----------------------------------------------------------------------------------------------------------------------<br />
*整理销售公司代码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DELETE&nbsp;GT_ALV_TAB&nbsp;WHERE&nbsp;ZBUKRS_SAL&nbsp;NOT&nbsp;IN&nbsp;S_BUKRS[].<br />
   </div>
   <div class="codeComment">
*整理门店<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_KUNAG[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_ALV_TAB&nbsp;WHERE&nbsp;KUNAG&nbsp;NOT&nbsp;IN&nbsp;S_KUNAG[].<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*整理收入凭证<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_VBELN[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_ALV_TAB&nbsp;WHERE&nbsp;VBELN&nbsp;NOT&nbsp;IN&nbsp;S_VBELN[].<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*整理大类<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_EXTWG[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_ALV_TAB&nbsp;WHERE&nbsp;EXTWG&nbsp;NOT&nbsp;IN&nbsp;S_EXTWG[].<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*整理小类<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_RAUBE[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_ALV_TAB&nbsp;WHERE&nbsp;RAUBE&nbsp;NOT&nbsp;IN&nbsp;S_RAUBE[].<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*整理供应商<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_LIFNR[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_ALV_TAB&nbsp;WHERE&nbsp;ZGYSDM&nbsp;NOT&nbsp;IN&nbsp;S_LIFNR[].<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*----------------------------------------------------------------------------------------------------------------------<br />
**计算优惠金额<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_TAB&nbsp;INTO&nbsp;WA_TMP_ALV&nbsp;WHERE&nbsp;KZWI1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_ALV_TAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI1&nbsp;=&nbsp;WA_TMP_ALV-KZWI1&nbsp;-&nbsp;WA_TMP_ALV-ZD01.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;WA_TMP_ALV-KZWI6&nbsp;-&nbsp;WA_ALV_TAB-KZWI1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ALV_TAB&nbsp;FROM&nbsp;WA_ALV_TAB&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;ZYHJG&nbsp;KZWI1.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*确定业务类型<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_TAB&nbsp;INTO&nbsp;WA_ALV_TAB&nbsp;WHERE&nbsp;SERV_TYPE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_ALV_TAB-SHKZG&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;WA_ALV_TAB-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;'商品销售'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_ALV_TAB-SHKZG&nbsp;=&nbsp;'S'&nbsp;OR&nbsp;WA_ALV_TAB-SHKZG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;'商品退货'.<br />
   </div>
   <div class="codeComment">
***************20151027增加退货克重负显示***************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZXSKZ&nbsp;=&nbsp;-1&nbsp;*&nbsp;WA_ALV_TAB-ZXSKZ.<br />
   </div>
   <div class="codeComment">
********************************************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ALV_TAB&nbsp;FROM&nbsp;WA_ALV_TAB&nbsp;INDEX&nbsp;SY-TABIX&nbsp;TRANSPORTING&nbsp;SERV_TYPE&nbsp;ZXSKZ.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*编码转描述<br />
   </div>
   <div class="code">
FORM FM_BM.<br />
&nbsp;&nbsp;DATA:&nbsp;IT_BM&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZFIRP0140_TY_BM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BM&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZFIRP0140_TY_BM.<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;WA_ALV_TAB&gt;&nbsp;TYPE&nbsp;ZSDRP0020_ALV1.<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GT_ALV_TAB&nbsp;TO&nbsp;IT_BM.<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zfirp0140_fg_modify/zfirp0140_fg_modify.html">'ZFIRP0140_FG_MODIFY'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_BM&nbsp;=&nbsp;IT_BM.<br />
<br />
   </div>
   <div class="codeComment">
*-------------------20160506增加标签名称-------------------------------<br />
*&nbsp;&nbsp;DATA:&nbsp;LT_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARG,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM_CHARG,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARACTERS&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARACTERS,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CHARACTERS&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM_CHARACTERS.<br />
*<br />
*&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GT_ALV_TAB[]&nbsp;TO&nbsp;LT_CHARG[].<br />
*<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'ZSDRP0020_FM_01'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_CHARG<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARACTERS&nbsp;=&nbsp;LT_CHARACTERS.<br />
*<br />
*&nbsp;&nbsp;SORT&nbsp;LT_CHARACTERS&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
*--------------------------end----------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_TAB&nbsp;ASSIGNING&nbsp;&lt;WA_ALV_TAB&gt;.<br />
   </div>
   <div class="codeComment">
*--------------------20160506bylinan--------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_CHARACTERS.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_CHARACTERS&nbsp;INTO&nbsp;LS_CHARACTERS&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-MATNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-CHARG<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_ALV_TAB&gt;-NAME2&nbsp;=&nbsp;LS_CHARACTERS-ZBQMC.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*-----------------------------end------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_BM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_BM&nbsp;INTO&nbsp;WA_BM&nbsp;WITH&nbsp;KEY&nbsp;EXTWG&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-EXTWG&nbsp;ZLYJSFS&nbsp;&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-ZLYJSFS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_ALV_TAB&gt;-EWBEZ&nbsp;=&nbsp;WA_BM-EWBEZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_ALV_TAB&gt;-BMTXT&nbsp;=&nbsp;WA_BM-BMTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_ALV_TAB&gt;-RAUBE&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_BM&nbsp;INTO&nbsp;WA_BM&nbsp;WITH&nbsp;KEY&nbsp;RAUBE&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-RAUBE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_ALV_TAB&gt;-RBTXT&nbsp;=&nbsp;WA_BM-RBTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_ALV_TAB&gt;-MATKL&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_BM&nbsp;INTO&nbsp;WA_BM&nbsp;WITH&nbsp;KEY&nbsp;MATKL&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-MATKL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_ALV_TAB&gt;-WGBEZ&nbsp;=&nbsp;WA_BM-WGBEZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;WA_ALV_TAB&gt;-KUNAG&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_BM&nbsp;INTO&nbsp;WA_BM&nbsp;WITH&nbsp;KEY&nbsp;KUNAG&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-KUNAG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;WA_ALV_TAB&gt;-SORTL&nbsp;=&nbsp;WA_BM-SORTL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;NAME1&nbsp;INTO&nbsp;&lt;WA_ALV_TAB&gt;-NAME1&nbsp;FROM&nbsp;LFA1&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MAKTX&nbsp;FROM&nbsp;MAKT&nbsp;INTO&nbsp;&lt;WA_ALV_TAB&gt;-NAME2&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;&lt;WA_ALV_TAB&gt;-MATNR.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
FORM FM_SERV_TYPE.<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_VBRK,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;VBRK-VBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_POSTYP&nbsp;TYPE&nbsp;VBRK-EX_POSTYP,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_VBRK.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;IT_TMP_ALV&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZSDRP0020_ALV1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TMP_ALV&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSDRP0020_ALV1,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_VBRK&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_VBRK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_VBELN&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_VBRK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_VBRK&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_VBRK.<br />
<br />
&nbsp;&nbsp;IT_TMP_ALV&nbsp;=&nbsp;GT_ALV_TAB.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;IT_TMP_ALV&nbsp;WHERE&nbsp;SERV_TYPE&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;IF&nbsp;IT_TMP_ALV&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TMP_ALV&nbsp;TO&nbsp;IT_VBELN.<br />
&nbsp;&nbsp;SORT&nbsp;IT_VBELN&nbsp;BY&nbsp;VBELN.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_VBELN&nbsp;COMPARING&nbsp;VBELN.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;VBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_POSTYP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;VBRK<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;IT_VBRK<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_VBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;VBELN&nbsp;=&nbsp;IT_VBELN-VBELN.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_VBRK&nbsp;BY&nbsp;VBELN.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TMP_ALV&nbsp;INTO&nbsp;WA_TMP_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_VBRK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_VBRK&nbsp;INTO&nbsp;WA_VBRK&nbsp;WITH&nbsp;KEY&nbsp;VBELN&nbsp;=&nbsp;WA_TMP_ALV-VBELN&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_VBRK-EX_POSTYP&nbsp;=&nbsp;'20'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TMP_ALV-SERV_TYPE&nbsp;=&nbsp;'商品退货'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_VBRK-EX_POSTYP&nbsp;=&nbsp;'21'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TMP_ALV-SERV_TYPE&nbsp;=&nbsp;'商品销售'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TMP_ALV&nbsp;FROM&nbsp;WA_TMP_ALV&nbsp;TRANSPORTING&nbsp;SERV_TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_TMP_ALV&nbsp;BY&nbsp;VBELN&nbsp;POSNR.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_TAB&nbsp;INTO&nbsp;WA_ALV_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TMP_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TMP_ALV&nbsp;INTO&nbsp;WA_TMP_ALV&nbsp;WITH&nbsp;KEY&nbsp;VBELN&nbsp;=&nbsp;WA_ALV_TAB-VBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POSNR&nbsp;=&nbsp;WA_ALV_TAB-POSNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;WA_TMP_ALV-SERV_TYPE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI1&nbsp;=&nbsp;WA_TMP_ALV-KZWI1&nbsp;-&nbsp;WA_TMP_ALV-ZD01.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;WA_TMP_ALV-KZWI6&nbsp;-&nbsp;WA_ALV_TAB-KZWI1.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ALV_TAB&nbsp;FROM&nbsp;WA_ALV_TAB&nbsp;TRANSPORTING&nbsp;SERV_TYPE."&nbsp;KZWI1&nbsp;ZYHJG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&用户点击事件<br />
*&---------------------------------------------------------------------*<br />
*FORM&nbsp;USER_COMMAND&nbsp;USING&nbsp;R_UCOMM&nbsp;LIKE&nbsp;SY-UCOMM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"做好自定义按包的准备<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
*&nbsp;&nbsp;IF&nbsp;REF_GRID&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;REF_GRID.<br />
*&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;IF&nbsp;NOT&nbsp;REF_GRID&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
*&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BTN_PRT'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;print_doc.<br />
*&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
*&nbsp;&nbsp;ENDCASE.<br />
*&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
*<br />
*ENDFORM.<br />
*********20151209&nbsp;CHANGE&nbsp;BY&nbsp;LINAN**********<br />
   </div>
   <div class="code">
FORM FM_CHECK_YH.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_TAB&nbsp;INTO&nbsp;WA_ALV_TAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;'商品销售'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_ALV_TAB-ZD01&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;WA_ALV_TAB-KZWI6&nbsp;-&nbsp;WA_ALV_TAB-KZWI1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;WA_ALV_TAB-KZWI6&nbsp;-&nbsp;WA_ALV_TAB-KZWI1&nbsp;+&nbsp;WA_ALV_TAB-ZD01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;'商品退货'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_ALV_TAB-ZD01&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI6&nbsp;=&nbsp;WA_ALV_TAB-KZWI6&nbsp;*&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;WA_ALV_TAB-KZWI6&nbsp;-&nbsp;WA_ALV_TAB-KZWI1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-KZWI6&nbsp;=&nbsp;WA_ALV_TAB-KZWI6&nbsp;*&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;WA_ALV_TAB-KZWI6&nbsp;-&nbsp;WA_ALV_TAB-KZWI1&nbsp;+&nbsp;WA_ALV_TAB-ZD01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_ALV_TAB-BUKRS&nbsp;=&nbsp;'7000'&nbsp;AND&nbsp;WA_ALV_TAB-ZYHJG&nbsp;&lt;&nbsp;0&nbsp;AND&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;'商品销售'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;WA_ALV_TAB-BUKRS&nbsp;=&nbsp;'7000'&nbsp;AND&nbsp;WA_ALV_TAB-ZYHJG&nbsp;&gt;&nbsp;0&nbsp;AND&nbsp;WA_ALV_TAB-SERV_TYPE&nbsp;=&nbsp;'商品退货'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_ALV_TAB-ZYHJG&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ALV_TAB&nbsp;FROM&nbsp;WA_ALV_TAB&nbsp;TRANSPORTING&nbsp;ZYHJG&nbsp;KZWI6.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
FORM FM_ZSDRP0020_DD.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZSDRP0020_DD&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZSDRP0020_DD,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZSDRP0020_DD&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSDRP0020_DD,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MACHTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MA_CH.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZSDRP0020_DD&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZSDRP0020_DD.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_ZSDRP0020_DD&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_MACHTAB&nbsp;INTO&nbsp;WA_MACHTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_ZSDRP0020_DD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSDRP0020_DD&nbsp;INTO&nbsp;LS_ZSDRP0020_DD&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;WA_MACHTAB-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;WA_MACHTAB-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_MACHTAB&nbsp;TO&nbsp;LT_MACHTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;IT_MACHTAB.<br />
&nbsp;&nbsp;IT_MACHTAB&nbsp;=&nbsp;LT_MACHTAB.<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*Selection&nbsp;texts<br />
*----------------------------------------------------------<br />
*&nbsp;S_BUKRS&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;商品大类<br />
*&nbsp;S_FKDAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日期<br />
*&nbsp;S_KUNAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门店编码<br />
*&nbsp;S_LIFNR&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_LYJSFS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;联营结算方式<br />
*&nbsp;S_MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;物料号<br />
*&nbsp;S_RAUBE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;商品小类<br />
*&nbsp;S_VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;凭证号(收入凭证)<br />
<br />
<br />
*Messages<br />
*----------------------------------------------------------<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;00<br />
*001&nbsp;&nbsp;&nbsp;&1&2&3&4&5&6&7&8<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
