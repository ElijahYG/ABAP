<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZMMRP0510</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMRP0510</h2>
<h3> Description: 商品采购数据查询报表</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;REPORT&nbsp;&nbsp;ZMMRP0510<br />
*&&nbsp;Application&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;MM-RP-0510<br />
*&&nbsp;Subject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;商品采购数据查询报表<br />
*&&nbsp;Author&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;LINAN<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;DATE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUTHOR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIPTION<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;----------&nbsp;&nbsp;&nbsp;&nbsp;-----------------<br />
*&&nbsp;2016/07/21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initial<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
REPORT ZMMRP0510.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;本程序取的商品库存均为DC80<br />
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;包含程序<br />
*&---------------------------------------------------------------------*<br />
*INCLUDE&nbsp;ZFI_COMMON_FORM.<br />
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;ALV显示相关<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
TYPE-POOLS: SLIS.               "ALV显示使用到的共享池<br />
<br />
DATA: L_GRID      TYPE REF TO CL_GUI_ALV_GRID.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;引用表<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
TABLES: SSCRFIELDS,     "GUI按钮相关<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMEX0010_RANG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARD,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMEX0010_MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMRP0210_BATCH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMRP0050_ITEM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM_DELEVRESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&定义结构体<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
TYPES: BEGIN OF STRU_OUT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_PH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-MATNR_PH,&nbsp;&nbsp;&nbsp;"需求商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_JH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"需求件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"库存件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"库存克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZFW_PH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,&nbsp;&nbsp;&nbsp;&nbsp;"需求款克重范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZFW_JH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,&nbsp;&nbsp;&nbsp;&nbsp;"拣货款克重范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZZQH_PH&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,&nbsp;&nbsp;&nbsp;&nbsp;"需求款指圈号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-ZGYSDM,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGJSCZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-ZGJSCZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"贵金属材质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-EXTWG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAUBE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-RAUBE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ01&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ01,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种一级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ02&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ02,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种二级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ03&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ03,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种三级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ04&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ04,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种四级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_YT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_YT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用途<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH_PH&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-EX_XNKH_PH,&nbsp;"需求虚拟款号<br />
   </div>
   <div class="codeComment">
*&nbsp;描述字段<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_MATNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;MAKT-MAKTX,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品编码描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;LFA1-NAME1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_GJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_GJS-EX_GJS_TEXT,&nbsp;&nbsp;"贵金属材质描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_EXTWG&nbsp;&nbsp;&nbsp;TYPE&nbsp;TWEWT-EWBEZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"大类描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_RAUBE&nbsp;&nbsp;&nbsp;TYPE&nbsp;T142T-RBTXT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_EX_PZ01&nbsp;TYPE&nbsp;ZMMEX0010_PZ01-EX_PZ01_TEXT,&nbsp;"品种一级描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_EX_PZ02&nbsp;TYPE&nbsp;ZMMEX0010_PZ02-EX_PZ01_TEXT,&nbsp;"品种二级描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_EX_PZ03&nbsp;TYPE&nbsp;ZMMEX0010_PZ03-EX_PZ01_TEXT,&nbsp;"品种三级描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_EX_PZ04&nbsp;TYPE&nbsp;ZMMEX0010_PZ04-EX_PZ01_TEXT,&nbsp;"品种四级描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_EX_PZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_PZ-EX_PZ_TEXT,&nbsp;&nbsp;&nbsp;&nbsp;"品质描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MS_EX_YT&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_YT-EX_YT_TEXT,&nbsp;&nbsp;&nbsp;&nbsp;"用途描述<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;FLAG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_OUT.<br />
TYPES: BEGIN OF STRU_STOCK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-WERKS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LGORT&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-LGORT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH&nbsp;TYPE&nbsp;ZDE_MMRP0210_XNKH,&nbsp;"&nbsp;虚拟款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MEINS&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-MEINS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLABS&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-CLABS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NTGEW&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-CLABS&nbsp;,&nbsp;"&nbsp;件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WESCH&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-CLABS&nbsp;,&nbsp;"&nbsp;克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_STOCK.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;定义常量,定义宏<br />
*&---------------------------------------------------------------------*<br />
*定义ALV显示宏<br />
   </div>
   <div class="code">
DEFINE ADD_ALV.<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_FIELDCAT.<br />
&nbsp;&nbsp;LS_FIELDCAT-COL_POS&nbsp;=&nbsp;LINES(&nbsp;LT_FIELDCAT&nbsp;)&nbsp;+&nbsp;1&nbsp;.&nbsp;&nbsp;"列位置<br />
&nbsp;&nbsp;LS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"要显示的字段<br />
&nbsp;&nbsp;LS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"中文描述字段名<br />
&nbsp;&nbsp;LS_FIELDCAT-NO_MERGING&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE.&nbsp;&nbsp;"排序后是否合并相同值<br />
<br />
&nbsp;&nbsp;IF&nbsp;LS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LIFNR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-REF_TABLE&nbsp;&nbsp;=&nbsp;'LFA1'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用表<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-REF_FIELD&nbsp;&nbsp;=&nbsp;'LIFNR'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用字段<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-JUST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"对齐方式<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"可编辑<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用表<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"引用字段<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-INTLEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"内部长度(筛选时),默认长度10<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-INTTYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-FIX_COLUMN&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE.&nbsp;"固定列<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-DO_SUM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE.&nbsp;"合计列<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-F4AVAILABL&nbsp;&nbsp;&nbsp;=&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"列搜索帮助,OO用<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;APPEND&nbsp;LS_FIELDCAT&nbsp;TO&nbsp;LT_FIELDCAT.<br />
END-OF-DEFINITION.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;定义全局数据<br />
*&---------------------------------------------------------------------*<br />
*定义变量<br />
   </div>
   <div class="code">
DATA: GL_CHECK TYPE CHAR1.<br />
<br />
   </div>
   <div class="codeComment">
*定义内表<br />
   </div>
   <div class="code">
DATA: GT_OUT_TAB TYPE STANDARD TABLE OF STRU_OUT.<br />
<br />
   </div>
   <div class="codeComment">
*定义字段符号<br />
   </div>
   <div class="code">
FIELD-SYMBOLS: &lt;GS_OUT_TAB&gt; TYPE STRU_OUT.<br />
<br />
   </div>
   <div class="codeComment">
*GUI添加按钮用结构<br />
   </div>
   <div class="code">
DATA FUNCTXT TYPE SMP_DYNTXT.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;选择屏幕<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
SELECTION-SCREEN BEGIN OF BLOCK BK1 WITH FRAME TITLE TEXT-T01.<br />
<br />
SELECT-OPTIONS:<br />
&nbsp;&nbsp;&nbsp;S_MAT_PH&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMRP0050_ITEM-MATNR&nbsp;NO&nbsp;INTERVALS&nbsp;MODIF&nbsp;ID&nbsp;Z01,&nbsp;&nbsp;&nbsp;"需求商品号<br />
&nbsp;&nbsp;&nbsp;S_MAT_JH&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMRP0050_ITEM-MATNR&nbsp;NO&nbsp;INTERVALS&nbsp;MODIF&nbsp;ID&nbsp;Z02,&nbsp;&nbsp;&nbsp;"拣货商品号<br />
&nbsp;&nbsp;&nbsp;S_KZF_PH&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_RANG-EX_KNAME&nbsp;NO&nbsp;INTERVALS&nbsp;MODIF&nbsp;ID&nbsp;Z01,"需求款克重范围<br />
&nbsp;&nbsp;&nbsp;S_KZF_JH&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_RANG-EX_KNAME&nbsp;NO&nbsp;INTERVALS&nbsp;MODIF&nbsp;ID&nbsp;Z02,"拣货款克重范围<br />
&nbsp;&nbsp;&nbsp;S_DATE1&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;SY-DATUM&nbsp;MODIF&nbsp;ID&nbsp;Z01,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"需求时间<br />
&nbsp;&nbsp;&nbsp;S_DATE2&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;SY-DATUM&nbsp;MODIF&nbsp;ID&nbsp;Z02.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货时间<br />
<br />
PARAMETERS: P_1 TYPE C RADIOBUTTON GROUP DATE DEFAULT 'X'   "需求<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER-COMMAND&nbsp;FLAG&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_2&nbsp;TYPE&nbsp;C&nbsp;RADIOBUTTON&nbsp;GROUP&nbsp;DATE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货<br />
<br />
SELECTION-SCREEN END OF BLOCK BK1.<br />
<br />
SELECTION-SCREEN BEGIN OF BLOCK BK2 WITH FRAME TITLE TEXT-T03.<br />
<br />
SELECT-OPTIONS:<br />
&nbsp;&nbsp;&nbsp;S_EXTWG&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMRP0050_ITEM-EXTWG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"大类<br />
&nbsp;&nbsp;&nbsp;S_RAUBE&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;MARA-RAUBE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类<br />
&nbsp;&nbsp;&nbsp;S_LIFNR&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMRP0210_BATCH-ZGYSDM,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商代码<br />
&nbsp;&nbsp;&nbsp;S_ZGJSCZ&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMRP0210_BATCH-ZGJSCZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"贵金属材质<br />
&nbsp;&nbsp;&nbsp;S_PZ01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_MARA-EX_PZ01,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种一级<br />
&nbsp;&nbsp;&nbsp;S_PZ02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_MARA-EX_PZ02,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种二级<br />
&nbsp;&nbsp;&nbsp;S_PZ03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_MARA-EX_PZ03,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种三级<br />
&nbsp;&nbsp;&nbsp;S_PZ04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_MARA-EX_PZ04,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种四级<br />
&nbsp;&nbsp;&nbsp;S_PZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_MARA-EX_PZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品质<br />
&nbsp;&nbsp;&nbsp;S_YT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ZMMEX0010_MARA-EX_YT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用途<br />
<br />
SELECTION-SCREEN END OF BLOCK BK2.<br />
<br />
SELECTION-SCREEN: BEGIN OF BLOCK B9 WITH FRAME TITLE TEXT-T02.<br />
PARAMETERS P_VARI TYPE SLIS_VARI.<br />
SELECTION-SCREEN: END OF BLOCK B9.<br />
<br />
SELECTION-SCREEN: FUNCTION KEY 1 . "GUI预留按钮位<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;初始化<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
INITIALIZATION.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_INIT.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;FUNCTXT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"定义GUI按钮<br />
*&nbsp;&nbsp;FUNCTXT-ICON_ID&nbsp;&nbsp;&nbsp;=&nbsp;ICON_WAREHOUSE.&nbsp;"按钮图标<br />
*&nbsp;&nbsp;FUNCTXT-ICON_TEXT&nbsp;=&nbsp;'按钮名称'.<br />
*<br />
*&nbsp;&nbsp;SSCRFIELDS-FUNCTXT_01&nbsp;=&nbsp;FUNCTXT.<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;PBO处理<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
AT SELECTION-SCREEN OUTPUT.      "屏幕显示检查<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_CHECK_SCREEN.<br />
<br />
   </div>
   <div class="codeComment">
*AT&nbsp;SELECTION-SCREEN.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"选择屏幕按钮<br />
*&nbsp;&nbsp;IF&nbsp;SSCRFIELDS-UCOMM&nbsp;=&nbsp;'FC01'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;TRANSACTION&nbsp;'ZMMIF0100'.<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
AT SELECTION-SCREEN ON VALUE-REQUEST FOR S_KZF_PH-LOW. "需求克重范围搜索帮助<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_HELP_KZF_PH.<br />
<br />
AT SELECTION-SCREEN ON VALUE-REQUEST FOR S_KZF_JH-LOW. "需求克重范围搜索帮助<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_HELP_KZF_JH.<br />
<br />
AT SELECTION-SCREEN ON VALUE-REQUEST FOR P_VARI. "选择布局<br />
&nbsp;&nbsp;PERFORM&nbsp;F_ALV_VARIANT_F4&nbsp;CHANGING&nbsp;P_VARI.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&F8<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
START-OF-SELECTION.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_CHECK_OB.&nbsp;&nbsp;&nbsp;&nbsp;"输入条件检查<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_MAIN_PROCESS."程序主流程<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&选择屏幕结束<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
END-OF-SELECTION.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_STATUS&nbsp;USING&nbsp;'输出至ALV...'.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_ALVSHOW&nbsp;TABLES&nbsp;GT_OUT_TAB.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ALV显示<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;初始化：清空全局变量<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_INIT.<br />
&nbsp;&nbsp;CLEAR:&nbsp;GL_CHECK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GT_OUT_TAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;F_ALV_VARIANT_F4<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_P_VARI&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM F_ALV_VARIANT_F4 CHANGING P_P_VARI TYPE SLIS_VARI.<br />
&nbsp;&nbsp;DATA:&nbsp;RS_VARIANT&nbsp;TYPE&nbsp;DISVARIANT.<br />
<br />
&nbsp;&nbsp;RS_VARIANT-REPORT&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID.<br />
&nbsp;&nbsp;RS_VARIANT-USERNAME&nbsp;=&nbsp;SY-UNAME.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_VARIANT_F4'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_VARIANT&nbsp;=&nbsp;RS_VARIANT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ES_VARIANT&nbsp;=&nbsp;RS_VARIANT<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_P_VARI&nbsp;=&nbsp;RS_VARIANT-VARIANT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM. " F_ALV_VARIANT_F4<br />
<br />
FORM FM_HELP_KZF_PH.                                     "销售克工费档<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_RANG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KNAME&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KZLOW&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KZLOW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KHIGH&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KHIGH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KZAVG&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KZAVG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_RANG.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_KZF&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_RANG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_KZF&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_RANG.<br />
   </div>
   <div class="codeComment">
*取数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZMMEX0010_RANG&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_KZF&nbsp;WHERE&nbsp;EX_KTYPE&nbsp;=&nbsp;'K'.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_KZF&nbsp;BY&nbsp;EX_KNAME.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_KZF&nbsp;COMPARING&nbsp;EX_KNAME.<br />
&nbsp;&nbsp;SORT&nbsp;LT_KZF&nbsp;BY&nbsp;EX_KZLOW&nbsp;EX_KHIGH.<br />
<br />
&nbsp;&nbsp;"调用展示函数<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETFIELD&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'EX_KNAME'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"表格要显示的字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPPROG&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"返回才程序<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-DYNNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"屏幕<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPROFIELD&nbsp;=&nbsp;'S_KZF_PH'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"往页面回填值的地方r<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_ORG&nbsp;&nbsp;&nbsp;=&nbsp;'S'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"显示类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_TAB&nbsp;&nbsp;&nbsp;=&nbsp;LT_KZF.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"传进去的表格&nbsp;帮助的内表<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
FORM FM_HELP_KZF_JH.                                     "销售克工费档<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA:&nbsp;LT_KZF&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_RANG,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_KZF&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMEX0010_RANG.<br />
**取数<br />
*&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZMMEX0010_RANG&nbsp;INTO&nbsp;TABLE&nbsp;LT_KZF&nbsp;WHERE&nbsp;EX_KTYPE&nbsp;=&nbsp;'K'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_RANG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KNAME&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KZLOW&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KZLOW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KHIGH&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KHIGH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KZAVG&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KZAVG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_RANG.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_KZF&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_RANG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_KZF&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_RANG.<br />
   </div>
   <div class="codeComment">
*取数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZMMEX0010_RANG&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_KZF&nbsp;WHERE&nbsp;EX_KTYPE&nbsp;=&nbsp;'K'.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_KZF&nbsp;BY&nbsp;EX_KNAME.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_KZF&nbsp;COMPARING&nbsp;EX_KNAME.<br />
&nbsp;&nbsp;SORT&nbsp;LT_KZF&nbsp;BY&nbsp;EX_KZLOW&nbsp;EX_KHIGH.<br />
<br />
&nbsp;&nbsp;"调用展示函数<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETFIELD&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'EX_KNAME'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"表格要显示的字段<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPPROG&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"返回才程序<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-DYNNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"屏幕<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPROFIELD&nbsp;=&nbsp;'S_KZF_JH'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"往页面回填值的地方r<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_ORG&nbsp;&nbsp;&nbsp;=&nbsp;'S'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"显示类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_TAB&nbsp;&nbsp;&nbsp;=&nbsp;LT_KZF.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"传进去的表格&nbsp;帮助的内表<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;更改输入后屏幕显示<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_CHECK_SCREEN.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_1&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'Z02'.&nbsp;&nbsp;&nbsp;"需求<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;S_MAT_JH[],<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_KZF_JH[],<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_DATE2[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;P_2&nbsp;=&nbsp;ABAP_TRUE&nbsp;AND&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'Z01'.&nbsp;&nbsp;"拣货<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;S_MAT_PH[],<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_KZF_PH[],<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S_DATE1[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;检查屏幕输入数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_CHECK_OB.<br />
<br />
&nbsp;&nbsp;IF&nbsp;P_1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.&nbsp;&nbsp;&nbsp;&nbsp;"需求<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;S_MAT_PH[]&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;S_DATE1[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'款号和时间不能同时为空'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;S_MAT_JH[]&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;S_DATE2[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'款号和时间不能同时为空'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;程序主逻辑<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_MAIN_PROCESS.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_STATUS&nbsp;USING&nbsp;'取数...'.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_DATA.&nbsp;&nbsp;&nbsp;"取数<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_STATUS&nbsp;USING&nbsp;'计算库存...'.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_STOCK.&nbsp;&nbsp;"计算库存<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_STATUS&nbsp;USING&nbsp;'取描述...'.<br />
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_BMMS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"取描述<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;取数逻辑<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_DATA.<br />
<br />
&nbsp;&nbsp;TYPES:<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_ZMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_PH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-MATNR_PH,&nbsp;&nbsp;&nbsp;"需求商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH_PH&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-EX_XNKH_PH,&nbsp;"虚拟款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-XQSL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"需求件数<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZFW_PH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,&nbsp;&nbsp;&nbsp;&nbsp;"需求克重范围<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_ZMM,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_0050,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_JH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH_PH&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-EX_XNKH_PH,&nbsp;"虚拟款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-JS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_HEAD-VBELN_DN,&nbsp;&nbsp;&nbsp;&nbsp;"交货单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_0050,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_0051,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_JH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH_PH&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-EX_XNKH_PH,&nbsp;"虚拟款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_0051,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_PH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_PH&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-MATNR_PH,&nbsp;&nbsp;&nbsp;"需求商品号<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH_PH&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-EX_XNKH_PH,&nbsp;"需求虚拟款号<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-XQSL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"需求件数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-ZGYSDM,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGJSCZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-ZGJSCZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"贵金属材质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTWG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-EXTWG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAUBE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-RAUBE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ01&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ01,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种一级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ02&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ02,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种二级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ03&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ03,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种三级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ04&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ04,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种四级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_YT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_YT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用途<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-JS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"库存件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"库存克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZFW_PH&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,&nbsp;&nbsp;&nbsp;&nbsp;"需求款克重范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZZQH_PH&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,&nbsp;&nbsp;&nbsp;&nbsp;"需求款指圈号<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_PH,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_JH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_JH&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货商品号<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH&nbsp;&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-EX_XNKH_PH,&nbsp;"需求虚拟款号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-ZGYSDM,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"供应商代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGJSCZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-ZGJSCZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"贵金属材质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTWG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-EXTWG,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAUBE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MARA-RAUBE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ01&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ01,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种一级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ02&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ02,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种二级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ03&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ03,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种三级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ04&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ04,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品种四级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_PZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_YT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA-EX_YT,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用途<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_JH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-JS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ_JH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-JS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"库存件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"库存克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZFW_JH&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,&nbsp;&nbsp;&nbsp;&nbsp;"拣货款克重范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_JH,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_KZF,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KCODE&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KCODE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KNAME&nbsp;TYPE&nbsp;ZMMEX0010_RANG-EX_KNAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_KZF.<br />
<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ZMM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_ZMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TMP_ZMM&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_ZMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ZMM_SUM&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_ZMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_ZMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_TMP_ZMM&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_ZMM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_PH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_PH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_JH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_JH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;RT_MATNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARA-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RT_MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_OUT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_KZF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_KZF,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ZQF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_KZF,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_KZF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_KZF,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZQF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_KZF,<br />
&nbsp;&nbsp;&nbsp;&nbsp;RT_KZF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMEX0010_RANG-EX_KNAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;RT_KCODE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMEX0010_RANG-EX_KCODE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;RW_KCODE&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RT_KCODE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_0050&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_0050,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_0051&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_0051,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_0051_SUM&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_0051,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_0050&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_0050,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_0051&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_0051<br />
&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;P_1&nbsp;EQ&nbsp;ABAP_TRUE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"需求<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;1.主要取数表&nbsp;ZMM_DELEVRESULT<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;MATNR_PH&nbsp;&nbsp;&nbsp;"需求商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH_PH&nbsp;"需求虚拟商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XQSL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"需求件数&nbsp;ZJS_PH&nbsp;XQSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMM_DELEVRESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR_PH&nbsp;IN&nbsp;S_MAT_PH[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;DATUM_PH&nbsp;IN&nbsp;S_DATE1[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_ZMM&nbsp;WHERE&nbsp;MATNR_PH&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ZMM&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'没有找到相应的数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"汇总需求件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZMM&nbsp;INTO&nbsp;LS_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;LS_ZMM&nbsp;INTO&nbsp;LT_ZMM_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_ZMM&nbsp;=&nbsp;LT_ZMM_SUM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"筛选指圈号需求款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZMM&nbsp;INTO&nbsp;LS_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ZMM-EX_XNKH_PH+8(1)&nbsp;=&nbsp;'Z'&nbsp;AND&nbsp;LS_ZMM-EX_XNKH_PH+8(4)&nbsp;NE&nbsp;'Z001'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZMM&nbsp;TO&nbsp;LT_TMP_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;2.筛选需求克重范围<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LINES&nbsp;OF&nbsp;S_KZF_PH[]&nbsp;TO&nbsp;RT_KZF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"取指圈范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;EX_KCODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_RANG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZQF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EX_KTYPE&nbsp;EQ&nbsp;'Z'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"取克重范围<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;EX_KCODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_RANG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KZF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EX_KNAME&nbsp;IN&nbsp;RT_KZF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EX_KTYPE&nbsp;EQ&nbsp;'K'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_KZF&nbsp;INTO&nbsp;LS_KZF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;RW_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_KCODE-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_KCODE-OPTION&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_KCODE-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_KZF-EX_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;RW_KCODE&nbsp;TO&nbsp;RT_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_ZMM&nbsp;WHERE&nbsp;EX_XNKH_PH+8(4)&nbsp;NOT&nbsp;IN&nbsp;RT_KCODE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_TMP_ZMM&nbsp;BY&nbsp;EX_XNKH_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_TMP_ZMM&nbsp;INTO&nbsp;LS_TMP_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZMM&nbsp;INTO&nbsp;LS_ZMM&nbsp;WITH&nbsp;KEY&nbsp;EX_XNKH_PH&nbsp;=&nbsp;LS_ZMM-EX_XNKH_PH&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_TMP_ZMM&nbsp;TO&nbsp;LT_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;3.取款式属性数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZMM&nbsp;INTO&nbsp;LS_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;RW_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-OPTION&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_ZMM-MATNR_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;RW_MATNR&nbsp;TO&nbsp;RT_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;RT_MATNR&nbsp;BY&nbsp;LOW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;RT_MATNR&nbsp;COMPARING&nbsp;LOW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;B~MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D~ZGYSDM&nbsp;&nbsp;&nbsp;&nbsp;"供应商代码&nbsp;&nbsp;ZGYSDM&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D~ZGJSCZ&nbsp;&nbsp;&nbsp;&nbsp;"贵金属材质&nbsp;&nbsp;EX_GJS&nbsp;ZGJSCZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~RAUBE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ01&nbsp;&nbsp;&nbsp;"品种一级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ02&nbsp;&nbsp;&nbsp;"品种二级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ03&nbsp;&nbsp;&nbsp;"品种三级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ04&nbsp;&nbsp;&nbsp;"品种四级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_YT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用途<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_PH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_MARA&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;MARA&nbsp;AS&nbsp;C&nbsp;ON&nbsp;C~MATNR&nbsp;=&nbsp;B~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMMRP0210_BATCH&nbsp;AS&nbsp;D&nbsp;ON&nbsp;D~MATNR&nbsp;=&nbsp;B~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;B~MATNR&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;RT_MATNR[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;C~EXTWG&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_EXTWG[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;C~RAUBE&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_RAUBE[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;D~ZGYSDM&nbsp;&nbsp;&nbsp;IN&nbsp;S_LIFNR[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;D~ZGJSCZ&nbsp;&nbsp;&nbsp;IN&nbsp;S_ZGJSCZ[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ01&nbsp;&nbsp;IN&nbsp;S_PZ01[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ02&nbsp;&nbsp;IN&nbsp;S_PZ02[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ03&nbsp;&nbsp;IN&nbsp;S_PZ03[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ04&nbsp;&nbsp;IN&nbsp;S_PZ04[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_PZ[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_YT&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_YT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;4.整合数据到GT_OUT_TAB<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_PH&nbsp;BY&nbsp;MATNR_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_KZF&nbsp;BY&nbsp;EX_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_ZQF&nbsp;BY&nbsp;EX_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZMM&nbsp;INTO&nbsp;LS_ZMM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_OUT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-MATNR_PH&nbsp;&nbsp;&nbsp;=&nbsp;LS_ZMM-MATNR_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZJS_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_ZMM-ZJS_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_XNKH_PH&nbsp;=&nbsp;LS_ZMM-EX_XNKH_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_PH&nbsp;INTO&nbsp;LS_PH&nbsp;WITH&nbsp;KEY&nbsp;MATNR_PH&nbsp;=&nbsp;LS_ZMM-MATNR_PH&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-LIFNR&nbsp;&nbsp;&nbsp;=&nbsp;LS_PH-LIFNR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZGJSCZ&nbsp;&nbsp;=&nbsp;LS_PH-ZGJSCZ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EXTWG&nbsp;&nbsp;&nbsp;=&nbsp;LS_PH-EXTWG&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-RAUBE&nbsp;&nbsp;&nbsp;=&nbsp;LS_PH-RAUBE&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ01&nbsp;=&nbsp;LS_PH-EX_PZ01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ02&nbsp;=&nbsp;LS_PH-EX_PZ02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ03&nbsp;=&nbsp;LS_PH-EX_PZ03.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ04&nbsp;=&nbsp;LS_PH-EX_PZ04.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ&nbsp;&nbsp;&nbsp;=&nbsp;LS_PH-EX_PZ&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_YT&nbsp;&nbsp;&nbsp;=&nbsp;LS_PH-EX_YT&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_KZF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_KZF&nbsp;INTO&nbsp;LS_KZF&nbsp;WITH&nbsp;KEY&nbsp;EX_KCODE&nbsp;=&nbsp;LS_ZMM-EX_XNKH_PH+8(4)&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZKZFW_PH&nbsp;=&nbsp;LS_KZF-EX_KNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZQF&nbsp;INTO&nbsp;LS_ZQF&nbsp;WITH&nbsp;KEY&nbsp;EX_KCODE&nbsp;=&nbsp;LS_ZMM-EX_XNKH_PH+8(4)&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZZQH_PH&nbsp;=&nbsp;LS_ZQF-EX_KNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_OUT_TAB&nbsp;TO&nbsp;GT_OUT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;筛选辅助查询条件<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_DELETE_SEL.<br />
<br />
&nbsp;&nbsp;ELSEIF&nbsp;P_2&nbsp;EQ&nbsp;ABAP_TRUE.&nbsp;&nbsp;&nbsp;&nbsp;"拣货<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;1.主要取数表&nbsp;ZMMRP0050_HEAD&nbsp;ZMMRP0050_ITEM<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;B~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~EX_XNKH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~JS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~KZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~VBELN_DN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_0050<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMRP0050_HEAD&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMMRP0050_ITEM&nbsp;AS&nbsp;B&nbsp;ON&nbsp;A~ZFHNO&nbsp;=&nbsp;B~ZFHNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMMRP0210_BATCH&nbsp;AS&nbsp;C&nbsp;ON&nbsp;B~MATNR&nbsp;=&nbsp;C~MATNR&nbsp;AND&nbsp;B~CHARG&nbsp;=&nbsp;C~CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~UPDAT&nbsp;IN&nbsp;S_DATE2[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~MATNR&nbsp;IN&nbsp;S_MAT_JH[]<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~YHDH&nbsp;&nbsp;NE&nbsp;ABAP_FALSE<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_0050&nbsp;WHERE&nbsp;MATNR_JH&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_CAL_CXSJ&nbsp;TABLES&nbsp;LT_0050.&nbsp;&nbsp;&nbsp;&nbsp;"排除冲销数据<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_0050&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'没有找到相应的数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"汇总需求件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_0050&nbsp;INTO&nbsp;LS_0050.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_0051.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0051-MATNR_JH&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-MATNR_JH&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0051-EX_XNKH_PH&nbsp;=&nbsp;LS_0050-EX_XNKH_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0051-ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0051-ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_0051&nbsp;TO&nbsp;LT_0051.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_0051&nbsp;INTO&nbsp;LS_0051.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;LS_0051&nbsp;INTO&nbsp;LT_0051_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_0050.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_0051_SUM&nbsp;INTO&nbsp;LS_0051.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_0050.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0050-MATNR_JH&nbsp;&nbsp;&nbsp;=&nbsp;LS_0051-MATNR_JH&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0050-EX_XNKH_PH&nbsp;=&nbsp;LS_0051-EX_XNKH_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0050-ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0051-ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0050-ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0051-ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_0050&nbsp;TO&nbsp;LT_0050.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;2.筛选需求克重范围<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;EX_KCODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_KNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_RANG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_KZF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EX_KNAME&nbsp;IN&nbsp;S_KZF_JH[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EX_KTYPE&nbsp;EQ&nbsp;'K'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_KZF&nbsp;INTO&nbsp;LS_KZF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;RW_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_KCODE-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_KCODE-OPTION&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_KCODE-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_KZF-EX_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;RW_KCODE&nbsp;TO&nbsp;RT_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_0050&nbsp;WHERE&nbsp;EX_XNKH_PH+8(4)&nbsp;NOT&nbsp;IN&nbsp;RT_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_0050&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'没有找到相应的数据'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;3.取款式属性数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_0050&nbsp;INTO&nbsp;LS_0050.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;RW_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-OPTION&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-MATNR_JH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;RW_MATNR&nbsp;TO&nbsp;RT_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;RT_MATNR&nbsp;BY&nbsp;LOW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;RT_MATNR&nbsp;COMPARING&nbsp;LOW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;B~MATNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D~ZGYSDM&nbsp;&nbsp;&nbsp;&nbsp;"供应商代码&nbsp;&nbsp;ZGYSDM&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D~ZGJSCZ&nbsp;&nbsp;&nbsp;&nbsp;"贵金属材质&nbsp;&nbsp;EX_GJS&nbsp;ZGJSCZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~EXTWG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品大类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~RAUBE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"小类<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ01&nbsp;&nbsp;&nbsp;"品种一级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ02&nbsp;&nbsp;&nbsp;"品种二级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ03&nbsp;&nbsp;&nbsp;"品种三级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ04&nbsp;&nbsp;&nbsp;"品种四级<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"品质<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EX_YT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"用途<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_JH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_MARA&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;MARA&nbsp;AS&nbsp;C&nbsp;ON&nbsp;C~MATNR&nbsp;=&nbsp;B~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMMRP0210_BATCH&nbsp;AS&nbsp;D&nbsp;ON&nbsp;D~MATNR&nbsp;=&nbsp;B~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;B~MATNR&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;RT_MATNR[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;C~EXTWG&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_EXTWG[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;C~RAUBE&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_RAUBE[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;D~ZGYSDM&nbsp;&nbsp;&nbsp;IN&nbsp;S_LIFNR[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;D~ZGJSCZ&nbsp;&nbsp;&nbsp;IN&nbsp;S_ZGJSCZ[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ01&nbsp;&nbsp;IN&nbsp;S_PZ01[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ02&nbsp;&nbsp;IN&nbsp;S_PZ02[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ03&nbsp;&nbsp;IN&nbsp;S_PZ03[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ04&nbsp;&nbsp;IN&nbsp;S_PZ04[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_PZ[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EX_YT&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;S_YT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;4.整合数据到GT_OUT_TAB<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_JH&nbsp;BY&nbsp;MATNR_JH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_KZF&nbsp;BY&nbsp;EX_KCODE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_0050&nbsp;INTO&nbsp;LS_0050.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_OUT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-MATNR_JH&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-MATNR_JH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-ZJS_JH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-ZKZ_JH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_XNKH_PH&nbsp;=&nbsp;LS_0050-EX_XNKH_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_JH&nbsp;INTO&nbsp;LS_JH&nbsp;WITH&nbsp;KEY&nbsp;MATNR_JH&nbsp;=&nbsp;LS_0050-MATNR_JH&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-LIFNR&nbsp;&nbsp;&nbsp;=&nbsp;LS_JH-LIFNR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZGJSCZ&nbsp;&nbsp;=&nbsp;LS_JH-ZGJSCZ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EXTWG&nbsp;&nbsp;&nbsp;=&nbsp;LS_JH-EXTWG&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-RAUBE&nbsp;&nbsp;&nbsp;=&nbsp;LS_JH-RAUBE&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ01&nbsp;=&nbsp;LS_JH-EX_PZ01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ02&nbsp;=&nbsp;LS_JH-EX_PZ02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ03&nbsp;=&nbsp;LS_JH-EX_PZ03.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ04&nbsp;=&nbsp;LS_JH-EX_PZ04.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_PZ&nbsp;&nbsp;&nbsp;=&nbsp;LS_JH-EX_PZ&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-EX_YT&nbsp;&nbsp;&nbsp;=&nbsp;LS_JH-EX_YT&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_KZF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_KZF&nbsp;INTO&nbsp;LS_KZF&nbsp;WITH&nbsp;KEY&nbsp;EX_KCODE&nbsp;=&nbsp;LS_0050-EX_XNKH_PH+8(4)&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_OUT_TAB-ZKZFW_JH&nbsp;=&nbsp;LS_KZF-EX_KNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_OUT_TAB&nbsp;TO&nbsp;GT_OUT_TAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;筛选辅助查询条件<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FM_DELETE_SEL.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;获取款式库存数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_STOCK.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;RT_MATNR&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;MSEG-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;RT_MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_STOCK&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_STOCK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STOCK&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_STOCK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;1.获取需求的款号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB&nbsp;ASSIGNING&nbsp;&lt;GS_OUT_TAB&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;RW_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-OPTION&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_1&nbsp;EQ&nbsp;ABAP_TRUE.&nbsp;&nbsp;"需求<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-MATNR_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RW_MATNR-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-MATNR_JH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;RW_MATNR&nbsp;TO&nbsp;RT_MATNR.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;RT_MATNR&nbsp;BY&nbsp;LOW.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;RT_MATNR&nbsp;COMPARING&nbsp;LOW.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;2.获取款式的库存<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;B~WERKS&nbsp;B~LGORT&nbsp;B~MATNR&nbsp;B~CHARG&nbsp;A~MEINS&nbsp;B~CLABS<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_STOCK<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MCHB&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;MARA&nbsp;AS&nbsp;A&nbsp;ON&nbsp;A~MATNR&nbsp;=&nbsp;B~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;B~MATNR&nbsp;IN&nbsp;RT_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~WERKS&nbsp;=&nbsp;'DC80'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~LGORT&nbsp;IN&nbsp;('1001','1002')<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~CLABS&nbsp;&gt;&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~EXTWG&nbsp;IN&nbsp;S_EXTWG[].<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;3.根据虚拟款号汇总库存<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_GET_CHARACTERS&nbsp;TABLES&nbsp;LT_STOCK.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;ALV显示<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_ALVSHOW TABLES IT_TABLE.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT&nbsp;TYPE&nbsp;LVC_S_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_FIELDCAT&nbsp;TYPE&nbsp;LVC_T_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_LAYOUT&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_LAYO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_VARIANT&nbsp;&nbsp;TYPE&nbsp;DISVARIANT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_LINES&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;根据内表字段判断表头还是行项目<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TEXT&nbsp;TYPE&nbsp;CHAR10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_NUM&nbsp;&nbsp;TYPE&nbsp;NUMC3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FLAG&nbsp;TYPE&nbsp;CHAR1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLASS&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_ABAP_STRUCTDESCR.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;TEXT&gt;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;COMP_WA&gt;&nbsp;TYPE&nbsp;ABAP_COMPDESCR.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LT_FIELDCAT[].<br />
<br />
&nbsp;&nbsp;DATA&nbsp;LS_OUT_TAB&nbsp;TYPE&nbsp;STRU_OUT.<br />
&nbsp;&nbsp;CLASS&nbsp;?=&nbsp;CL_ABAP_TYPEDESCR=&gt;DESCRIBE_BY_DATA(&nbsp;LS_OUT_TAB&nbsp;).<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;CLASS-&gt;COMPONENTS&nbsp;ASSIGNING&nbsp;&lt;COMP_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;COMP_WA&gt;-NAME&nbsp;NE&nbsp;'FLAG'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_NUM&nbsp;=&nbsp;L_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TEXT&nbsp;=&nbsp;'TEXT-'&nbsp;&&&nbsp;L_NUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;(L_TEXT)&nbsp;TO&nbsp;&lt;TEXT&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD_ALV:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;COMP_WA&gt;-NAME&nbsp;&lt;TEXT&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;P_1&nbsp;EQ&nbsp;ABAP_TRUE.&nbsp;&nbsp;&nbsp;"需求<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'MATNR_JH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'ZJS_JH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'ZKZ_JH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'ZKZFW_JH'.<br />
&nbsp;&nbsp;ELSE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'MATNR_PH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'ZJS_PH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'ZKZFW_PH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_FIELDCAT&nbsp;WHERE&nbsp;FIELDNAME&nbsp;=&nbsp;'ZZQH_PH'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;调整ALV显示布局<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;LS_LAYOUT.<br />
&nbsp;&nbsp;LS_LAYOUT-CWIDTH_OPT&nbsp;=&nbsp;ABAP_TRUE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"优化列宽设置<br />
&nbsp;&nbsp;LS_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LS_LAYOUT-SEL_MODE&nbsp;=&nbsp;'D'.<br />
&nbsp;&nbsp;LS_LAYOUT-BOX_FNAME&nbsp;=&nbsp;'FLAG'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"选择行头按钮<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;管理布局结构<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;LS_VARIANT.<br />
&nbsp;&nbsp;LS_VARIANT-REPORT&nbsp;=&nbsp;SY-REPID.<br />
&nbsp;&nbsp;LS_VARIANT-VARIANT&nbsp;=&nbsp;P_VARI&nbsp;.<br />
<br />
&nbsp;&nbsp;GV_LINES&nbsp;=&nbsp;LINES(&nbsp;IT_TABLE&nbsp;).<br />
&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'共有'&nbsp;GV_LINES&nbsp;'数据！'&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;调用ALV<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY_LVC'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'FM_GUI_STATUS'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;=&nbsp;'FM_USER_COMMAND'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_HTML_TOP_OF_PAGE&nbsp;=&nbsp;'HTML_TOP_OF_PAGE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"To-Do：确定是否需要Top&nbsp;Page<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_HTML_HEIGHT_TOP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"To-Do：确定Top&nbsp;Page的高度<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT_LVC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT_LVC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_VARIANT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_VARIANT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"保存布局<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"不能保存为缺省<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_TABLE[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'系统错误'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&设置ALV的GUI状态<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GUI_STATUS USING P_EXTAB TYPE SLIS_T_EXTAB.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;P_EXTAB&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&RNT_PREV'&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"填写不显示的功能码<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&AQW'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'%SL'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&INFO'&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;FCODE&nbsp;=&nbsp;'&VEXCEL'&nbsp;)&nbsp;).<br />
*&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'自己定义去'&nbsp;EXCLUDING&nbsp;P_EXTAB.<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;设置用户命令<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_USER_COMMAND USING RS_UCOMM    LIKE SY-UCOMM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;FREE&nbsp;L_GRID.<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;L_GRID.<br />
*&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;L_GRID-&gt;CHECK_CHANGED_DATA.<br />
*&nbsp;&nbsp;IF&nbsp;NOT&nbsp;L_GRID&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;L_GRID-&gt;REFRESH_TABLE_DISPLAY.&nbsp;"refresh&nbsp;alv<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;CASE&nbsp;RS_UCOMM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"捕捉用户动作<br />
*<br />
*&nbsp;&nbsp;&nbsp;WHEN&nbsp;''.<br />
*<br />
*&nbsp;&nbsp;ENDCASE.<br />
*<br />
**设置刷新<br />
*&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
**保证行、列位置在自动刷新时不变<br />
*&nbsp;&nbsp;RS_SELFIELD-COL_STABLE&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;RS_SELFIELD-ROW_STABLE&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;筛选辅助查询条件<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_DELETE_SEL.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;EXTWG&nbsp;&nbsp;&nbsp;NOT&nbsp;IN&nbsp;S_EXTWG[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;RAUBE&nbsp;&nbsp;&nbsp;NOT&nbsp;IN&nbsp;S_RAUBE[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;LIFNR&nbsp;&nbsp;&nbsp;NOT&nbsp;IN&nbsp;S_LIFNR[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;ZGJSCZ&nbsp;&nbsp;NOT&nbsp;IN&nbsp;S_ZGJSCZ[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;EX_PZ01&nbsp;NOT&nbsp;IN&nbsp;S_PZ01[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;EX_PZ02&nbsp;NOT&nbsp;IN&nbsp;S_PZ02[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;EX_PZ03&nbsp;NOT&nbsp;IN&nbsp;S_PZ03[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;EX_PZ04&nbsp;NOT&nbsp;IN&nbsp;S_PZ04[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;EX_PZ&nbsp;&nbsp;&nbsp;NOT&nbsp;IN&nbsp;S_PZ[].<br />
&nbsp;&nbsp;DELETE&nbsp;GT_OUT_TAB&nbsp;WHERE&nbsp;EX_YT&nbsp;&nbsp;&nbsp;NOT&nbsp;IN&nbsp;S_YT[].<br />
<br />
ENDFORM.<br />
<br />
FORM FM_GET_CHARACTERS TABLES IT_TABLE.<br />
<br />
&nbsp;&nbsp;DATA:BEGIN&nbsp;OF&nbsp;LS_ZMMRP0210_BATCH&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;&nbsp;&nbsp;TYPE&nbsp;MCHB-CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH&nbsp;TYPE&nbsp;ZMMRP0210_BATCH-EX_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LS_ZMMRP0210_BATCH&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZMMRP0210_BATCH&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_ZMMRP0210_BATCH.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;GS_SGM_INFO&nbsp;,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;MATNR,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;WERKS_D,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LGORT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LGORT_D,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH	TYPE&nbsp;ZDE_MMRP0210_XNKH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NTGEW	&nbsp;&nbsp;TYPE&nbsp;ENTGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WESCH	&nbsp;&nbsp;TYPE&nbsp;WESCH,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATAB&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;DATAB,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;GS_SGM_INFO&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;GT_SGM_INFO&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;GS_SGM_INFO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SGM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GT_SGM_INFO.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LV_BEGIN&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_END&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_TIMS&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_LINES&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MAX&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_STOCK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_STOCK,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARG_TEMP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CHARG_TEMP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;LT_CHARG_TEMP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARACTERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CHARACTERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM_CHARACTERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CHARACTERS_TEMP&nbsp;LIKE&nbsp;LT_CHARACTERS.<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;LS_STOCK&gt;&nbsp;TYPE&nbsp;STRU_STOCK.<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE[]&nbsp;TO&nbsp;LT_STOCK[].<br />
   </div>
   <div class="codeComment">
*&nbsp;取得虚拟款号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_ZMMRP0210_BATCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMRP0210_BATCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_STOCK<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_STOCK-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CHARG&nbsp;=&nbsp;LT_STOCK-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;LV_MAX&nbsp;=&nbsp;10000&nbsp;.<br />
&nbsp;&nbsp;LV_LINES&nbsp;=&nbsp;LINES(&nbsp;IT_TABLE&nbsp;).<br />
&nbsp;&nbsp;IF&nbsp;LV_LINES&nbsp;MOD&nbsp;LV_MAX&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_TIMS&nbsp;=&nbsp;LV_LINES&nbsp;DIV&nbsp;LV_MAX&nbsp;.&nbsp;"&nbsp;总共需要循环多少次<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_TIMS&nbsp;=&nbsp;LV_LINES&nbsp;DIV&nbsp;LV_MAX&nbsp;+&nbsp;1&nbsp;.&nbsp;"&nbsp;总共需要循环多少次<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DO&nbsp;LV_TIMS&nbsp;TIMES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;LT_CHARACTERS_TEMP,LT_CHARG_TEMP&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BEGIN&nbsp;=&nbsp;LV_MAX&nbsp;*&nbsp;(&nbsp;SY-INDEX&nbsp;-&nbsp;1&nbsp;)&nbsp;+&nbsp;1&nbsp;.&nbsp;"&nbsp;本次循环从内表GT_STOCK的哪一行开始<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-INDEX&nbsp;=&nbsp;LV_TIMS&nbsp;.&nbsp;"&nbsp;最后一次<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_END&nbsp;=&nbsp;LV_LINES&nbsp;.&nbsp;"&nbsp;本次循环从内表GT_STOCK的哪一行结束<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_END&nbsp;=&nbsp;LV_MAX&nbsp;*&nbsp;SY-INDEX&nbsp;.&nbsp;"&nbsp;本次循环从内表GT_STOCK的哪一行结束<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_STOCK&nbsp;ASSIGNING&nbsp;&lt;LS_STOCK&gt;&nbsp;FROM&nbsp;LV_BEGIN&nbsp;TO&nbsp;LV_END&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:LS_CHARG_TEMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CHARG_TEMP-MATNR&nbsp;=&nbsp;&lt;LS_STOCK&gt;-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CHARG_TEMP-CHARG&nbsp;=&nbsp;&lt;LS_STOCK&gt;-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&nbsp;LS_CHARG_TEMP&nbsp;TO&nbsp;LT_CHARG_TEMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_CHARG_TEMP&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_CHARG_TEMP&nbsp;COMPARING&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zsdrp0020_fm_01/zsdrp0020_fm_01.html">'ZSDRP0020_FM_01'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_CHARG_TEMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARACTERS&nbsp;=&nbsp;LT_CHARACTERS_TEMP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LINES&nbsp;OF&nbsp;LT_CHARACTERS_TEMP&nbsp;TO&nbsp;LT_CHARACTERS&nbsp;.<br />
&nbsp;&nbsp;ENDDO.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_ZMMRP0210_BATCH&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
&nbsp;&nbsp;SORT&nbsp;LT_CHARACTERS&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_STOCK&nbsp;ASSIGNING&nbsp;&lt;LS_STOCK&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZMMRP0210_BATCH&nbsp;INTO&nbsp;LS_ZMMRP0210_BATCH&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;LS_STOCK&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;&lt;LS_STOCK&gt;-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_STOCK&gt;-EX_XNKH&nbsp;=&nbsp;LS_ZMMRP0210_BATCH-EX_XNKH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_CHARACTERS&nbsp;INTO&nbsp;LS_CHARACTERS&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;LS_STOCK&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;&lt;LS_STOCK&gt;-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;LS_STOCK&gt;-MEINS&nbsp;=&nbsp;'ST'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_STOCK&gt;-WESCH&nbsp;=&nbsp;&lt;LS_STOCK&gt;-CLABS&nbsp;.&nbsp;&nbsp;&nbsp;"&nbsp;件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_STOCK&gt;-NTGEW&nbsp;=&nbsp;&lt;LS_STOCK&gt;-CLABS&nbsp;*&nbsp;LS_CHARACTERS-ZJZ&nbsp;.&nbsp;"&nbsp;克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CHARACTERS-ZJZ&nbsp;&lt;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_STOCK&gt;-WESCH&nbsp;=&nbsp;1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_STOCK&gt;-WESCH&nbsp;=&nbsp;&lt;LS_STOCK&gt;-CLABS&nbsp;/&nbsp;LS_CHARACTERS-ZJZ&nbsp;.&nbsp;&nbsp;&nbsp;"&nbsp;件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_STOCK&gt;-NTGEW&nbsp;=&nbsp;&lt;LS_STOCK&gt;-CLABS&nbsp;&nbsp;.&nbsp;"&nbsp;克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;LS_STOCK&gt;&nbsp;TO&nbsp;GS_SGM_INFO&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;GS_SGM_INFO&nbsp;INTO&nbsp;GT_SGM_INFO&nbsp;.&nbsp;"&nbsp;按键值汇总件数和克重<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_LINES_COLLECT&nbsp;=&nbsp;LV_LINES_COLLECT&nbsp;+&nbsp;1&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;GT_SGM_INFO&nbsp;BY&nbsp;EX_XNKH.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB&nbsp;ASSIGNING&nbsp;&lt;GS_OUT_TAB&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_SGM_INFO&nbsp;INTO&nbsp;GS_SGM&nbsp;WITH&nbsp;KEY&nbsp;EX_XNKH&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EX_XNKH_PH&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-ZJS&nbsp;=&nbsp;GS_SGM-WESCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-ZKZ&nbsp;=&nbsp;GS_SGM-NTGEW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;获取编码描述<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_BMMS.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_GJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_GJS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EXTWG&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_EXTWG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_RAUBE&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_RAUBE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EX_PZ01&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_EX_PZ01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EX_PZ02&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_EX_PZ02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EX_PZ03&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_EX_PZ03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EX_PZ04&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_EX_PZ04,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EX_PZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_EX_PZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EX_YT&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_EX_YT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MATNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_T_MATNR,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MATNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_LIFNR&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_GJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_GJS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EXTWG&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_EXTWG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RAUBE&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_RAUBE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EX_PZ01&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_EX_PZ01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EX_PZ02&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_EX_PZ02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EX_PZ03&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_EX_PZ03,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EX_PZ04&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_EX_PZ04,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EX_PZ&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_EX_PZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_EX_YT&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCBMS_TY_EX_YT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB&nbsp;ASSIGNING&nbsp;&lt;GS_OUT_TAB&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_1&nbsp;EQ&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MATNR-MATNR&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-MATNR_PH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_MATNR&nbsp;TO&nbsp;LT_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MATNR-MATNR&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-MATNR_JH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_MATNR&nbsp;TO&nbsp;LT_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_get_ms/zmm_get_ms.html">'ZMM_GET_MS'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_MATNR&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_LIFNR&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_ZGJSCZ&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EXTWG&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_RAUBE&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EX_PZ01&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EX_PZ02&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EX_PZ03&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EX_PZ04&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EX_PZ&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EX_YT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_MATNR&nbsp;&nbsp;&nbsp;=&nbsp;LT_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_LIFNR&nbsp;&nbsp;&nbsp;=&nbsp;LT_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_GJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_GJS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_EXTWG&nbsp;&nbsp;&nbsp;=&nbsp;LT_EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RAUBE&nbsp;&nbsp;&nbsp;=&nbsp;LT_RAUBE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_EX_PZ01&nbsp;=&nbsp;LT_EX_PZ01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_EX_PZ02&nbsp;=&nbsp;LT_EX_PZ02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_EX_PZ03&nbsp;=&nbsp;LT_EX_PZ03<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_EX_PZ04&nbsp;=&nbsp;LT_EX_PZ04<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_EX_PZ&nbsp;&nbsp;&nbsp;=&nbsp;LT_EX_PZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_EX_YT&nbsp;&nbsp;&nbsp;=&nbsp;LT_EX_YT.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_OUT_TAB&nbsp;ASSIGNING&nbsp;&lt;GS_OUT_TAB&gt;.<br />
   </div>
   <div class="codeComment">
*&nbsp;取商品款号描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_1&nbsp;EQ&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MATNR&nbsp;INTO&nbsp;LS_MATNR&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-MATNR_PH&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_MATNR&nbsp;=&nbsp;LS_MATNR-MS_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MATNR&nbsp;INTO&nbsp;LS_MATNR&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-MATNR_JH&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_MATNR&nbsp;=&nbsp;LS_MATNR-MS_MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;供应商描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_LIFNR&nbsp;INTO&nbsp;LS_LIFNR&nbsp;WITH&nbsp;KEY&nbsp;LIFNR&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-LIFNR&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_LIFNR&nbsp;=&nbsp;LS_LIFNR-MS_LIFNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;贵金属材质描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_GJS&nbsp;INTO&nbsp;LS_GJS&nbsp;WITH&nbsp;KEY&nbsp;EX_GJS&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-ZGJSCZ&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_GJS&nbsp;=&nbsp;LS_GJS-MS_GJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;大类描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EXTWG&nbsp;INTO&nbsp;LS_EXTWG&nbsp;WITH&nbsp;KEY&nbsp;EXTWG&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EXTWG&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_EXTWG&nbsp;=&nbsp;LS_EXTWG-MS_EXTWG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;小类描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_RAUBE&nbsp;INTO&nbsp;LS_RAUBE&nbsp;WITH&nbsp;KEY&nbsp;RAUBE&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-RAUBE&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_RAUBE&nbsp;=&nbsp;LS_RAUBE-MS_RAUBE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;品种1级描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EX_PZ01&nbsp;INTO&nbsp;LS_EX_PZ01&nbsp;WITH&nbsp;KEY&nbsp;EX_PZ01&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EX_PZ01&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_EX_PZ01&nbsp;=&nbsp;LS_EX_PZ01-MS_PZ01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;品种2级描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EX_PZ02&nbsp;INTO&nbsp;LS_EX_PZ02&nbsp;WITH&nbsp;KEY&nbsp;EX_PZ02&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EX_PZ02&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_EX_PZ02&nbsp;=&nbsp;LS_EX_PZ02-MS_PZ02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;品种3级描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EX_PZ03&nbsp;INTO&nbsp;LS_EX_PZ03&nbsp;WITH&nbsp;KEY&nbsp;EX_PZ03&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EX_PZ03&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_EX_PZ03&nbsp;=&nbsp;LS_EX_PZ03-MS_PZ03.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;品种4级描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EX_PZ04&nbsp;INTO&nbsp;LS_EX_PZ04&nbsp;WITH&nbsp;KEY&nbsp;EX_PZ04&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EX_PZ04&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_EX_PZ04&nbsp;=&nbsp;LS_EX_PZ04-MS_PZ04.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;品质描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EX_PZ&nbsp;INTO&nbsp;LS_EX_PZ&nbsp;WITH&nbsp;KEY&nbsp;EX_PZ&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EX_PZ&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_EX_PZ&nbsp;=&nbsp;LS_EX_PZ-MS_PZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;用途描述<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EX_YT&nbsp;INTO&nbsp;LS_EX_YT&nbsp;WITH&nbsp;KEY&nbsp;EX_YT&nbsp;=&nbsp;&lt;GS_OUT_TAB&gt;-EX_YT&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;GS_OUT_TAB&gt;-MS_EX_YT&nbsp;=&nbsp;LS_EX_YT-MS_YT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM .<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;状态显示<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_STATUS USING I_TXT.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'SAPGUI_PROGRESS_INDICATOR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT&nbsp;=&nbsp;I_TXT.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;排除冲销数据<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_CAL_CXSJ TABLES IT_TABLE.<br />
<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_0050,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR_JH&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-MATNR,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货商品号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_XNKH_PH&nbsp;TYPE&nbsp;ZMM_DELEVRESULT-EX_XNKH_PH,&nbsp;"虚拟款号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJS_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-JS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZKZ_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_ITEM-KZ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"拣货克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMRP0050_HEAD-VBELN_DN,&nbsp;&nbsp;&nbsp;&nbsp;"交货单号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_0050,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;STRU_VBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBELN&nbsp;TYPE&nbsp;ZMMRP0050_HEAD-VBELN_DN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WADAT&nbsp;TYPE&nbsp;LIKP-WADAT_IST,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_VBELN.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_VBELN&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_VBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_VBELN&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_VBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_WADAT_IST&nbsp;TYPE&nbsp;LIKP-WADAT_IST,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RT_VBELN&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;ZMMRP0050_HEAD-VBELN_DN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_VBELN&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;RT_VBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_0050&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_0050,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_TMP_0050&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_0050,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_0050&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_0050.<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE[]&nbsp;TO&nbsp;LT_0050[].<br />
&nbsp;&nbsp;LT_TMP_0050&nbsp;=&nbsp;LT_0050.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_TMP_0050&nbsp;BY&nbsp;VBELN.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_TMP_0050&nbsp;COMPARING&nbsp;VBELN.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_TMP_0050&nbsp;INTO&nbsp;LS_0050.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_WADAT_IST.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;WADAT_IST<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_WADAT_IST<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LIKP<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;VBELN&nbsp;=&nbsp;LS_0050-VBELN.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_WADAT_IST&nbsp;EQ&nbsp;'00000000'.&nbsp;"如果符合条件则说明已经冲销或未收货<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;RS_VBELN.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_VBELN-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_VBELN-OPTION&nbsp;=&nbsp;'EQ'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_VBELN-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-VBELN.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;RS_VBELN&nbsp;TO&nbsp;RT_VBELN.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;VBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WADAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LIKP<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;LT_VBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_TMP_0050<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;VBELN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_TMP_0050-VBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;WADAT_IST&nbsp;=&nbsp;'00000000'.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_VBELN&nbsp;INTO&nbsp;LS_VBELN.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_VBELN-WADAT&nbsp;=&nbsp;'00000000'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;RS_VBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_VBELN-SIGN&nbsp;&nbsp;&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_VBELN-OPTION&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_VBELN-LOW&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_0050-VBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;RS_VBELN&nbsp;TO&nbsp;RT_VBELN.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;RT_VBELN&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;LT_0050&nbsp;WHERE&nbsp;VBELN&nbsp;IN&nbsp;RT_VBELN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;IT_TABLE[].<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LT_0050[]&nbsp;TO&nbsp;IT_TABLE[].<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*Text&nbsp;elements<br />
*----------------------------------------------------------<br />
*&nbsp;001&nbsp;需求商品号<br />
*&nbsp;002&nbsp;拣货商品号<br />
*&nbsp;003&nbsp;需求件数<br />
*&nbsp;004&nbsp;拣货件数<br />
*&nbsp;005&nbsp;拣货克重<br />
*&nbsp;006&nbsp;库存件数<br />
*&nbsp;007&nbsp;库存克重<br />
*&nbsp;008&nbsp;需求款克重范围<br />
*&nbsp;009&nbsp;拣货款克重范围<br />
*&nbsp;010&nbsp;需求款指圈号<br />
*&nbsp;011&nbsp;供应商代码<br />
*&nbsp;012&nbsp;贵金属材质<br />
*&nbsp;013&nbsp;商品大类<br />
*&nbsp;014&nbsp;小类<br />
*&nbsp;015&nbsp;品种一级<br />
*&nbsp;016&nbsp;品种二级<br />
*&nbsp;017&nbsp;品种三级<br />
*&nbsp;018&nbsp;品种四级<br />
*&nbsp;019&nbsp;品质<br />
*&nbsp;020&nbsp;用途<br />
*&nbsp;021&nbsp;虚拟款号<br />
*&nbsp;022&nbsp;商品款号描述<br />
*&nbsp;023&nbsp;供应商描述<br />
*&nbsp;024&nbsp;贵金属材质描述<br />
*&nbsp;025&nbsp;大类描述<br />
*&nbsp;026&nbsp;小类描述<br />
*&nbsp;027&nbsp;品种1级描述<br />
*&nbsp;028&nbsp;品种2级描述<br />
*&nbsp;029&nbsp;品种3级描述<br />
*&nbsp;030&nbsp;品种4级描述<br />
*&nbsp;031&nbsp;品质描述<br />
*&nbsp;032&nbsp;用途描述<br />
*&nbsp;T01&nbsp;输入主要查询条件<br />
*&nbsp;T02&nbsp;输入自定义布局<br />
*&nbsp;T03&nbsp;输入辅助属性查询条件<br />
<br />
<br />
*Selection&nbsp;texts<br />
*----------------------------------------------------------<br />
*&nbsp;P_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;按需求款号查询<br />
*&nbsp;P_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;按拣货款号查询<br />
*&nbsp;P_VARI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;选择布局<br />
*&nbsp;S_DATE1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;需求时间<br />
*&nbsp;S_DATE2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;拣货时间<br />
*&nbsp;S_EXTWG&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_KZF_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;拣货克重范围编码<br />
*&nbsp;S_KZF_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;需求克重范围编码<br />
*&nbsp;S_LIFNR&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_MAT_JH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;拣货款号<br />
*&nbsp;S_MAT_PH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;需求款号<br />
*&nbsp;S_PZ&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_PZ01&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_PZ02&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_PZ03&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_PZ04&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_RAUBE&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_YT&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;S_ZGJSCZ&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
<br />
*Messages<br />
*----------------------------------------------------------<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;00<br />
*001&nbsp;&nbsp;&nbsp;&1&2&3&4&5&6&7&8<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;ZCB<br />
*000&nbsp;&nbsp;&nbsp;&1&2&3&4<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
