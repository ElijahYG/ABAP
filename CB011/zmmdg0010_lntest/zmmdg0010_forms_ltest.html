<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZMMDG0010_FORMS_LTEST</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMDG0010_FORMS_LTEST</h2>
<h3> Description: Include ZMMDG0010_FORMS</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;包含&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMDG0010_FORMS<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_BUILD_FIELDCAT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_BUILD_FIELDCAT CHANGING PT_FIELDCAT TYPE LVC_T_FCAT.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;LS_FCAT&nbsp;TYPE&nbsp;LVC_S_FCAT.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-DYNNR&nbsp;=&nbsp;'9100'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'LVC_FIELDCATALOG_MERGE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BUFFER_ACTIVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_STRUCTURE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZMMDG0010_ALV_S01'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CLIENT_NEVER_DISPLAY&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BYPASSING_BUFFER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_INTERNAL_TABNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCONSISTENT_INTERFACE&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'LVC_FIELDCATALOG_MERGE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BUFFER_ACTIVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_STRUCTURE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZMMDG0010_ALV_S02'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CLIENT_NEVER_DISPLAY&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BYPASSING_BUFFER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_INTERNAL_TABNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCONSISTENT_INTERFACE&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;PT_FIELDCAT&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;PT_FIELDCAT&nbsp;INTO&nbsp;LS_FCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_FCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'MATNR'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'EBELN'&nbsp;&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'MBLNR'&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-HOTSPOT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;EQ&nbsp;'CHARG'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-EDIT&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-EDIT&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;EQ&nbsp;'ZHXM'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'ZFPH'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'EBELN'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'EBELP'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'BLDAT'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'BUDAT'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'MBLNR'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'MJAHR'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;'ZEILE'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-FIX_COLUMN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-EDIT&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-OUTPUTLEN&nbsp;=&nbsp;LS_FCAT-INTLEN&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_FCAT-REF_FIELD&nbsp;=&nbsp;&nbsp;LS_FCAT-FIELDNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;PT_FIELDCAT&nbsp;FROM&nbsp;LS_FCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CREATE_ALV<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_GT_OUTTAB&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_GT_FIELDCAT&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_GS_LAYOUT&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_CREATE_ALV   CHANGING PT_OUTTAB LIKE &lt;DYN_TABLE&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PT_FIELDCAT&nbsp;TYPE&nbsp;LVC_T_FCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PS_LAYOUT&nbsp;TYPE&nbsp;LVC_S_LAYO.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_EXCLUDE&nbsp;TYPE&nbsp;UI_FUNCTIONS.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;&nbsp;G_EVENT_RECEIVER&nbsp;IS&nbsp;&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_EVENT_RECEIVER.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
****&nbsp;&nbsp;fieldcat<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_BUILD_FIELDCAT&nbsp;CHANGING&nbsp;PT_FIELDCAT.<br />
<br />
   </div>
   <div class="codeComment">
****&nbsp;tollbutton<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;EXCLUDE_TB_FUNCTIONS&nbsp;CHANGING&nbsp;LT_EXCLUDE.<br />
<br />
<br />
&nbsp;&nbsp;GS_LAYOUT-CTAB_FNAME&nbsp;=&nbsp;'CELLCOLORS'.<br />
&nbsp;&nbsp;GS_LAYOUT-STYLEFNAME&nbsp;=&nbsp;'CELLTAB'.<br />
   </div>
   <div class="codeComment">
***************MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;&nbsp;2015.11.20&nbsp;START&nbsp;*******************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;GS_LAYOUT-SEL_MODE&nbsp;&nbsp;&nbsp;=&nbsp;'D'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"选择方式，任意多选<br />
   </div>
   <div class="codeComment">
***************MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;&nbsp;2015.11.20&nbsp;END&nbsp;&nbsp;&nbsp;*******************<br />
*&nbsp;&nbsp;gs_layout-cwidth_opt&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"优化列宽<br />
   </div>
   <div class="code">
&nbsp;&nbsp;G_VARIANT-REPORT&nbsp;&nbsp;=&nbsp;SY-REPID.<br />
&nbsp;&nbsp;G_VARIANT-VARIANT&nbsp;=&nbsp;L_VARI&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*贵金属界面<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;SY-DYNNR&nbsp;=&nbsp;'9100'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CONTAINER&nbsp;&nbsp;=&nbsp;'CONTROL01'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID&nbsp;IS&nbsp;&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_CUSTOM_CONTAINER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;G_CONTAINER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;G_CUSTOM_CONTAINER.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BUFFER_ACTIVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_VARIANT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;G_VARIANT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_FALSE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TOOLBAR_EXCLUDING&nbsp;=&nbsp;LT_EXCLUDE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_OUTTAB.<br />
<br />
   </div>
   <div class="codeComment">
*单元格响应修改<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;HANDLE_DATA_CHANGED&nbsp;FOR&nbsp;G_GRID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;TOOLBAR&nbsp;FOR&nbsp;G_GRID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;USER_COMMAND&nbsp;FOR&nbsp;G_GRID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;HANDLE_CELL_CLICK&nbsp;&nbsp;&nbsp;FOR&nbsp;G_GRID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;SET_TOOLBAR_INTERACTIVE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*镶嵌界面<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;&nbsp;SY-DYNNR&nbsp;=&nbsp;'9200'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CONTAINER&nbsp;&nbsp;=&nbsp;'CONTROL02'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID2&nbsp;IS&nbsp;&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_CUSTOM_CONTAINER2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;G_CONTAINER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_GRID2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;G_CUSTOM_CONTAINER2.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BUFFER_ACTIVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_VARIANT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;G_VARIANT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TOOLBAR_EXCLUDING&nbsp;=&nbsp;LT_EXCLUDE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_OUTTAB.<br />
<br />
   </div>
   <div class="codeComment">
*单元格响应修改<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;HANDLE_DATA_CHANGED&nbsp;FOR&nbsp;G_GRID2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;TOOLBAR&nbsp;FOR&nbsp;G_GRID2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;USER_COMMAND&nbsp;FOR&nbsp;G_GRID2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;HANDLE_CELL_CLICK&nbsp;&nbsp;&nbsp;FOR&nbsp;G_GRID2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;SET_TOOLBAR_INTERACTIVE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*入库<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;&nbsp;SY-DYNNR&nbsp;=&nbsp;'9300'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CONTAINER&nbsp;&nbsp;=&nbsp;'CONTROL03'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID3&nbsp;IS&nbsp;&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_CUSTOM_CONTAINER3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;G_CONTAINER.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;G_GRID3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;G_CUSTOM_CONTAINER3.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID3-&gt;SET_READY_FOR_INPUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_READY_FOR_INPUT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID3-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BUFFER_ACTIVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_VARIANT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;G_VARIANT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SAVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TOOLBAR_EXCLUDING&nbsp;=&nbsp;LT_EXCLUDE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_FIELDCAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_OUTTAB.<br />
<br />
   </div>
   <div class="codeComment">
*单元格响应修改<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID3-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;HANDLE_DATA_CHANGED&nbsp;FOR&nbsp;G_GRID3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;TOOLBAR&nbsp;FOR&nbsp;G_GRID3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;USER_COMMAND&nbsp;FOR&nbsp;G_GRID3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;&nbsp;&nbsp;G_EVENT_RECEIVER-&gt;HANDLE_CELL_CLICK&nbsp;&nbsp;&nbsp;FOR&nbsp;G_GRID3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID3-&gt;SET_TOOLBAR_INTERACTIVE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;EXCLUDE_TB_FUNCTIONS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_LT_EXCLUDE&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM EXCLUDE_TB_FUNCTIONS  CHANGING PT_EXCLUDE TYPE UI_FUNCTIONS.<br />
&nbsp;&nbsp;DATA&nbsp;LS_EXCLUDE&nbsp;TYPE&nbsp;UI_FUNC.<br />
<br />
<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_COPY_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_DELETE_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_APPEND_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_INSERT_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_MOVE_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_PRINT&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_PRINT_PREV&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_mb_export&nbsp;.<br />
*&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;pt_exclude.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_GRAPH&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_mb_view&nbsp;.<br />
*&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;pt_exclude.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_DETAIL&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_HELP&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
&nbsp;&nbsp;LS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_INFO&nbsp;.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_EXCLUDE&nbsp;TO&nbsp;PT_EXCLUDE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;MC_MB_VARIANT.<br />
*&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;pt_exclude.<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
"messdeta<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CHANGE_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_CHANGE_DATA .<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_ALV_EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_EDIT&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SAVE_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_SAVE_DATA .<br />
&nbsp;&nbsp;DATA:&nbsp;L_ZPH12&nbsp;&nbsp;TYPE&nbsp;NUM12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZPH&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;NUM13,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ANSWER&nbsp;TYPE&nbsp;C.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZMMDG0010&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMDG0010_01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMMDG0010&nbsp;TYPE&nbsp;ZMMDG0010_01.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;GT_MESSAGE,GS_MESSAGE.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;G_FLG_SAVE.<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_CHECK_DATA."检查数据<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZFPH&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_FLG_SAVE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;IF&nbsp;G_FLG_SAVE&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_CONFIRM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_QUESTION&nbsp;&nbsp;=&nbsp;'是否确认保存'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSWER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_ANSWER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_NOT_FOUND&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_ANSWER&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZFPH&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NUMBER_GET_NEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR&nbsp;=&nbsp;'01'&nbsp;&nbsp;"在编号范围中分配的序列号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZFPH'&nbsp;&nbsp;&nbsp;&nbsp;"编码对象名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_ZPH12.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"输出生成的流水号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmmif0060_fm/zmmif0060_fm.html">'ZMMIF0060_FM'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_INPUT&nbsp;&nbsp;=&nbsp;L_ZPH12<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_OUTPUT&nbsp;=&nbsp;L_ZPH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_FPH&nbsp;=&nbsp;L_ZPH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZPH&nbsp;=&nbsp;TXT_FPH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-EKORG&nbsp;=&nbsp;TXT_CGZZ."采购组织<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-EKGRP&nbsp;=&nbsp;TXT_CGZ."采购组<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-BUKRS&nbsp;=&nbsp;TXT_GSDM."公司代码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-WERKS&nbsp;=&nbsp;EKPO-WERKS."地点<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-LGORT&nbsp;=&nbsp;EKPO-LGORT."库位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZYWLX&nbsp;=&nbsp;TXT_YWLX."业务类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZLYJSFS&nbsp;=&nbsp;TXT_JSFS."结算方式<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZXSJGJLDW&nbsp;=&nbsp;TXT_XSJG."&nbsp;销售价格计算单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZYHID&nbsp;=&nbsp;SY-UNAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZRQ&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZLRSJ&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZFPH&nbsp;=&nbsp;L_ZPH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;GS_ZMMDG0010-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMDG0010_01&nbsp;FROM&nbsp;TABLE&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'信息录入成功'&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_EDIT&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'信息录入失败'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_MODIF_SCREEN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_MODIF_SCREEN .<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_ALV_EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TAB1'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'T1'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'T2'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-DYNNR&nbsp;=&nbsp;'0100'&nbsp;OR&nbsp;SY-DYNNR&nbsp;=&nbsp;'0200'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;SET_READY_FOR_INPUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_READY_FOR_INPUT&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;SET_READY_FOR_INPUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_READY_FOR_INPUT&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;SET_READY_FOR_INPUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_READY_FOR_INPUT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;G_GRID2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;SET_READY_FOR_INPUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_READY_FOR_INPUT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TAB1'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'T1'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'T2'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-DYNNR&nbsp;=&nbsp;'0100'&nbsp;OR&nbsp;SY-DYNNR&nbsp;=&nbsp;'0200'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_JCZLSH'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'ZMMDG0010_01-ZRQ'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'ZMMDG0010_01-ZYHID'<br />
&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'ZMMDG0010_01-ZZT'&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_ZLHJ'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_JSHJ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_BSHJ'&nbsp;&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_ZLXJ'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_JEXJ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_JSXJ'&nbsp;&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_BSXJ'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'ZMMDG0010_01-ZLRSJ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_FPH'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_CBHJ'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_LSHJ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_JCDZLHJ'&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_JCDJSHJ'&nbsp;&nbsp;OR&nbsp;SCREEN-NAME&nbsp;=&nbsp;'TXT_JCDBSHJ'&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-INPUT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_ENTER_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_READ_DATA .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;L_LEN&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:&nbsp;L_TM2&nbsp;TYPE&nbsp;CHAR2.<br />
&nbsp;&nbsp;DATA:&nbsp;L_TLIN1&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TLIN2&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_GJSXX&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMRP0080_GJSXX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_GJSXX&nbsp;TYPE&nbsp;ZMMRP0080_GJSXX.<br />
&nbsp;&nbsp;DATA:&nbsp;L_MSG&nbsp;TYPE&nbsp;STRING.<br />
<br />
&nbsp;&nbsp;RANGES:S_ZJSZBM&nbsp;FOR&nbsp;ZMMRP0080_GJSXX-ZJSZBM.<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;LS_ZJSZBM&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;S_ZJSZBM.<br />
&nbsp;&nbsp;DATA:&nbsp;L_SQL_FIELD&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZMMDG0010&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;&nbsp;ZMMDG0010_01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMMDG0010&nbsp;TYPE&nbsp;&nbsp;ZMMDG0010_01.<br />
<br />
<br />
   </div>
   <div class="codeComment">
***动态SQL<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DEFINE&nbsp;&nbsp;MACRO_DYNPRO_SQL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_GJSXX&nbsp;FROM&nbsp;ZMMRP0080_GJSXX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;(&1).<br />
<br />
&nbsp;&nbsp;END-OF-DEFINITION.<br />
<br />
&nbsp;&nbsp;CONDENSE&nbsp;TXT_TM&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;L_LEN&nbsp;=&nbsp;STRLEN(&nbsp;TXT_TM&nbsp;).<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR:&nbsp;&lt;DYN_TABLE&gt;,&lt;DYN_WA&gt;.<br />
<br />
*条码检查&nbsp;只有数字<br />
<br />
*&nbsp;&nbsp;matcher&nbsp;=&nbsp;cl_abap_matcher=&gt;create(&nbsp;pattern&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'\d+'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;TXT_TM&nbsp;).<br />
*&nbsp;&nbsp;match&nbsp;=&nbsp;matcher-&gt;match(&nbsp;).<br />
*&nbsp;&nbsp;IF&nbsp;match&nbsp;&lt;&gt;&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'条码格式有误,不可有数字外的字符'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;TXT_TM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXIT&nbsp;.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
*条码长度检查<br />
*&nbsp;&nbsp;IF&nbsp;&nbsp;l_len&nbsp;=&nbsp;13&nbsp;and&nbsp;TXT_JCZBM&nbsp;IS&nbsp;INITIAL.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;TXT_TM&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TM2&nbsp;=&nbsp;TXT_TM+0(1).<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;条码分类<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&nbsp;L_TM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'5'&nbsp;OR&nbsp;'7'.&nbsp;"商品包码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SQL_FIELD&nbsp;=&nbsp;'ZSPBM'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZSPBM&nbsp;=&nbsp;TXT_TM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_GJSXX&nbsp;FROM&nbsp;ZMMRP0080_GJSXX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZSPBM&nbsp;=&nbsp;TXT_TM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ZMMDG0010&nbsp;IS&nbsp;&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GT_GJSXX&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_GJSXX&nbsp;INTO&nbsp;GS_GJSXX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_GJSXX&nbsp;TO&nbsp;LS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;&nbsp;LT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;LINES&nbsp;L_TLIN1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;GT_GJSXX&nbsp;LINES&nbsp;L_TLIN2.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TLIN1&nbsp;=&nbsp;&nbsp;L_TLIN2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_EDIT&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;TXT_TM&nbsp;'此商品包码已经部分录入，请检查！'&nbsp;INTO&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;L_MSG&nbsp;TYPE&nbsp;'S'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'6'&nbsp;OR&nbsp;'2'."商品标签条码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SQL_FIELD&nbsp;=&nbsp;'ZSPTM'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZSPTM&nbsp;=&nbsp;TXT_TM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ZMMDG0010&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_GJSXX&nbsp;FROM&nbsp;ZMMRP0080_GJSXX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZSPTM&nbsp;=&nbsp;TXT_TM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GT_GJSXX&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_GJSXX&nbsp;INTO&nbsp;GS_GJSXX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_GJSXX&nbsp;TO&nbsp;LS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;&nbsp;LT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'4'."&nbsp;分配号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SQL_FIELD&nbsp;=&nbsp;'ZFPH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZFPH&nbsp;=&nbsp;TXT_TM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;else.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'条码格式有误，长度不符'&nbsp;type&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;TXT_TM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;exit.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
<br />
<br />
<br />
*&nbsp;检测站编码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;TXT_JCZBM&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"单值<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_ZJSZBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZJSZBM-SIGN&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZJSZBM-OPTION&nbsp;=&nbsp;'CP'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZJSZBM-LOW&nbsp;=&nbsp;TXT_JCZBM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZJSZBM&nbsp;TO&nbsp;S_ZJSZBM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;TXT_TM&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZJSZBM&nbsp;IN&nbsp;S_ZJSZBM&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_GJSXX&nbsp;FROM&nbsp;ZMMRP0080_GJSXX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;&nbsp;ZJSZBM&nbsp;IN&nbsp;S_ZJSZBM&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;LS_WHERE&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;L_SQL_FIELD&nbsp;NE&nbsp;'ZFPH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'&nbsp;ZJSZBM&nbsp;'&nbsp;'&nbsp;IN&nbsp;'&nbsp;'&nbsp;S_ZJSZBM&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SQL_FIELD&nbsp;'&nbsp;EQ&nbsp;'&nbsp;'&nbsp;TXT_TM&nbsp;'&nbsp;INTO&nbsp;LS_WHERE&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
   </div>
   <div class="codeComment">
****动态SQL<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MACRO_DYNPRO_SQL:&nbsp;LS_WHERE&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_ZMMDG0010&nbsp;IS&nbsp;&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GT_GJSXX&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_GJSXX&nbsp;INTO&nbsp;GS_GJSXX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_GJSXX&nbsp;TO&nbsp;LS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;&nbsp;LT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;检测站编码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;TXT_PO&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;TXT_PO.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*批次号重复录入<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;FLG_CHARG&nbsp;TYPE&nbsp;C,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_ZFPH&nbsp;&nbsp;TYPE&nbsp;C,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_GYSDM&nbsp;TYPE&nbsp;C.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_ZMMDG0010&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZMMDG0010&nbsp;INTO&nbsp;LS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;WITH&nbsp;KEY&nbsp;CHARG&nbsp;=&nbsp;LS_ZMMDG0010-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_CHARG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;WITH&nbsp;KEY&nbsp;ZFPH&nbsp;=&nbsp;LS_ZMMDG0010-ZFPH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_ZFPH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;WITH&nbsp;KEY&nbsp;ZGYSDM&nbsp;=&nbsp;LS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_GYSDM&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;FLG_GYSDM&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'&nbsp;供应商信息不一致，请检查！'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;FLG_ZFPH&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'&nbsp;分配号不一致，请检查！'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;FLG_CHARG&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'&nbsp;批次号重复录入，请检查！'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;LT_ZSPBM&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPBM&nbsp;TYPE&nbsp;ZMMDG0010_01-ZSPBM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LT_ZSPBM.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;LT_ZMMDG0010&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:TXT_BSXJ,TXT_ZLXJ,TXT_JSXJ,TXT_BSXJ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_ZMMDG0010&nbsp;BY&nbsp;ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;LT_ZMMDG0010&nbsp;INTO&nbsp;LS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;LT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_ZLXJ&nbsp;=&nbsp;TXT_ZLXJ&nbsp;+&nbsp;LS_ZMMDG0010-ZSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZSPBM&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;NEW&nbsp;ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_BSXJ&nbsp;=&nbsp;&nbsp;TXT_BSXJ&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;LINES&nbsp;TXT_JSXJ.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;合计小计处理<br />
*--------------------------------------------------------------------*<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;LINES&nbsp;TXT_JSHJ.<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*检查录入数据<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;IS&nbsp;INITIAL&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'没有符合的数据'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_ZMMDG0010&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;WHERE&nbsp;ZFPH&nbsp;IS&nbsp;&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_EDIT&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_FPH&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZFPH&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_YWLX&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZYWLX&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_JSFS&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZLYJSFS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_XSJG&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXSJGJLDW&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_CGZZ&nbsp;=&nbsp;GS_ZMMDG0010-EKORG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_CGZ&nbsp;=&nbsp;GS_ZMMDG0010-EKGRP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_GSDM&nbsp;=&nbsp;GS_ZMMDG0010-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKPO-WERKS&nbsp;=&nbsp;GS_ZMMDG0010-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKPO-LGORT&nbsp;=&nbsp;GS_ZMMDG0010-LGORT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-MBLNR&nbsp;IS&nbsp;NOT&nbsp;&nbsp;INITIAL&nbsp;OR&nbsp;GS_ZMMDG0010-EBELN&nbsp;IS&nbsp;&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;GT_ZSPBM,&nbsp;TXT_BSHJ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_ZLHJ&nbsp;=&nbsp;TXT_ZLHJ&nbsp;+&nbsp;&nbsp;GS_ZMMDG0010-ZJZ."&nbsp;重量合计<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;NEW&nbsp;ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_BSHJ&nbsp;=&nbsp;TXT_BSHJ&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'此单据已经创建PO或已入库，无法编辑'&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_BUTTON_CLOSE&nbsp;=&nbsp;'X'."单据完成按钮<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_BUTTON_CLOSE&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR:TXT_PO,&nbsp;TXT_TM,&nbsp;TXT_JCZBM.<br />
<br />
<br />
<br />
<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_EXPORT_IMPORT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*--------------------------------------&nbsp;--------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_EXPORT_IMPORT .<br />
&nbsp;&nbsp;DATA:&nbsp;LV_MESSAGE&nbsp;&nbsp;TYPE&nbsp;STRING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_INDEX&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-INDEX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_RC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_FILETABLE&nbsp;TYPE&nbsp;FILETABLE.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_GUI_FRONTEND_SERVICES=&gt;FILE_OPEN_DIALOG<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WINDOW_TITLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'选择数据文件'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_FILTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'EXCEL文件|*.XLSX;*.XLS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MULTISELECTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SPACE<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;I_FILETABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;I_RC<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_OPEN_DIALOG_FAILED&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CNTL_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ERROR_NO_GUI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT_SUPPORTED_BY_GUI&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;AND&nbsp;I_RC&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;I_FILETABLE&nbsp;INTO&nbsp;G_FILENM&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'没有选择文件或是选择文件错误！'&nbsp;&nbsp;TYPE&nbsp;'S'&nbsp;&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*PERFORM&nbsp;FM_READ_EXCEL&nbsp;USING&nbsp;p_filenm&nbsp;LT_DATA.<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FILE&nbsp;&nbsp;TYPE&nbsp;RLGRAP-FILENAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_LINE&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;DATA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TAB&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ALSMEX_TABLINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_TAB&nbsp;&nbsp;TYPE&nbsp;ALSMEX_TABLINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;O_EXCEL&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;TY_EXCEL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DATA&nbsp;TYPE&nbsp;TY_EXCEL.<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LINE&gt;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;CREATE&nbsp;DATA&nbsp;LW_LINE&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;ASSIGN&nbsp;LW_LINE-&gt;*&nbsp;TO&nbsp;&lt;LINE&gt;.<br />
&nbsp;&nbsp;L_FILE&nbsp;=&nbsp;G_FILENM.<br />
&nbsp;&nbsp;TRANSLATE&nbsp;L_FILE&nbsp;TO&nbsp;UPPER&nbsp;CASE.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'ALSM_EXCEL_TO_INTERNAL_TABLE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILENAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_FILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BEGIN_COL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_BEGIN_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_END_COL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;250<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_END_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;65536<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTERN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_TAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCONSISTENT_PARAMETERS&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPLOAD_OLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'上传文件有误！'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'上传文件有误！'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;LT_TAB&nbsp;WHERE&nbsp;ROW&nbsp;=&nbsp;1.&nbsp;&nbsp;"删除字段名行<br />
<br />
&nbsp;&nbsp;REFRESH:<br />
&nbsp;&nbsp;&nbsp;&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_TAB&nbsp;INTO&nbsp;LW_TAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;CHANGE&nbsp;OF&nbsp;LW_TAB-ROW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-TABIX&nbsp;NE&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;&lt;LINE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDON.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;LW_TAB-COL&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;TRY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;=&nbsp;LW_TAB-VALUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;CX_ROOT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'上传文件的列多于接收内表的列'&nbsp;SPACE&nbsp;SPACE&nbsp;SPACE.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'上传文件的列多于接收内表的列'&nbsp;TYPE&nbsp;'E'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDTRY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;LAST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;O_EXCEL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;O_EXCEL&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'上传文件为空'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ZMMEX0010&nbsp;TYPE&nbsp;ZMMEX0010_MARA.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_ZHXM&nbsp;TYPE&nbsp;NUM5&nbsp;VALUE&nbsp;10.<br />
&nbsp;&nbsp;CLEAR:GT_ZMMDG0010[],GT_ZMMDG0010,GS_ZMMDG0010,&lt;DYN_TABLE&gt;,&lt;DYN_WA&gt;.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;O_EXCEL&nbsp;INTO&nbsp;LW_DATA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZHXM&nbsp;=&nbsp;LV_ZHXM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;LW_DATA&nbsp;TO&nbsp;GS_ZMMDG0010.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_ZMMEX0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_ZMMEX0010&nbsp;FROM&nbsp;ZMMEX0010_MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ZMMEX0010&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;GS_ZMMDG0010-ZGJSCZ&nbsp;&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZGJSCZ&nbsp;=&nbsp;LS_ZMMEX0010-EX_GJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZXSKGFD&nbsp;=&nbsp;LS_ZMMEX0010-EX_JJJB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZSLDW&nbsp;=&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZSLDW&nbsp;&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQZSZLDW&nbsp;=&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZXQZSZLDW&nbsp;&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSZLDW1&nbsp;=&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSZLDW1&nbsp;&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSZLDW2&nbsp;=&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSZLDW2&nbsp;&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSZLDW3&nbsp;=&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSZLDW3&nbsp;&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSZLDW4&nbsp;=&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSZLDW4&nbsp;&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-ZGYSDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;GS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;TXT_LSHJ&nbsp;=&nbsp;TXT_LSHJ&nbsp;+&nbsp;&nbsp;GS_ZMMDG0010-ZCKLSJ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;TXT_CBHJ&nbsp;=&nbsp;TXT_CBHJ&nbsp;+&nbsp;&nbsp;GS_ZMMDG0010-ZCGJG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZLSZJE&nbsp;=&nbsp;GS_ZMMDG0010-ZCKLSJ&nbsp;*&nbsp;GS_ZMMDG0010-ZSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_ZHXM&nbsp;&nbsp;=&nbsp;&nbsp;LV_ZHXM&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_MODIF_FIELDCAT."根据价格表修改FIELDCAT<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ALV02&nbsp;TYPE&nbsp;ZMMDG0010_01.<br />
&nbsp;&nbsp;IF&nbsp;GS_PMZD-ZCGJG&nbsp;=&nbsp;'4'.&nbsp;"&nbsp;(（采购克工费+采购克附加费）*采购数量+采购件附加费&nbsp;)&nbsp;/&nbsp;数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJG&nbsp;=&nbsp;(&nbsp;(&nbsp;LS_ALV02-ZCGKDJ&nbsp;+&nbsp;LS_ALV02-ZCGKGF&nbsp;+&nbsp;LS_ALV02-ZCGGFJF&nbsp;)&nbsp;*&nbsp;LS_ALV02-ZSL&nbsp;+&nbsp;LS_ALV02-ZCGJFJF&nbsp;)&nbsp;/&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;REFRESH_TABLE_DISPLAY.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_GRID2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;REFRESH_TABLE_DISPLAY.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_DOWN_MOD<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_DOWN_MOD USING C_FULLPATH I_NAME.<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_DEFAULT&nbsp;&nbsp;TYPE&nbsp;STRING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FILENAME&nbsp;TYPE&nbsp;STRING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FULLPATH&nbsp;TYPE&nbsp;STRING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;L_DEFAULT&nbsp;=&nbsp;I_NAME.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_GUI_FRONTEND_SERVICES=&gt;FILE_SAVE_DIALOG&nbsp;"调用保存对话框<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_EXTENSION&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'XLS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_FILE_NAME&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_DEFAULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILENAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_FILENAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_PATH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FULLPATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_FULLPATH<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CNTL_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ERROR_NO_GUI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOT_SUPPORTED_BY_GUI&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;C_FULLPATH&nbsp;=&nbsp;L_FULLPATH.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FM_GET_TEMPLATE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_0072&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_G_PATH&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FM_GET_TEMPLATE  USING I_OBJID I_PATH.<br />
   </div>
   <div class="codeComment">
*&nbsp;取模板<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_OBJID&nbsp;&nbsp;TYPE&nbsp;W3OBJID,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_RC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_PATH&nbsp;&nbsp;&nbsp;TYPE&nbsp;RLGRAP-FILENAME,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_ERRTXT&nbsp;TYPE&nbsp;CHAR200,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LW_DATA&nbsp;&nbsp;TYPE&nbsp;WWWDATATAB.<br />
<br />
&nbsp;&nbsp;L_OBJID&nbsp;=&nbsp;I_OBJID.<br />
&nbsp;&nbsp;L_PATH&nbsp;&nbsp;=&nbsp;I_PATH.<br />
   </div>
   <div class="codeComment">
*&nbsp;取模板的内部存储数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;RELID&nbsp;OBJID<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;WWWDATA<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;LW_DATA<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;SRTF2&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;RELID&nbsp;=&nbsp;'MI'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;OBJID&nbsp;=&nbsp;L_OBJID.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;调用函数下载模板<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'DOWNLOAD_WEB_OBJECT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LW_DATA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESTINATION&nbsp;=&nbsp;L_PATH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_RC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_RC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'模板文件：'&nbsp;L_OBJID&nbsp;'下载失败'&nbsp;INTO&nbsp;L_ERRTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;L_ERRTXT&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'模板文件：'&nbsp;L_OBJID&nbsp;'不存在'&nbsp;INTO&nbsp;L_ERRTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;L_ERRTXT&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_MODIF_FIELDCAT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_MODIF_FIELDCAT .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ALV01&nbsp;TYPE&nbsp;TY_OUTTAB.<br />
&nbsp;&nbsp;DATA:&nbsp;L_DFIELD&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_FCAT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CELLTAB&nbsp;TYPE&nbsp;LVC_T_STYL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_INDEX&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ST1&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;TY_ST1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1&nbsp;TYPE&nbsp;TY_ST1.<br />
&nbsp;&nbsp;DATA:&nbsp;L_UNIT&nbsp;TYPE&nbsp;CHAR3."外部单位<br />
&nbsp;&nbsp;DATA:&nbsp;L_MSG&nbsp;&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA:CL_DESCR&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_ABAP_STRUCTDESCR.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&lt;FS_COMP&gt;&nbsp;TYPE&nbsp;ABAP_COMPDESCR.<br />
&nbsp;&nbsp;FIELD-SYMBOLS&nbsp;&lt;FS_NAME&gt;&nbsp;TYPE&nbsp;ANY.<br />
&nbsp;&nbsp;DATA:&nbsp;LW_LINE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;DATA.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LINE&gt;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS2&gt;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;DYN_LTABLE&gt;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE.<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;DATA&nbsp;LW_LINE&nbsp;LIKE&nbsp;&nbsp;GS_PMZD.<br />
&nbsp;&nbsp;ASSIGN&nbsp;LW_LINE-&gt;*&nbsp;TO&nbsp;&lt;LINE&gt;.<br />
   </div>
   <div class="codeComment">
**************************************<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;G_ALV_EDIT&nbsp;&lt;&gt;'X'&nbsp;OR&nbsp;&lt;DYN_TABLE&gt;&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;根据条件表进行判断字段属性<br />
   </div>
   <div class="code">
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'ZSLDW'&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS&gt;&nbsp;=&nbsp;'PC'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_CUNIT_OUTPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&lt;FS&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LANGUAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LONG_TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_UNIT<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHORT_TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIT_NOT_FOUND&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;READ&nbsp;&nbsp;TABLE&nbsp;GT_PMZD&nbsp;INTO&nbsp;GS_PMZD&nbsp;WITH&nbsp;KEY&nbsp;ZYWLX&nbsp;=&nbsp;TXT_YWLX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZJSFS&nbsp;=&nbsp;TXT_JSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZXSJGJSDW&nbsp;=&nbsp;TXT_XSJG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZCGDW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;L_UNIT.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'业务类型:'&nbsp;TXT_YWLX&nbsp;',结算方式:'&nbsp;&nbsp;TXT_JSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;',销售价格单位'&nbsp;TXT_XSJG&nbsp;',&nbsp;采购单位'&nbsp;L_UNIT&nbsp;&nbsp;'&nbsp;没有在配置表‘ZMMDG0010_PMZD’&nbsp;进行维护'INTO&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;L_MSG&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;读取结构字段名位置<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CL_DESCR&nbsp;?=&nbsp;CL_ABAP_TYPEDESCR=&gt;DESCRIBE_BY_DATA(&nbsp;GS_PMZD&nbsp;).<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;CL_DESCR-&gt;COMPONENTS&nbsp;ASSIGNING&nbsp;&lt;FS_COMP&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1-F1&nbsp;=&nbsp;SY-TABIX&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1-F2&nbsp;=&nbsp;&lt;FS_COMP&gt;-NAME.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ST1&nbsp;TO&nbsp;LT_ST1.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;GT_FIELD&nbsp;=&nbsp;LT_ST1.<br />
<br />
<br />
&nbsp;&nbsp;&lt;LINE&gt;&nbsp;=&nbsp;GS_PMZD.<br />
&nbsp;&nbsp;FREE:&nbsp;GT_CELLCOLORS,&nbsp;GT_ALVTAB.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_INDEX&nbsp;=&nbsp;SY-TABIX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GT_ALVTAB&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ST1&nbsp;INTO&nbsp;LS_ST1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;LS_ST1-F1&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_CELLTAB&nbsp;USING&nbsp;'READ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1-F2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_CELLTAB&nbsp;USING&nbsp;'EDIT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1-F2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LT_CELLTAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'3'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_CELLTAB&nbsp;USING&nbsp;'REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1-F2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LT_CELLTAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'4'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_CELLTAB&nbsp;USING&nbsp;'READ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1-F2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_FILL_CELLTAB&nbsp;USING&nbsp;'READ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ST1-F2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LT_CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LINES&nbsp;OF&nbsp;GT_ALVTAB&nbsp;INTO&nbsp;TABLE&nbsp;LS_ALV01-CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LINES&nbsp;OF&nbsp;GT_CELLCOLORS&nbsp;INTO&nbsp;TABLE&nbsp;LS_ALV01-CELLCOLORS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'CELLTAB'&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'CELLCOLORS'&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS2&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;&nbsp;=&nbsp;&nbsp;LS_ALV01-CELLTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS2&gt;&nbsp;&nbsp;=&nbsp;&nbsp;LS_ALV01-CELLCOLORS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;&nbsp;INDEX&nbsp;L_INDEX.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_INIT_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_INIT_DATA .<br />
<br />
&nbsp;&nbsp;ZMMDG0010_01-ZRQ&nbsp;&nbsp;&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;ZMMDG0010_01-ZLRSJ&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;ZMMDG0010_01-ZYHID&nbsp;=&nbsp;SY-UNAME.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;TXT_CGZZ&nbsp;=&nbsp;'8000'.<br />
*&nbsp;&nbsp;txt_cgz&nbsp;=&nbsp;'110'.<br />
*&nbsp;&nbsp;TXT_GSDM&nbsp;=&nbsp;'8000'.<br />
*&nbsp;屏幕字段表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_PMZD&nbsp;FROM&nbsp;&nbsp;ZMMDG0010_PMZD.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_ZMMDG0010_GJSCZ&nbsp;&nbsp;FROM&nbsp;ZMMDG0010_GJSCZ.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_YWLX&nbsp;FROM&nbsp;ZMMDG0010_YWLX.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_JSFS&nbsp;FROM&nbsp;ZMMDG0010_JSFS.<br />
<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_VALUE_DOMAN.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_FILL_CELLTAB<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_1423&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_LT_CELLTAB&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_FILL_CELLTAB USING VALUE(P_MODE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIELDNAME&nbsp;TYPE&nbsp;CHAR20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;PT_CELLTAB&nbsp;TYPE&nbsp;LVC_T_STYL.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_CELLTAB&nbsp;TYPE&nbsp;LVC_S_STYL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL&nbsp;&nbsp;TYPE&nbsp;LVC_S_SCOL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;RAW4.<br />
<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;P_MODE&nbsp;EQ&nbsp;'READ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MODE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
&nbsp;&nbsp;ELSEIF&nbsp;P_MODE&nbsp;EQ&nbsp;'REQUEST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-FNAME&nbsp;=&nbsp;FIELDNAME&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-COLOR-COL&nbsp;=&nbsp;'3'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-COLOR-INT&nbsp;=&nbsp;'1'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-COLOR-INV&nbsp;=&nbsp;'1'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_S_SCOL&nbsp;TO&nbsp;GT_CELLCOLORS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MODE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_ENABLED.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MODE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_ENABLED.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;FIELDNAME&nbsp;EQ&nbsp;'MWSKZ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-FNAME&nbsp;=&nbsp;FIELDNAME&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-COLOR-COL&nbsp;=&nbsp;'3'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-COLOR-INT&nbsp;=&nbsp;'1'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_S_SCOL-COLOR-INV&nbsp;=&nbsp;'1'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_S_SCOL&nbsp;TO&nbsp;GT_CELLCOLORS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MODE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_ENABLED.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;LS_CELLTAB-FIELDNAME&nbsp;=&nbsp;FIELDNAME.<br />
&nbsp;&nbsp;LS_CELLTAB-STYLE&nbsp;=&nbsp;L_MODE.<br />
&nbsp;&nbsp;INSERT&nbsp;LS_CELLTAB&nbsp;INTO&nbsp;TABLE&nbsp;PT_CELLTAB.<br />
&nbsp;&nbsp;INSERT&nbsp;LS_CELLTAB&nbsp;INTO&nbsp;TABLE&nbsp;GT_ALVTAB.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_DYNPRO_ITAB<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_DYNPRO_ITAB .<br />
&nbsp;&nbsp;DATA&nbsp;LS_FCAT&nbsp;TYPE&nbsp;LVC_S_FCAT.<br />
&nbsp;&nbsp;DATA:L_NAME&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA:IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_STBL.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ALV02&nbsp;TYPE&nbsp;&nbsp;ZMMDG0010_ALV_S02.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*动态内表创建<br />
*--------------------------------------------------------------------*<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;L_NAME&nbsp;=&nbsp;G_ALV_FIELD_QC.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_ALV_VALUE_QC&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DYN_FIELD&gt;&nbsp;=&nbsp;&nbsp;&nbsp;G_ALV_VALUE_QC&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_FIELDCAT&nbsp;INTO&nbsp;LS_FCAT&nbsp;WITH&nbsp;KEY&nbsp;FIELDNAME&nbsp;=&nbsp;G_ALV_FIELD_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;LS_FCAT-FIELDNAME&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;&lt;DYN_FIELD&gt;.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;DYN_FIELD&gt;&nbsp;=&nbsp;&nbsp;&nbsp;G_ALV_VALUE_QC&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_NAME&nbsp;=&nbsp;G_ALV_FIELD_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;&nbsp;TRANSPORTING&nbsp;(G_ALV_FIELD_QC).<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*****&nbsp;快速更改公式字段计算<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZGJSCZ'&nbsp;OR&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZWWJZ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZGJSCZ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZGJSCZ&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZWWJZ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZWWJZ&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_ZMMDG0010_GJSCZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010_GJSCZ&nbsp;INTO&nbsp;GS_ZMMDG0010_GJSCZ&nbsp;WITH&nbsp;KEY&nbsp;GJSCZ&nbsp;=&nbsp;LS_ALV02-ZGJSCZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZWWZJZ&nbsp;=&nbsp;LS_ALV02-ZWWJZ&nbsp;*&nbsp;(&nbsp;GS_ZMMDG0010_GJSCZ-YLBL&nbsp;/&nbsp;GS_ZMMDG0010_GJSCZ-GJSBL&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZJZ'&nbsp;OR&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCKKDJ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZJZ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJZ&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCKKDJ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCKKDJ&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCKLSJ&nbsp;=&nbsp;LS_ALV02-ZCKKDJ&nbsp;*&nbsp;LS_ALV02-ZJZ.&nbsp;"&nbsp;参考零售价=（参考克单价*金重）<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZJS'.&nbsp;"&nbsp;&nbsp;件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJZ&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZZJZ&nbsp;=&nbsp;&nbsp;LS_ALV02-ZJS&nbsp;*&nbsp;&nbsp;LS_ALV02-ZJZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGKDJ'&nbsp;OR&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGKGF'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGGFJF'&nbsp;OR&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGJFJF'&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZSL'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&nbsp;G_ALV_FIELD_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGKDJ'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGKDJ&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGKGF'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGKGF&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGGFJF'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGGFJF&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGJFJF'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJFJF&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZSL'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;=&nbsp;&nbsp;G_ALV_VALUE_QC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_PMZD-ZCGJG&nbsp;=&nbsp;'4'.&nbsp;"&nbsp;(（采购克工费+采购克附加费）*采购数量+采购件附加费&nbsp;)&nbsp;/&nbsp;数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJG&nbsp;=&nbsp;(&nbsp;(&nbsp;LS_ALV02-ZCGKDJ&nbsp;+&nbsp;LS_ALV02-ZCGKGF&nbsp;+&nbsp;LS_ALV02-ZCGGFJF&nbsp;)&nbsp;*&nbsp;LS_ALV02-ZSL&nbsp;+&nbsp;LS_ALV02-ZCGJFJF&nbsp;)&nbsp;/&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*快速修改完毕刷新<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;IS_STABLE.<br />
&nbsp;&nbsp;IS_STABLE-COL&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;IS_STABLE-ROW&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-DYNNR&nbsp;=&nbsp;'9100'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"刷新<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IS_STABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SOFT_REFRESH&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"刷新<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IS_STABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SOFT_REFRESH&nbsp;=&nbsp;'X'.<br />
<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SCREEN_KSXG<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_SCREEN_KSXG .<br />
&nbsp;&nbsp;DATA&nbsp;LS_FCAT&nbsp;TYPE&nbsp;LVC_S_FCAT.<br />
&nbsp;&nbsp;DATA&nbsp;L_MSG&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_CELLTAB&nbsp;TYPE&nbsp;LVC_T_STYL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CELLTAB&nbsp;TYPE&nbsp;LVC_S_STYL.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ALV01&nbsp;TYPE&nbsp;TY_OUTTAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02&nbsp;TYPE&nbsp;TY_OUTTAB2.<br />
<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'&nbsp;CELLTAB'&nbsp;OF&nbsp;STRUCTURE&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_CELLTAB&nbsp;=&nbsp;&lt;FS&gt;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_CELLTAB&nbsp;INTO&nbsp;LS_CELLTAB&nbsp;WHERE&nbsp;&nbsp;STYLE&nbsp;=&nbsp;'00100000'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;TXT_CGKDJ&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CELLTAB-FIELDNAME&nbsp;=&nbsp;'ZCGKDJ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;&nbsp;'采购克单价不能编辑'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;TXT_CGKGF&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CELLTAB-FIELDNAME&nbsp;=&nbsp;'ZCGKGF'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;&nbsp;'采购克工费不能编辑'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;TXT_CGKFJF&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CELLTAB-FIELDNAME&nbsp;=&nbsp;'ZCGKFJF'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;&nbsp;'采购克附加费不能编辑'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;TXT_CGJFJF&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_CELLTAB-FIELDNAME&nbsp;=&nbsp;'ZCGJFJF'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;&nbsp;'采购件附加费不能编辑'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'&nbsp;ZCGKDJ'&nbsp;OF&nbsp;STRUCTURE&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;=&nbsp;TXT_CGKDJ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'&nbsp;ZCGKGF'&nbsp;OF&nbsp;STRUCTURE&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;&nbsp;=&nbsp;TXT_CGKGF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'&nbsp;ZCGGFJF'&nbsp;OF&nbsp;STRUCTURE&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;&nbsp;=&nbsp;TXT_CGKFJF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;'&nbsp;ZCGJFJF'&nbsp;OF&nbsp;STRUCTURE&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS&gt;&nbsp;=&nbsp;TXT_CGJFJF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;&nbsp;TXT_CGKDJ&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;&nbsp;TXT_CGKGF&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;TXT_CGKFJF&nbsp;IS&nbsp;INITIAL&nbsp;&nbsp;AND&nbsp;TXT_CGJFJF&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_PMZD-ZCGJG&nbsp;=&nbsp;'4'.&nbsp;"&nbsp;(（采购克工费+采购克附加费）*采购数量+采购件附加费&nbsp;)&nbsp;/&nbsp;数量<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJG&nbsp;=&nbsp;(&nbsp;(&nbsp;TXT_CGKDJ&nbsp;+&nbsp;TXT_CGKGF&nbsp;+&nbsp;TXT_CGKFJF&nbsp;)&nbsp;*&nbsp;LS_ALV02-ZSL&nbsp;+&nbsp;TXT_CGJFJF&nbsp;)&nbsp;/&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;IF&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGKDJ'&nbsp;OR&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGKGF'&nbsp;OR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGGFJF'&nbsp;OR&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZCGJFJF'&nbsp;or<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_ALV_FIELD_QC&nbsp;=&nbsp;'ZSL'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&nbsp;G_ALV_FIELD_QC.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGKDJ'&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGKDJ&nbsp;=&nbsp;&nbsp;G_ALV_value_QC.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGKGF'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGKGF&nbsp;=&nbsp;&nbsp;G_ALV_value_QC.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGGFJF'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGGFJF&nbsp;=&nbsp;&nbsp;G_ALV_value_QC.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZCGJFJF'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJFJF&nbsp;=&nbsp;&nbsp;G_ALV_value_QC.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ZSL'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;=&nbsp;&nbsp;G_ALV_value_QC.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_PMZD-ZCGJG&nbsp;=&nbsp;'4'.&nbsp;"&nbsp;(（采购克工费+采购克附加费）*采购数量+采购件附加费&nbsp;)&nbsp;/&nbsp;数量<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;LS_ALV02.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJG&nbsp;=&nbsp;(&nbsp;(&nbsp;LS_ALV02-ZCGKDJ&nbsp;+&nbsp;LS_ALV02-ZCGKGF&nbsp;+&nbsp;LS_ALV02-ZCGGFJF&nbsp;)&nbsp;*&nbsp;LS_ALV02-ZSL&nbsp;+&nbsp;LS_ALV02-ZCGJFJF&nbsp;)&nbsp;/&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CHECK_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_CHECK_DATA .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;L_MSG&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA&nbsp;LS_FCAT&nbsp;TYPE&nbsp;LVC_S_FCAT.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ST1&nbsp;TYPE&nbsp;TY_ST1.<br />
&nbsp;&nbsp;DATA:&nbsp;LW_LINE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;DATA.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;LINE&gt;,&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZMMEX0010&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMMEX0010&nbsp;TYPE&nbsp;ZMMEX0010_MARA.<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;LS_ALV02&nbsp;TYPE&nbsp;TY_OUTTAB2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ALV02&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;TY_OUTTAB2.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_MARA&nbsp;TYPE&nbsp;MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MARA&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;MARA.<br />
&nbsp;&nbsp;DATA:LV_CHARG&nbsp;TYPE&nbsp;NUM10.<br />
<br />
   </div>
   <div class="codeComment">
***&nbsp;字段搜索帮助表检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;LS_MARA_CK&nbsp;TYPE&nbsp;MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_BSCZ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_BSCZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BSCZ&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_BSCZ,&nbsp;"主石类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_T006&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;T006,&nbsp;"单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ZSJD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_ZSJD,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZSJD&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_ZSJD,&nbsp;"主石级别<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ZSYS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_ZSYS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZSYS&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_ZSYS,&nbsp;"颜色<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ZSQG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_ZSQG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZSQG&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_ZSQG,&nbsp;"切工、<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_JJJB&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_JJJB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_JJJB&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_JJJB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_GJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_GJS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_GJS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_GJS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_GJSYS&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_GJSYS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_GJSYS&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_GJSYS.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_BSCZ&nbsp;FROM&nbsp;ZMMEX0010_BSCZ.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZSJD&nbsp;FROM&nbsp;ZMMEX0010_ZSJD.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZSYS&nbsp;FROM&nbsp;ZMMEX0010_ZSYS.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZSQG&nbsp;FROM&nbsp;ZMMEX0010_ZSQG.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_JJJB&nbsp;FROM&nbsp;ZMMEX0010_JJJB.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_GJS&nbsp;FROM&nbsp;ZMMEX0010_GJS.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_GJSYS&nbsp;FROM&nbsp;ZMMEX0010_GJSYS.<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;DATA&nbsp;LW_LINE&nbsp;LIKE&nbsp;&nbsp;GS_PMZD.<br />
&nbsp;&nbsp;ASSIGN&nbsp;LW_LINE-&gt;*&nbsp;TO&nbsp;&lt;LINE&gt;.<br />
&nbsp;&nbsp;&lt;LINE&gt;&nbsp;=&nbsp;GS_PMZD.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;GT_MESSAGE[],G_CK_NUM,&nbsp;GT_YWLX.<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_YWLX&nbsp;INTO&nbsp;GT_YWLX&nbsp;WITH&nbsp;KEY&nbsp;BM&nbsp;=&nbsp;&nbsp;TXT_YWLX.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_FIELD_CK&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;&nbsp;'业务类型&nbsp;不在范围值内'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_DYNPREAD&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;DYNPREAD&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;LW_DYNPREAD&nbsp;TYPE&nbsp;DYNPREAD&nbsp;.<br />
<br />
&nbsp;&nbsp;LW_DYNPREAD-FIELDNAME&nbsp;=&nbsp;'TXT_YWLX'.<br />
&nbsp;&nbsp;APPEND&nbsp;LW_DYNPREAD&nbsp;TO&nbsp;LT_DYNPREAD&nbsp;.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'DYNP_VALUES_READ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNUMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'0100'<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPFIELDS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_DYNPREAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_ABAPWORKAREA&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_DYNPROFIELD&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_DYNPRONAME&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_DYNPRONUMMER&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_REQUEST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_FIELDDESCRIPTION&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_PARAMETER&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNDEFIND_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE_CONVERSION&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPL_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;10<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;FREE:&nbsp;GT_JSFSF4[],ITHP_JSFS[].<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_DYNPREAD&nbsp;INTO&nbsp;LW_DYNPREAD&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_JSFSF4&nbsp;FROM&nbsp;ZMMDG0010_VJSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZYWLX&nbsp;=&nbsp;LW_DYNPREAD-FIELDVALUE.<br />
<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_JSFSF4&nbsp;INTO&nbsp;GT_JSFSF4&nbsp;WITH&nbsp;KEY&nbsp;ZJSFS&nbsp;=&nbsp;&nbsp;TXT_JSFS.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_FIELD_CK&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;&nbsp;'结算方式&nbsp;不在范围值内'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;TXT_YWLX&nbsp;=&nbsp;''OR&nbsp;&nbsp;TXT_JSFS&nbsp;=&nbsp;''&nbsp;OR&nbsp;TXT_XSJG&nbsp;=&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_FIELD_CK&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;&nbsp;'业务类型/结算方式/采购单位/销售价格计算单位&nbsp;不能为空'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;EKPO-WERKS&nbsp;=&nbsp;''OR&nbsp;&nbsp;EKPO-LGORT&nbsp;=&nbsp;''&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;&nbsp;'地点/库存地点&nbsp;不能为空'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_FIELD&nbsp;INTO&nbsp;LS_ST1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;LS_ST1-F1&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;LINE&gt;&nbsp;TO&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS&gt;&nbsp;=&nbsp;'3'&nbsp;OR&nbsp;&lt;FS&gt;&nbsp;=&nbsp;'4'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_FIELDCAT&nbsp;INTO&nbsp;LS_FCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_FCAT-FIELDNAME&nbsp;=&nbsp;LS_ST1-F2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;COMPONENT&nbsp;LS_FCAT-FIELDNAME&nbsp;OF&nbsp;STRUCTURE&nbsp;&lt;DYN_WA&gt;&nbsp;&nbsp;&nbsp;TO&nbsp;&lt;DYN_FIELD&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;DYN_FIELD&gt;&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;&nbsp;LS_ALV02-ZHXM&nbsp;'字段'&nbsp;LS_FCAT-SCRTEXT_S&nbsp;'不能为空！'INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;LS_ALV02-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;LS_ALV02-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ALV02&nbsp;TO&nbsp;LT_ALV02.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;&lt;DYN_TABLE&gt;&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMEX0010&nbsp;FROM&nbsp;ZMMEX0010_MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_ALV02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_ALV02-MATNR.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;供应商唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_ZGYSDM&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGYSDM&nbsp;TYPE&nbsp;ZDE_ZGYSDM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_ZGYSDM.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;税码唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_MWSKZ&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MWSKZ&nbsp;TYPE&nbsp;MWSKZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_MWSKZ.<br />
<br />
<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ALV02&nbsp;INTO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_OUTPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;LS_ALV02-ZGYSDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;IT_ZGYSDM-ZGYSDM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_ZGYSDM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_MWSKZ-MWSKZ&nbsp;=&nbsp;LS_ALV02-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_MWSKZ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZMMEX0010&nbsp;INTO&nbsp;LS_ZMMEX0010&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZGJSCZ&nbsp;&lt;&gt;&nbsp;LS_ZMMEX0010-EX_GJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'材质'LS_ALV02-ZGJSCZ&nbsp;'主数据材质'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMMEX0010-EX_GJS&nbsp;'&nbsp;不一致'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'W'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSBM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQZSBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSZLDW&nbsp;&lt;&gt;&nbsp;LS_MARA-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'镶嵌主石单位'LS_ALV02-ZXQZSZLDW&nbsp;'主数据单位'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MARA-MEINS&nbsp;'&nbsp;不一致'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW1&nbsp;&lt;&gt;&nbsp;LS_MARA-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'镶嵌旁石单位1'LS_ALV02-ZXQPSZLDW1&nbsp;'主数据单位'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MARA-MEINS&nbsp;'&nbsp;不一致'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW2&nbsp;&lt;&gt;&nbsp;LS_MARA-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'镶嵌旁石单位2'LS_ALV02-ZXQPSZLDW2&nbsp;'主数据单位'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MARA-MEINS&nbsp;'&nbsp;不一致'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW3&nbsp;&lt;&gt;&nbsp;LS_MARA-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'镶嵌旁石单位3'LS_ALV02-ZXQPSZLDW3&nbsp;'主数据单位'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MARA-MEINS&nbsp;'&nbsp;不一致'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM4&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW4&nbsp;&lt;&gt;&nbsp;LS_MARA-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'镶嵌旁石单位4'LS_ALV02-ZXQPSZLDW4&nbsp;'主数据单位'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MARA-MEINS&nbsp;'&nbsp;不一致'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-MWSKZ&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'税码&nbsp;不能为空'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_MARA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_MARA-MEINS&nbsp;&lt;&gt;&nbsp;LS_ALV02-ZSLDW&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;&nbsp;'行项目&nbsp;'&nbsp;&nbsp;LS_ALV02-ZHXM&nbsp;'录入单位'&nbsp;&nbsp;LS_ALV02-ZSLDW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'；基本单位'&nbsp;LS_MARA-MEINS&nbsp;&nbsp;'不一致，请检查'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXSKGFD&nbsp;=&nbsp;'X999'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'销售克工费档为X999，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"测试专用，后续改回期初<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-CHARG&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LV_CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_CHARG&nbsp;&nbsp;=&nbsp;LS_ALV02-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_CHARG&nbsp;&gt;=&nbsp;'0000000000'&nbsp;AND&nbsp;LV_CHARG&nbsp;&lt;=&nbsp;'5999999999'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'行项目'&nbsp;LS_ALV02-ZHXM&nbsp;'商品码（批次号）'&nbsp;LS_ALV02-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',不在有效范围’0000000000~5999999999之间，请修改&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
****字段值范围检查<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSBM&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA_CK&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQZSBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌主石编码不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石类型<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSLX&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSCZ&nbsp;INTO&nbsp;LS_BSCZ&nbsp;WITH&nbsp;KEY&nbsp;EX_BSCZ&nbsp;=&nbsp;LS_ALV02-ZXQZSLX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌主石类型不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石重量单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSZLDW&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_T006&nbsp;FROM&nbsp;T006&nbsp;WHERE&nbsp;MSEHI&nbsp;=&nbsp;LS_ALV02-ZXQZSZLDW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌主石重量单位不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石级别<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSJB&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSJD&nbsp;INTO&nbsp;LS_ZSJD&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSJD&nbsp;=&nbsp;LS_ALV02-ZXQZSJB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌主石级别不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石颜色<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSYS&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSYS&nbsp;INTO&nbsp;LS_ZSYS&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSYS&nbsp;=&nbsp;LS_ALV02-ZXQZSYS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌主石颜色不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石切工<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQZSQG&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSQG&nbsp;INTO&nbsp;LS_ZSQG&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSQG&nbsp;=&nbsp;LS_ALV02-ZXQZSQG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌主石切工不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石编码1<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM1&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA_CK&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石编码1不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石类型1<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSLX1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSCZ&nbsp;INTO&nbsp;LS_BSCZ&nbsp;WITH&nbsp;KEY&nbsp;EX_BSCZ&nbsp;=&nbsp;LS_ALV02-ZXQPSLX1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石类型1不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石重量单位1<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_T006&nbsp;FROM&nbsp;T006&nbsp;WHERE&nbsp;MSEHI&nbsp;=&nbsp;LS_ALV02-ZXQPSZLDW1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石重量单位1不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石级别1<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSJB1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSJD&nbsp;INTO&nbsp;LS_ZSJD&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSJD&nbsp;=&nbsp;LS_ALV02-ZXQPSJB1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石级别1不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石颜色1<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSYS1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSYS&nbsp;INTO&nbsp;LS_ZSYS&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSYS&nbsp;=&nbsp;LS_ALV02-ZXQPSYS1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石颜色1不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石编码2<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM2&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA_CK&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石编码2不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石类型2<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSLX2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSCZ&nbsp;INTO&nbsp;LS_BSCZ&nbsp;WITH&nbsp;KEY&nbsp;EX_BSCZ&nbsp;=&nbsp;LS_ALV02-ZXQPSLX2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石类型2不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石重量单位2<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_T006&nbsp;FROM&nbsp;T006&nbsp;WHERE&nbsp;MSEHI&nbsp;=&nbsp;LS_ALV02-ZXQPSZLDW2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石重量单位2不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石级别2<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSJB2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSJD&nbsp;INTO&nbsp;LS_ZSJD&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSJD&nbsp;=&nbsp;LS_ALV02-ZXQPSJB2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石级别2不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石颜色2<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSYS2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSYS&nbsp;INTO&nbsp;LS_ZSYS&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSYS&nbsp;=&nbsp;LS_ALV02-ZXQPSYS2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石颜色2不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石编码3<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM3&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA_CK&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石编码3不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石类型3<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSLX3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSCZ&nbsp;INTO&nbsp;LS_BSCZ&nbsp;WITH&nbsp;KEY&nbsp;EX_BSCZ&nbsp;=&nbsp;LS_ALV02-ZXQPSLX3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石类型3不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石重量单位3<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_T006&nbsp;FROM&nbsp;T006&nbsp;WHERE&nbsp;MSEHI&nbsp;=&nbsp;LS_ALV02-ZXQPSZLDW3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石重量单位3不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石级别3<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSJB3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSJD&nbsp;INTO&nbsp;LS_ZSJD&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSJD&nbsp;=&nbsp;LS_ALV02-ZXQPSJB3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石级别3不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石颜色3<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSYS3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSYS&nbsp;INTO&nbsp;LS_ZSYS&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSYS&nbsp;=&nbsp;LS_ALV02-ZXQPSYS3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石颜色3不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石编码4<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSBM4&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_MARA_CK&nbsp;FROM&nbsp;MARA&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-ZXQPSBM4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石编码4不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石类型4<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSLX4&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_BSCZ&nbsp;INTO&nbsp;LS_BSCZ&nbsp;WITH&nbsp;KEY&nbsp;EX_BSCZ&nbsp;=&nbsp;LS_ALV02-ZXQPSLX4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石类型4不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石重量单位4<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSZLDW4&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;LS_T006&nbsp;FROM&nbsp;T006&nbsp;WHERE&nbsp;MSEHI&nbsp;=&nbsp;LS_ALV02-ZXQPSZLDW4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石重量单位4不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌主石级别4<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSJB4&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSJD&nbsp;INTO&nbsp;LS_ZSJD&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSJD&nbsp;=&nbsp;LS_ALV02-ZXQPSJB4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石级别4不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"镶嵌旁石颜色4<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXQPSYS4&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZSYS&nbsp;INTO&nbsp;LS_ZSYS&nbsp;WITH&nbsp;KEY&nbsp;EX_ZSYS&nbsp;=&nbsp;LS_ALV02-ZXQPSYS4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'镶嵌旁石颜色4不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"销售价格计算单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXSJGJLDW&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXSJGJLDW&nbsp;=&nbsp;'G'&nbsp;OR&nbsp;LS_ALV02-ZXSJGJLDW&nbsp;&nbsp;=&nbsp;'ST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LS_ALV02-ZXSJGJLDW&nbsp;&nbsp;=&nbsp;'PC'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'销售价格计算单位不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;赠品标记<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZZPBJ&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZZPBJ&nbsp;=&nbsp;'X'&nbsp;OR&nbsp;LS_ALV02-ZZPBJ&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;LS_ALV02-ZZPBJ&nbsp;=&nbsp;'1'&nbsp;OR&nbsp;LS_ALV02-ZZPBJ&nbsp;=&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'赠品标记不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"贵金属材质<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZGJSCZ&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_GJS&nbsp;INTO&nbsp;LS_GJS&nbsp;WITH&nbsp;KEY&nbsp;EX_GJS&nbsp;=&nbsp;LS_ALV02-ZGJSCZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'贵金属材质不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"贵金属颜色<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZGJSYS&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_GJSYS&nbsp;INTO&nbsp;LS_GJSYS&nbsp;WITH&nbsp;KEY&nbsp;EX_GJSYS&nbsp;=&nbsp;LS_ALV02-ZGJSYS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MSG&nbsp;=&nbsp;'贵金属颜色不在可输入范围内，请修改主数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_ZGYSDM&nbsp;BY&nbsp;ZGYSDM.<br />
&nbsp;&nbsp;SORT&nbsp;IT_MWSKZ&nbsp;BY&nbsp;MWSKZ.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_ZGYSDM&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_MWSKZ&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_ZGYSDM&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;'供应商必须唯一'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_MWSKZ&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;'税码必须唯一'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_CK_NUM&nbsp;=&nbsp;G_CK_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_CK_NUM&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;G_FLG_SAVE&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'数据校验通过，请保存'&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_MESSAGE&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'C14Z_MESSAGES_SHOW_AS_POPUP'&nbsp;"输出检查信息<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_MESSAGE_TAB&nbsp;=&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_REFICH_ALV<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_REFRESH_ALV .<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_STBL.<br />
&nbsp;&nbsp;CLEAR&nbsp;IS_STABLE.<br />
&nbsp;&nbsp;IS_STABLE-COL&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;IS_STABLE-ROW&nbsp;=&nbsp;'X'.<br />
<br />
<br />
&nbsp;&nbsp;CASE&nbsp;&nbsp;SY-DYNNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'9100'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IS_STABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SOFT_REFRESH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'9200'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_GRID2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IS_STABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SOFT_REFRESH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'9300'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;G_GRID3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID3-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IS_STABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SOFT_REFRESH&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_PROCESS_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_PROCESS_DATA .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZMMEX0010&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMEX0010_MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMMEX0010&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZMMEX0010_MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ZMMDG0010_02&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMDG0010_02,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMMDG0010_02&nbsp;TYPE&nbsp;ZMMDG0010_02.<br />
<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;FS&gt;.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ALV01&nbsp;TYPE&nbsp;TY_OUTTAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02&nbsp;TYPE&nbsp;TY_OUTTAB2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ALV02&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;TY_OUTTAB2.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_MARA&nbsp;TYPE&nbsp;MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MARA&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;MARA.<br />
<br />
<br />
   </div>
   <div class="codeComment">
***&nbsp;获取价格信息表内容<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010_02&nbsp;FROM&nbsp;ZMMDG0010_02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;GT_ZMMDG0010<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZGYSDM&nbsp;=&nbsp;GT_ZMMDG0010-ZGYSDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;ZSPKH&nbsp;=&nbsp;GT_ZMMDG0010-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;ZLYJSFS&nbsp;=&nbsp;GS_PMZD-ZJSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;ZXSJGJSDW&nbsp;=&nbsp;GS_PMZD-ZXSJGJSDW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;DFLG&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;(&nbsp;DATAB&nbsp;&lt;=&nbsp;SY-DATUM&nbsp;&nbsp;AND&nbsp;&nbsp;DATBI&nbsp;&gt;=&nbsp;SY-DATUM&nbsp;&nbsp;).<br />
<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_ZMMDG0010_02&nbsp;BY&nbsp;DATAB&nbsp;DESCENDING.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;&nbsp;INTO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ALV02&nbsp;TO&nbsp;LT_ALV02.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;TXT_ZLHJ,GT_ZSPBM[],&nbsp;TXT_BSHJ.<br />
<br />
&nbsp;&nbsp;IF&nbsp;&lt;DYN_TABLE&gt;&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMEX0010&nbsp;FROM&nbsp;ZMMEX0010_MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_ALV02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_ALV02-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_MAKT&nbsp;FROM&nbsp;MAKT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_ALV02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_ALV02-MATNR.<br />
   </div>
   <div class="codeComment">
*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LT_ALV02&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_MARA&nbsp;&nbsp;FROM&nbsp;MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_ALV02<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_ALV02-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&lt;DYN_TABLE&gt;&nbsp;INTO&nbsp;&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;LS_ALV02.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZHXM&nbsp;IS&nbsp;INITIAL."行项目<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZHXM&nbsp;=&nbsp;ZHXM&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZHXM&nbsp;=&nbsp;ZHXM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-MAKTX&nbsp;IS&nbsp;INITIAL."描述<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MAKT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_MAKT&nbsp;INTO&nbsp;GS_MAKT&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-MAKTX&nbsp;=&nbsp;GS_MAKT-MAKTX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZJZ&nbsp;&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZSLDW&nbsp;=&nbsp;'G'."<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJZ&nbsp;=&nbsp;LS_ALV02-ZSL."金重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZJZDW&nbsp;IS&nbsp;INITIAL."金重单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJZDW&nbsp;=&nbsp;'G'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;TXT_YWLX&nbsp;&nbsp;=&nbsp;'T001'&nbsp;&nbsp;OR&nbsp;&nbsp;&nbsp;TXT_YWLX&nbsp;&nbsp;=&nbsp;'T007'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZWWJZ&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZWWJZ&nbsp;=&nbsp;LS_ALV02-ZJZ.&nbsp;"委外金重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZWWJZDW&nbsp;IS&nbsp;INITIAL."委外金重单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZWWJZDW&nbsp;=&nbsp;'G'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZWWZJZ&nbsp;IS&nbsp;INITIAL."委外足金比例计算<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_ZMMDG0010_GJSCZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010_GJSCZ&nbsp;INTO&nbsp;GS_ZMMDG0010_GJSCZ&nbsp;WITH&nbsp;KEY&nbsp;GJSCZ&nbsp;=&nbsp;LS_ALV02-ZGJSCZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZWWZJZ&nbsp;=&nbsp;LS_ALV02-ZWWJZ&nbsp;*&nbsp;(&nbsp;GS_ZMMDG0010_GJSCZ-YLBL&nbsp;/&nbsp;GS_ZMMDG0010_GJSCZ-GJSBL&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZWWZJZDW&nbsp;IS&nbsp;INITIAL."委外足金重单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZWWZJZDW&nbsp;=&nbsp;'G'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZXSJGJLDW&nbsp;IS&nbsp;INITIAL."销售价格计算单位<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZXSJGJLDW&nbsp;=&nbsp;TXT_XSJG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-WAERS&nbsp;IS&nbsp;INITIAL."币别<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-WAERS&nbsp;=&nbsp;'CNY'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
***价格表<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZMMDG0010_02&nbsp;INTO&nbsp;LS_ZMMDG0010_02&nbsp;WITH&nbsp;KEY&nbsp;ZGYSDM&nbsp;=&nbsp;LS_ALV02-ZGYSDM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPKH&nbsp;&nbsp;=&nbsp;LS_ALV02-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-MWSKZ&nbsp;=&nbsp;LS_ZMMDG0010_02-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_ALV02-ZCGKGF&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGKGF&nbsp;=&nbsp;LS_ZMMDG0010_02-ZCGKGF."采购克工费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGGFJF&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGGFJF&nbsp;=&nbsp;LS_ZMMDG0010_02-ZCGKFJF."采购克附加费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZCGJFJF&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJFJF&nbsp;=&nbsp;LS_ZMMDG0010_02-ZCGJFJF."采购件附加费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_ALV02-ZCGJG&nbsp;&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_PMZD-ZCGJG&nbsp;=&nbsp;'4'.&nbsp;"&nbsp;(（采购克工费+采购克附加费）*采购数量+采购件附加费&nbsp;)&nbsp;/&nbsp;数量<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCGJG&nbsp;=&nbsp;(&nbsp;(&nbsp;LS_ALV02-ZCGKDJ&nbsp;+&nbsp;LS_ALV02-ZCGKGF&nbsp;+&nbsp;LS_ALV02-ZCGGFJF&nbsp;)&nbsp;*&nbsp;LS_ALV02-ZSL&nbsp;+&nbsp;LS_ALV02-ZCGJFJF&nbsp;)&nbsp;/&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZJSKGF&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJSKGF&nbsp;=&nbsp;LS_ZMMDG0010_02-ZJSKGF."结算克工费<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJSKDKZ&nbsp;&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJSKDKZ&nbsp;=&nbsp;LS_ZMMDG0010_02-ZJSKDKZ."结算克倒扣值<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_ALV02-ZJSKL&nbsp;&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJSKL&nbsp;=&nbsp;LS_ZMMDG0010_02-ZJSKL."结算扣率<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_ALV02-ZCKLSJ&nbsp;&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZCKLSJ&nbsp;=&nbsp;LS_ALV02-ZCKKDJ&nbsp;*&nbsp;LS_ALV02-ZJZ."参考零售价&nbsp;&nbsp;&nbsp;克单价*&nbsp;金重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_ZMMEX0010&nbsp;INTO&nbsp;LS_ZMMEX0010&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZXSKGFD&nbsp;=&nbsp;LS_ZMMEX0010-EX_JJJB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_ZLHJ&nbsp;=&nbsp;TXT_ZLHJ&nbsp;+&nbsp;&nbsp;LS_ALV02-ZJZ."&nbsp;重量合计<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZSLDW&nbsp;=&nbsp;'PC'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZSLDW&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZLSZJE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZLSZJE&nbsp;&nbsp;=&nbsp;&nbsp;LS_ALV02-ZSL&nbsp;*&nbsp;LS_ALV02-ZCKLSJ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ALV02-ZJS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_MARA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MARA&nbsp;INTO&nbsp;LS_MARA&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LS_ALV02-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_MARA-MEINS&nbsp;=&nbsp;'G'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJS&nbsp;=&nbsp;LS_ALV02-ZSL&nbsp;/&nbsp;LS_ALV02-ZJZ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJS&nbsp;=&nbsp;LS_ALV02-ZSL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZZJZ&nbsp;&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZZJZ&nbsp;=&nbsp;&nbsp;LS_ALV02-ZJS&nbsp;*&nbsp;&nbsp;LS_ALV02-ZJZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;&nbsp;LS_ALV02-MEINS&nbsp;=&nbsp;'G'&nbsp;.<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-MEINS&nbsp;=&nbsp;'ST'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV02-ZJS&nbsp;=&nbsp;LS_ALV02-ZSL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_LSHJ&nbsp;=&nbsp;TXT_LSHJ&nbsp;+&nbsp;&nbsp;LS_ALV02-ZCKLSJ.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_CBHJ&nbsp;=&nbsp;TXT_CBHJ&nbsp;+&nbsp;&nbsp;LS_ALV02-ZCGJG.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ALV02&nbsp;TO&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&lt;DYN_TABLE&gt;&nbsp;FROM&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;LS_ALV02,&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;NEW&nbsp;ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_BSHJ&nbsp;=&nbsp;TXT_BSHJ&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_READ_RK<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_READ_RK .<br />
&nbsp;&nbsp;DATA:&nbsp;L_LEN&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:&nbsp;L_TM2&nbsp;TYPE&nbsp;CHAR2.<br />
&nbsp;&nbsp;DATA:&nbsp;L_TLIN1&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TLIN2&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_GJSXX&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMRP0080_GJSXX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_GJSXX&nbsp;TYPE&nbsp;ZMMRP0080_GJSXX.<br />
&nbsp;&nbsp;DATA:&nbsp;L_MSG&nbsp;TYPE&nbsp;STRING.<br />
<br />
&nbsp;&nbsp;RANGES:S_ZJSZBM&nbsp;FOR&nbsp;ZMMRP0080_GJSXX-ZJSZBM.<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;LS_ZJSZBM&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;S_ZJSZBM.<br />
&nbsp;&nbsp;DATA:&nbsp;L_SQL_FIELD&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ZMMDG0010&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;&nbsp;ZMMDG0010_01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZMMDG0010&nbsp;TYPE&nbsp;&nbsp;ZMMDG0010_01.<br />
<br />
&nbsp;&nbsp;CONDENSE&nbsp;TXT_TM&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;L_LEN&nbsp;=&nbsp;STRLEN(&nbsp;TXT_TM&nbsp;).<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR:&nbsp;&lt;DYN_TABLE&gt;,&lt;DYN_WA&gt;.<br />
<br />
*条码检查&nbsp;只有数字<br />
<br />
*&nbsp;&nbsp;matcher&nbsp;=&nbsp;cl_abap_matcher=&gt;create(&nbsp;pattern&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'\d+'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;TXT_TM&nbsp;).<br />
*&nbsp;&nbsp;match&nbsp;=&nbsp;matcher-&gt;match(&nbsp;).<br />
*&nbsp;&nbsp;IF&nbsp;match&nbsp;&lt;&gt;&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'条码格式有误,不可有数字外的字符'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;TXT_TM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXIT&nbsp;.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
*条码长度检查<br />
*&nbsp;&nbsp;IF&nbsp;&nbsp;l_len&nbsp;=&nbsp;13&nbsp;and&nbsp;TXT_JCZBM&nbsp;IS&nbsp;INITIAL.<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;TXT_TM&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TM2&nbsp;=&nbsp;TXT_TM+0(1).<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;条码分类<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&nbsp;L_TM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'5'&nbsp;OR&nbsp;'7'.&nbsp;"商品包码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SQL_FIELD&nbsp;=&nbsp;'ZSPBM'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZSPBM&nbsp;=&nbsp;TXT_TM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZFPH&nbsp;&lt;&gt;&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'6'&nbsp;OR&nbsp;'2'."商品标签条码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SQL_FIELD&nbsp;=&nbsp;'ZSPTM'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZSPTM&nbsp;=&nbsp;TXT_TM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZFPH&nbsp;&lt;&gt;&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'4'."&nbsp;分配号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_SQL_FIELD&nbsp;=&nbsp;'ZFPH'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZFPH&nbsp;=&nbsp;TXT_TM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZFPH&nbsp;&lt;&gt;&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;else.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'条码格式有误，长度不符'&nbsp;type&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;TXT_TM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;exit.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
*&nbsp;检测站编码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;TXT_JCZBM&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"单值<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_ZJSZBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZJSZBM-SIGN&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZJSZBM-OPTION&nbsp;=&nbsp;'CP'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_ZJSZBM-LOW&nbsp;=&nbsp;TXT_JCZBM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZJSZBM&nbsp;TO&nbsp;S_ZJSZBM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;TXT_TM&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZJSZBM&nbsp;IN&nbsp;S_ZJSZBM&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;TXT_PO&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;FROM&nbsp;ZMMDG0010_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;TXT_PO.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;采购订单&nbsp;物料凭证&nbsp;重复录入<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;FLG_EBELN&nbsp;TYPE&nbsp;C,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_MBLNR&nbsp;TYPE&nbsp;C.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_ZMMDG0010&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZMMDG0010&nbsp;INTO&nbsp;LS_ZMMDG0010.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;WITH&nbsp;KEY&nbsp;EBELN&nbsp;=&nbsp;LS_ZMMDG0010-EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_EBELN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ZMMDG0010-MBLNR&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;WITH&nbsp;KEY&nbsp;MBLNR&nbsp;=&nbsp;LS_ZMMDG0010-MBLNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_MBLNR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;FLG_EBELN&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'&nbsp;采购订单不一致，请检查！'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;FLG_MBLNR&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'&nbsp;物料凭证不一致，请检查！'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;LT_ZSPBM&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZSPBM&nbsp;TYPE&nbsp;ZMMDG0010_01-ZSPBM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;LT_ZSPBM.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;LT_ZMMDG0010&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:TXT_BSXJ,TXT_ZLXJ,TXT_JSXJ,TXT_BSXJ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;LT_ZMMDG0010&nbsp;BY&nbsp;ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;LT_ZMMDG0010&nbsp;INTO&nbsp;LS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;LT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_ZLXJ&nbsp;=&nbsp;TXT_ZLXJ&nbsp;+&nbsp;LS_ZMMDG0010-ZSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ZSPBM&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;NEW&nbsp;ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_BSXJ&nbsp;=&nbsp;&nbsp;TXT_BSXJ&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;LT_ZMMDG0010&nbsp;LINES&nbsp;TXT_JSXJ.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;LT_ZMMDG0010&nbsp;INTO&nbsp;LS_ZMMDG0010.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZMMDG0010&nbsp;TO&nbsp;GT_zmmdg0010.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;FREE&nbsp;&lt;DYN_TABLE&gt;.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;GT_ZMMDG0010&nbsp;BY&nbsp;ZFPH&nbsp;ZHXM&nbsp;ASCENDING.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;GT_ZMMDG0010&nbsp;COMPARING&nbsp;&nbsp;ZFPH&nbsp;&nbsp;ZHXM.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;&nbsp;&lt;DYN_TABLE&gt;&nbsp;IS&nbsp;INITIAL&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'没有符合的数据'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:TXT_TM,GT_ZSPBM[],&nbsp;TXT_JCDBSHJ,TXT_JCDZLHJ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_LSHJ,TXT_CBHJ.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;TXT_JCDZLHJ&nbsp;=&nbsp;TXT_JCDZLHJ&nbsp;+&nbsp;&nbsp;GS_ZMMDG0010-ZJZ."&nbsp;重量合计,<br />
&nbsp;&nbsp;&nbsp;&nbsp;TXT_LSHJ&nbsp;=&nbsp;TXT_LSHJ&nbsp;+&nbsp;&nbsp;GS_ZMMDG0010-ZCKLSJ."&nbsp;零售价合计,<br />
&nbsp;&nbsp;&nbsp;&nbsp;TXT_CBHJ&nbsp;=&nbsp;TXT_CBHJ&nbsp;+&nbsp;&nbsp;GS_ZMMDG0010-ZCGJG."成本合计,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AT&nbsp;NEW&nbsp;ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_JCDBSHJ&nbsp;=&nbsp;TXT_JCDBSHJ&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDAT.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;LINES&nbsp;TXT_JCDJSHJ.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_POST_DOCUMENT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_POST_DOCUMENT .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;GOODSMVT_HEADER&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;BAPI2017_GM_HEAD_02&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOODSMVT_ITEMS&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;BAPI2017_GM_ITEM_SHOW&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZSMM_GOODSMVT&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PURCH_DOC_RA&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;BAPI2017_GM_PURCH_DOC_RA&nbsp;WITH&nbsp;HEADER&nbsp;LINE.<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;T_BATCH&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;TYPE&nbsp;MCH1-CHARG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;&nbsp;T_BATCH.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_OUT&nbsp;&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;BAPIRET2&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RETURN&nbsp;TYPE&nbsp;BAPIRET2.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;L_ZSPTM&nbsp;TYPE&nbsp;NUM12.<br />
&nbsp;&nbsp;DATA:&nbsp;L_ZSPTM2&nbsp;TYPE&nbsp;NUM13.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;T_KL&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MSLB-MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;TYPE&nbsp;MSLB-WERKS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFNR&nbsp;TYPE&nbsp;MSLB-LIFNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LBLAB&nbsp;TYPE&nbsp;MSLB-LBLAB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;T_KL.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_MSLB&nbsp;TYPE&nbsp;MSLB,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MSLB&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;MSLB.<br />
&nbsp;&nbsp;DATA:&nbsp;L_FLG_GR&nbsp;TYPE&nbsp;C.<br />
&nbsp;&nbsp;DATA:&nbsp;L_MSG&nbsp;TYPE&nbsp;STRING.<br />
<br />
   </div>
   <div class="codeComment">
**--------------------------------------------------------------------*<br />
**PO过账<br />
**--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;FLG_MBLNR&nbsp;TYPE&nbsp;C,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_EBELN&nbsp;TYPE&nbsp;C.<br />
<br />
&nbsp;&nbsp;FREE&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;GS_ZMMDG0010-CHARG.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-MBLNR&nbsp;&lt;&gt;&nbsp;''&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_MBLNR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-EBELN&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLG_EBELN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
**统计扣料计算<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQZSBM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-MATNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQZSBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-WERKS&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LIFNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LBLAB&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQZSZL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-MATNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSBM1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-WERKS&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LIFNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LBLAB&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSLZL1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-MATNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSBM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-WERKS&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LIFNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LBLAB&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSLZL2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-MATNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSBM3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-WERKS&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LIFNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LBLAB&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSLZL3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM4&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-MATNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSBM4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-WERKS&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LIFNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_KL-LBLAB&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZXQPSLZL4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;T_KL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;SORT&nbsp;T_KL&nbsp;BY&nbsp;MATNR&nbsp;WERKS&nbsp;LIFNR.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;T_KL.<br />
&nbsp;&nbsp;IF&nbsp;T_KL[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_MSLB&nbsp;FROM&nbsp;MSLB<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;T_KL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;T_KL-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;WERKS&nbsp;=&nbsp;T_KL-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SOBKZ&nbsp;=&nbsp;'O'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;LIFNR&nbsp;=&nbsp;T_KL-LIFNR.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_LBLAB&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_LBLAB2&nbsp;TYPE&nbsp;STRING.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;T_KL&nbsp;INTO&nbsp;T_KL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MSLB&nbsp;INTO&nbsp;LS_MSLB&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;T_KL-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_MSLB-LBLAB&nbsp;&lt;&nbsp;T_KL-LBLAB&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_LBLAB&nbsp;=&nbsp;T_KL-LBLAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_LBLAB2&nbsp;=&nbsp;LS_MSLB-LBLAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'物料'&nbsp;&nbsp;T_KL-MATNR&nbsp;'此次入库扣料'&nbsp;LS_LBLAB&nbsp;&nbsp;',供应商库存'&nbsp;LS_LBLAB2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;无法满足入库'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_FLG_GR&nbsp;=&nbsp;'X&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_LBLAB&nbsp;=&nbsp;T_KL-LBLAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'物料'&nbsp;T_KL-MATNR&nbsp;'此次入库扣料'&nbsp;LS_LBLAB&nbsp;&nbsp;',供应商库存为空'<br />
&nbsp;&nbsp;&nbsp;'&nbsp;无法满足入库'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_FLG_GR&nbsp;=&nbsp;'X&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_mslb&nbsp;INTO&nbsp;LS_MSLB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;t_kl&nbsp;INTO&nbsp;t_kl&nbsp;with&nbsp;key&nbsp;matnr&nbsp;=&nbsp;LS_MSLB-MATNR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;LS_MSLB-LBLAB&nbsp;&lt;&nbsp;t_kl-LBLAB&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_LBLAB&nbsp;=&nbsp;t_kl-LBLAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_LBLAB2&nbsp;=&nbsp;LS_MSLB-LBLAB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'物料'&nbsp;LS_MSLB-MATNR&nbsp;&nbsp;'此次入库扣料'&nbsp;LS_LBLAB&nbsp;&nbsp;'&nbsp;库存'&nbsp;LS_LBLAB2<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;无法满足入库'&nbsp;INTO&nbsp;L_MSG&nbsp;SEPARATED&nbsp;BY&nbsp;''.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;L_MSG.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_FLG_GR&nbsp;=&nbsp;'X&nbsp;'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;FLG_EBELN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'采购订单为空，无法入库'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FLG_GR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;FLG_MBLNR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'采购订单已经入库'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_FLG_GR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_MESSAGE&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'C14Z_MESSAGES_SHOW_AS_POPUP'&nbsp;"输出检查信息<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_MESSAGE_TAB&nbsp;=&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;L_FLG_GR&nbsp;EQ&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-EBELN&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-EBELN&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-EBELP&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-EBELP&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-MATNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-MATNR&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-QNT&nbsp;&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-ZSL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-UOM&nbsp;=&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZSLDW&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-BWART&nbsp;=&nbsp;&nbsp;'101'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-WERKS&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-WERKS&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-BUDAT&nbsp;=&nbsp;ZMMDG0010_01-BUDAT&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-BLDAT&nbsp;=&nbsp;ZMMDG0010_01-BLDAT&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_MOVEDATA-BATCH&nbsp;=&nbsp;GS_ZMMDG0010-CHARG."批次<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LT_MOVEDATA.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LT_OUT.<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_po_goodsmvt/zmm_po_goodsmvt.html">'ZMM_PO_GOODSMVT'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_RETURN&nbsp;=&nbsp;L_RETURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_DATA&nbsp;&nbsp;&nbsp;=&nbsp;LT_MOVEDATA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_OUT.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*过账回写数据表，先读取物料凭证<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;LT_OUT-TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;LT_OUT-MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;L_RETURN-TYPE&nbsp;=&nbsp;'E'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_FLG&nbsp;=&nbsp;''.,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;INDEX&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PURCH_DOC_RA-LOW&nbsp;=&nbsp;GS_ZMMDG0010-EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;PURCH_DOC_RA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_GOODSMVT_GETITEMS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PURCH_DOC_RA&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PURCH_DOC_RA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOODSMVT_HEADER&nbsp;=&nbsp;GOODSMVT_HEADER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GOODSMVT_ITEMS&nbsp;&nbsp;=&nbsp;GOODSMVT_ITEMS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_OUT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT&nbsp;WHERE&nbsp;TYPE&nbsp;=&nbsp;'E'&nbsp;OR&nbsp;TYPE&nbsp;=&nbsp;'A'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RETURN-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_RETURN-TYPE&nbsp;&lt;&gt;&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GOODSMVT_ITEMS[]&nbsp;INTO&nbsp;GOODSMVT_ITEMS&nbsp;WITH&nbsp;KEY&nbsp;PO_NUMBER&nbsp;=&nbsp;GS_ZMMDG0010-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_ITEM&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE_TYPE&nbsp;=&nbsp;'101'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATERIAL&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_OUTPUT'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-MATNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-MBLNR&nbsp;=&nbsp;GOODSMVT_ITEMS-MAT_DOC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-MJAHR&nbsp;=&nbsp;GOODSMVT_ITEMS-DOC_YEAR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZEILE&nbsp;=&nbsp;GOODSMVT_ITEMS-MATDOC_ITM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GOODSMVT_HEADER&nbsp;WITH&nbsp;KEY&nbsp;MAT_DOC&nbsp;=&nbsp;&nbsp;GOODSMVT_ITEMS-MAT_DOC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-BUDAT&nbsp;=&nbsp;GOODSMVT_HEADER-PSTNG_DATE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-BLDAT&nbsp;=&nbsp;GOODSMVT_HEADER-DOC_DATE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-CHARG&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-CHARG&nbsp;=&nbsp;&nbsp;GOODSMVT_ITEMS-BATCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZSPTM+0(2)&nbsp;=&nbsp;60.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ZSPTM+2(10)&nbsp;=&nbsp;GS_ZMMDG0010-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmmif0060_fm/zmmif0060_fm.html">'ZMMIF0060_FM'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_INPUT&nbsp;&nbsp;=&nbsp;L_ZSPTM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_OUTPUT&nbsp;=&nbsp;L_ZSPTM2.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZSPTM&nbsp;=&nbsp;&nbsp;L_ZSPTM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ZMMDG0010&nbsp;FROM&nbsp;&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMDG0010_01&nbsp;FROM&nbsp;TABLE&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*更新批次特性值<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;LT_ZBATCH_CHANGE&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZBATCH_CHANGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZBATCH_CHANGE&nbsp;TYPE&nbsp;ZBATCH_CHANGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BNUM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;NUM10.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LT_OUT.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;LS_ZBATCH_CHANGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZBATCH_CHANGE&nbsp;TO&nbsp;LT_ZBATCH_CHANGE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NUMBER_GET_NEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR&nbsp;=&nbsp;'01'&nbsp;&nbsp;"在编号范围中分配的序列号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZBNUM'&nbsp;&nbsp;&nbsp;&nbsp;"编码对象名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;BNUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"输出生成的流水号<br />
<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_batch_change/zmm_batch_change.html">'ZMM_BATCH_CHANGE'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IM_NUMBER&nbsp;=&nbsp;BNUM<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_RETURN&nbsp;&nbsp;=&nbsp;L_RETURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_DATA&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_ZBATCH_CHANGE[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_RETURN&nbsp;&nbsp;=&nbsp;LT_OUT.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;LT_OUT-TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;LT_OUT-MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;L_RETURN-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*下发批次特性<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_OUTPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_VALUE_DOMAN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_VALUE_DOMAN .<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_RETURN&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;SY-SUBRC,<br />
&nbsp;&nbsp;&nbsp;&nbsp;I_DOM_APSTT&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;DD07V,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_WA_DOMTAB&nbsp;TYPE&nbsp;DD07V.<br />
<br />
&nbsp;&nbsp;IF&nbsp;I_DOM_APSTT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'DD_DOMVALUES_GET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOMNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZDE_ZXSJG'&nbsp;&nbsp;&nbsp;"“域名<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LANGU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-LANGU<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LV_RETURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DD07V_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;I_DOM_APSTT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRONG_TEXTFLAG&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;I_DOM_APSTT&nbsp;INTO&nbsp;LV_WA_DOMTAB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ITHP_PLINE-VALUE&nbsp;=&nbsp;LV_WA_DOMTAB-DOMVALUE_L.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ITHP_PLINE-TEXT&nbsp;=&nbsp;LV_WA_DOMTAB-DDTEXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ITHP_PLINE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_FREE_ALV<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_FREE_ALV .<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;FREE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_CUSTOM_CONTAINER&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_CUSTOM_CONTAINER-&gt;FREE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_GRID2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;FREE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_CUSTOM_CONTAINER2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_CUSTOM_CONTAINER2-&gt;FREE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_GRID3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID3-&gt;FREE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_CUSTOM_CONTAINER3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_CUSTOM_CONTAINER3-&gt;FREE.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;&lt;DYN_TABLE&gt;,ZMMDG0010_01.<br />
&nbsp;&nbsp;FREE:&nbsp;G_GRID,G_CUSTOM_CONTAINER,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_GRID2,G_CUSTOM_CONTAINER2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_GRID3,G_CUSTOM_CONTAINER3.<br />
<br />
&nbsp;&nbsp;FREE:&nbsp;GT_FIELDCAT[],GS_LAYOUT.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*屏幕值清除<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;&nbsp;ZHXM,&nbsp;TXT_CGZZ,TXT_CGZ,TXT_GSDM,TXT_FPH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_TM,TXT_YWLX,TXT_JSFS,TXT_XSJG,TXT_FPH,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_ZLHJ,TXT_JSHJ,TXT_BSHJ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_JCDZLHJ,TXT_JCDJSHJ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_ZLXJ,TXT_JEXJ,TXT_JSXJ,TXT_BSXJ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_CGKDJ,TXT_CGKGF,TXT_CGJFJF,TXT_CGKFJF,EKPO,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TXT_JCDBSHJ,TXT_CBHJ,TXT_LSHJ.<br />
&nbsp;&nbsp;G_ALV_EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;FREE:&nbsp;&nbsp;GT_ALVTAB&nbsp;,&nbsp;GT_CELLCOLORS,&nbsp;GT_ZMMDG0010.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SHOW_MESSAGE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_SHOW_MESSAGE .<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'C14Z_MESSAGES_SHOW_AS_POPUP'<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_MESSAGE_TAB&nbsp;=&nbsp;GT_MESSAGE.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;&lt;DYN_WA&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&lt;DYN_WA&gt;&nbsp;TO&nbsp;&lt;DYN_TABLE&gt;.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CREATE_PO<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_CREATE_PO .<br />
&nbsp;&nbsp;DATA:&nbsp;LT_DATA&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;ZSMM_PO_CREATE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_DATA&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZSMM_PO_CREATE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_POITEMS&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;BAPIMEPOITEM&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;BAPIRET2&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_PO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;EBELN,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_MBLNR&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;MBLNR,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_BSART&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BSART,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RETURN&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIRET2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_FLG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;C.<br />
<br />
   </div>
   <div class="codeComment">
*BOM&nbsp;更改<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;LT_BOM&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZSMM_BOM_CHANGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM&nbsp;TYPE&nbsp;ZSMM_BOM_CHANGE.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_GJSCZ&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMDG0010_GJSCZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_GJSCZ&nbsp;TYPE&nbsp;ZMMDG0010_GJSCZ.<br />
&nbsp;&nbsp;DATA:&nbsp;L_MOD&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;3.<br />
&nbsp;&nbsp;DATA:&nbsp;LT_MARA&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;MARA,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MARA&nbsp;TYPE&nbsp;MARA.<br />
&nbsp;&nbsp;DATA:&nbsp;MSG&nbsp;TYPE&nbsp;STRING.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;HXM&nbsp;TYPE&nbsp;NUM5.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;采购组织唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_EKORG&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKORG&nbsp;TYPE&nbsp;EKORG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_EKORG.<br />
   </div>
   <div class="codeComment">
*&nbsp;采购组织唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_EKGRP&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKGRP&nbsp;TYPE&nbsp;EKGRP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_EKGRP.<br />
   </div>
   <div class="codeComment">
*&nbsp;公司代码<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_BUKRS&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUKRS&nbsp;TYPE&nbsp;BUKRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_BUKRS.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;供应商唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_ZGYSDM&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZGYSDM&nbsp;TYPE&nbsp;CHAR10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_ZGYSDM.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;税码唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_MWSKZ&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MWSKZ&nbsp;TYPE&nbsp;MWSKZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_MWSKZ.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;业务类型唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_ZYWLX&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZYWLX&nbsp;TYPE&nbsp;ZDE_ZYWLX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_ZYWLX.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;结算方式唯一检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;IT_ZLYJSFS&nbsp;OCCURS&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZLYJSFS&nbsp;TYPE&nbsp;ZDE_ZLYJSFS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;IT_ZLYJSFS.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_LIFNR&nbsp;TYPE&nbsp;LIFNR.<br />
   </div>
   <div class="codeComment">
*&nbsp;判断检查或保存时，所有行项目中采购组织ZMM0003-EKORG<br />
*、采购组ZMM0003-EKGRP、<br />
*公司代码ZMM0003-BUKRS、供应商ZMM0003-ZGYSDM、业务类型、<br />
*结算方式值是否唯一，如果不唯一，则返回错误消息‘存在多个XXX值，请检查’<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_BUKRS-BUKRS&nbsp;=&nbsp;GS_ZMMDG0010-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_EKORG-EKORG&nbsp;=&nbsp;GS_ZMMDG0010-EKORG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_EKORG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_EKGRP-EKGRP&nbsp;=&nbsp;GS_ZMMDG0010-EKGRP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_EKGRP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_ZGYSDM-ZGYSDM&nbsp;=&nbsp;GS_ZMMDG0010-ZGYSDM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_ZGYSDM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_MWSKZ-MWSKZ&nbsp;=&nbsp;GS_ZMMDG0010-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_ZYWLX-ZYWLX&nbsp;=&nbsp;GS_ZMMDG0010-ZYWLX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_ZYWLX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IT_ZLYJSFS-ZLYJSFS&nbsp;=&nbsp;GS_ZMMDG0010-ZLYJSFS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;IT_ZLYJSFS.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_BUKRS.<br />
&nbsp;&nbsp;SORT&nbsp;IT_EKORG.<br />
&nbsp;&nbsp;SORT&nbsp;IT_EKGRP.<br />
&nbsp;&nbsp;SORT&nbsp;IT_ZGYSDM.<br />
&nbsp;&nbsp;SORT&nbsp;IT_MWSKZ.<br />
&nbsp;&nbsp;SORT&nbsp;IT_ZYWLX.<br />
&nbsp;&nbsp;SORT&nbsp;IT_ZLYJSFS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_BUKRS&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_EKORG&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_EKGRP&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_ZGYSDM&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_MWSKZ&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_ZYWLX&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_ZLYJSFS&nbsp;COMPARING&nbsp;ALL&nbsp;FIELDS.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_BUKRS&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'公司代码不是唯一，请检查'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_EKORG&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'采购组织不是唯一，请检查'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_EKGRP&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'采购组不是唯一，请检查'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_ZGYSDM&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'供应商不是唯一，请检查'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_MWSKZ&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'税码不是唯一，请检查'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_ZYWLX&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'业务类型不是唯一，请检查'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_ZLYJSFS&nbsp;INDEX&nbsp;2.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'结算方式不是唯一，请检查'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GT_MESSAGE.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;LT_GJSCZ&nbsp;FROM&nbsp;ZMMDG0010_GJSCZ.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_ZMMDG0010&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'检索数据为空，无法创建PO'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;HXM&nbsp;=&nbsp;10.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-EBELP&nbsp;=&nbsp;HXM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;LS_DATA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_DATA-EBELP&nbsp;=&nbsp;HXM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_DATA-MENGE&nbsp;=&nbsp;GS_ZMMDG0010-ZSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_DATA-MEINS&nbsp;=&nbsp;GS_ZMMDG0010-ZSLDW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_DATA-EEIND&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_DATA-NETPR&nbsp;=&nbsp;GS_ZMMDG0010-ZCGJG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_DATA-BATCH&nbsp;=&nbsp;GS_ZMMDG0010-CHARG."批次<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;LS_DATA-BATCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;LS_DATA-BATCH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;&nbsp;LS_DATA&nbsp;TO&nbsp;LT_DATA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;HXM&nbsp;=&nbsp;HXM&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ZMMDG0010&nbsp;FROM&nbsp;GS_ZMMDG0010&nbsp;TRANSPORTING&nbsp;EBELP.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010&nbsp;INDEX&nbsp;1.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;创建PO<br />
*--------------------------------------------------------------------*<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-EBELN&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_FLG&nbsp;&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;&nbsp;X&nbsp;表示初始PO为空<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_PO&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-EBELN.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_MBLNR&nbsp;=&nbsp;&nbsp;GS_ZMMDG0010-MBLNR.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_FLG&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;PO_FLG&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_po_create/zmm_po_create.html">'ZMM_PO_CREATE'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_YWLX&nbsp;&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-ZYWLX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_PO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;O_PO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_BSART&nbsp;&nbsp;=&nbsp;O_BSART<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_RETURN&nbsp;=&nbsp;L_RETURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_DATA&nbsp;&nbsp;&nbsp;=&nbsp;LT_DATA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_ITEM&nbsp;&nbsp;&nbsp;=&nbsp;LT_POITEMS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_OUT.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;LT_OUT-TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;LT_OUT-MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_RETURN-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_FLG&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;PO&nbsp;回写数据表&nbsp;&nbsp;采购订单创建成功<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_POITEMS[]&nbsp;INTO&nbsp;LT_POITEMS&nbsp;WITH&nbsp;KEY&nbsp;PO_ITEM&nbsp;=&nbsp;GS_ZMMDG0010-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-EBELN&nbsp;=&nbsp;O_PO.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-EBELP&nbsp;=&nbsp;LT_POITEMS-PO_ITEM.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
***&nbsp;委外BOM&nbsp;赋值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_GJSCZ&nbsp;INTO&nbsp;LS_GJSCZ&nbsp;WITH&nbsp;KEY&nbsp;GJSCZ&nbsp;=&nbsp;GS_ZMMDG0010-ZGJSCZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_GJSCZ-GJSBL&nbsp;IS&nbsp;NOT&nbsp;&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MOD&nbsp;=&nbsp;&nbsp;LS_GJSCZ-YLBL&nbsp;/&nbsp;LS_GJSCZ-GJSBL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_MOD&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ZMMDG0010-ZWWZJZ&nbsp;=&nbsp;GS_ZMMDG0010-ZWWJZ&nbsp;*&nbsp;L_MOD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELN&nbsp;=&nbsp;O_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELP&nbsp;=&nbsp;GS_ZMMDG0010-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MATNR&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-IDNRK&nbsp;=&nbsp;LS_GJSCZ-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MEINS&nbsp;=&nbsp;'G'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MENGE&nbsp;=&nbsp;GS_ZMMDG0010-ZWWZJZ&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_BOM&nbsp;&nbsp;TO&nbsp;LT_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQZSBM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELN&nbsp;=&nbsp;O_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELP&nbsp;=&nbsp;GS_ZMMDG0010-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MATNR&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-IDNRK&nbsp;=&nbsp;GS_ZMMDG0010-ZXQZSBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MEINS&nbsp;=&nbsp;GS_ZMMDG0010-ZXQZSZLDW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MENGE&nbsp;=&nbsp;GS_ZMMDG0010-ZXQZSZL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_BOM&nbsp;&nbsp;TO&nbsp;LT_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELN&nbsp;=&nbsp;O_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELP&nbsp;=&nbsp;GS_ZMMDG0010-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MATNR&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-IDNRK&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSBM1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MEINS&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSZLDW1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MENGE&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSLZL1&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_BOM&nbsp;&nbsp;TO&nbsp;LT_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELN&nbsp;=&nbsp;O_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELP&nbsp;=&nbsp;GS_ZMMDG0010-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MATNR&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-IDNRK&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSBM2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MEINS&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSZLDW2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MENGE&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSLZL2&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_BOM&nbsp;&nbsp;TO&nbsp;LT_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM3&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELN&nbsp;=&nbsp;O_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELP&nbsp;=&nbsp;GS_ZMMDG0010-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MATNR&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-IDNRK&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSBM3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MEINS&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSZLDW3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MENGE&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSLZL3&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_BOM&nbsp;&nbsp;TO&nbsp;LT_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ZMMDG0010-ZXQPSBM4&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELN&nbsp;=&nbsp;O_PO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-EBELP&nbsp;=&nbsp;GS_ZMMDG0010-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MATNR&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-IDNRK&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSBM4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MEINS&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSZLDW4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BOM-MENGE&nbsp;=&nbsp;GS_ZMMDG0010-ZXQPSLZL4&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_BOM&nbsp;&nbsp;TO&nbsp;LT_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ZMMDG0010&nbsp;FROM&nbsp;&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMDG0010_01&nbsp;FROM&nbsp;TABLE&nbsp;GT_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;委外BOM更改<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;O_BSART&nbsp;=&nbsp;'Z001'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_bom_change/zmm_bom_change.html">'ZMM_BOM_CHANGE'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_RETURN&nbsp;=&nbsp;L_RETURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_DATA&nbsp;&nbsp;&nbsp;=&nbsp;LT_BOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_OUT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;LT_OUT-TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;LT_OUT-MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_RETURN-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PO_FLG&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'采购订单已经创建'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_DELETE_LIEN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_DELETE_LIEN .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;&nbsp;LT_ROWID&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;LVC_T_ROW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_ROW&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;LVC_T_ROID,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ROW&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;LVC_S_ROID.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_ALV&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZMMDG0010_01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ALV&nbsp;TYPE&nbsp;ZMMDG0010_01.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID-&gt;GET_SELECTED_ROWS(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROWID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_ROW_NO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_ROW&nbsp;).<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;G_GRID2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;G_GRID2-&gt;GET_SELECTED_ROWS(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_INDEX_ROWS&nbsp;=&nbsp;LT_ROWID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_ROW_NO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_ROW&nbsp;).<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_ROW&nbsp;DESCENDING&nbsp;BY&nbsp;ROW_ID.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_ROW&nbsp;INTO&nbsp;LS_ROW&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;&lt;DYN_TABLE&gt;&nbsp;INDEX&nbsp;&nbsp;LS_ROW-ROW_ID.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_CHANGE_CHARG<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_CHANGE_CHARG .<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*更新批次特性值<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;LT_ZBATCH_CHANGE&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZBATCH_CHANGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ZBATCH_CHANGE&nbsp;TYPE&nbsp;ZBATCH_CHANGE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_OUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;BAPIRET2&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_RETURN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BAPIRET2.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LT_OUT.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ZMMDG0010&nbsp;TO&nbsp;LS_ZBATCH_CHANGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_ZBATCH_CHANGE&nbsp;TO&nbsp;LT_ZBATCH_CHANGE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;BNUM&nbsp;TYPE&nbsp;NUM10.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NUMBER_GET_NEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR&nbsp;=&nbsp;'01'&nbsp;&nbsp;"在编号范围中分配的序列号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZBNUM'&nbsp;&nbsp;&nbsp;&nbsp;"编码对象名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;BNUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"输出生成的流水号<br />
<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmm_batch_change/zmm_batch_change.html">'ZMM_BATCH_CHANGE'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IM_NUMBER&nbsp;=&nbsp;BNUM<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_RETURN&nbsp;&nbsp;=&nbsp;L_RETURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_DATA&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_ZBATCH_CHANGE[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_RETURN&nbsp;&nbsp;=&nbsp;LT_OUT.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OUT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGID&nbsp;=&nbsp;'ZMM01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGNO&nbsp;=&nbsp;'000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGTY&nbsp;=&nbsp;LT_OUT-TYPE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MESSAGE-MSGV1&nbsp;=&nbsp;LT_OUT-MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MESSAGE&nbsp;TO&nbsp;GT_MESSAGE.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;L_RETURN-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*下发批次特性<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ZMMDG0010&nbsp;INTO&nbsp;GS_ZMMDG0010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_OUTPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;&nbsp;=&nbsp;GS_ZMMDG0010-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;GS_ZMMDG0010-MATNR.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Module&nbsp;&nbsp;MOD_JSFS_F4&nbsp;&nbsp;INPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
MODULE MOD_JSFS_F4 INPUT.<br />
<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_DYNPREAD&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;DYNPREAD&nbsp;.<br />
&nbsp;&nbsp;DATA:&nbsp;LW_DYNPREAD&nbsp;TYPE&nbsp;DYNPREAD&nbsp;.<br />
<br />
&nbsp;&nbsp;LW_DYNPREAD-FIELDNAME&nbsp;=&nbsp;'TXT_YWLX'.<br />
&nbsp;&nbsp;APPEND&nbsp;LW_DYNPREAD&nbsp;TO&nbsp;LT_DYNPREAD&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'DYNP_VALUES_READ'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNUMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-DYNNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPFIELDS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LT_DYNPREAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_ABAPWORKAREA&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_DYNPROFIELD&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_DYNPRONAME&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_DYNPRONUMMER&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_REQUEST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_FIELDDESCRIPTION&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INVALID_PARAMETER&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNDEFIND_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOUBLE_CONVERSION&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STEPL_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;10<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;FREE:&nbsp;GT_JSFSF4[],ITHP_JSFS[].<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_DYNPREAD&nbsp;INTO&nbsp;LW_DYNPREAD&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;TABLE&nbsp;GT_JSFSF4&nbsp;FROM&nbsp;ZMMDG0010_VJSFS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZYWLX&nbsp;=&nbsp;LW_DYNPREAD-FIELDVALUE.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;GT_JSFSF4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ITHP_JSFS-VALUE&nbsp;=&nbsp;GT_JSFSF4-ZJSFS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_JSFS&nbsp;INTO&nbsp;GT_JSFS&nbsp;WITH&nbsp;KEY&nbsp;BM&nbsp;=&nbsp;GT_JSFSF4-ZJSFS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITHP_JSFS-TEXT&nbsp;=&nbsp;GT_JSFS-BMTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ITHP_JSFS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETFIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'VALUE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;大写,可选值内表的字段名<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;就写'S'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPPROG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;返回的输入框所在的main&nbsp;program<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-DYNNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;返回的输入框所在屏幕<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPROFIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'TXT_JSFS'&nbsp;&nbsp;&nbsp;&nbsp;"返回的输入框名<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ITHP_JSFS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;可选值的内表<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARAMETER_ERROR&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_VALUES_FOUND&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDMODULE.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Module&nbsp;&nbsp;MOD_YWLX_F4&nbsp;&nbsp;INPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
MODULE MOD_YWLX_F4 INPUT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;TXT_JSFS.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ITHP_YWLX&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;GT_YWLX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITHP_YWLX-VALUE&nbsp;=&nbsp;GT_YWLX-BM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITHP_YWLX-TEXT&nbsp;=&nbsp;GT_YWLX-BMTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ITHP_YWLX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETFIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'VALUE'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;大写,可选值内表的字段名<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;就写'S'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPPROG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;返回的输入框所在的main&nbsp;program<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-DYNNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;返回的输入框所在屏幕<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNPROFIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'TXT_YWLX'&nbsp;&nbsp;&nbsp;&nbsp;"返回的输入框名<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE_TAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ITHP_YWLX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;可选值的内表<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARAMETER_ERROR&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_VALUES_FOUND&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;SY-MSGID&nbsp;TYPE&nbsp;SY-MSGTY&nbsp;NUMBER&nbsp;SY-MSGNO<br />
&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SY-MSGV1&nbsp;SY-MSGV2&nbsp;SY-MSGV3&nbsp;SY-MSGV4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
ENDMODULE.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
