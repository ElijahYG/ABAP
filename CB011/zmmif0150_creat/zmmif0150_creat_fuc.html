<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=GBK" />
<title>ZMMIF0150_CREAT_FUC</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMIF0150_CREAT_FUC</h2>
<h3> Description: Include ZMMIF0150_CREAT_FUC</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;包含&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMIF0150_CREAT_FUC<br />
*&---------------------------------------------------------------------*<br />
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_MAIN_PROCESS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_MAIN_PROCESS .<br />
<br />
&nbsp;&nbsp;CLEAR:SYS.<br />
<br />
   </div>
   <div class="codeComment">
*屏幕输入检查<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_INPUT_FIELD_CHECK.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*数据处理<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_MAIN_DATA.<br />
<br />
   </div>
   <div class="codeComment">
*-----20160128&nbsp;BY&nbsp;LINAN---------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FM_ADD_CBJE.<br />
   </div>
   <div class="codeComment">
*------------END----------------<br />
<br />
*Message<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_SHOW_MESSAGE.<br />
<br />
ENDFORM.<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*在途取数函数<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
FORM GET_DAT1.<br />
<br />
&nbsp;&nbsp;CLEAR:SYS.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*取EKPO&nbsp;采购订单(调拨单)信息<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_EKPO_INFO.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*取EKBE&nbsp;交货历史记录<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_EKBE_INFO.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*库存地点<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_LGORT_INFO.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*物料信息<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_MARA_INFO.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*批次特性<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_GET_CHARG_INFO.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*数据整合<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;FRM_INTEGRATION_DATA.<br />
<br />
   </div>
   <div class="codeComment">
*************20160830-LINAN-修改库存地点**************************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;LS_TABLE&gt;&nbsp;TYPE&nbsp;STRU_0010.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;ASSIGNING&nbsp;&lt;LS_TABLE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;LS_TABLE&gt;-LGORT&nbsp;=&nbsp;'9999'.<br />
&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
********************end****************************************<br />
<br />
<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*取单位<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;IT_T_CHARACTERS-ZXSJGJLDW.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单位<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;MEINS.<br />
*<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*取单品件数<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
*&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;WITH&nbsp;KEY&nbsp;XCHPF&nbsp;=&nbsp;'X'&nbsp;.<br />
<br />
*&nbsp;&nbsp;clear&nbsp;wa_table.<br />
*<br />
*&nbsp;&nbsp;loop&nbsp;at&nbsp;it_t_characters.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;read&nbsp;table&nbsp;it_table&nbsp;into&nbsp;wa_table&nbsp;with&nbsp;&nbsp;key&nbsp;matnr&nbsp;=&nbsp;it_t_characters-matnr&nbsp;charg&nbsp;=&nbsp;it_t_characters-charg&nbsp;binary&nbsp;search.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;lv_index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-tabix.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zjz&nbsp;=&nbsp;it_t_characters-zjz.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"取单品克重<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;index&nbsp;lv_index&nbsp;transporting&nbsp;zjz.<br />
*<br />
*&nbsp;&nbsp;endloop.<br />
<br />
*&nbsp;&nbsp;clear&nbsp;wa_table.<br />
<br />
*<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
**排序<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
*&nbsp;&nbsp;sort&nbsp;it_table&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;matnr&nbsp;charg&nbsp;.<br />
*<br />
*&nbsp;&nbsp;sort&nbsp;it_t_characters&nbsp;by&nbsp;matnr&nbsp;charg.<br />
*<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
**依据所给条件取相应数据<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
*<br />
*&nbsp;&nbsp;loop&nbsp;at&nbsp;it_t_characters&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;read&nbsp;table&nbsp;it_table&nbsp;into&nbsp;wa_table&nbsp;with&nbsp;key&nbsp;matnr&nbsp;=&nbsp;it_t_characters-matnr&nbsp;charg&nbsp;=&nbsp;it_t_characters-charg&nbsp;binary&nbsp;search.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;lv_index&nbsp;=&nbsp;sy-tabix.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-xchpf&nbsp;=&nbsp;'X'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zbqmc&nbsp;&nbsp;=&nbsp;it_t_characters-zbqmc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-charg&nbsp;&nbsp;=&nbsp;wa_table-charg.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次号<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zcklsj&nbsp;=&nbsp;it_t_characters-zcklsj.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zsptm&nbsp;&nbsp;=&nbsp;it_t_characters-zsptm.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品条码<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zspbm&nbsp;&nbsp;=&nbsp;it_t_characters-zspbm.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品包码<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zfph&nbsp;&nbsp;&nbsp;=&nbsp;it_t_characters-zfph.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"分配号<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-clabs&nbsp;&nbsp;=&nbsp;wa_table-clabs.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;index&nbsp;lv_index&nbsp;transporting&nbsp;zbqmc&nbsp;charg&nbsp;zcklsj&nbsp;zsptm&nbsp;zspbm&nbsp;zfph&nbsp;clabs.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;endloop.<br />
*<br />
*&nbsp;&nbsp;clear&nbsp;wa_table.<br />
*<br />
*&nbsp;&nbsp;loop&nbsp;at&nbsp;it_table&nbsp;into&nbsp;wa_table.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-meins&nbsp;=&nbsp;'G'&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-tempb&nbsp;&lt;&gt;&nbsp;'01'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-zjz&nbsp;is&nbsp;initial&nbsp;or&nbsp;wa_table-zjz&nbsp;=&nbsp;'0'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单品克重为空或者为0<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;=&nbsp;'1'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;=&nbsp;wa_table-zztsl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;&nbsp;transporting&nbsp;zdpjs&nbsp;zzkz.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;/&nbsp;wa_table-zjz.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;&nbsp;transporting&nbsp;zdpjs&nbsp;zzkz.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-meins&nbsp;&lt;&gt;&nbsp;'G'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-tempb&nbsp;&lt;&gt;&nbsp;'01'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-zjz&nbsp;is&nbsp;initial&nbsp;or&nbsp;wa_table-zjz&nbsp;=&nbsp;'0'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单品克重为空或者为0<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;=&nbsp;'0'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;&nbsp;transporting&nbsp;zzkz&nbsp;zdpjs.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;*&nbsp;wa_table-zjz.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;&nbsp;transporting&nbsp;zzkz&nbsp;zdpjs.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-meins&nbsp;=&nbsp;'ST'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-tempb&nbsp;=&nbsp;'01'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;wa_table-zztsl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PC\X的件数<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;&nbsp;=&nbsp;wa_table-zjz&nbsp;*&nbsp;wa_table-zztsl.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;&nbsp;transporting&nbsp;zdpjs&nbsp;zzkz.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-meins&nbsp;&lt;&gt;&nbsp;'ST'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-tempb&nbsp;=&nbsp;'01'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-zjz&nbsp;is&nbsp;initial&nbsp;or&nbsp;wa_table-zjz&nbsp;=&nbsp;'0'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;'1'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;&nbsp;transporting&nbsp;zdpjs&nbsp;zzkz.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;/&nbsp;wa_table-zjz.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;&nbsp;transporting&nbsp;zzkz&nbsp;zdpjs.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;endloop.<br />
*<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
**不属于批次管理的数值<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
*<br />
*&nbsp;&nbsp;clear&nbsp;wa_table.<br />
*<br />
*&nbsp;&nbsp;loop&nbsp;at&nbsp;it_table&nbsp;into&nbsp;wa_table&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-xchpf&nbsp;=&nbsp;''.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zbqmc&nbsp;&nbsp;=&nbsp;wa_table-maktx.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-charg&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次号<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zcklsj&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zsptm&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品条码<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zspbm&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品包码<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-clabs&nbsp;&nbsp;=&nbsp;wa_table-labst.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;transporting&nbsp;zbqmc&nbsp;charg&nbsp;zcklsj&nbsp;zsptm&nbsp;zspbm&nbsp;clabs.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-meins&nbsp;=&nbsp;'G'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;&nbsp;=&nbsp;wa_table-zztsl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总克重<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;transporting&nbsp;zzkz&nbsp;zdpjs.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;wa_table-meins&nbsp;=&nbsp;'ST'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zzkz&nbsp;&nbsp;&nbsp;=&nbsp;wa_table-zztsl&nbsp;*&nbsp;wa_table-zjz.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总克重<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_table-zdpjs&nbsp;&nbsp;=&nbsp;wa_table-zztsl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;it_table&nbsp;from&nbsp;wa_table&nbsp;transporting&nbsp;zzkz&nbsp;zdpjs.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
*<br />
*&nbsp;&nbsp;endloop.<br />
*<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
**排序<br />
**------------------------------------------------------------------------------------------------------------------------------------<br />
*<br />
*&nbsp;&nbsp;sort&nbsp;it_table&nbsp;by&nbsp;matnr.<br />
<br />
<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*在途ALV1显示<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
FORM ALV_SHOW1.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-Z_NUMB&nbsp;=&nbsp;SY-TABIX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;Z_NUMB.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;IT_FIELDCAT[].<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'Z_NUMB'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'行号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WERKS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'门店'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LGORT'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'库存地'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WERKS_SH'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'收货工厂'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品款号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
   </div>
   <div class="codeComment">
**********************************************************************<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELN'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'转储单号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELP'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'行项目'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MENGE_ZT'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'在途数量'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'发货数量'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BPMNG'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'收货数量'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
   </div>
   <div class="codeComment">
**********************************************************************<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPTM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品条码'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPBM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品包码'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZBQMC'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'标签名称'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CHARG'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'批次号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZJZ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'单品克重'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;clear:&nbsp;wa_fieldcat.<br />
*&nbsp;&nbsp;wa_fieldcat-tabname&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
*&nbsp;&nbsp;wa_fieldcat-fieldname&nbsp;=&nbsp;'CLABS'.<br />
*&nbsp;&nbsp;wa_fieldcat-seltext_l&nbsp;=&nbsp;'数量'.<br />
*&nbsp;&nbsp;append&nbsp;wa_fieldcat&nbsp;to&nbsp;it_fieldcat.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZZKZ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'总克重'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'单位'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MARA'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZDPJS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'件数'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZCKLSJ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'参考零售价'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'TEMPB'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品类型标记'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZFPH'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'分配号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EXTWG'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'大类'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EX_PZ01'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'品种一级'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;clear:&nbsp;wa_fieldcat.<br />
*&nbsp;&nbsp;wa_fieldcat-tabname&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
*&nbsp;&nbsp;wa_fieldcat-fieldname&nbsp;=&nbsp;'VBELN'.<br />
*&nbsp;&nbsp;wa_fieldcat-seltext_l&nbsp;=&nbsp;'交货单号'.<br />
*&nbsp;&nbsp;append&nbsp;wa_fieldcat&nbsp;to&nbsp;it_fieldcat.<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WA_LAYOUT-COLWIDTH_OPTIMIZE&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"自动适应最大列宽<br />
&nbsp;&nbsp;WA_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"前置零&nbsp;&nbsp;补零<br />
<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_FIELDCAT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'PF_STATUS_SET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'USER_COMMAND'<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*正常取数函数<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
FORM GET_DAT.<br />
   </div>
   <div class="codeComment">
*********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START&nbsp;*****************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_TABLE&nbsp;LIKE&nbsp;IT_TABLE[]&nbsp;WITH&nbsp;HEADER&nbsp;LINE.<br />
   </div>
   <div class="codeComment">
*********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;END&nbsp;&nbsp;&nbsp;*****************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;IT_TABLE[].<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
   </div>
   <div class="codeComment">
*********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START&nbsp;*****************<br />
**查询表内数据<br />
*&nbsp;&nbsp;SELECT<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~MATNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LABST<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~WERKS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LGORT<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MEINS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EXTWG<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~TEMPB<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~XCHPF<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~CHARG<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~CLABS<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E~MAKTX<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_TABLE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MARD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;A&nbsp;INNER&nbsp;JOIN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;B&nbsp;ON&nbsp;B~MATNR&nbsp;EQ&nbsp;A~MATNR&nbsp;INNER&nbsp;JOIN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAKT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;E&nbsp;ON&nbsp;E~MATNR&nbsp;EQ&nbsp;A~MATNR&nbsp;LEFT&nbsp;JOIN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MCHB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;C&nbsp;ON&nbsp;C~LGORT&nbsp;EQ&nbsp;A~LGORT&nbsp;AND&nbsp;C~MATNR&nbsp;EQ&nbsp;A~MATNR&nbsp;AND&nbsp;C~WERKS&nbsp;EQ&nbsp;A~WERKS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~WERKS&nbsp;&nbsp;&nbsp;IN&nbsp;S_WERKS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~LGORT&nbsp;&nbsp;&nbsp;IN&nbsp;S_LGORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"以什么条件找<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EXTWG&nbsp;&nbsp;&nbsp;IN&nbsp;S_EXTWG<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MATNR&nbsp;&nbsp;&nbsp;IN&nbsp;S_MATNR.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;MATNR&nbsp;EX_PZ01&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;WA_ZMMEX0010_MARA<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_MARA<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;WA_TABLE-MATNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EX_PZ01&nbsp;IN&nbsp;S_EX_PZ1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_ZMMEX0010_MARA&nbsp;TO&nbsp;IT_ZMMEX0010_MARA.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDSELECT.<br />
*<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*&nbsp;1.取无批次商品库存<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LABST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LGORT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~TEMPB<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MATKL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~XCHPF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C~MAKTX<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MARD&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;MARA&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;B~MATNR&nbsp;=&nbsp;A~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;MAKT&nbsp;AS&nbsp;C<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;C~MATNR&nbsp;EQ&nbsp;A~MATNR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~WERKS&nbsp;&nbsp;&nbsp;IN&nbsp;S_WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~LGORT&nbsp;&nbsp;&nbsp;IN&nbsp;S_LGORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"以什么条件找<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EXTWG&nbsp;&nbsp;&nbsp;IN&nbsp;S_EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MATNR&nbsp;&nbsp;&nbsp;IN&nbsp;S_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~MATKL&nbsp;&nbsp;&nbsp;IN&nbsp;S_MATKL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LGORT<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~TEMPB<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~XCHPF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MATKL<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~CLABS<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E~MAKTX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPENDING&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MCHB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;&nbsp;MARA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;B~MATNR&nbsp;=&nbsp;A~MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;MAKT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;E<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;E~MATNR&nbsp;=&nbsp;A~MATNR<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~WERKS&nbsp;&nbsp;&nbsp;IN&nbsp;S_WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~LGORT&nbsp;&nbsp;&nbsp;IN&nbsp;S_LGORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"以什么条件找<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~EXTWG&nbsp;&nbsp;&nbsp;IN&nbsp;S_EXTWG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~MATNR&nbsp;&nbsp;&nbsp;IN&nbsp;S_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~MATKL&nbsp;&nbsp;&nbsp;IN&nbsp;S_MATKL.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;IT_ZMMEX0010_MARA[].<br />
&nbsp;&nbsp;LT_TABLE[]&nbsp;=&nbsp;IT_TABLE[].<br />
&nbsp;&nbsp;SORT&nbsp;LT_TABLE&nbsp;BY&nbsp;MATNR.<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;LT_TABLE&nbsp;COMPARING&nbsp;MATNR.<br />
&nbsp;&nbsp;IF&nbsp;LT_TABLE[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EX_PZ01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_ZMMEX0010_MARA[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;LT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;LT_TABLE-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EX_PZ01&nbsp;IN&nbsp;S_EX_PZ1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;END&nbsp;&nbsp;&nbsp;*****************<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BY&nbsp;MATNR.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_ZMMEX0010_MARA&nbsp;BY&nbsp;MATNR.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_ZMMEX0010_MARA&nbsp;INTO&nbsp;WA_ZMMEX0010_MARA&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;WA_TABLE-MATNR&nbsp;BINARY&nbsp;SEARCH.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;LV_INDEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-TABIX.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-EX_PZ01&nbsp;=&nbsp;WA_ZMMEX0010_MARA-EX_PZ01.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;INDEX&nbsp;LV_INDEX&nbsp;TRANSPORTING&nbsp;EX_PZ01.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;EX_PZ01.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;IF&nbsp;S_EX_PZ1&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;IT_TABLE&nbsp;WHERE&nbsp;EX_PZ01&nbsp;&lt;&gt;&nbsp;S_EX_PZ1-LOW&nbsp;OR&nbsp;EX_PZ01&nbsp;IS&nbsp;INITIAL.<br />
*<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;S_EX_PZ1[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;IT_TABLE&nbsp;WHERE&nbsp;EX_PZ01&nbsp;NOT&nbsp;IN&nbsp;S_EX_PZ1[].<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*清除零库存<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-XCHPF&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-LABST&nbsp;=&nbsp;WA_TABLE-CLABS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-LABST&nbsp;=&nbsp;WA_TABLE-LABST.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;IT_TABLE&nbsp;WHERE&nbsp;LABST&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;LABST&nbsp;=&nbsp;0.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-LABST&nbsp;=&nbsp;0&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;TABLE&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*取数批次特性<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:IT_T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_T_CHARACTERS&nbsp;LIKE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZMM_CHARACTERS&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_T_CHARACTERS&nbsp;LIKE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM_CHARACTERS.<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE[]&nbsp;TO&nbsp;IT_T_CHARG[].<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zsdrp0020_fm_01/zsdrp0020_fm_01.html">'ZSDRP0020_FM_01'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_T_CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARACTERS&nbsp;=&nbsp;IT_T_CHARACTERS.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*排序<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_T_CHARACTERS&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*取单位<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;IT_T_CHARACTERS-ZXSJGJLDW.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单位<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;MEINS.<br />
*<br />
*&nbsp;&nbsp;ENDLOOP.<br />
<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*取单品件数<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
*&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;WITH&nbsp;KEY&nbsp;XCHPF&nbsp;=&nbsp;'X'&nbsp;.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_T_CHARACTERS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;WITH&nbsp;&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;IT_T_CHARACTERS-MATNR&nbsp;CHARG&nbsp;=&nbsp;IT_T_CHARACTERS-CHARG&nbsp;BINARY&nbsp;SEARCH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_INDEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-TABIX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZJZ&nbsp;=&nbsp;IT_T_CHARACTERS-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"取单品克重<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;INDEX&nbsp;LV_INDEX&nbsp;TRANSPORTING&nbsp;ZJZ.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*排序<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_T_CHARACTERS&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*依据所给条件取相应数据<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_T_CHARACTERS&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;IT_T_CHARACTERS-MATNR&nbsp;CHARG&nbsp;=&nbsp;IT_T_CHARACTERS-CHARG&nbsp;BINARY&nbsp;SEARCH.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_INDEX&nbsp;=&nbsp;SY-TABIX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-XCHPF&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZBQMC&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZBQMC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-CHARG&nbsp;&nbsp;=&nbsp;WA_TABLE-CHARG.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZCKLSJ&nbsp;=&nbsp;IT_T_CHARACTERS-ZCKLSJ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSPTM&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZSPTM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品条码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSPBM&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZSPBM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品包码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZFPH&nbsp;&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZFPH.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"分配号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-CLABS&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;INDEX&nbsp;LV_INDEX&nbsp;TRANSPORTING&nbsp;ZBQMC&nbsp;CHARG&nbsp;ZCKLSJ&nbsp;ZSPTM&nbsp;ZSPBM&nbsp;ZFPH&nbsp;CLABS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;'G'&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-TEMPB&nbsp;&lt;&gt;&nbsp;'01'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-ZJZ&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;WA_TABLE-ZJZ&nbsp;=&nbsp;'0'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单品克重为空或者为0<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;=&nbsp;'1'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;ZDPJS&nbsp;ZZKZ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;/&nbsp;WA_TABLE-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;ZDPJS&nbsp;ZZKZ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;&lt;&gt;&nbsp;'G'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-TEMPB&nbsp;&lt;&gt;&nbsp;'01'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-ZJZ&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;WA_TABLE-ZJZ&nbsp;=&nbsp;'0'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"单品克重为空或者为0<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;=&nbsp;'0'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;ZZKZ&nbsp;ZDPJS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;*&nbsp;WA_TABLE-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;ZZKZ&nbsp;ZDPJS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;'ST'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-TEMPB&nbsp;=&nbsp;'01'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PC\X的件数<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZJZ&nbsp;*&nbsp;WA_TABLE-CLABS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;ZDPJS&nbsp;ZZKZ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;&lt;&gt;&nbsp;'ST'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-TEMPB&nbsp;=&nbsp;'01'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-ZJZ&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;WA_TABLE-ZJZ&nbsp;=&nbsp;'0'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;'1'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;ZDPJS&nbsp;ZZKZ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-ZJZ&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;/&nbsp;WA_TABLE-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;&nbsp;TRANSPORTING&nbsp;ZZKZ&nbsp;ZDPJS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*不属于批次管理的数值<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-XCHPF&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZBQMC&nbsp;&nbsp;=&nbsp;WA_TABLE-MAKTX.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-CHARG&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZCKLSJ&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSPTM&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品条码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZSPBM&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品包码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-CLABS&nbsp;&nbsp;=&nbsp;WA_TABLE-LABST.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"数量<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZBQMC&nbsp;CHARG&nbsp;ZCKLSJ&nbsp;ZSPTM&nbsp;ZSPBM&nbsp;CLABS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;'G'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-LABST.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总克重<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZZKZ&nbsp;ZDPJS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;WA_TABLE-MEINS&nbsp;=&nbsp;'ST'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-LABST&nbsp;*&nbsp;WA_TABLE-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总克重<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZDPJS&nbsp;&nbsp;=&nbsp;WA_TABLE-LABST.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZZKZ&nbsp;ZDPJS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*排序<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;BY&nbsp;MATNR.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
**判断生成是否成功<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*<br />
*&nbsp;&nbsp;Z_PDBH&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;SY-DATUM&nbsp;&&&nbsp;SY-UZEIT.<br />
*<br />
*&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'盘点表'&nbsp;Z_PDBH&nbsp;'生成'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
<br />
   </div>
   <div class="code">
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*正常ALV显示<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
FORM ALV_SHOW.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-Z_NUMB&nbsp;=&nbsp;SY-TABIX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;Z_NUMB.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;IT_FIELDCAT[].<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'Z_NUMB'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'行号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WERKS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'门店'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LGORT'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'库存地'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品款号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPTM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品条码'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPBM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品包码'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZBQMC'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'标签名称'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CHARG'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'批次号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZJZ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'单品克重'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CLABS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'数量'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZZKZ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'总克重'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'单位'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MARA'.<br />
&nbsp;&nbsp;WA_FIELDCAT-REF_FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZDPJS'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'件数'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZCKLSJ'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'参考零售单价'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
   </div>
   <div class="codeComment">
*------------20160128&nbsp;BY&nbsp;LINAN-------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZLSZJE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'参考零售总金额'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZSPCB'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品成本'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
   </div>
   <div class="codeComment">
*------------------END---------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'TEMPB'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品类型标记'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZFPH'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'分配号'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZJSZBM'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'检测站编码'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZCT1'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'抽屉号1'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZCT2'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'抽屉号2'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EXTWG'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'大类'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EX_PZ01'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'品种一级'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;WA_FIELDCAT.<br />
&nbsp;&nbsp;WA_FIELDCAT-TABNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IT_TABLE'.<br />
&nbsp;&nbsp;WA_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATKL'.<br />
&nbsp;&nbsp;WA_FIELDCAT-SELTEXT_L&nbsp;=&nbsp;'商品类目'.<br />
&nbsp;&nbsp;APPEND&nbsp;WA_FIELDCAT&nbsp;TO&nbsp;IT_FIELDCAT.<br />
<br />
<br />
&nbsp;&nbsp;WA_LAYOUT-COLWIDTH_OPTIMIZE&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"自动适应最大列宽<br />
&nbsp;&nbsp;WA_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"前置零&nbsp;&nbsp;补零<br />
<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'REUSE_ALV_GRID_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PROGRAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-REPID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_FIELDCAT[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_PF_STATUS_SET&nbsp;=&nbsp;'PF_STATUS_SET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_CALLBACK_USER_COMMAND&nbsp;&nbsp;=&nbsp;'USER_COMMAND'<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROGRAM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*制作按钮<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
FORM USER_COMMAND USING R_UCOMM LIKE SY-UCOMM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SELFIELD&nbsp;TYPE&nbsp;SLIS_SELFIELD.<br />
<br />
&nbsp;&nbsp;IF&nbsp;REF_GRID&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'GET_GLOBALS_FROM_SLVC_FULLSCR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_GRID&nbsp;=&nbsp;REF_GRID.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;NOT&nbsp;REF_GRID&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;REF_GRID-&gt;CHECK_CHANGED_DATA&nbsp;.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;R_UCOMM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BIN_OUTPUT'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GEI_OUTPUT.<br />
<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;RS_SELFIELD-REFRESH&nbsp;=&nbsp;'X'.<br />
<br />
ENDFORM.<br />
<br />
FORM PF_STATUS_SET USING P_EXTAB TYPE SLIS_T_EXTAB..<br />
&nbsp;&nbsp;"Set&nbsp;the&nbsp;Button&nbsp;using&nbsp;the&nbsp;staus<br />
&nbsp;&nbsp;"Copy&nbsp;the&nbsp;Standard&nbsp;status&nbsp;from&nbsp;the&nbsp;program&nbsp;SAPLKKBL&nbsp;status<br />
&nbsp;&nbsp;"&nbsp;STANDARD&nbsp;using&nbsp;SE41,&nbsp;and&nbsp;use&nbsp;that&nbsp;here.<br />
&nbsp;&nbsp;"Pf&nbsp;status<br />
&nbsp;&nbsp;SET&nbsp;PF-STATUS&nbsp;'ZMMIF0150_CREAT_PF'.<br />
<br />
ENDFORM.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*下发函数(按钮)<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
FORM GEI_OUTPUT.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_PDITEM&nbsp;LIKE&nbsp;WA_PDITEM&nbsp;OCCURS&nbsp;0.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:&nbsp;LV_ANSWER&nbsp;TYPE&nbsp;CHAR1.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;L_BIANHAO&nbsp;TYPE&nbsp;NUMC2.<br />
<br />
&nbsp;&nbsp;L_BIANHAO&nbsp;=&nbsp;01.<br />
<br />
&nbsp;&nbsp;Z_PDBH&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;SY-DATUM+2(6)&nbsp;&&&nbsp;SY-UZEIT+0(2)&nbsp;.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;WA_PDHEAD.<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*判断是否已经存在<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;IT_PDHEAD1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMIF0150_PDHEAD<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;=&nbsp;S_WERKS-LOW<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;LGORT&nbsp;=&nbsp;S_LGORT-LOW<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;ZDJRQ&nbsp;=&nbsp;SY-DATUM.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;&nbsp;IT_PDHEAD1&nbsp;BY&nbsp;ZPDBH&nbsp;DESCENDING.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_PDHEAD1&nbsp;INTO&nbsp;WA_PDHEAD1&nbsp;INDEX&nbsp;1.<br />
<br />
&nbsp;&nbsp;IF&nbsp;Z_PDBH+0(14)&nbsp;=&nbsp;WA_PDHEAD1-ZPDBH+0(14).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_CONFIRM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_QUESTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'该门店和库存地下在当前日期已生成盘点表,是否继续？'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_BUTTON_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'是'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_BUTTON_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'否'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_BUTTON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'1'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_COLUMN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;25<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_ROW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISPLAY_CANCEL_BUTTON&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSWER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LV_ANSWER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_NOT_FOUND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;LV_ANSWER&nbsp;=&nbsp;'1'.<br />
<br />
<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*正常盘点信息保存及下发<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:L_LINES&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:L_INDEXC(2).<br />
&nbsp;&nbsp;DATA:L_INDEXC3(3).<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;IT_PDHEAD[],<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ZFLAG&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;ZFLAG_XC&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDHEAD.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_PDHEAD&nbsp;INTO&nbsp;WA_PDHEAD&nbsp;INDEX&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZDJRQ&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前日期<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZCJR&nbsp;&nbsp;=&nbsp;SY-UNAME.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前使用人<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZPDBH&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;SY-DATUM+2(6)&nbsp;&&&nbsp;SY-UZEIT+0(2)&nbsp;&&&nbsp;L_BIANHAO.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点编号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZFLAG&nbsp;=&nbsp;ZFLAG_XC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点标记<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;WA_PDHEAD&nbsp;.<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;z_pdbh+0(14)&nbsp;&lt;&gt;&nbsp;wa_pdhead1-zpdbh+0(14).<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_pdhead-zmdkcd&nbsp;=&nbsp;s_werks-low&nbsp;&&&nbsp;s_lgort-low&nbsp;&&&nbsp;'001'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"XULIEHAO<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;zmmif0150_pdhead&nbsp;from&nbsp;wa_pdhead&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;else.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;:&nbsp;l_num1&nbsp;type&nbsp;numc3.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_num1&nbsp;=&nbsp;wa_pdhead1-zmdkcd+8(3).<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_num1&nbsp;=&nbsp;l_num1&nbsp;+&nbsp;1.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_bianhao&nbsp;=&nbsp;wa_pdhead1-zpdbh+16(2).<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_bianhao&nbsp;=&nbsp;l_bianhao&nbsp;+&nbsp;1.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_pdhead-zpdbh&nbsp;=&nbsp;s_werks-low&nbsp;&&&nbsp;s_lgort-low&nbsp;&&&nbsp;sy-datum+2(6)&nbsp;&&&nbsp;sy-uzeit+0(2)&nbsp;&&&nbsp;l_bianhao.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_pdhead-zmdkcd&nbsp;=&nbsp;wa_pdhead1-zmdkcd+0(8)&nbsp;&&&nbsp;l_num1.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modify&nbsp;zmmif0150_pdhead&nbsp;from&nbsp;wa_pdhead&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;endif.<br />
<br />
*盘点单号唯一性<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;IT_PDHEAD1&nbsp;LINES&nbsp;L_LINES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_LINES&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;IT_PDHEAD1&nbsp;BY&nbsp;ZPDBH&nbsp;DESCENDING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_PDHEAD1&nbsp;INTO&nbsp;WA_PDHEAD1&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_INDEXC&nbsp;=&nbsp;WA_PDHEAD1-ZPDBH+16(2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_INDEXC&nbsp;=&nbsp;L_INDEXC&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNPACK&nbsp;L_INDEXC&nbsp;TO&nbsp;L_INDEXC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD1-ZPDBH+16(2)&nbsp;=&nbsp;L_INDEXC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZPDBH&nbsp;=&nbsp;WA_PDHEAD1-ZPDBH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*拆分序列号<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;L_INDEXC3&nbsp;=&nbsp;L_LINES&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;UNPACK&nbsp;L_INDEXC3&nbsp;TO&nbsp;L_INDEXC3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZMDKCD&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;L_INDEXC3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;WA_PDHEAD&nbsp;.<br />
<br />
<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_PDITEM.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_pditem-zpdbh&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;s_werks-low&nbsp;&&&nbsp;s_lgort-low&nbsp;&&&nbsp;sy-datum+2(6)&nbsp;&&&nbsp;sy-uzeit+0(6).<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDBH&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_PDHEAD-ZPDBH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZITEM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-MATNR&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-CHARG&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZBQMC&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZBQMC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZDPJS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZDPJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-MEINS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPTM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPTM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPBM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZCKLSJ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZCKLSJ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-TEMPB&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-TEMPB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZJZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZJZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZZKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZZKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZFPH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZFPH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDYGH&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZPDYGH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPOSITEM&nbsp;=&nbsp;WA_TABLE-ZPOSITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPOSPDSL&nbsp;=&nbsp;WA_TABLE-ZPOSPDSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDCYS&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZPDCYS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-CLABS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZJSZBM&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZJSZBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZCT1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZCT1&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZCT2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZCT2&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;WA_PDITEM&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_PDITEM&nbsp;TO&nbsp;LT_PDITEM.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_PDITEM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;TABLE&nbsp;LT_PDITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'更新失败'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*生成成功<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S001(00)&nbsp;WITH&nbsp;'盘点表'&nbsp;WA_PDHEAD-ZPDBH&nbsp;'生成'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*下发盘点单号<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zmmif0150_idoc_output_01/zmmif0150_idoc_output_01.html">'ZMMIF0150_IDOC_OUTPUT_01'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IM_ZPDBH&nbsp;=&nbsp;WA_PDHEAD-ZPDBH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_WAIT&nbsp;&nbsp;=&nbsp;'X'.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*在途库存盘点信息保存<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ELSEIF&nbsp;&nbsp;ZZT&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;ZFLAG&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-ZZT&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;TRANSPORTING&nbsp;ZZT&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDHEAD.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_PDHEAD&nbsp;INTO&nbsp;WA_PDHEAD&nbsp;INDEX&nbsp;1&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZDJRQ&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前日期<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZCJR&nbsp;&nbsp;=&nbsp;SY-UNAME.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前使用人<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZPDBH&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;SY-DATUM+2(6)&nbsp;&&&nbsp;SY-UZEIT+0(6).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点编号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZFLAG&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点标记<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZZT&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZZT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;WA_PDHEAD&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_PDITEM.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDBH&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;SY-DATUM+2(6)&nbsp;&&&nbsp;SY-UZEIT+0(6).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZITEM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-MATNR&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-CHARG&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZBQMC&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZBQMC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZDPJS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZDPJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-MEINS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPTM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPTM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPBM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZCKLSJ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZCKLSJ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-TEMPB&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-TEMPB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZJZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZJZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZZKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZZKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZFPH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZFPH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDYGH&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZPDYGH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPOSITEM&nbsp;=&nbsp;WA_TABLE-ZPOSITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPOSPDSL&nbsp;=&nbsp;WA_TABLE-ZPOSPDSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDCYS&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZPDCYS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-CLABS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZZTSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-WERKS_SH&nbsp;=&nbsp;WA_TABLE-WERKS_SH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-EBELN&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-EBELN.<br />
<br />
<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;WA_PDITEM&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_PDITEM&nbsp;TO&nbsp;LT_PDITEM.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_PDITEM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;TABLE&nbsp;LT_PDITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'更新失败'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*正常盘点信息保存<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ELSEIF&nbsp;ZFLAG&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;ZFLAG_XC&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE&nbsp;TO&nbsp;IT_PDHEAD.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_PDHEAD&nbsp;INTO&nbsp;WA_PDHEAD&nbsp;INDEX&nbsp;1&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZDJRQ&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前日期<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZCJR&nbsp;&nbsp;=&nbsp;SY-UNAME.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"当前使用人<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZPDBH&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;SY-DATUM+2(6)&nbsp;&&&nbsp;SY-UZEIT+0(6).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点编号<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WA_PDHEAD-ZFLAG&nbsp;=&nbsp;ZFLAG_XC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"盘点标记<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDHEAD&nbsp;FROM&nbsp;WA_PDHEAD&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_TABLE.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LT_PDITEM.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDBH&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S_WERKS-LOW&nbsp;&&&nbsp;S_LGORT-LOW&nbsp;&&&nbsp;SY-DATUM+2(6)&nbsp;&&&nbsp;SY-UZEIT+0(6).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZITEM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-MATNR&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-CHARG&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZBQMC&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZBQMC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZDPJS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZDPJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-MEINS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPTM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPTM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPBM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZCKLSJ&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZCKLSJ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-TEMPB&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-TEMPB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZJZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZJZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZZKZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZZKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZFPH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZFPH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDYGH&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZPDYGH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPOSITEM&nbsp;=&nbsp;WA_TABLE-ZPOSITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPOSPDSL&nbsp;=&nbsp;WA_TABLE-ZPOSPDSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZSPS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZSPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZPDCYS&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZPDCYS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-CLABS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-CLABS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZJSZBM&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZJSZBM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZCT1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZCT1&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_PDITEM-ZCT2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;WA_TABLE-ZCT2&nbsp;&nbsp;.<br />
<br />
<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;WA_PDITEM&nbsp;.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_PDITEM&nbsp;TO&nbsp;LT_PDITEM.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LT_PDITEM&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;ZMMIF0150_PDITEM&nbsp;FROM&nbsp;TABLE&nbsp;LT_PDITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E001(00)&nbsp;WITH&nbsp;'更新失败'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------------------------------------------------------------------<br />
*生成成功<br />
*---------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MESSAGE&nbsp;S000(ZCB)&nbsp;WITH&nbsp;'盘点表'&nbsp;WA_PDHEAD-ZPDBH&nbsp;'生成'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'S'&nbsp;.<br />
<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_INPUT_FIELD_CHECK<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_INPUT_FIELD_CHECK .<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*&nbsp;判断查询条件<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
*&nbsp;&nbsp;IF&nbsp;ZZT&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;AND&nbsp;ZFLAG&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;s001(00)&nbsp;with&nbsp;'POS盘点标记和在途盘点信息只能二选一'&nbsp;display&nbsp;like&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SYS-TYPE&nbsp;=&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SYS-MESSAGE&nbsp;=&nbsp;'POS盘点标记和在途盘点信息只能二选一'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXIT&nbsp;.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;ZZT&nbsp;IS&nbsp;INITIAL&nbsp;AND&nbsp;S_LGORT&nbsp;IS&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;s001(00)&nbsp;with&nbsp;'必须填写库存地点'&nbsp;display&nbsp;like&nbsp;'E'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SYS-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SYS-MESSAGE&nbsp;=&nbsp;'必须填写库存地点'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_MAIN_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_MAIN_DATA .<br />
<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ZFLAG&nbsp;=&nbsp;'X'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_DAT.<br />
&nbsp;&nbsp;ELSEIF&nbsp;ZZT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_DAT1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"在途查询<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_ALV_SHOW<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_ALV_SHOW .<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ZFLAG&nbsp;=&nbsp;'X'&nbsp;&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_SHOW.<br />
&nbsp;&nbsp;ELSEIF&nbsp;ZZT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_SHOW1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"在途ALV<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_SHOW_MESSAGE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_SHOW_MESSAGE .<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;EQ&nbsp;'E'.<br />
&nbsp;&nbsp;MESSAGE&nbsp;SYS-MESSAGE&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_EKPO_INFO<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_EKPO_INFO .<br />
<br />
   </div>
   <div class="codeComment">
*条件如下<br />
*订单类型&nbsp;ZSTO&nbsp;or&nbsp;ZSUB<br />
*elikz&nbsp;=&nbsp;''<br />
*retpo&nbsp;=&nbsp;''<br />
*loekz&nbsp;=&nbsp;''<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;A~EBELN&nbsp;B~EBELP&nbsp;A~RESWK&nbsp;A~BSART&nbsp;A~RESWK&nbsp;AS&nbsp;WERKS&nbsp;B~MATNR&nbsp;&nbsp;B~TXZ01&nbsp;AS&nbsp;MAKTX<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~WERKS&nbsp;AS&nbsp;WERKS_SH<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;EKKO&nbsp;AS&nbsp;A&nbsp;INNER&nbsp;JOIN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EKPO&nbsp;AS&nbsp;B&nbsp;ON&nbsp;A~EBELN&nbsp;=&nbsp;B~EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~RESWK&nbsp;IN&nbsp;S_WERKS&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;BSART&nbsp;=&nbsp;'ZSTO'&nbsp;OR&nbsp;BSART&nbsp;=&nbsp;'ZSUB'&nbsp;)&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~ELIKZ&nbsp;=&nbsp;''&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~RETPO&nbsp;=&nbsp;''&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~LOEKZ&nbsp;=&nbsp;''&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MATNR&nbsp;IN&nbsp;S_MATNR&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;IT_TABLE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SYS-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SYS-MESSAGE&nbsp;=&nbsp;'没有符合数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;WERKS&nbsp;EBELN&nbsp;EBELP&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;WA_EKPO&nbsp;FROM&nbsp;EKPO<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;WA_TABLE-EBELN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EBELP&nbsp;=&nbsp;WA_TABLE-EBELP.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;WA_EKPO&nbsp;TO&nbsp;IT_EKPO.<br />
*<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;BY&nbsp;EBELN&nbsp;EBELP.<br />
*<br />
*&nbsp;&nbsp;SORT&nbsp;IT_EKPO&nbsp;BY&nbsp;EBELN&nbsp;EBELP.<br />
*<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_EKPO&nbsp;INTO&nbsp;WA_EKPO.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_TABLE&nbsp;INTO&nbsp;WA_TABLE&nbsp;WITH&nbsp;KEY&nbsp;EBELN&nbsp;=&nbsp;WA_EKPO-EBELN&nbsp;EBELP&nbsp;=&nbsp;WA_EKPO-EBELP.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LV_INDEX&nbsp;=&nbsp;SY-TABIX.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WA_TABLE-WERKS_SH&nbsp;=&nbsp;WA_EKPO-WERKS.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;IT_TABLE&nbsp;FROM&nbsp;WA_TABLE&nbsp;INDEX&nbsp;LV_INDEX&nbsp;TRANSPORTING&nbsp;WERKS_SH.<br />
*<br />
*&nbsp;&nbsp;ENDLOOP.<br />
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;BY&nbsp;EBELN&nbsp;EBELP.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_EKBE_INFO<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_EKBE_INFO .<br />
<br />
&nbsp;&nbsp;DATA:GT_EKBE&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;EKBE.<br />
&nbsp;&nbsp;DATA:GS_EKBE&nbsp;TYPE&nbsp;EKBE.<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_EKBE<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;EKBE<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;IT_TABLE-EBELN&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;IT_TABLE-EBELP&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;VGABE&nbsp;=&nbsp;'1'&nbsp;OR&nbsp;VGABE&nbsp;=&nbsp;'6'&nbsp;)&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;BEWTP&nbsp;=&nbsp;'E'&nbsp;OR&nbsp;BEWTP&nbsp;=&nbsp;'U'&nbsp;)&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;BWART&nbsp;=&nbsp;'101'&nbsp;OR&nbsp;BWART&nbsp;=&nbsp;'102'&nbsp;OR&nbsp;BWART&nbsp;=&nbsp;'641'&nbsp;OR&nbsp;BWART&nbsp;=&nbsp;'642'&nbsp;OR&nbsp;BWART&nbsp;=&nbsp;'643'&nbsp;OR&nbsp;BWART&nbsp;=&nbsp;'644'&nbsp;).<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_EKBE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SYS-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SYS-MESSAGE&nbsp;=&nbsp;'没有符合数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;GT_EKBE&nbsp;BY&nbsp;EBELN&nbsp;EBELP.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;L_LINE&nbsp;&nbsp;TYPE&nbsp;I,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_EKBE&nbsp;LIKE&nbsp;GT_EKBE.<br />
&nbsp;&nbsp;LT_EKBE&nbsp;=&nbsp;GT_EKBE.<br />
&nbsp;&nbsp;L_LINE&nbsp;=&nbsp;LINES(&nbsp;LT_EKBE&nbsp;).<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;ASSIGNING&nbsp;&lt;FS_TABLE&gt;.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;START**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GT_EKBE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EKBE&nbsp;INTO&nbsp;GS_EKBE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;EBELN&nbsp;=&nbsp;&lt;FS_TABLE&gt;-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;&lt;FS_TABLE&gt;-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_EKBE&nbsp;TO&nbsp;GT_EKBE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_TABIX&nbsp;=&nbsp;L_TABIX&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;L_TABIX&nbsp;&gt;&nbsp;L_LINE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_EKBE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_EKBE&nbsp;INTO&nbsp;GS_EKBE&nbsp;INDEX&nbsp;L_TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_EKBE-EBELN&nbsp;&lt;&gt;&nbsp;&lt;FS_TABLE&gt;-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;GS_EKBE-EBELP&nbsp;&lt;&gt;&nbsp;&lt;FS_TABLE&gt;-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
**********MODIFY&nbsp;BY&nbsp;LIQUAN&nbsp;2015.09.30&nbsp;&nbsp;&nbsp;END**************<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_EKBE&nbsp;INTO&nbsp;GS_EKBE&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;&lt;FS_TABLE&gt;-EBELN&nbsp;AND&nbsp;EBELP&nbsp;=&nbsp;&lt;FS_TABLE&gt;-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;GS_EKBE-BWART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'101'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-BPMNG&nbsp;=&nbsp;&lt;FS_TABLE&gt;-BPMNG&nbsp;+&nbsp;GS_EKBE-BPMNG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'102'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-BPMNG&nbsp;=&nbsp;&lt;FS_TABLE&gt;-BPMNG&nbsp;-&nbsp;GS_EKBE-BPMNG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'641'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;+&nbsp;GS_EKBE-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'642'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;-&nbsp;GS_EKBE-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'643'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;+&nbsp;GS_EKBE-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'644'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;-&nbsp;GS_EKBE-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-CHARG&nbsp;=&nbsp;GS_EKBE-CHARG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-BEWTP&nbsp;=&nbsp;GS_EKBE-BEWTP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-MENGE_ZT&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MENGE&nbsp;-&nbsp;&lt;FS_TABLE&gt;-BPMNG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MENGE_ZT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNPACK&nbsp;&lt;FS_TABLE&gt;-EBELP&nbsp;TO&nbsp;&lt;FS_TABLE&gt;-POSNR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;IT_TABLE&nbsp;WHERE&nbsp;MENGE_ZT&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;IF&nbsp;IT_TABLE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SYS-TYPE&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SYS-MESSAGE&nbsp;=&nbsp;'没有符合数据'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_MODIFY_SCREEN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_MODIFY_SCREEN .<br />
<br />
&nbsp;&nbsp;DATA:L_ACTIVE&nbsp;TYPE&nbsp;SCREEN-ACTIVE.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;ZFLAG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ACTIVE&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;ZZT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L_ACTIVE&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;SCREEN-GROUP1&nbsp;EQ&nbsp;'MO1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;L_ACTIVE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_LGORT_INFO<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_LGORT_INFO .<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;DATA:LT_LIPS&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;LIPS.<br />
&nbsp;&nbsp;DATA:LS_LIPS&nbsp;TYPE&nbsp;LIPS.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;VBELN&nbsp;POSNR&nbsp;LGORT&nbsp;VGBEL&nbsp;VGPOS<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_LIPS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LIPS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;VGBEL&nbsp;=&nbsp;IT_TABLE-EBELN&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VGPOS&nbsp;=&nbsp;IT_TABLE-POSNR&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LGORT&nbsp;IN&nbsp;S_LGORT.<br />
<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_LIPS&nbsp;BY&nbsp;VGBEL&nbsp;VGPOS.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;ASSIGNING&nbsp;&lt;FS_TABLE&gt;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_LIPS&nbsp;INTO&nbsp;LS_LIPS&nbsp;WITH&nbsp;KEY&nbsp;VGBEL&nbsp;=&nbsp;&lt;FS_TABLE&gt;-EBELN&nbsp;VGPOS&nbsp;=&nbsp;&lt;FS_TABLE&gt;-POSNR&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-LGORT&nbsp;=&nbsp;LS_LIPS-LGORT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;IT_TABLE&nbsp;WHERE&nbsp;LGORT&nbsp;IS&nbsp;INITIAL.<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_MARA_INFO<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_MARA_INFO .<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;MATNR&nbsp;TEMPB&nbsp;&nbsp;XCHPF&nbsp;EXTWG&nbsp;MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;IT_TABLE-MATNR.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;MATNR&nbsp;EX_PZ01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_ZMMEX0010_MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMMEX0010_MARA<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;IT_TABLE-MATNR.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;LT_MARA&nbsp;BY&nbsp;MATNR.<br />
&nbsp;&nbsp;SORT&nbsp;GT_ZMMEX0010_MARA&nbsp;BY&nbsp;MATNR.<br />
<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_GET_CHARG_INFO<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_GET_CHARG_INFO .<br />
<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;IS&nbsp;INITIAL.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*取数批次特性<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TABLE[]&nbsp;TO&nbsp;IT_T_CHARG[].<br />
&nbsp;&nbsp;SORT&nbsp;IT_T_CHARG&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_T_CHARG.<br />
<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zsdrp0020_fm_01/zsdrp0020_fm_01.html">'ZSDRP0020_FM_01'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_T_CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_CHARACTERS&nbsp;=&nbsp;IT_T_CHARACTERS.<br />
<br />
<br />
&nbsp;&nbsp;SORT&nbsp;IT_T_CHARACTERS&nbsp;BY&nbsp;MATNR&nbsp;CHARG.<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FRM_INTEGRATION_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FRM_INTEGRATION_DATA .<br />
<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;SYS-TYPE&nbsp;IS&nbsp;INITIAL.<br />
<br />
<br />
&nbsp;&nbsp;DATA:LS_MARA&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;LT_MARA.<br />
&nbsp;&nbsp;DATA:GS_ZMMEX0010_MARA&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GT_ZMMEX0010_MARA.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;ASSIGNING&nbsp;&lt;FS_TABLE&gt;.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*mara<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_MARA&nbsp;INTO&nbsp;LS_MARA&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MATNR&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-TEMPB&nbsp;=&nbsp;LS_MARA-TEMPB.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-XCHPF&nbsp;=&nbsp;LS_MARA-XCHPF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-EXTWG&nbsp;=&nbsp;LS_MARA-EXTWG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;=&nbsp;LS_MARA-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*gt_zmmex0010_mara<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMMEX0010_MARA&nbsp;INTO&nbsp;GS_ZMMEX0010_MARA&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MATNR&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-EX_PZ01&nbsp;=&nbsp;GS_ZMMEX0010_MARA-EX_PZ01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*characters<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_T_CHARACTERS&nbsp;&nbsp;WITH&nbsp;&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MATNR&nbsp;CHARG&nbsp;=&nbsp;&lt;FS_TABLE&gt;-CHARG&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZJZ&nbsp;=&nbsp;IT_T_CHARACTERS-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"取单品克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-XCHPF&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZBQMC&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZBQMC.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"标签名称<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZCKLSJ&nbsp;=&nbsp;IT_T_CHARACTERS-ZCKLSJ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPTM&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZSPTM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品条码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPBM&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZSPBM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品包码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZFPH&nbsp;&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZFPH.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"分配号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZJSZBM&nbsp;=&nbsp;IT_T_CHARACTERS-ZJSZBM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"检测站编码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZCT1&nbsp;&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZCT1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"抽屉号1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZCT2&nbsp;&nbsp;&nbsp;=&nbsp;IT_T_CHARACTERS-ZCT2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"抽屉号2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*G\X的件数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;=&nbsp;'G'&nbsp;AND&nbsp;&lt;FS_TABLE&gt;-TEMPB&nbsp;&lt;&gt;&nbsp;'01'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-ZJZ&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;/&nbsp;&lt;FS_TABLE&gt;-ZJZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;&lt;&gt;&nbsp;'G'&nbsp;AND&nbsp;&lt;FS_TABLE&gt;-TEMPB&nbsp;&lt;&gt;&nbsp;'01'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;.&nbsp;""G\X的件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-ZJZ&nbsp;IS&nbsp;INITIAL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;*&nbsp;&lt;FS_TABLE&gt;-ZJZ.&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*PC\X的件数<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-TEMPB&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PC\X的件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZJZ&nbsp;*&nbsp;&lt;FS_TABLE&gt;-ZZTSL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;&lt;&gt;&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-TEMPB&nbsp;=&nbsp;'01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-ZJZ&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;&lt;FS_TABLE&gt;-ZJZ&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;/&nbsp;&lt;FS_TABLE&gt;-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X的件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G\X时的总克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*不属于批次管理的数值<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-XCHPF&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZBQMC&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MAKTX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-CHARG&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"批次号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZCKLSJ&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"参考零售价<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPTM&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品条码<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPBM&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"商品包码<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;=&nbsp;'G'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZZKZ&nbsp;&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL&nbsp;*&nbsp;&lt;FS_TABLE&gt;-ZJZ.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"总克重<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZDPJS&nbsp;&nbsp;=&nbsp;&lt;FS_TABLE&gt;-ZZTSL.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"件数<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*------------------------------------------------------------------------------------------------------------------------------------<br />
*排序<br />
*------------------------------------------------------------------------------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TABLE&nbsp;BY&nbsp;MATNR.<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&-----------------------------------------------------------------------------------------<br />
*&&nbsp;增加&nbsp;参考零售价,零售总金额,商品成本&nbsp;等字段<br />
*&-----------------------------------------------------------------------------------------<br />
   </div>
   <div class="code">
FORM FM_ADD_CBJE.<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;STRU_MBEW,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"取商品成本类型<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATNR&nbsp;TYPE&nbsp;MBEW-MATNR,&nbsp;&nbsp;&nbsp;"物料号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWKEY&nbsp;TYPE&nbsp;MBEW-BWKEY,&nbsp;&nbsp;&nbsp;"评估范围(地点)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWTAR&nbsp;TYPE&nbsp;MBEW-BWTAR,&nbsp;&nbsp;&nbsp;"评估类型(批次)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALK3&nbsp;TYPE&nbsp;MBEW-SALK3,&nbsp;&nbsp;&nbsp;"成本(如果是单品管理直接取这个)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERPR&nbsp;TYPE&nbsp;MBEW-VERPR,&nbsp;&nbsp;&nbsp;"移动平均价(如果是批次管理商品用这个去算)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;STRU_MBEW.<br />
&nbsp;&nbsp;DATA:&nbsp;IT_TMP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_0010,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TMP1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_0010,<br />
*取参考单价<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_BATCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;ZCB01_TY_T_ZSD_BATCH_PRICE_KEY,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BATCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;IT_BATCH,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_BATCH_PRICE&nbsp;TYPE&nbsp;&nbsp;ZCB01_TY_T_ZSD_BATCH_PRICE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_BATCH_PRICE&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;IT_BATCH_PRICE,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_MBEW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MBEW,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_MBEW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_MBEW<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_MBEW1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;STRU_MBEW,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WA_MBEW1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STRU_MBEW<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;1.&nbsp;取参考零售价,零售总金额<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IT_TMP&nbsp;=&nbsp;IT_TABLE.<br />
&nbsp;&nbsp;DELETE&nbsp;IT_TMP&nbsp;WHERE&nbsp;CHARG&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;WERKS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;IT_TMP&nbsp;TO&nbsp;IT_BATCH.<br />
<br />
&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zg_get_sales_price_itab/zg_get_sales_price_itab.html">'ZG_GET_SALES_PRICE_ITAB'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_BATCH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_BATCH<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ET_BATCH_PRICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;IT_BATCH_PRICE<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRONG_IM_GET_STOCK&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRONG_IRT_WERKS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'查询批次库存是异常：WRONG_IM_GET_STOCK'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ELSEIF&nbsp;SY-SUBRC&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'查询批次库存是异常：WRONG_IRT_WERKS'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ELSEIF&nbsp;SY-SUBRC&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;E000(ZCB)&nbsp;WITH&nbsp;'查询批次库存是异常：OTHERS'&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;2.&nbsp;取商品成本<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;IT_TMP.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TMP1.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IT_TMP&nbsp;&nbsp;=&nbsp;IT_TABLE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;IT_TMP1&nbsp;=&nbsp;IT_TABLE.<br />
*&nbsp;&nbsp;DELETE&nbsp;IT_TMP&nbsp;&nbsp;WHERE&nbsp;TEMPB&nbsp;NE&nbsp;'01'.&nbsp;"筛选一般商品<br />
*&nbsp;&nbsp;DELETE&nbsp;IT_TMP1&nbsp;WHERE&nbsp;TEMPB&nbsp;NE&nbsp;'02'.&nbsp;"筛选批次码商品<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_TMP&nbsp;&nbsp;BY&nbsp;MATNR&nbsp;WERKS&nbsp;CHARG.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;SORT&nbsp;IT_TMP1&nbsp;BY&nbsp;MATNR&nbsp;WERKS&nbsp;CHARG.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_TMP&nbsp;&nbsp;COMPARING&nbsp;MATNR&nbsp;WERKS&nbsp;CHARG.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;IT_TMP1&nbsp;COMPARING&nbsp;MATNR&nbsp;WERKS&nbsp;CHARG.<br />
*&nbsp;取商品成本<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWKEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWTAR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SALK3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VERPR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;MBEW<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;IT_MBEW<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;IT_TMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;EQ&nbsp;IT_TMP-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BWKEY&nbsp;EQ&nbsp;IT_TMP-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BWTAR&nbsp;EQ&nbsp;IT_TMP-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;3.&nbsp;汇总数据<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SORT&nbsp;IT_BATCH_PRICE&nbsp;BY&nbsp;MATNR&nbsp;CHARG&nbsp;WERKS.<br />
&nbsp;&nbsp;SORT&nbsp;IT_MBEW&nbsp;BY&nbsp;MATNR&nbsp;BWKEY&nbsp;BWTAR.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;IT_TABLE&nbsp;ASSIGNING&nbsp;&lt;FS_TABLE&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_BATCH_PRICE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_BATCH_PRICE&nbsp;INTO&nbsp;WA_BATCH_PRICE&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHARG&nbsp;=&nbsp;&lt;FS_TABLE&gt;-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WERKS&nbsp;=&nbsp;&lt;FS_TABLE&gt;-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZCKLSJ&nbsp;=&nbsp;WA_BATCH_PRICE-KBETR_MJJG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZLSZJE&nbsp;=&nbsp;WA_BATCH_PRICE-KBETR_MJJG&nbsp;*&nbsp;&lt;FS_TABLE&gt;-ZDPJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;WA_MBEW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;IT_MBEW&nbsp;INTO&nbsp;WA_MBEW&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;&lt;FS_TABLE&gt;-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWKEY&nbsp;=&nbsp;&lt;FS_TABLE&gt;-WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BWTAR&nbsp;=&nbsp;&lt;FS_TABLE&gt;-CHARG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPCB&nbsp;=&nbsp;WA_MBEW-SALK3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-ZSPCB&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&lt;FS_TABLE&gt;-TEMPB.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'01'.&nbsp;&nbsp;"一般商品<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPCB&nbsp;=&nbsp;WA_MBEW-SALK3.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'02'.&nbsp;&nbsp;"批次码商品<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPCB&nbsp;=&nbsp;WA_MBEW-VERPR&nbsp;*&nbsp;&lt;FS_TABLE&gt;-ZDPJS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;&lt;FS_TABLE&gt;-MEINS&nbsp;=&nbsp;'G'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_TABLE&gt;-ZSPCB&nbsp;=&nbsp;WA_MBEW-VERPR&nbsp;*&nbsp;&lt;FS_TABLE&gt;-ZZKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">www.bjcaibai.com.cn201609</td>
   </tr>
</table>
</body>
</html>
